"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(i,e,n,t){void 0===t&&(t=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&("get"in a?e.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(i,t,a)}:function(i,e,n,t){i[t=void 0===t?n:t]=e[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),__importStar=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(null!=i)for(var n in i)"default"!==n&&Object.prototype.hasOwnProperty.call(i,n)&&__createBinding(e,i,n);return __setModuleDefault(e,i),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Nativize=exports.initNativize=void 0;const electron_1=require("electron"),native_manager_1=require("./native-manager"),ipc=(Object.defineProperty(exports,"Nativize",{enumerable:!0,get:function(){return native_manager_1.Nativize}}),__importStar(require("@base/electron-base-ipc")));let initLimitTimes=5,mainWindow=null;const MainWindowName="MainWindow",isWin32="win32"===process.platform,scale=electron_1.screen.getPrimaryDisplay().scaleFactor;let MainWindowWidth=0,MainWindowHeight=0;const resizeHandle=null;function initMainWindowEvent(){isWin32&&(mainWindow.on("focus",()=>{native_manager_1.Nativize.redraw()}),mainWindow.on("restore",()=>{native_manager_1.Nativize.redraw()}),mainWindow.on("will-resize",(i,e)=>{var n;null!=(n=native_manager_1.Nativize.parentWindow)&&n.setSize(e.width*scale,e.height*scale),mainWindow.setBackgroundColor("#434343")}),mainWindow.on("resized",()=>{mainWindow.setBackgroundColor("#00000000"),native_manager_1.Nativize.redraw()}),mainWindow.on("move",()=>{native_manager_1.Nativize.redraw()}))}function initMainWindow(){var{width:i,height:e}=mainWindow.getBounds();native_manager_1.Nativize.init(mainWindow.getNativeWindowHandle(),i,e),MainWindowWidth=i,MainWindowHeight=e,initMainWindowEvent()}async function initSceneWindow(i){await native_manager_1.Nativize.createWindow(native_manager_1.Nativize.mainWindowRect.w,native_manager_1.Nativize.mainWindowRect.h,MainWindowName,i),native_manager_1.Nativize.resizeWindow(MainWindowName,native_manager_1.Nativize.mainWindowRect)}async function initNativize(i){(mainWindow=i.uuid2win[i.uuids[0]])?(initMainWindow(),ipc.on("native:engine-ready",async(i,e)=>{await initSceneWindow(e)}),ipc.on("editor-lib-windows:scene-resize",(i,e)=>{var n,t;e&&e.width&&(t=mainWindow.getContentSize(),n=isWin32?scale:1,t={x:Math.round(e.left*n),y:Math.round((isWin32?e.top:t[1]-e.bottom)*n),w:Math.round(e.width*n),h:Math.round(e.height*n)},native_manager_1.Nativize.resizeWindow(MainWindowName,t))})):0<initLimitTimes&&setTimeout(()=>{initLimitTimes--,initNativize(i)},1e3)}exports.initNativize=initNativize;