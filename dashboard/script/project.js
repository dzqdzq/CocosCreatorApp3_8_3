"use strict";const existsSync=require("fs")["existsSync"],{readJSONSync,outputJSONSync}=require("fs-extra"),join=require("path")["join"],semver=require("semver"),project=require("@editor/project"),ipc=require("@base/electron-base-ipc"),Dialog=require("@editor/creator/dist/dialog")["Dialog"],{t,errorDialog,chooseProjectPath}=require("./util"),version=require("@editor/setting")["version"];exports.openProject=async function(o){try{if(!(o=o||await chooseProjectPath(t("open_project"))))return!1;if(!existsSync(o))return await Dialog.warn(t("message.project_missing"),{title:t("project_missing"),buttons:[t("cancel")]}),!1;var e=join(o,"package.json"),i=readJSONSync(e);let s=!0;var a=i.creator?.version||i.version;if(a){var c,n=semver.gt(semver.valid(semver.coerce(version)),semver.valid(semver.coerce(a))),v=semver.lt(semver.valid(semver.coerce(version)),semver.valid(semver.coerce(a)));let e="",r="";if(n&&(e=t("message.upgrade_message"),r=t("message.upgrade_detail")),v&&(e=t("message.degrade_message"),r=t("message.degrade_detail")),e&&(r=r.replace("$$projectVersion",i.version).replace("$$editorVersion",version).replace("$$projectPath",o),c=await Dialog.warn(e,{title:t("warn"),detail:r,buttons:[t("confirm"),t("cancel")]}),s=0===c.response),!s)return!1}return i.version=version,outputJSONSync(e,i,{spaces:2}),project.open(o),!0}catch(e){return await errorDialog(t("message.check_version_error",{error:e.message}),o),console.error(e),!1}};