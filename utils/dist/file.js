"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.trashItem=exports.copy=exports.unzip=exports.getName=void 0;const fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),path_1=require("path");function getName(e){if(!(0,fs_extra_1.existsSync)(e))return e;var t=(0,path_1.dirname)(e),r=(0,path_1.extname)(e);let a=(0,path_1.basename)(e,r);for(;/(\d+)$/.test(a)?a=a.replace(/(\d+)$/,(e,t)=>{let r=parseInt(t,10);return(r=(r+=1).toString().padStart(t.length,"0"))+""}):a+="-001",e=(0,path_1.join)(t,a),(0,fs_extra_1.existsSync)(e+r););return e+r}exports.getName=getName;const unzipOfDarwin=function(e,t,r){var a=(0,path_1.dirname)(t),a=((0,fs_extra_1.ensureDirSync)(a),(0,child_process_1.spawn)("unzip",[e,"-d",t]));let n="",s=(a.stderr.on("data",e=>{n+=e}),"");a.stdout.on("data",e=>{s+=e}),a.on("close",e=>{s&&console.log(s),n&&console.warn(n);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})},unzipOfWin32=function(e,t,r){var a=(0,path_1.dirname)(t),a=((0,fs_extra_1.ensureDirSync)(a),(0,child_process_1.spawn)((0,path_1.join)(Editor.App.path,"../tools/unzip.exe"),[e,"-d",t]));let n="",s=(a.stderr.on("data",e=>{n+=e}),"");a.stdout.on("data",e=>{s+=e}),a.on("close",e=>{s&&console.log(s),n&&console.warn(n);let t=null;0!==e&&(t=new Error("The decompression has failed")),r(t)})};async function unzip(e,t,r={}){let a;a="win32"===process.platform?unzipOfWin32:unzipOfDarwin;const n=(0,path_1.join)(Editor.Project.tmpDir,".utils_temp",(0,path_1.basename)(e,".zip"));await(0,fs_extra_1.remove)(n),await new Promise((t,r)=>{a(e,n,e=>{if(e)return r(e);t()})}),r.peel&&1===(r=(0,fs_extra_1.readdirSync)(n)).length?await(0,fs_extra_1.copy)((0,path_1.join)(n,r[0]),t):await(0,fs_extra_1.copy)(n,t),await(0,fs_extra_1.remove)(n)}function copy(e,t){!function e(t,r){if((0,fs_extra_1.existsSync)(t)){var a=(0,fs_extra_1.lstatSync)(t);if(a.isDirectory()){(0,fs_extra_1.ensureDirSync)(r),a.isSymbolicLink()||(0,fs_extra_1.chmodSync)(r,511);for(const n of(0,fs_extra_1.readdirSync)(t))e((0,path_1.join)(t,n),(0,path_1.join)(r,n))}else(0,fs_extra_1.copySync)(t,r),a.isSymbolicLink()||(0,fs_extra_1.chmodSync)(r,511)}}(e,t)}async function trashItem(e){var t;"browser"===process.type?(t=require("electron")["shell"],await t.trashItem(e)):(t=require("@electron/remote")["shell"],await t.trashItem(e))}exports.unzip=unzip,exports.copy=copy,exports.trashItem=trashItem;