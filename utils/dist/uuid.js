"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.nameToSubId=exports.generate=exports.getUuidFromLibPath=exports.isUUID=exports.decompressUUID=exports.compressHex=exports.compressUUID=exports.NonUuidMark=void 0;const crypto_1=require("crypto"),Uuid=require("node-uuid"),Base64KeyChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",AsciiTo64=new Array(128);for(let e=0;e<128;++e)AsciiTo64[e]=0;for(let e=0;e<64;++e)AsciiTo64[Base64KeyChars.charCodeAt(e)]=e;const Reg_Dash=/-/g,Reg_Uuid=/^[0-9a-fA-F-]{36}$/,Reg_NormalizedUuid=/^[0-9a-fA-F]{32}$/,Reg_CompressedUuid=/^[0-9a-zA-Z+/]{22,23}$/,Reg_CompressedSubAssetUuid=/^([0-9a-zA-Z+/]{22,23})((@[0-9a-fA-F]{5,})+)+$/,Reg_subAssetUuid=/([^@]{32,36})((@[0-9a-fA-F]{5,})+)+$/,Reg_UuidInLibPath=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,}((@[0-9a-fA-F]{5,})+)?).*/;function compressUUID(e,s){var r=e.match(Reg_subAssetUuid);return r?compressNormalUuid(e=r[1],s)+r[2]:compressNormalUuid(e,s)}function compressNormalUuid(e,s){if(Reg_Uuid.test(e))e=e.replace(Reg_Dash,"");else if(!Reg_NormalizedUuid.test(e))return e;return compressHex(e,!0===s?2:5)}function compressHex(e,s){var r=e.length;let t;t=void 0!==s?s:r%3;for(var s=e.slice(0,t),o=[];t<r;){var i=parseInt(e[t],16),u=parseInt(e[t+1],16),a=parseInt(e[t+2],16);o.push(Base64KeyChars[i<<2|u>>2]),o.push(Base64KeyChars[(3&u)<<4|a]),t+=3}return s+o.join("")}function decompressUUID(e){var s=e.match(Reg_CompressedSubAssetUuid);return s?decompressNormalUuid(e=s[1])+s[2]:decompressNormalUuid(e)}function decompressNormalUuid(s){if(23===s.length){var r=[];for(let e=5;e<23;e+=2){var t=AsciiTo64[s.charCodeAt(e)],o=AsciiTo64[s.charCodeAt(e+1)];r.push((t>>2).toString(16)),r.push(((3&t)<<2|o>>4).toString(16)),r.push((15&o).toString(16))}s=s.slice(0,5)+r.join("")}else{if(22!==s.length)return s;var i=[];for(let e=2;e<22;e+=2){var u=AsciiTo64[s.charCodeAt(e)],a=AsciiTo64[s.charCodeAt(e+1)];i.push((u>>2).toString(16)),i.push(((3&u)<<2|a>>4).toString(16)),i.push((15&a).toString(16))}s=s.slice(0,2)+i.join("")}return[s.slice(0,8),s.slice(8,12),s.slice(12,16),s.slice(16,20),s.slice(20)].join("-")}function isUUID(e){return Reg_CompressedUuid.test(e)||Reg_NormalizedUuid.test(e)||Reg_Uuid.test(e)||Reg_subAssetUuid.test(e)}function getUuidFromLibPath(e){e=e.match(Reg_UuidInLibPath);return e?encodeURI(e[1]):""}function generate(e=!0){var s=Uuid.v4();return e?compressUUID(s,e):s}exports.NonUuidMark=".",exports.compressUUID=compressUUID,exports.compressHex=compressHex,exports.decompressUUID=decompressUUID,exports.isUUID=isUUID,exports.getUuidFromLibPath=getUuidFromLibPath,exports.generate=generate;const _extendIndex=[1,2,3,4,5,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,26,27,28,29,30];function nameToSubId(e,s=0){var r=(0,crypto_1.createHash)("md5").update(e).digest("hex");let t=r[0]+r[6]+r[16]+r[25]+r[31];for(let e=0;e<s;e++)t+=r[_extendIndex[e]];return t}exports.nameToSubId=nameToSubId;