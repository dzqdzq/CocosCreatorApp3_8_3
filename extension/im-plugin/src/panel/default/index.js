const _0x39ab=["./host-api.js","image","dom-ready","defineProperty","info-title","save-file","silent-check-and-update","panels","get-data","type","get-redirect-url","env","close-panel","ready","channel","request","downloadProgress","dayjs/plugin/utc","canceled","url","style","dayjs","save-image","gif","extend","__esModule","ipcRenderer","percent","download-canceled",":force-close-panel","image-filter-name","block","info-non-logged-in","close","callId","send","electron","default","download-with-progress","file-selected","basename","update-btn","src","filePaths","length","broadcast","select-file","filePath",":get-version","update","getLanguage","addBroadcastListener","./style.css","join","@base/electron-windows/package.json","beforeClose","update-toolbar","getTimezoneOffset","click","select-image","App","dayjs/plugin/timezone","download","path","silent-check","select","download-succeeded","dirname","newMsgCount","preload","transferred","is-ready","release","info","utf8","args","save",":panel-win-state-changed","download-progress","readFileSync","methods","none","total",":close","guess","get-sign-in-url","name","jpeg","png","addEventListener","updateBtn","paths","im-plugin","innerText","template","jpg","removeEventListener","../../common-lib/dialog","Message","push","fileName","refresh","setAttribute","file-filter-name","removeBroadcastListener","get-sign-in-url-failed","I18n","display","assign","webview","#loading-page","#btn-4","isLoggedIn","./node_modules"],_0x5050=(!function(e){for(var a=377;--a;)e.push(e.shift())}(_0x39ab),function(e,a){return e-=426,_0x39ab[e]}),_0x4e8e4a=_0x5050;var __importDefault=this&&this.__importDefault||function(e){var a=_0x5050;return e&&e[a(531)]?e:{default:e}};Object[_0x4e8e4a(509)](exports,"__esModule",{value:!0}),exports[_0x4e8e4a(472)]=exports[_0x4e8e4a(539)]=exports[_0x4e8e4a(447)]=exports[_0x4e8e4a(519)]=exports.$=exports[_0x4e8e4a(526)]=exports[_0x4e8e4a(486)]=void 0;const path_1=__importDefault(require(_0x4e8e4a(455))),fs_1=__importDefault(require("fs")),electron_1=require(_0x4e8e4a(428)),download_1=__importDefault(require(_0x4e8e4a(454))),file_url_1=__importDefault(require("file-url")),translate_1=require("../../common-lib/translate"),dialog_1=require(_0x4e8e4a(489)),namespace_1=require("../../constant/namespace"),os_1=__importDefault(require("os")),pluginVersion=electron_1[_0x4e8e4a(532)].sendSync(namespace_1.ns+_0x4e8e4a(440));var utc=require(_0x4e8e4a(523)),timezone=require(_0x4e8e4a(453)),dayjs=require(_0x4e8e4a(527));dayjs[_0x4e8e4a(530)](utc),dayjs[_0x4e8e4a(530)](timezone),module[_0x4e8e4a(483)][_0x4e8e4a(491)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](Editor.App[_0x4e8e4a(455)],_0x4e8e4a(505)));const element=require("@editor/panel/lib/element"),windowsPkg=require(_0x4e8e4a(446)),ipcFlag=windowsPkg[_0x4e8e4a(478)]+"@"+windowsPkg.version;let forceClose=!1;const template=fs_1[_0x4e8e4a(429)][_0x4e8e4a(471)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](__dirname,"./index.html"),_0x4e8e4a(466)),style=(exports[_0x4e8e4a(486)]=template,fs_1.default[_0x4e8e4a(471)](path_1[_0x4e8e4a(429)][_0x4e8e4a(445)](__dirname,_0x4e8e4a(444)),_0x4e8e4a(466))),selector=(exports[_0x4e8e4a(526)]=style,{webview:"#webview",loadingPage:_0x4e8e4a(502),updateBtn:_0x4e8e4a(503)});exports.$=selector;let action=_0x4e8e4a(493);async function controlUpdateBtn(a){const t=_0x4e8e4a;await Editor[t(490)][t(521)](t(484),t(456))?(a.$.updateBtn[t(526)][t(499)]=t(537),a.$[t(482)][t(485)]=translate_1.tr(t(433))||t(441),a.$[t(482)][t(481)](t(450),async()=>{var e=t;a.$[e(482)][e(526)][e(499)]="none",Editor[e(490)][e(427)]("im-plugin",e(512))})):(a.$[t(482)].style[t(499)]=t(473),a.$[t(482)][t(488)](t(450),()=>{}))}let that=null;async function ready(){const n=_0x4e8e4a;var e;await controlUpdateBtn(that=this),forceClose=!1,Editor.Panel.kitControl,Editor[n(490)][n(443)](namespace_1.ns+n(535),forceClosePanel),await Editor.User[n(504)]()?(this.$[n(501)][n(481)](n(508),()=>{var e=n;Editor[e(490)][e(427)](namespace_1.ns,e(508))}),this.$.webview[n(494)]("webpreferences","contextIsolation=false"),this.$[n(501)][n(494)](n(461),file_url_1.default(path_1.default[n(445)](__dirname,n(506)))),this.$[n(501)][n(481)]("ipc-message",e=>{var a=n;onIpcMessage(e,this.$[a(501)],this.$.loadingPage)}),(e=await Editor.Message[n(521)](namespace_1.ns,n(477)))?(this.$[n(501)][n(434)]=e,this.$[n(501)][n(481)]("new-window",async e=>{var a=n;electron_1.shell.openExternal(await Editor[a(490)][a(521)](namespace_1.ns,a(516),e[a(525)]))}),electron_1[n(532)].on(ipcFlag+n(475),()=>{var e=n;action=e(539)}),electron_1[n(532)].on(namespace_1.ns+n(469),(e,a)=>{var t=n;try{this.$.webview[t(427)](namespace_1.ns+t(469),a)}catch(e){}}),electron_1[n(532)][n(427)](namespace_1.ns+":panel-ready")):(dialog_1[n(465)](translate_1.tr(n(497)),{title:translate_1.tr(n(510))}),Editor[n(490)].broadcast(namespace_1.ns+":force-close-panel"))):(await dialog_1[n(465)](translate_1.tr(n(538)),{title:translate_1.tr(n(510)),buttons:[translate_1.tr("ok")],default:0}),Editor.Message[n(437)](namespace_1.ns+n(535)))}async function beforeClose(e={}){var a=_0x4e8e4a;if(forceClose||e.move||element[a(513)]&&1<element.panels[a(436)])return!0;if("refresh"===action)return!0;action="refresh";try{return!!await Editor[a(490)][a(521)](namespace_1.ns,"whether-close")||(electron_1[a(532)].send(namespace_1.ns+":hide-panel"),!1)}catch(e){return!0}}function close(){var e=_0x4e8e4a;Editor[e(490)][e(496)](namespace_1.ns+e(535),forceClosePanel)}function onIpcMessage(i,l,e){const n=_0x4e8e4a;async function a(e){const t=_0x5050,a=i[t(467)][0][t(515)],n=i[t(467)][0][t(492)];var s="image"===a?{title:translate_1.tr(t(528)),path:n,filters:[{name:translate_1.tr(t(536)),extensions:[t(487),"jpeg",t(480),"gif"]}]}:{title:translate_1.tr(t(511)),path:n,filters:[{name:translate_1.tr(t(495)),extensions:["*"]}]},s=await dialog_1[t(468)](s);if(s[t(439)]){var r=i.args[0].url,o=path_1[t(429)][t(459)](s[t(439)]),r=download_1.default(r,o,{filename:path_1[t(429)][t(432)](s.filePath)});if(e){r.on(t(522),e=>{var a=t;l[a(427)](a(470),{callId:i[a(467)][0].callId,percent:e[a(533)],transferred:e[a(462)],total:e[a(474)]})});try{await r,l[t(427)](t(458),i.args[0].callId)}catch(e){l.send("download-failed",{callId:i.args[0].callId,errorStr:e.toString()})}}}else e&&l.send(t(534),i[t(467)][0][t(426)])}switch(i[n(520)]){case"new-msg":Editor[n(490)][n(427)](namespace_1.ns,n(448),{newMsgCount:i[n(467)][0][n(460)]});break;case n(463):e[n(526)][n(499)]="none";break;case n(454):a(!1);break;case n(438):!async function(){var e,a=n,t=(t=_0x5050,e=t(507)===i[t(467)][0][t(515)]?{title:translate_1.tr(t(451)),filters:[{name:translate_1.tr(t(536)),extensions:[t(487),t(479),t(480),t(529)]}]}:{title:translate_1.tr(t(438)),filters:[{name:translate_1.tr(t(495)),extensions:["*"]}]},await dialog_1[t(457)](e));t[a(524)]?l[a(427)](a(431),""):l[a(427)](a(431),t[a(435)][0])}();break;case n(430):a(!0);break;case"request-data":!async function(){var e=n,a={entry:"plugin",languageType:Editor[e(498)][e(442)](),osTimeZone:"UTC"+(0<=-(new Date)[e(449)]()?"+":"")+-(new Date)[e(449)]()/60+" "+dayjs.tz[e(476)](),dashBoardVersion:process[e(517)].COCOS_DASHBOARD_VERSION,creatorVersion:Editor[e(452)].version,pluginVersion:pluginVersion,osType:os_1[e(429)][e(515)](),osVersion:os_1[e(429)][e(464)]()};l[e(427)](e(514),Object[e(500)]({},a))}()}}function forceClosePanel(){var e=_0x4e8e4a;forceClose=!0,Editor[e(490)][e(427)](namespace_1.ns,e(518))}exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;const methods={async check(){that&&await controlUpdateBtn(that)}};exports[_0x4e8e4a(472)]=methods;