const _0x879a=["city","[Im-plugin] Im-plugin online version is error, ","__setModuleDefault","extensions","getConfig","path","pipe","prototype","User","success","import-package","catch","fromWebContents","hostname","paths","request-progress","im-plugin:check","getRedirectUrl","sender","[im-plugin] Current version is ","platform","download-url","public-ip","push","-error","removeListener","extension","reload","code","./common-lib/update-toolbar","./constant/namespace","log","getDate","Project","getLanguage","[Im-plugin] Download im-plugin zip.","[Im-plugin] Check im-plugin version.","tmpdir","compare-versions","open","show","then","getData","ensureDir","onClosePanel","init","[Im-plugin] No online info of im-plugin.","[Im-plugin] Im-plugin online version has something wrong, don't update.","updateToolbar","Update","queryIPList","unload","[Im-plugin] Remove Succeed.","im-plugin","[Im-plugin] Remove your old im-plugin to ","[Im-plugin] Unzip installation failed .","close","sumErrorTime","progreass","[Im-plugin] The editor does not support automatic updates of versions below 3.3.1.If im-plugin has new version, you need to download it manually from the store.","plugin","call","create","province","returnValue","arch","default","lastErrorTime","getTimezoneOffset","_waitClosedMain","[Im-plugin] Im-plugin zip exists.","enable","has","home","split",":hide-panel","toUTCString","3.3.1","Network","request","methods","electron","Profile","global","__importDefault","error","broadcast"," failed.","App","[Im-plugin] The number of errors reached online on the day, 5 times.","join","./main-lib/service","firstErrorTime","__createBinding","Package","@base/electron-windows","message","data","dashboard","plugin_url","setConfig","getTime","onShowPanel",":get-version","./main-lib/http-utils","remove","cocos_uid","Message","im-plugin.zip","fs-extra","Panel","onHidePanel","__esModule","createWriteStream","assign","country","defineProperty","[Im-plugin] Go back to old version.","dirname","getPackages","[Im-plugin] Go back ok.","im-plugin.IgnoreImVersion","[Im-plugin] Update ","I18n","load","copy","plugin_version","http://k.cocosgame.net:58511","ipcMain","getImSetting","BrowserWindow","nickname","version","secretary","env","im-plugin.callback","[Im-plugin] Im-plugin online version is ","getFullYear","hide","getInstance"],_0x397a=(!function(e){for(var o=472;--o;)e.push(e.shift())}(_0x879a),function(e,o){return e-=184,_0x879a[e]}),_0x468768=_0x397a;var __createBinding=this&&this[_0x468768(226)]||(Object[_0x468768(195)]?function(e,o,n,i){var r=_0x468768;void 0===i&&(i=n),Object[r(249)](e,i,{enumerable:!0,get:function(){return o[n]}})}:function(e,o,n,i){e[i=void 0===i?n:i]=o[n]}),__setModuleDefault=this&&this[_0x468768(275)]||(Object[_0x468768(195)]?function(e,o){var n=_0x468768;Object[n(249)](e,n(199),{enumerable:!0,value:o})}:function(e,o){e[_0x468768(199)]=o}),__importStar=this&&this.__importStar||function(e){var o=_0x468768;if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)"default"!==i&&Object[o(280)].hasOwnProperty[o(194)](e,i)&&__createBinding(n,e,i);return __setModuleDefault(n,e),n},__importDefault=this&&this[_0x468768(217)]||function(e){return e&&e.__esModule?e:{default:e}};Object[_0x468768(249)](exports,_0x468768(245),{value:!0}),exports[_0x468768(184)]=exports[_0x468768(257)]=exports[_0x468768(213)]=void 0;const os_1=__importDefault(require("os")),path_1=__importStar(require(_0x468768(278))),compare_versions_1=__importDefault(require(_0x468768(311))),electron_1=require(_0x468768(214)),service_1=__importDefault(require(_0x468768(224))),namespace_1=require(_0x468768(303)),update_toolbar_1=require(_0x468768(302)),controller_1=__importDefault(require("./main-lib/controller")),fs_1=require("fs"),http_utils_1=require(_0x468768(237)),requestProgress=require(_0x468768(288)),request=require(_0x468768(212)),windows=(module[_0x468768(287)][_0x468768(296)](path_1.default[_0x468768(223)](Editor[_0x468768(221)][_0x468768(278)],"./node_modules")),require(_0x468768(228))),fse=require(_0x468768(242)),publicIpApi=require(_0x468768(295)),controller=controller_1[_0x468768(199)][_0x468768(272)]();let panelWin=null;const reportOptions={url:_0x468768(260),method:"POST",json:!0};function _ip2int(e){return e=e[_0x468768(207)]("."),e=256*Number(e[0])*256*256+256*Number(e[1])*256+256*Number(e[2])+Number(e[3]),e>>>=0}async function commonFields(){var e=_0x468768;let o="",n="",i="",r="",t="",a="";try{(o=await publicIpApi.v4())&&(p=await http_utils_1.postData("https://im.cocos.com/welcome/query",{ip:o}),e(282)==(null==p?void 0:p[e(301)]))&&(n=null==(s=null==p?void 0:p[e(230)])?void 0:s[e(273)],i=null==(l=null==p?void 0:p.data)?void 0:l[e(248)],r=null==(c=null==p?void 0:p[e(230)])?void 0:c[e(196)],a=null==(u=null==p?void 0:p[e(230)])?void 0:u.district,t=i+"-"+r+"-"+n)}catch(e){o=""}var s=process[e(267)],l=(new Date)[e(209)](),c=s[e(231)],p=await Editor[e(221)][e(265)],u=await Editor[e(256)][e(307)](),s=await Editor[e(281)][e(315)]();return{appType:e(266),time:l,dashBoardVersion:c,creatorVersion:p,city:n,country:i,district:a,province:r,address:t,locate:u,userData:s,nickName:s[e(264)],email:s.email,cocos_uid:s[e(239)],ips:await Editor[e(211)][e(323)](),osType:os_1[e(199)].type(),osPlatform:os_1[e(199)][e(293)](),osHostname:os_1[e(199)][e(286)](),osTmpdir:os_1[e(199)][e(310)](),publicIp:o,osArch:os_1.default[e(198)](),currentPjName:Editor[e(306)].name}}async function reportInformation(){var e=_0x468768,o=(new Date)[e(201)]()/60,n=getVersion(),{time:i,dashBoardVersion:r,creatorVersion:t,locate:a,userData:s,city:l,country:c,district:p,province:u,address:d,nickName:m,email:_,cocos_uid:g,ips:f,osType:v,osPlatform:h,osHostname:w,osTmpdir:x,appType:I,osArch:y,publicIp:b,currentPjName:E}=await commonFields(),o={timeZone:o,time:i,dashBoardVersion:r,creatorVersion:t,pluginVersion:n,district:p,locate:a,userData:s,nickName:m,email:_,cocos_uid:g,ips:f,osType:v,osPlatform:h,osHostname:w,osTmpdir:x,appType:I,osArch:y,publicIp:b,city:l,country:c,province:u,address:d,currentPjName:E,entryType:e(193),reportType:"Start"};request(Object[e(247)]({},reportOptions,{body:o}),()=>{})}async function updateReportInformation(e,o,n,i){var r=_0x468768,{time:t,dashBoardVersion:a,creatorVersion:s,locate:l,userData:c,nickName:p,city:u,country:d,province:m,address:_,email:g,appType:f,cocos_uid:v,ips:h,district:w,osType:x,osPlatform:I,osHostname:y,publicIp:b,osTmpdir:E,osArch:V,currentPjName:T}=await commonFields(),t={time:t,preVersion:e,newVersion:o,updateStatus:n,dashBoardVersion:a,creatorVersion:s,publicIp:b,district:w,locate:l,city:u,country:d,province:m,address:_,userData:c,nickName:p,email:g,cocos_uid:v,appType:f,ips:h,osType:x,osPlatform:I,osHostname:y,osTmpdir:E,osArch:V,currentPjName:T,reportType:r(322)};i&&Object[r(247)](t,{errorName:i.name,errorMessage:i[r(229)]}),request(Object[r(247)]({},reportOptions,{body:t}),()=>{})}function load(){var e=_0x468768;electron_1[e(261)].on(namespace_1.ns+e(208),hidePanel),electron_1[e(261)].on(namespace_1.ns+e(236),getVersion_),controller[e(318)](),isVersionMore331()&&silentCheckAndUpdate(),setTimeout(()=>{reportInformation()},1e3)}function unload(){var e=_0x468768;electron_1[e(261)].removeListener(namespace_1.ns+":hide-panel",hidePanel),electron_1[e(261)][e(298)](namespace_1.ns+e(236),getVersion_),controller.uninit()}exports[_0x468768(257)]=load,exports[_0x468768(184)]=unload;let savedInfo=null;const downloadZip=async(i,r)=>{const t=_0x468768;await fse[t(316)](path_1[t(251)](r)),await new Promise((n,o)=>{var e=t;requestProgress(request(i),{delay:300}).on(e(191),function(e){}).on(e(218),function(e){o(e)}).on("end",function(e,o){n(null)})[e(279)](fs_1[e(246)](r))})},formatVersion=e=>e.replace(/\./g,"-"),isVersionMore331=()=>{var e=_0x468768,o=Editor[e(221)].version;return compare_versions_1.default(o,e(210))<=0?(console.warn(e(192)),!1):!(0<=compare_versions_1[e(199)](o,"3.7.0"))},silentCheck=async()=>{var e=_0x468768;if(console.log(e(309)),isVersionMore331()){var o=await(await service_1.default[e(272)]())[e(262)]();if(o&&o[e(259)]&&o[e(232)]){var n=o[e(259)];if(!0===await Editor[e(215)][e(277)](e(254),formatVersion(n),"global"))console[e(304)](e(320));else{var i=await Editor[e(215)].getConfig(e(254),e(200),e(216));if(!((new Date).getTime()-i<6e5)){i=getCurrentErrorTime(),i=await Editor.Profile[e(277)]("im-plugin.IgnoreImVersion",i,e(216));if(parseInt(i)<=0)console[e(304)](e(222));else if(compare_versions_1[e(199)].validate(n)){console[e(304)](e(269)+n+".");i=getVersion();if(console[e(304)]("[Im-plugin] Im-plugin local version is "+i+"."),!(compare_versions_1[e(199)](n,i)<=0))return{imSetting:o,newVersion:n,curVersion:i};console[e(304)]("[Im-plugin] Im-plugin need not update.")}else console[e(304)](e(274)+n+".")}}}else console[e(304)](e(319))}},unZipAndInstall=async(i,r)=>new Promise(async o=>{const n=_0x468768;await Editor[n(240)][n(212)](n(299),n(283),n(216),i,{forceImport:!0})[n(314)](async()=>{var e=n;await fse[e(238)](i),await Editor[e(240)][e(212)](e(299),e(204),r,!0),o(!0)})[n(284)](()=>{o(!1)})}),getCurrentErrorTime=()=>{var e=_0x468768,o=new Date;return o[e(270)]()+"-"+(o.getMonth()+1)+"-"+o[e(305)]()+e(297)},silentCheckAndUpdate=async()=>{const i=_0x468768,o=await silentCheck();if(o){const{imSetting:s,newVersion:l,curVersion:c}=o,p=path_1[i(223)](Editor.App.home,"extension-callback",i(268));await fse[i(316)](p),console[i(304)](i(187)+p);let n=path_1[i(223)](Editor[i(221)][i(206)],i(276),i(186)),e=await Editor[i(227)][i(252)]({name:i(186),enable:!0});e[0]&&(n=e[0][i(278)]);const u=path_1[i(223)](Editor[i(221)].home,i(276),"im-plugin"),d=path_1[i(223)](Editor.App[i(206)],"download",i(241));try{await fse[i(258)](n,p)[i(314)](async()=>{var e=i;console[e(304)](e(185));let o=!0;if(await Editor[e(215)][e(277)]("im-plugin.IgnoreImVersion",e(294),e(216))===s[e(232)])try{await fse.realpath(d),console[e(304)](e(203)),o=!1}catch(e){o=!0}if(await Editor[e(215)][e(233)](e(254),e(294),s[e(232)],"global"),o&&(console[e(304)](e(308)),await downloadZip(s.plugin_url,d)),await Editor[e(243)][e(205)]("default"))console.log("[Im-plugin] You need to update in panel due to you opening it.");else{if(!await unZipAndInstall(d,u))throw new Error(e(188));updateReportInformation(c,l,!0,null)}})}catch(e){updateReportInformation(c,l,!1,e),console.error(i(255)+l+i(220));var r=await Editor[i(215)][i(277)]("im-plugin.IgnoreImVersion",i(225),i(216)),t=(await Editor[i(215)][i(233)](i(254),i(200),(new Date)[i(234)](),"global"),r||await Editor[i(215)].setConfig("im-plugin.IgnoreImVersion",i(225),(new Date).getTime(),i(216)),getCurrentErrorTime()),a=await Editor[i(215)][i(277)]("im-plugin.IgnoreImVersion",t,i(216)),a=(a?await Editor.Profile.setConfig("im-plugin.IgnoreImVersion",t,a-1,i(216)):await Editor[i(215)][i(233)](i(254),t,4,"global"),await Editor[i(215)][i(277)](i(254),"sumErrorTime",i(216))),t=(a?await Editor[i(215)][i(233)](i(254),i(190),a+1,i(216)):await Editor.Profile[i(233)]("im-plugin.IgnoreImVersion",i(190),1,i(216)),2592e6<=(new Date)[i(234)]()-r);(15<=a||t)&&await Editor[i(215)][i(233)](i(254),formatVersion(l),!0,i(216)),console.log(i(250)+c),await fse[i(258)](p,n).then(async()=>{const o=i;console[o(304)](o(253)),await Editor[o(240)][o(212)]("extension",o(300),n).then(()=>{var e=o;fse[e(238)](p),fse.remove(d),console[e(304)]("[Im-plugin] Remove callback folder.")})})}}},methods={showPanel(){var e=_0x468768;console.log(e(292)+getVersion()),panelWin?(panelWin[e(313)](),isVersionMore331()&&Editor[e(240)][e(219)](e(289)),panelWin=null):Editor[e(243)][e(312)](namespace_1.ns),controller[e(235)]()},silentCheckAndUpdate:silentCheckAndUpdate,silentCheck:silentCheck,unZipAndInstall:unZipAndInstall,closePanel(){var e=_0x468768;Editor[e(243)][e(189)](namespace_1.ns),panelWin=null,controller[e(317)]()},whetherClose:()=>windows[_0x468768(202)],getSignInUrl:async()=>(await service_1[_0x468768(199)].getInstance()).getSignInUrl(),getRedirectUrl:async e=>(await service_1[_0x468768(199)][_0x468768(272)]())[_0x468768(290)](e),updateToolbarMain(e,o){var n=_0x468768;update_toolbar_1[n(321)](e,o)},saveToolbarInfo(e){savedInfo=e},getSavedToolbarInfo:()=>savedInfo};function hidePanel(e){var o=_0x468768;(panelWin=electron_1[o(263)][o(285)](e[o(291)]))?(panelWin[o(271)](),controller[o(244)]()):console.error("cannot hide panel, panelWin is undefined")}function getVersion_(e){e[_0x468768(197)]=getVersion()}function getVersion(){var e=_0x468768;return Editor[e(227)][e(252)]({name:namespace_1.ns,enable:!0})[0][e(265)]}exports[_0x468768(213)]=methods;