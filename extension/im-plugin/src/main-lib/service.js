const _0x39fc=["sessionCode","get session failed","requestService","instance","data","getInstance","cleanImSetting","getSessionToken","default","getUserData","then","getImSetting","https://creator-api.cocos.com/api","indexOf","user_licnese","I18n","/service/get_im_setting","/session/token","getSessionCode","User","init","shouldShowEntrance","__esModule","sessionId","isVip","postData","getSignInUrl","getRedirectUrl","getNewMsgCount","session_id","encodeParams","&redirect_url=","show_entrance","defineProperty","remote","sessionToken","sessionChanged","/account/client_signin?session_id=","error","lang=","getLanguage","init failed, cannot get session id"],_0x3479=(!function(e){for(var t=226;--t;)e.push(e.shift())}(_0x39fc),function(e,t){return e-=207,_0x39fc[e]}),_0xe28eab=_0x3479,http_utils_1=(Object[_0xe28eab(225)](exports,_0xe28eab(214),{value:!0}),require("./http-utils")),apiBaseUrl=_0xe28eab(246);class Service{constructor(){var e=_0xe28eab;this[e(215)]=null,this[e(234)]=null,this[e(227)]=null,this.imSetting=null}static async[_0xe28eab(239)](){var e,t=_0xe28eab;return Service[t(237)]&&!await Service[t(237)].sessionChanged()?Service[t(237)]:(await(e=new Service)[t(212)](),Service[t(237)]=e)}async[_0xe28eab(228)](){var e=_0xe28eab;return(await this[e(243)]())[e(221)]!==this[e(215)]}async["getUserData"](){var e=_0xe28eab;let t=null;return t=(t=Editor.User.getData())[e(244)]?t:Editor[e(226)][e(211)].getData()}async[_0xe28eab(212)](){var t=_0xe28eab,e=await this[t(243)]();if(this.sessionId=e.session_id,this[t(215)])try{this[t(234)]=await this.getSessionCode(this[t(215)]),this[t(227)]=await this[t(241)](this.sessionCode)}catch(e){console[t(230)](t(235)),console.error(e)}else console[t(230)](t(233))}async[_0xe28eab(245)](){var e=_0xe28eab;try{var t=await this[e(236)](apiBaseUrl+e(208),{session_token:this[e(227)]});return this.imSetting=t[e(238)],t[e(238)]}catch(e){return null}}[_0xe28eab(240)](){this.imSetting=null}async["getButtonTitle"](){var e=await this.getImSetting();return e?e.button_title:""}async[_0xe28eab(216)](){var e=_0xe28eab,t=await this[e(245)]();return!!t&&!!t[e(248)]}async[_0xe28eab(220)](){var e=_0xe28eab,t=await this[e(245)]();if(!t)return 0;try{var s=await http_utils_1[e(217)](t.msg_api_url);return s[e(238)]?s[e(238)]:0}catch(e){return 0}}async[_0xe28eab(213)](){var e=_0xe28eab,t=await this[e(245)]();return!!t&&!!t[e(224)]}async[_0xe28eab(218)](){var e=_0xe28eab,t=await this.getImSetting();return t?this[e(219)](t.entry_url):null}[_0xe28eab(219)](e){var t=_0xe28eab,e=e+(0<=e[t(247)]("?")?"&":"?")+(t(231)+Editor[t(207)][t(232)]());return apiBaseUrl+t(229)+this[t(215)]+t(223)+encodeURIComponent(e)}async[_0xe28eab(210)](e){var t=_0xe28eab;return(await this[t(236)](apiBaseUrl+"/session/code",{session_id:e}))[t(238)].session_code}async[_0xe28eab(241)](e){var t=_0xe28eab;return(await this.requestService(apiBaseUrl+t(209),{session_code:e})).data.session_token}async[_0xe28eab(236)](e,t){var s=_0xe28eab;return http_utils_1[s(217)](e,http_utils_1[s(222)](t))}}(exports[_0xe28eab(242)]=Service)[_0xe28eab(237)]=null;