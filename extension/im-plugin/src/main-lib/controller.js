const _0x2c14=["getInstance","login","onLanguageChanged","electron","../common-lib/update-toolbar","Package","onUserLogout","dispatchLoggedInState","focus","blur","Message","onHidePanel","../constant/namespace","onLoggedInShouldNotShowState","default","getButtonTitle","message","sender","send",":panel-ready","setMenuVisibility","contributions","removeBroadcastListener","__esModule","bind","panel window is undefined","./service","setPanelBlurred","removeListener","cleanImSetting","cleanUp","__importDefault","apply","onNotLoggedInState","minimize","User","updateToolbar","name","join","onUserLogin","instance","addBroadcastListener","restore","../../resources/images/icon.png","hide","logout","Menu","shouldShowEntrance","uninit","fromWebContents","./new-msg-count-timer","init","i18n:change","isLoggedIn","show","path","ipcMain","onClosePanel","info","onPanelReady"],_0x3206=(!function(e){for(var t=332;--t;)e.push(e.shift())}(_0x2c14),function(e,t){return e-=354,_0x2c14[e]}),_0x41453b=_0x3206;var __importDefault=this&&this[_0x41453b(354)]||function(e){var t=_0x41453b;return e&&e[t(406)]?e:{default:e}};Object.defineProperty(exports,_0x41453b(406),{value:!0});const path_1=__importDefault(require(_0x41453b(378))),electron_1=require(_0x41453b(386)),update_toolbar_1=require(_0x41453b(387)),namespace_1=require(_0x41453b(395)),new_msg_count_timer_1=__importDefault(require(_0x41453b(373))),service_1=__importDefault(require(_0x41453b(409))),newMsgCountTimer=new_msg_count_timer_1[_0x41453b(397)][_0x41453b(383)]();class Controller{constructor(){var e=_0x41453b;this[e(362)]=this.onUserLogin[e(407)](this),this[e(389)]=this[e(389)][e(407)](this),this[e(385)]=this.onLanguageChanged[e(407)](this),this.onPanelReady=this.onPanelReady.bind(this)}static[_0x41453b(383)](){var e=_0x41453b;return this[e(363)]||(this[e(363)]=new Controller),this.instance}async[_0x41453b(374)](){var e=_0x41453b;Editor[e(358)].on(e(384),this[e(362)]),Editor.User.on(e(368),this[e(389)]),Editor[e(393)][e(364)](e(375),this[e(385)]),electron_1[e(379)].on(namespace_1.ns+e(402),this[e(382)]),await Editor[e(358)][e(376)]()?this[e(390)]():(this[e(356)](),setTimeout(()=>{this.setMenuVisibility(!1)},500))}[_0x41453b(371)](){var e=_0x41453b;Editor.User[e(411)](e(384),this[e(362)]),Editor[e(358)][e(411)](e(368),this.onUserLogout),Editor[e(393)][e(405)](e(375),this[e(385)]),electron_1[e(379)][e(411)](namespace_1.ns+e(402),this[e(382)])}["onShowPanel"](){var e=_0x41453b;newMsgCountTimer[e(413)](),update_toolbar_1[e(359)]({newMsgCount:0},!0),update_toolbar_1[e(410)](!1)}[_0x41453b(394)](){var e=_0x41453b;update_toolbar_1[e(410)](!0)}[_0x41453b(380)](){update_toolbar_1.setPanelBlurred(!0)}[_0x41453b(362)](){this[_0x41453b(390)]()}[_0x41453b(389)](){this[_0x41453b(356)]()}async[_0x41453b(385)](){var e=_0x41453b;await Editor.User[e(376)]()&&this[e(390)]()}async[_0x41453b(390)](){var e=_0x41453b,t=await service_1.default[e(383)]();t[e(412)](),await t[e(370)]()?this.onLoggedInShouldShowState():this[e(396)]()}[_0x41453b(356)](){var e=_0x41453b;Editor[e(393)].broadcast(namespace_1.ns+":force-close-panel"),this.setMenuVisibility(!1),update_toolbar_1[e(359)]({showToolbar:!1}),newMsgCountTimer[e(413)]()}async["onLoggedInShouldShowState"](){var e=_0x41453b,t=await service_1[e(397)][e(383)](),n=await t.isVip(),t=await t[e(398)]();this[e(403)](!0),update_toolbar_1.updateToolbar({showToolbar:!0,isVip:n,buttonTitle:t}),newMsgCountTimer.setUp()}[_0x41453b(396)](){this.onNotLoggedInState()}[_0x41453b(382)](n){const o=_0x41453b,e=electron_1.BrowserWindow[o(372)](n[o(400)]);function t(e){var t=o;n[t(400)][t(401)](namespace_1.ns+":panel-win-state-changed",e)}e?(e.on(o(392),t[o(407)](null,o(392))),e.on(o(391),t.bind(null,"focus")),e.on(o(377),t[o(407)](null,"show")),e.on(o(367),t.bind(null,o(367))),e.on("minimize",t[o(407)](null,o(357))),e.on("restore",t[o(407)](null,o(365))),e.on(o(392),()=>{update_toolbar_1.setPanelBlurred(!0)}),e.on(o(391),()=>{var e=o;update_toolbar_1[e(359)]({newMsgCount:0},!0),update_toolbar_1.setPanelBlurred(!1)})):console.error(o(408))}[_0x41453b(403)](e){const t=_0x41453b;var n;const o=Editor[t(388)].getPackages({name:namespace_1.ns}),a=o[o.length-1],i=a[t(360)],s=null==(n=a[t(381)][t(404)])?void 0:n.menu[0];s&&(e?Editor[t(369)].add(s[t(378)],Object.assign(Object.assign({},s),{icon:path_1.default[t(361)](__dirname,t(366)),click:()=>{var e=t;Editor[e(393)][e(401)](i,s[e(399)])}})):Editor[t(369)].remove(s[t(378)],s),Editor.Menu[t(355)]())}}(exports[_0x41453b(397)]=Controller).instance=null;