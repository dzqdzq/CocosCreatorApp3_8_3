"use strict";const _0x22a02a=_0x5723;function _0x4d76(e,t){const a=_0x570f();return(_0x4d76=function(e,t){return e-=146,a[e]})(e,t)}!function(){for(var e=_0x5723,t=_0x4436();;)try{if(390123==-parseInt(e(428))*(parseInt(e(450))/2)+parseInt(e(547))/3+-parseInt(e(426))/4+-parseInt(e(561))/5*(-parseInt(e(557))/6)+parseInt(e(497))/7+-parseInt(e(481))/8*(parseInt(e(422))/9)+parseInt(e(471))/10)break;t.push(t.shift())}catch(e){t.push(t.shift())}}();const _0x2d02d4=_0x4d76;function _0x570f(){const e=_0x5723,t=[e(456),e(511),e(441),e(432),e(430),e(532),e(489),e(467),"Message","all",e(500),e(558),e(454),e(442),e(538),e(562),e(455),"pluginExists",e(503),"default",e(559),"service","openService",e(419),e(514),e(448),e(438),e(530),e(535),e(553),e(534),e(463),e(435),e(545),"147225TxFxDG",e(506),"find",e(485),e(507),e(425),"path","installed",e(533),e(529),e(502),e(444),e(526),e(488),e(427),"service:handle-penetrate-param",e(565),e(519),e(445),"startsWith",e(469),e(560),"delete",e(461),"debug",e(524),"get",e(479),e(464),e(487),e(465),e(563),e(523),e(549),e(470),".prefab",e(501),"size",e(449),"login","package.json",e(483),e(486),e(480),e(498),e(518),e(556),"cocos-service.simple",e(424),"package.json is not found.",e(473),e(516),e(462),e(492),e(554),e(499),e(508),e(540),e(555),"dependency","getServicePluginInfo",e(490),e(468),e(546),e(512),e(520),"node","getProjectPath",e(541),"unload",e(542),"compareVersion",e(443),"UNKNOW",e(437),"scene",e(517),"csProtocol",e(544),e(552),e(537),"info","__esModule","service_name","success",e(446),e(510),"open","requestMsg",e(459),"Panel","sendMsg",e(496),"methods",e(451),e(434),"onServiceStatusChanged",e(436),e(439),"browser.update_tips",e(440),"popup",e(453),e(504),e(460),"userChanged",e(551),e(474),e(493),"readBindGame",e(550),"cloud_json"];return(_0x570f=function(){return t})()}function _0x4436(){const e=["14743YUjIOw","root","csEditor","silence_disable_service","readJSONSync","plugin-msg-service","ensureDir","isLogin","./protocol","close","install.js","ipcMain","1295140pUILjO","message","request","234DVnLqn","fs-extra","plugin-msg","main","info","deleteCache","98400WowCgn","14UiTuoD","then","Panel","36OERBDl","removeListener","dialogMsgBox","185044BDKqLL","default","service_name_error","sender","broadcast","log","package_download_url","values","refresh-asset","existsSync","__importDefault","has","query-uuid","create-node","161990bgdKnZ","6825730jhfLUb","version","defineProperty","asset-db","userChanged","target","../utils","unload","logout","csUtil","1568xweoKU","compareVersion","install","csHttp","User","stringify","require","Project","join","csPlugin","path","getGameDetail","602548jPiFLI","push","browser.update_now","cocos-service","1897504oiimxd","catch","value","csLogger","redirect_url","error","service-","import","./plugin","download_url","getServiceVersion","BrowserWindow","Message","apiPost","3.7.0","../utils/_inner","service","getRedirectUrl","fromWebContents","getCreatorVersion","service_id","popupShow","load","silenceCreateGame","readServiceList","focus","update-extension","64ZGeYOe","browser.cancel","warn","target not exist!","methods","send","assets","cloud-component:update-import","service:userChanged","pluginName","service_component_name","global","scene","name","map","remove","plugin-msg-popup","set","csConfig","requestMsg","broadcastMsg","plugin","enable","223665HPdxlX","copy","cocos-service:popup-show","includes","${name}","wirteEnableService","builder","service_type","cocos-service:service-data-change","config_id","12NefsBC","assets/cloud-component","extension","readServiceParam","959505WaEZzm","getCustomPlugin","cloud-function","shift","registerPluginsI18n","writeBindGame","params","replace","8946MfVIHr","installPlugin","db://assets/cloud-component/","83692JVilay","2895416mwFjHD","app_id"];return(_0x4436=function(){return e})()}!function(){for(var t=_0x5723,e=_0x4d76,a=_0x570f();;)try{if(303493==+parseInt(e(195))+parseInt(e(199))/2+parseInt(e(233))/3*(-parseInt(e(189))/4)+-parseInt(e(187))/5+-parseInt(e(271))/6+-parseInt(e(238))/7*(parseInt(e(258))/8)+-parseInt(e(159))/9*(-parseInt(e(267))/10))break;a[t(494)](a[t(564)]())}catch(e){a[t(494)](a.shift())}}();var __importDefault=this&&this[_0x22a02a(466)]||function(e){return e&&e[_0x4d76(169)]?e:{default:e}};Object[_0x2d02d4(283)](exports,_0x2d02d4(169),{value:!0}),exports[_0x2d02d4(156)]=exports[_0x2d02d4(250)]=exports[_0x2d02d4(180)]=void 0;const electron_1=require("electron"),utils_1=require(_0x22a02a(477)),plugin_1=__importDefault(require(_0x22a02a(505))),protocol_1=__importDefault(require(_0x2d02d4(184))),_inner_1=require(_0x2d02d4(151)),fs_extra_1=require(_0x2d02d4(244)),path_1=require(_0x2d02d4(239));let popupWindows=new Map,firstRun=!0;async function load(){var e=_0x22a02a,t=_0x2d02d4;Editor[t(236)].on(t(272),exports[t(180)][t(192)]),Editor[t(236)].on(t(260),exports[e(528)].userChanged),electron_1[t(185)].on(t(266),exports[e(528)][t(278)]),await plugin_1[e(457)][t(249)]()}function unload(){var e=_0x22a02a,t=_0x2d02d4;Editor[e(485)][t(211)]("login",exports[t(180)][e(475)]),Editor.User[t(211)](t(260),exports[t(180)][t(192)]),electron_1[t(185)][e(454)](e(549),exports[t(180)][e(518)])}function _0x5723(e,t){const a=_0x4436();return(_0x5723=function(e,t){return e-=419,a[e]})(e,t)}exports[_0x2d02d4(180)]={async openServicePanel(e){var t=_0x22a02a,a=_0x2d02d4;await Editor[a(177)][a(206)](a(179))?(await Editor[a(177)][t(522)](a(179)),utils_1[a(203)][a(178)](utils_1[a(203)][t(545)],a(251),a(220),a(248),e)):await Editor.Panel[a(174)](a(179),e)},openPopup(t,e,a){var s,r=_0x22a02a,i=_0x2d02d4;try{popupWindows[i(206)](t)?null!=(s=popupWindows[i(259)](t))&&s[r(522)]():Editor[i(177)][i(174)](i(280),t,e)}catch(e){popupWindows.delete(t)}},closePopup(t){var e,a=_0x2d02d4;try{popupWindows[a(206)](t)&&(null!=(e=popupWindows[a(259)](t))&&e[a(161)](),popupWindows[a(255)](t))}catch(e){popupWindows[a(255)](t)}},printLog(e,t){var a=_0x22a02a,s=_0x2d02d4;a(502)===e&&console[s(243)](t),a(447)===e&&console[s(168)](t),s(256)===e&&console[s(256)](t),s(245)===e&&console.warn(t)},popupShow(e,t){var a=_0x22a02a,s=_0x2d02d4,a=electron_1[s(289)][a(515)](e[s(176)]),e=t[s(241)];null!==a&&e&&popupWindows[s(155)](e,a)},async userChanged(){var e=_0x2d02d4;await Editor[e(177)][e(206)](e(179))&&Editor[e(207)][e(242)](e(179),e(251),e(220),e(204))},apiRequest:async(a,s={})=>"redirect_url"===a?await protocol_1[_0x2d02d4(218)][_0x2d02d4(223)](s[_0x2d02d4(269)]):new Promise((e,t)=>protocol_1[_0x22a02a(457)][_0x2d02d4(173)](a,s)[_0x2d02d4(181)](e)[_0x2d02d4(277)](e=>t(new Error(JSON[_0x2d02d4(275)](e))))),async enableService(t,e,a=""){const s=_0x22a02a,r=_0x2d02d4;t[r(252)](r(217))||(t=r(217)+t);var i=(await utils_1[r(157)][s(521)]())[r(235)](e=>e[r(229)]===t);if(void 0===i)throw new Error(utils_1.csEditor.tr(s(458)));let n=(await utils_1[r(157)][r(196)]()||{app_id:r(160)})[s(427)];if(r(160)===n)try{var o=await(0,_inner_1[r(152)])(),_=(n=o[r(247)],await utils_1[r(157)][r(222)](o),await utils_1[r(157)].readConfigSet());_&&(a=_[r(279)])}catch(e){return e[r(201)]}try{var d=await utils_1[r(164)][r(286)](n);e&&"0"!==i[r(287)]&&!d[r(220)][r(197)](i[r(163)])&&await utils_1[r(164)][r(221)](n,i[r(163)]),await utils_1[r(157)][r(166)](i[r(163)],e,a)[r(277)](utils_1.csLogger[r(257)]),utils_1[r(209)][s(447)](utils_1[r(203)].tr(e?"silence_open_service":s(431))[s(421)](r(193),i[r(170)]))}catch(e){return e[r(201)]}return plugin_1[r(218)][r(216)](t)||await plugin_1[r(218)][s(423)](t,i[r(285)],(e,t)=>{var a=r;t&&utils_1[a(203)].tr(a(240))}),r(171)},pluginMsg:async(e,t,a={})=>_0x22a02a(513)===e&&await Editor[_0x22a02a(452)][_0x2d02d4(206)](_0x22a02a(496))?await utils_1[_0x22a02a(430)][_0x2d02d4(175)](utils_1[_0x22a02a(430)][_0x22a02a(545)],_0x22a02a(433),t,a):_0x2d02d4(188)===e&&0<popupWindows[_0x2d02d4(270)]?await utils_1[_0x2d02d4(203)][_0x22a02a(543)](utils_1[_0x2d02d4(203)][_0x2d02d4(232)],_0x2d02d4(290),t,a):_0x22a02a(527),serviceReady(){firstRun&&(firstRun=!1,setTimeout(async()=>{var e,t=_0x5723,a=_0x4d76;await utils_1[a(203)][a(231)]()&&(e=await utils_1[a(164)][a(214)](),-1===utils_1[a(276)][a(158)](utils_1[a(203)][a(284)](),a(200)))&&1!==utils_1[t(480)][a(158)](e[a(146)],utils_1[t(430)][a(284)]())&&1===utils_1[t(480)][t(482)](e[t(472)],utils_1[a(203)][a(237)]())&&0===await utils_1[t(430)][a(215)](t(447),utils_1[t(430)].tr(a(186)),utils_1[a(203)].tr("dialog_title"),[utils_1[a(203)].tr(t(495)),utils_1[a(203)].tr(t(525))],0)&&(e=await utils_1[t(484)][a(259)](e[a(234)],{}),utils_1[a(209)][a(168)](utils_1[a(203)].tr("browser.updating_tips")),utils_1[a(203)][a(178)](a(219),a(265),e[a(234)],utils_1[a(203)][a(232)],a(227)),Editor[t(452)][a(161)](utils_1.csEditor[a(232)]))},5e3))},async i18nChange(){var e=_0x22a02a,t=_0x2d02d4;utils_1[t(203)][t(165)](t(291)),await Editor[t(177)][t(206)](t(179))&&Editor[e(509)][t(242)](t(179),"plugin-msg",t(220),"service:i18nChange")},async onServiceStatusChanged(e){var t,a=_0x22a02a,s=_0x2d02d4;try{var r,i,n=utils_1[s(148)][s(147)](e[s(229)]);void 0!==n&&null!=(t=n[s(228)])&&t.main&&((r={}).service_id=e[s(163)],r[s(229)]=e.service_component_name,r[s(150)]=e[s(150)]||!1,r[a(420)]=await utils_1[s(157)][s(254)](e[s(163)]),(i=utils_1[s(276)][s(262)](n[a(491)],n[s(228)].main))[s(183)])&&await i[s(183)](utils_1[s(203)][s(154)](),r)}catch(e){utils_1[s(209)][s(257)](e)}},async dropScene(e,s,t){const r=_0x2d02d4;await Promise[r(208)](t[r(213)](async e=>{var t=_0x5723,a=r,e=(await exports[a(180)][a(190)](e[a(288)]),a(281)+e[a(167)]+"/"+e[a(167)]+a(268)),t=await Editor[a(207)][a(212)](t(474),a(149),e);utils_1[a(203)][a(178)](a(162),a(253),{position:s,assetUuid:t})}))},async dropHierarchy(e,t){const r=_0x2d02d4;t=t||e[r(230)],await Promise[r(208)](t[r(213)](async e=>{var t=_0x5723,a=r,s=e[t(476)]||e[a(153)]||e.to,e=(await exports[t(528)][a(190)](e[t(499)]),a(281)+e.name+"/"+e[a(167)]+a(268)),e=await Editor[a(207)][a(212)](a(194),a(149),e);utils_1[a(203)][a(178)](t(536),a(253),{parent:s,assetUuid:e})}))},async dropAssets(e,t){const a=_0x22a02a,s=_0x2d02d4;t=t||e[s(230)],await Promise[s(208)](t[s(213)](async e=>exports[s(180)][s(190)](e[a(499)])))},async import(e){var t=_0x22a02a,a=_0x2d02d4;if((0,fs_extra_1[a(263)])(e)){e={cloud_json:(0,path_1[t(489)])(e,a(273)),assets:(0,path_1[t(489)])(e,"assets"),function:(0,path_1[a(205)])(e,a(264)),install:(0,path_1[a(205)])(e,a(225))};if(!(0,fs_extra_1[a(263)])(e[a(198)]))throw new Error(a(282));var s=(0,fs_extra_1[a(202)])(e[a(198)]),s={root:(0,path_1[a(205)])(Editor[a(246)][a(239)],a(210)),assets:(0,path_1[a(205)])(Editor[a(246)][a(239)],t(558),s[a(167)])};await(0,fs_extra_1[a(182)])(s[t(429)]);try{(0,fs_extra_1[t(465)])(e[a(226)])&&!(0,fs_extra_1[a(263)])(s[a(226)])&&await(0,fs_extra_1[t(548)])(e[a(226)],s[a(226)]),(0,fs_extra_1[a(263)])(e[a(274)])&&(utils_1[t(480)][a(224)](e[t(483)]),await require(e[t(483)])[a(172)]({assetsPath:s[a(226)]}))}catch(e){utils_1[a(209)][a(243)](e),(0,fs_extra_1[a(263)])(s[a(226)])&&await(0,fs_extra_1[t(539)])(s[a(226)])}await Editor[t(509)][a(212)](a(194),a(261),s[t(429)]),Editor[a(207)][a(191)](t(531))}}},exports[_0x2d02d4(250)]=load,exports[_0x22a02a(478)]=unload;