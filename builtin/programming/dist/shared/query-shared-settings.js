"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.querySharedSettings=void 0;const fs_extra_1=__importDefault(require("fs-extra")),url_1=require("url");async function querySharedSettings(r){var[e,t,o,i,s,l,n]=await Promise.all([Editor.Profile.getProject("project","script.useDefineForClassFields"),Editor.Profile.getProject("project","script.allowDeclareFields"),Editor.Profile.getProject("project","script.loose"),!1,Editor.Profile.getProject("project","script.exportsConditions"),Editor.Profile.getProject("project","script.importMap"),Editor.Profile.getProject("project","script.preserveSymlinks")]);let a;if(l)try{var p=Editor.UI.__protected__.File.resolveToRaw(l),u=await fs_extra_1.default.readJson(p,{encoding:"utf8"});verifyImportMapJson(u)?a={json:u,url:(0,url_1.pathToFileURL)(p).href}:r.error("Ill-formed import map.")}catch(e){r.error(`Failed to load import map at ${l}: `+e)}return{useDefineForClassFields:null==e||e,allowDeclareFields:null==t||t,loose:null!=o&&o,exportsConditions:null!=s?s:[],guessCommonJsExports:null!=i&&i,importMap:a,preserveSymlinks:null!=n&&n}}function verifyImportMapJson(e){if("object"!=typeof e||!e)return!1;var r=e=>{if("object"!=typeof e||!e)return!1;for(const r of Object.values(e))if("string"!=typeof r)return!1;return!0};if("imports"in e&&!r(e.imports))return!1;if("scopes"in e)for(const t of Object.values(e))if(!r(t))return!1;return!0}exports.querySharedSettings=querySharedSettings;