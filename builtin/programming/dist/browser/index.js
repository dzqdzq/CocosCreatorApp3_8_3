"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const browser_1=require("../worker/browser"),intelligence_1=require("../intelligence"),query_shared_settings_1=require("../shared/query-shared-settings");async function load(){Editor.Message.__protected__.addBroadcastListener("asset-db:ready",regenerateCommonTsConfig),Editor.Message.__protected__.addBroadcastListener("asset-db:db-ready",regenerateCommonTsConfig),Editor.Message.__protected__.addBroadcastListener("asset-db:db-close",regenerateCommonTsConfig),await(0,browser_1.load)()}async function unload(){Editor.Message.__protected__.removeBroadcastListener("asset-db:ready",regenerateCommonTsConfig),Editor.Message.__protected__.removeBroadcastListener("asset-db:db-ready",regenerateCommonTsConfig),Editor.Message.__protected__.removeBroadcastListener("asset-db:db-close",regenerateCommonTsConfig)}async function regenerateCommonTsConfig(){await(0,intelligence_1.generateCommonTsConfig)()}exports.methods=Object.assign(Object.assign({},browser_1.methods),{async"query-shared-settings"(){return(0,query_shared_settings_1.querySharedSettings)(console)},async"custom-macro-changed"(){await(0,intelligence_1.updateCustomMacro)()},async querySortedPlugins(e={}){const a=await Editor.Message.request("asset-db","query-assets",{ccType:"cc.Script",userData:Object.assign(Object.assign({},e),{isPlugin:!0})});a.sort((e,r)=>e.name.localeCompare(r.name));e=await Editor.Profile.getProject("project","script.sortingPlugin");return Array.isArray(e)&&e.length&&Array.from(e).reverse().reduce((e,r,s)=>{var t,o=a.findIndex(e=>e.uuid===r);return e<o?(t=a.splice(o,1),a.splice(e,0,t[0]),e):o},a.length),a.map(e=>({uuid:e.uuid,file:e.library[".js"],url:e.url}))}}),exports.load=load,exports.unload=unload;