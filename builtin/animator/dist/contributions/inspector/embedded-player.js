"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("../../panel/utils"),Vue=require("vue/dist/vue.js");let panel=null,vm=null;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/embedded-player.html"),"utf8"),EmbeddedPlayerVM=Vue.extend({name:"EmbeddedPlayerVM",data(){return{embeddedPlayer:null,selectInfo:{root:"",clipUuid:""},nodeFilterOptions:{pathPattern:""}}},computed:{typeInfo(){if(this.embeddedPlayer&&this.embeddedPlayer.playable)return utils_1.EmbeddedPlayerMenuMap[this.embeddedPlayer.playable.type]},defaultDisplayName(){return this.embeddedPlayer?this.embeddedPlayer.displayName||(this.embeddedPlayer.playable?.path?(0,path_1.basename)(this.embeddedPlayer.playable.path):""):""}},methods:{onSelectNode(e){e=e.target;Editor.Panel.__protected__.openKit("ui-kit.searcher",{elem:e,params:[{type:"node",droppable:"cc.Node",filterOptions:this.nodeFilterOptions}],listeners:{confirm:e=>{e&&this.onNodeConfirm(e.info.path)},change:e=>{e&&this.onNodeConfirm(e.info.path)},cancel:e=>{e&&this.onNodeConfirm(e.info.path)}}})},onNodeConfirm(e){e&&this.embeddedPlayer?.playable&&(e={...this.embeddedPlayer,playable:{...this.embeddedPlayer.playable,path:e.replace(this.selectInfo.root,"")}},this.updateEmbeddedPlayer(e),this.embeddedPlayer=e)},onAssetConfirm(e){this.embeddedPlayer?.playable&&(e={...this.embeddedPlayer,playable:{...this.embeddedPlayer.playable,clip:e}},this.updateEmbeddedPlayer(e),this.embeddedPlayer=e)},onDisplayNameConfirm(e){this.embeddedPlayer&&(e={...this.embeddedPlayer,displayName:e},this.updateEmbeddedPlayer(e),this.embeddedPlayer=e)},updateEmbeddedPlayer(e){Editor.Message.request("scene","animation-operation",[{funcName:"updateEmbeddedPlayer",args:[this.selectInfo.clipUuid,this.embeddedPlayer,e]}])},onReconciledSpeed(e){this.embeddedPlayer&&(this.embeddedPlayer.reconciledSpeed=e,this.updateEmbeddedPlayer(this.embeddedPlayer))}},template:vueTemplate});function update(e){if(vm)try{var d=e.map(e=>JSON.parse(e))[0];vm.nodeFilterOptions.pathPattern=d.root+"/**",vm.$set(vm,"embeddedPlayer",d.dump),vm.$set(vm,"selectInfo",d)}catch(e){console.error(e)}}function ready(){panel=this,vm?.$destroy(),(vm=new EmbeddedPlayerVM).$mount(panel.$.container)}function close(){vm?.$destroy(),vm=null,panel=null}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/embedded-player.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"},exports.update=update,exports.ready=ready,exports.close=close;