"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.components=exports.methods=exports.watch=exports.computed=exports.setup=exports.data=exports.directives=void 0;const vue_js_1=__importStar(require("vue/dist/vue.js")),animation_ctrl_1=require("../share/animation-ctrl"),ipc_event_1=require("../share/ipc-event"),utils_1=require("./../utils"),grid_ctrl_1=require("../share/grid-ctrl"),global_data_1=require("../share/global-data"),animation_editor_1=require("../share/animation-editor"),hooks_1=require("./hooks"),directives_1=require("./directives"),components_1=require("./components"),bezier_presets_1=require("../share/bezier-presets"),changeFailedClips=[],data=(exports.directives=(0,directives_1.adaptDirectives)({set:directives_1.PropSet}),function(){return{loading:"wait_scene_ready",toast:{message:""},currentFrame:0,root:"",selectedId:"",selectedIds:new Set,selectPath:"",moveNodePath:"",selectProperty:null,nodeDump:null,eventsDump:null,clipsMenu:[],selectKeyInfo:null,selectEventInfo:null,selectEmbeddedPlayerInfo:null,aniCompType:null,animationMode:!1,animationState:"stop",editEventFrame:0,maskPanel:"",selectDataChange:0,nodesHeight:0,nodeScrollInfo:null,propertyScrollInfo:null,embeddedPlayerScrollInfo:null,moveInfo:null,boxInfo:null,boxStyle:null,boxData:null,previewPointer:null,propertiesMenu:null,properties:null,updateKeyFrame:0,updatePosition:0,updateSelectKey:1,updateSelectNode:1,scrolling:!1,expandInfo:{},layout:{topPec:25,centerPec:30,auxCurvePec:15,leftPec:30,_totalPec:100,__version__:"1.0.1"},leftResizeMoving:!1,expandLayout:{embeddedPlayer:!1,node:!0,property:!0,auxiliaryCurve:!1},enableEmbeddedPlayer:!0,filterInvalid:!1,filterName:"",active:!0,wrapModeList:[],showAnimCurve:!1,showAnimEmbeddedPlayer:!0,lightCurve:null,hasSelectedCurveClip:!1,curveDisabledCCtypes:animation_editor_1.animationEditor.curveDisabledCCtypes,presetSize:110,expandTab:"",searchPresetName:"",timeInfos:[],showType:"frame",embeddedPlayerGroups:[],showUseBakedAnimationWarn:!1,useBakedAnimationWarnTip:null,currentSceneMode:"preview"}}),setup=(exports.data=data,(e,t)=>{var r=(0,hooks_1.useBaseStore)(),i=(0,hooks_1.useGridStore)(),o=(0,hooks_1.useI18n)()["t"];const a=(0,vue_js_1.toRef)(r,"isSkeletonClip"),n=(0,vue_js_1.toRef)(i,"offset"),s=(0,vue_js_1.toRef)(i,"scale");var i=(0,vue_js_1.toRef)(r,"clipConfig"),l=(0,vue_js_1.toRef)(r,"currentClip"),r=(0,vue_js_1.toRef)(r,"focusedCurve"),d=(0,vue_js_1.ref)(),p=(0,vue_js_1.ref)(),c=(0,vue_js_1.ref)();const u=(0,vue_js_1.ref)();var m=(0,vue_js_1.ref)();const _=(0,hooks_1.useAuxCurveStore)();var f=(0,hooks_1.useTransformEvent)(),h=(f.onUpdate(e=>{grid_ctrl_1.gridCtrl.grid&&(n.value=grid_ctrl_1.gridCtrl.grid.xAxisOffset,s.value=grid_ctrl_1.gridCtrl.grid.xAxisScale),"property"!==e&&u.value&&u.value.curveCtrl&&grid_ctrl_1.gridCtrl.grid&&(0,grid_ctrl_1.syncAxisX)(grid_ctrl_1.gridCtrl.grid,u.value.curveCtrl.grid),grid_ctrl_1.gridCtrl.grid?.render(),animation_editor_1.animationEditor.updatePositionInfo(),u.value?.repaint(),animation_editor_1.animationEditor.renderTimeAxis()}),(0,vue_js_1.computed)(()=>_.enabled&&a.value));const y=(0,vue_js_1.ref)({});return{t:o,auxCurveStore:_,currentClip:l,clipConfig:i,isSkeletonClip:a,offset:n,scale:s,curve:u,auxCurve:m,gridCanvas:c,chart:d,right:p,focusedCurve:r,toPercent:e=>e+"%",transformEvent:f,enableAuxCurve:h,updateAuxCurveEnableState:async()=>{await _.updateEnableState()},onAddEmbeddedPlayer:e=>{const t="string"==typeof e.group&&e.group?e.group:"";""!==t&&vue_js_1.default.set(y.value,t,e),animation_editor_1.animationEditor.addEmbeddedPlayer(e).finally(()=>{""!==t&&vue_js_1.default.delete(y.value,t)})},isEmbeddedPlayerAdding:e=>{return void 0!==(0,vue_js_1.unref)(y)[e]}}}),vComputed=(exports.setup=setup,{displayLayout(){const t=this;if(!Object.keys(t.expandLayout).filter(e=>!t.expandLayout[e]).length)return t.layout;const r={...t.layout};var e=["topPec","centerPec","auxCurvePec"],i=animation_editor_1.animationEditor.layoutConfig.totalPec;if(t.expandLayout.embeddedPlayer||(r.topPec=0,e.splice(e.findIndex(e=>"topPec"===e),1)),t.expandLayout.node||(r.centerPec=0,e.splice(e.findIndex(e=>"centerPec"===e),1)),t.expandLayout.auxiliaryCurve||(r.auxCurvePec=0,e.splice(e.findIndex(e=>"auxCurvePec"===e),1)),!t.expandLayout.property){i=i-(r.topPec+r.centerPec+r.auxCurvePec);if(0<e.length&&0<i){const o=i/e.length;e.forEach(e=>{r[e]+=o})}}return r},currentTime(){return(0,utils_1.transFrameByType)(this.currentFrame,this.showType,this.sample)},displayPropertiesMenu(){var e;return this.propertiesMenu?(e=(0,utils_1.sortPropertyMenu)(this.propertiesMenu,this.properties??{}),animation_editor_1.animationEditor.calcCreatePropMenu(e)):[]},selectPropertyRenderDump(){var e,t=this;return t.selectProperty&&t.selectProperty.dump?((e=JSON.parse(JSON.stringify(t.selectProperty.dump))).extends&&e.extends.includes("cc.Asset")&&(e.type===e.extends[0]||e.extends[0].startsWith("cc.")||(e.type=e.extends[0],t.selectProperty.dump.type=e.extends[0])),e.readonly=t.clipConfig&&t.clipConfig.isLock||t.selectProperty.missing,JSON.stringify(e)):null},presetArr(){const t=this;return t.searchPresetName?bezier_presets_1.defaultBezier.value.filter(e=>new RegExp(t.searchPresetName,"i").test(e.name)):bezier_presets_1.defaultBezier.value},lock(){return Boolean(!this.clipConfig||this.clipConfig.isLock||this.maskPanel||!this.animationMode)},selectPropData(){var e,t;return animation_ctrl_1.animationCtrl.clipsDump&&this.selectProperty?({prop:e,nodePath:t}=this.selectProperty,animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t]&&animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t][e]):null},computeSelectPath(){var e=this;if(!e.updateSelectNode)return"";if(e.selectPath)return e.selectPath;let t="";return t=e.selectedId&&e.nodeDump?animation_ctrl_1.animationCtrl.nodesDump.uuid2path[e.selectedId]:t},sample(){let e=60;return this.clipConfig&&(e=this.clipConfig.sample),animation_editor_1.animationEditor.updateSample(e),e},lastFrameInfo(){let e=0;this.clipConfig&&this.clipConfig.duration&&(e=(0,utils_1.timeToFrame)(this.clipConfig.duration,this.sample));var t=grid_ctrl_1.gridCtrl.frameToCanvas(e);return{frame:e,x:t}},propertyHeight(){const t=this;if(!t.properties)return 0;let r=0;return Object.keys(t.properties).forEach(e=>{t.properties[e].hidden||(r+=animation_editor_1.animationEditor.LINE_HEIGHT)}),r},stickInfo(){const r=this;if(!r.properties||!r.selectKeyInfo||!r.selectKeyInfo.keyFrames||r.selectKeyInfo.keyFrames.length<2||!r.updateSelectKey||!r.updatePosition||!r.propertyScrollInfo)return animation_editor_1.animationEditor.hasShowStick=!1,null;const i=[],o=[],a=[];return r.selectKeyInfo.keyFrames.forEach((e,t)=>{r.computeSelectPath&&r.selectKeyInfo.keyFrames[t]&&r.selectKeyInfo.keyFrames[t].nodePath!==r.computeSelectPath||(i.push(e.x||0),r.properties[e.prop]&&o.push(r.properties[e.prop].top),a.push(e.frame))}),a.sort((e,t)=>e-t),animation_editor_1.animationEditor.stickInfo.leftFrame=a[0],animation_editor_1.animationEditor.stickInfo.rightFrame=a[a.length-1],i.sort((e,t)=>e-t),o.sort((e,t)=>e-t),i[i.length-1]===i[0]?(animation_editor_1.animationEditor.hasShowStick=!1,null):(animation_editor_1.animationEditor.stickInfo.width=i[i.length-1]-i[0]+18,animation_editor_1.animationEditor.stickInfo.height=o[o.length-1]-o[0]+animation_editor_1.animationEditor.LINE_HEIGHT,animation_editor_1.animationEditor.stickInfo.left=i[0]+grid_ctrl_1.gridCtrl.grid.xAxisOffset-10,animation_editor_1.animationEditor.stickInfo.top=o[0]-r.propertyScrollInfo.top,animation_editor_1.animationEditor.hasShowStick=!0,JSON.parse(JSON.stringify(animation_editor_1.animationEditor.stickInfo)))},curveData(){var e=this;if(!e.selectProperty||!e.showAnimCurve||!e.properties)return animation_editor_1.animationEditor.repaintCurve(null),null;var t=animation_ctrl_1.animationCtrl.clipsDump?.pathsDump[e.selectProperty.nodePath];if(!t)return null;var r=t[e.selectProperty.prop];if(!(r&&r.isCurveSupport&&r.type&&e.properties[e.selectProperty.prop]))return animation_editor_1.animationEditor.repaintCurve(null),null;if(r.type&&animation_editor_1.animationEditor.curveDisabledCCtypes.includes(r.type.value))return animation_editor_1.animationEditor.repaintCurve(null),null;var i={curveInfos:{},wrapMode:e.clipConfig.wrapMode,duration:e.clipConfig.duration*e.clipConfig.sample};let o=!1;if(r.partKeys)for(const n of r.partKeys){var a=t[n];i.curveInfos[n]={keys:a.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:a.preExtrap,postWrapMode:a.postExtrap,color:e.properties[n].color},o=!(!o&&!i.curveInfos[n].keys.find(e=>e.easingMethod))}else i.curveInfos={[e.selectProperty.prop]:{keys:r.keyFrames.map(e=>e.curve).filter(e=>!!e),preWrapMode:r.preExtrap,postWrapMode:r.postExtrap,color:e.properties[e.selectProperty.prop].color}},o=!(!o&&!i.curveInfos[e.selectProperty.prop].keys.find(e=>e.easingMethod));return animation_editor_1.animationEditor.checkCurveDataDirty(i)&&animation_editor_1.animationEditor.repaintCurve(i),{...i,hasUserEasingMethod:o}},curveStyle(){return this.showAnimCurve&&this.computeSelectPath?{width:"100%",height:"100%"}:{display:"none"}},stickBoxStyle(){var e=this;return e.stickInfo?{width:e.stickInfo.width+"px",height:e.stickInfo.height+"px",top:e.stickInfo.top+"px",left:e.stickInfo.left+"px"}:null},currentKeyEmptyInfo(){const r=this;if(!animation_ctrl_1.animationCtrl.clipsDump||!r.properties)return{};const i={},o=animation_ctrl_1.animationCtrl.clipsDump.pathsDump[r.computeSelectPath];return o&&Object.keys(r.properties).forEach(e=>{var t;o[e]&&(t=o[e].keyFrames,i[e]=!t.find(e=>e.frame===r.currentFrame))}),i},nodeTitle(){return this.filterInvalid?"i18n:animator.node.nodeHasAnimation":"i18n:animator.node.title"}});async function mounted(){var e=this,t=(animation_ctrl_1.animationCtrl.init(e),animation_editor_1.animationEditor.init(e),global_data_1.Flags.sceneReady=await Editor.Message.request("scene","query-is-ready"),global_data_1.Flags.sceneReady&&await animation_editor_1.animationEditor.debounceRefresh(),e.wrapModeList=await Editor.Message.request("scene","query-enum-list-with-path","AnimationClip.WrapMode"),e.wrapModeList?.forEach(e=>{e.tip=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.tip`)||e.name,e.name=Editor.I18n.t(`animator.animationCurve.WrapMode.${e.name}.label`)||e.name}),await animation_editor_1.animationEditor.getConfig("layout"));t&&"object"==typeof t&&(t.topPec||(t.topPec=t.top&&t.top/e.$refs.container.offsetHeight*100||25,t.leftPec=t.left&&t.left/e.$refs.container.offsetWidth*100||30),"string"==typeof t.topPec&&(t.topPec=Number(t.topPec.replace("%",""))||25),"string"==typeof t.leftPec&&(t.leftPec=Number(t.leftPec.replace("%",""))||30),t.centerPec=t.centerPec??30,Object.assign(e.layout,t)),e.expandLayout=Object.assign(e.expandLayout,await animation_editor_1.animationEditor.getConfig("expandLayout")||{}),await e.updateEnableEmbeddedPlayer(),await e.updateAuxCurveEnableState(),e.selectedIds=new Set(Editor.Selection.getSelected("node")),e.selectedId=Editor.Selection.getLastSelected("node"),e.currentSceneMode=await(0,ipc_event_1.IquerySceneMode)()}exports.computed=vComputed,exports.watch={async selectedId(e,t){var r=this;const i=r.computeSelectPath;if((r.selectKeyInfo&&r.selectKeyInfo.keyFrames.find(e=>e.nodePath!==i)&&(r.selectKeyInfo=null),!e&&animation_ctrl_1.animationCtrl.nodesDump)&&(animation_ctrl_1.animationCtrl.nodesDump.uuid2path[t]!==i&&i))return;r.updateSelectNode=-r.updateSelectNode,await animation_editor_1.animationEditor.updateSelectedId(),r.properties&&(r.selectProperty&&r.selectProperty.nodePath!==i||!r.selectProperty)?(e=Object.keys(r.properties)[0],animation_editor_1.animationEditor.updateSelectProperty({nodePath:i,prop:e,missing:r.properties[e].missing,clipUuid:animation_ctrl_1.animationCtrl.clipsDump.uuid,isCurveSupport:r.properties[e].isCurveSupport})):r.selectProperty=null},selectKeyInfo(){this.showAnimCurve?animation_editor_1.animationEditor.selectKeyUpdateFlag&&animation_editor_1.animationEditor.updateCurveSelecteKeys():animation_editor_1.animationEditor.selectKeyUpdateFlag=!0},root(){this.filterInvalid=!1,this.filterName="",this.nodesHeight=0},async currentClip(e,t){var r,i=this;e!==t&&e&&(await(0,ipc_event_1.IsetEditClip)(e)?(i.selectEventInfo=null,r=await(i.selectKeyInfo=null,ipc_event_1.IqueryPlayingClipTime)(i.currentClip),r=(0,utils_1.timeToFrame)(r,i.sample),animation_editor_1.animationEditor.setCurrentFrame(r)):(changeFailedClips.push(e),console.warn("Set edit clip failed!"+e),changeFailedClips.includes(t)?i.currentClip="":i.currentClip=t))},layout:{deep:!0,handler(){(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.resize()})}},currentFrame(){this.calcSelectProperty(null,!0)},boxData(){const i=this;if(i.boxData&&animation_ctrl_1.animationCtrl.clipsDump){const{origin:o,h:a,w:n,type:t}=i.boxData;if("property"!==t||i.properties){var e=i.boxInfo?.rawKeyFrames;const s=e||[],l=("node"===t?i.nodeScrollInfo:i.propertyScrollInfo).top,d=e?function(t){s.find(e=>e.rawFrame===t.rawFrame&&e.prop===t.prop&&e.nodePath==e.nodePath)||s.push(t)}:e=>s.push(e);function r(e,t){Object.values(e).forEach(r=>{var e=r.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-l;!t&&(e<o.y||e>o.y+a)||r.keyFrames.forEach(e=>{var t=e.x+i.offset;t>o.x&&t<o.x+n&&(t={frame:e.frame,rawFrame:e.frame,nodePath:r.nodePath,x:e.x,prop:r.prop},d({...t,key:(0,utils_1.calcKeyFrameKey)(t)}))})})}"node"===t?Object.keys(animation_ctrl_1.animationCtrl.clipsDump.pathsDump).forEach(t=>{var e=i.nodeDump.find(e=>e.path===t);!e||(e=e.top+animation_editor_1.animationEditor.LINE_HEIGHT/2+animation_editor_1.animationEditor.KEY_SIZE_R-l)<o.y||e>o.y+a||r(animation_ctrl_1.animationCtrl.clipsDump.pathsDump[t],!0)}):r(i.properties),s.sort((e,t)=>e.frame-t.frame),i.selectKeyInfo={nodePath:i.computeSelectPath,keyFrames:s,location:"prop",prop:i.selectProperty?.prop}}}}},exports.methods={onClipCurvePreset(e){this.$refs.curve.curveCtrl.applyBezierToSelectedCurveClip(e),(0,utils_1.multiplyTrackWithTimer)("hippoAnimator",{A100000:1,project_id:Editor.Project.uuid,clip_id:this.currentClip,version:Editor.App.version})},toggleExpandLayoutChange(e){this.expandLayout[e]=!this.expandLayout[e],animation_editor_1.animationEditor.setConfig("expandLayout",this.expandLayout),(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.resize()})},showSelectedKeys(){switch(this.focusedCurve){case"curve":this.showAnimCurve&&null!=this.$refs.curve&&this.$refs.curve.zoomToSelectedKeys();break;case"auxCurve":this.$refs.auxCurve.zoomToSelectedKeys()}},showAllKeys(){switch(this.focusedCurve){case"curve":this.showAnimCurve&&this.clipConfig?.duration&&this.curveData&&this.$refs.curve.zoomToFit();break;case"auxCurve":this.$refs.auxCurve.zoomToFit()}},onUpdateEvent(e,t,r){0===r.length?animation_ctrl_1.animationCtrl.deleteEvent():(0,ipc_event_1.IApplyOperation)((0,ipc_event_1.IupdateEvent)(e,t,r))},toggleInvalidNode(){this.filterInvalid=!this.filterInvalid,this.$refs.nodes.scrollTop=this.nodeScrollInfo.top=0,animation_editor_1.animationEditor.calcDisplayClips()},onFilter(e){e.stopPropagation(),e.preventDefault(),this.filterName!==e.target.value&&animation_editor_1.animationEditor.debounceFilterNode(e.target.value)},async calcSelectProperty(e,t=!1){var r=this;(e=t&&r.selectProperty?r.selectProperty:e)&&(t=await(0,ipc_event_1.IgetPropValueAtFrame)(r.currentClip,e.nodePath,e.prop,r.currentFrame),r.selectProperty=Object.assign(e,{dump:t}))},queryDurationStyle(e){if(!e||!grid_ctrl_1.gridCtrl.grid)return"";let t=grid_ctrl_1.gridCtrl.grid.valueToPixelH(0),r=(t<0&&(t=0),grid_ctrl_1.gridCtrl.grid.valueToPixelH(e)-t);return r<0&&(t=r,r=0),`transform: translateX(${t}px); width: ${r}px`},pointerPosition(e=0){return grid_ctrl_1.gridCtrl.frameToCanvas(this.currentFrame)+(e??grid_ctrl_1.gridCtrl.grid?.xAxisOffset??0)-grid_ctrl_1.gridCtrl.startOffset},onMouseWheel(e){e.shiftKey?animation_editor_1.animationEditor.moveTimeLine("darwin"===process.platform?e.deltaX:e.deltaY):Math.abs(e.deltaX)>Math.abs(e.deltaY)?animation_editor_1.animationEditor.moveTimeLine(e.deltaY):animation_editor_1.animationEditor.scaleTimeLineAt(-e.deltaY,Math.round(e.offsetX))},onMouseDown(e){const t=this;t.moveNodePath="",t.boxInfo=null,t.boxStyle=null;var r,i=e.target.getAttribute("name");"event"!==i&&(t.selectEventInfo=null),"key"===i||"stick"===i||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectKeyInfo=null),"range"===i||"stick"===i||(0,utils_1.checkCtrlOrCommand)(e)||(t.selectEmbeddedPlayerInfo=null,Editor.Selection.unselect("animation-embeddedPlayer",Editor.Selection.getSelected("animation-embeddedPlayer")));let o=null;function a(){e.offsetY>t.$refs["property-content"].offsetTop?global_data_1.Flags.mouseDownName="property":e.offsetY>t.$refs["node-content"].offsetTop&&e.offsetY<t.$refs["property-content"].offsetTop&&(global_data_1.Flags.mouseDownName="node")}switch(i){case"time-pointer":global_data_1.Flags.mouseDownName="time-pointer";break;case"pointer":1!==e.button&&(global_data_1.Flags.mouseDownName="pointer");break;case"stick":global_data_1.Flags.mouseDownName="stick",t.selectKeyInfo.startX=e.x,t.selectKeyInfo.offset=0,t.selectKeyInfo.offsetFrame=0,global_data_1.Flags.startDragStickInfo={type:"center"};break;default:if(1===e.button||2===e.button){if(global_data_1.Flags.startDragGridInfo={start:e.x,lastStart:e.x},2===e.button&&(a(),global_data_1.Flags.mouseDownName))break;return void(global_data_1.Flags.mouseDownName="grid")}i&&(global_data_1.Flags.mouseDownName=i)}o||global_data_1.Flags.mouseDownName||(a(),global_data_1.Flags.mouseDownName&&(o={type:global_data_1.Flags.mouseDownName,ctrlKey:(0,utils_1.checkCtrlOrCommand)(e)})),["node","property"].includes(global_data_1.Flags.mouseDownName)&&o&&(r=grid_ctrl_1.gridCtrl.pageToCtrl(e.x,e.y),o.startX=r.x,o.startY=r.y,o.ctrlKey=(0,utils_1.checkCtrlOrCommand)(e),o.ctrlKey&&t.selectKeyInfo&&t.selectKeyInfo.keyFrames&&(o.rawKeyFrames=t.selectKeyInfo.keyFrames),t.boxInfo=o)},onPropertyListContextMouseDown(e){global_data_1.Flags.mouseDownName="property-list-content"},onScroll(e,t){const r=this;if(!global_data_1.Flags.onScrolling){const i="node"===t?r.nodeScrollInfo:r.propertyScrollInfo,o=e.target.scrollTop;o===i.top||(global_data_1.Flags.lastScrollTops.splice(0,0,o),global_data_1.Flags.lastScrollTops.length=3,global_data_1.Flags.lastScrollTops[0]===global_data_1.Flags.lastScrollTops[2])||r.scrolling||(global_data_1.Flags.onScrolling=!0,r.scrolling=!0,requestAnimationFrame(()=>{i.top=o,animation_ctrl_1.animationCtrl.nodesDump?.nodesDump||animation_editor_1.animationEditor.calcNodes(),animation_editor_1.animationEditor.calcDisplayClips(),r.updateKeyFrame++,r.scrolling=!1,global_data_1.Flags.onScrolling=!1}))}},async onConfirm(e){var t=e.target.getAttribute("name"),e=e.target.value;"sample"===t&&animation_editor_1.animationEditor.updateSample(e),await animation_ctrl_1.animationCtrl.updateConfig(t,e)},onStartResize(e,t){animation_editor_1.animationEditor.onStartResize(e,t)},toggleAniCurve(){this.showAnimCurve=!this.showAnimCurve,(0,vue_js_1.nextTick)(()=>{animation_editor_1.animationEditor.initCurve()})},async onEditEasingMethodCurve(e){const t=this;if(t.showAnimCurve&&t.curveData&&t.curveData.hasUserEasingMethod){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();e=await Editor.Dialog.warn(Editor.I18n.t("animator.tips.abort_easing_method"),{buttons:[Editor.I18n.t("animator.cancel"),Editor.I18n.t("animator.abort")],default:0,cancel:0});if(0!==e.response){const r=[],i=t.selectProperty["nodePath"];for(const o of Object.keys(t.curveData.curveInfos))t.curveData.curveInfos[o].keys.forEach(e=>{e.easingMethod&&r.push((0,ipc_event_1.ImodifyCurveOfKey)(t.currentClip,i,o,Math.round(e.point.x),{easingMethod:0}))});(0,ipc_event_1.IApplyOperation)(r)}}},onShowUseBakedAnimationWarn(e){if(this.useBakedAnimationWarnTip)return;const t=document.createElement("div");var r=document.createElement("ui-label");r.style.whiteSpace="normal",r.setAttribute("value","i18n:animator.tips.use_baked_animation.detailed_warn_by_ska"),t.appendChild(r);const i=e.target;r=i.getBoundingClientRect();t.getBoundingClientRect();t.setAttribute("style",`
            position: absolute;
            width: 608px;
            left: ${r.left-22}px;
            top: ${r.top+r.height+4}px;
            z-index: 101;
            display: block;
            border-radius: 2px;
            background: #424242ff;
            border: 1px solid #8f8f8fff;
            box-shadow: 0 0 12px 0 #000000a6;
            padding: 16px;    
        `);const o=e=>{document.removeEventListener("mousedown",n),t.removeEventListener("mouseleave",a),this.useBakedAnimationWarnTip&&(this.useBakedAnimationWarnTip=null,setTimeout(()=>{t.remove()},100))},a=e=>{e.composedPath().includes(i)||o(e)},n=e=>{e.composedPath().includes(t)||o(e)};t.addEventListener("mouseleave",a),document.addEventListener("mousedown",n),this.useBakedAnimationWarnTip=t,document.body.appendChild(t)},changeFrameShowType(e){const t=this;requestAnimationFrame(()=>{t.showType=e,grid_ctrl_1.gridCtrl.grid.labelShowType=e,grid_ctrl_1.gridCtrl.grid.updateLabels(),animation_editor_1.animationEditor.setConfig("showType",e)})},onScale(e){animation_editor_1.animationEditor.scaleTimeLineWith(e)},onTimeConfirm(e){const t=this;var r=e.target.value;if(/^([0-9]*)f?$/.test(r))animation_editor_1.animationEditor.updateCurrentFrame(Number(r));else{var i=animation_ctrl_1.animationCtrl.clipConfig.sample,o=r.match(/^([0-9]*)-([0-9]*)$/);if(o)o=Number(o[1])*i+Number(o[2]),animation_editor_1.animationEditor.updateCurrentFrame(o);else{o=/^((?<m>\d((\.\d*)?))m)?(?<s>(\d((\.\d*)?)))s$/;if(o.test(r)){var{m:r,s:o}=r.match(o)["groups"];let e=(0,utils_1.timeToFrame)(Number(o),i);r&&(e+=Number(r)*i),animation_editor_1.animationEditor.updateCurrentFrame(e)}requestAnimationFrame(()=>{e.path[0].value=t.currentTime})}}},onPropChange(e){!this.selectProperty||e.detail&&e.detail.ignoreChange||(e={value:{newValue:e.target.dump.value},prop:this.selectProperty.prop,nodePath:this.computeSelectPath,frame:this.currentFrame},animation_ctrl_1.animationCtrl.callByDebounce("createKey",e,{recordUndo:!1}))},onPropConfirm(e){!this.selectProperty||e.detail&&e.detail.ignoreChange||(e={value:{newValue:e.target.dump.value},prop:this.selectProperty.prop,nodePath:this.computeSelectPath,frame:this.currentFrame},animation_ctrl_1.animationCtrl.callByDebounce("createKey",e))},async onShowEmbeddedPlayerMenu(e){var t=animation_editor_1.animationEditor.getEmbeddedPlayerMenu();Editor.Menu.popup({menu:t})},async updateEnableEmbeddedPlayer(){this.enableEmbeddedPlayer=await animation_editor_1.animationEditor.getConfig("enableEmbeddedPlayer")??!0,this.enableEmbeddedPlayer||(this.expandLayout.embeddedPlayer=!1)}},exports.components={"control-preview":components_1.ControlPointer,"control-track-tree":components_1.ControlTrackTree,"preview-row":components_1.PreviewRow,"preview-range-row":components_1.PreviewRangeRow,"tool-bar":components_1.AnimatorToolbar,"node-tree":components_1.NodeTree,"property-tree":components_1.PropertyTree,"tips-mask":components_1.TipsMask,events:components_1.EventsRow,"property-tools":components_1.PropertyTools,"event-editor":components_1.EventEditor,"ctrl-stick":components_1.CtrlStick,"ani-mask":components_1.AniMask,AuxiliaryCurves:components_1.AuxiliaryCurves,AuxiliaryCurveFrames:components_1.AuxiliaryCurveFrames,CurvePresets:components_1.CurvePresets,PropertyCurve:components_1.PropertyCurve},exports.mounted=mounted;