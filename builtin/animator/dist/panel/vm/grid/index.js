"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.syncAxisY=exports.syncAxisX=exports.Grid=void 0;const Chroma=require("chroma-js"),HALF_TEXT_WIDTH=5,POINT_LENGTH=2,LinearTicks=require("./../../../../static/script/linear-ticks.js"),clamp=Editor.Utils.Math["clamp"];class Grid{set cxt2D(t){this.canvas=t.canvas,this._cxt2D=t}get cxt2D(){return this._cxt2D}get xMinScale(){return this.hticks.minValueScale}get xMaxScale(){return this.hticks.maxValueScale}constructor(t){this.xAxisScale=1,this.xAxisOffset=0,this.xAnchor=.5,this.yAxisScale=1,this.yAxisOffset=0,this.yAnchor=.5,this.labelShowType="time",this.cxt2D=t.context,this.axis=t.axis,this.labelShowType=t.showType,this.cxt2D.lineWidth=t.lineWidth||1,this.lineColor=t.color||"#ccc",this._lineColor=Chroma(this.lineColor),this.hticks=new LinearTicks;var{lods:s,minScale:i,maxScale:e,sample:h,startOffset:a,container:x}=this.axis;this.xAxisOffset=a||0,this.startOffset=a||0,this.sample=h,this.container=x,this.hticks.initTicks(s,i,e,h).spacing(10,20),this.xAxisScale=clamp(this.xAxisScale,this.hticks.minValueScale,this.hticks.maxValueScale),this.hformat=t.hformat}updateScale(t,s){var{lods:i,sample:e}=this.axis;this.hticks.initTicks(i,t,s,e).spacing(10,20)}xAxisScaleAt(t,s){var i=this.pixelToValueH(t),s=(this.xAxisScale=clamp(s,this.hticks.minValueScale,this.hticks.maxValueScale),this.valueToPixelH(i));return this.transferX(t-s),this.xAxisScale}transferX(e){if(!(this.xAxisOffset===this.startOffset&&0<e)){let t=this.xAxisOffset+e;t>this.startOffset&&(t=this.startOffset);let s,i;void 0!==this.xMinRange&&null!==this.xMinRange&&(s=this.valueToPixelH(this.xMinRange)),void 0!==this.xMaxRange&&null!==this.xMaxRange&&(i=this.valueToPixelH(this.xMaxRange),i=Math.max(0,i-this.canvas.width)),this.xAxisOffset=t,void 0!==s&&void 0!==i?this.xAxisOffset=clamp(this.xAxisOffset,-i,-s):void 0!==s?this.xAxisOffset=Math.min(this.xAxisOffset,-s):void 0!==i&&(this.xAxisOffset=Math.max(this.xAxisOffset,-i))}}resize(t,s){var i;t&&s||(i=this.canvas.getBoundingClientRect(),t=t||i.width,s=s||i.height,t=Math.round(t),s=Math.round(s)),this.canvas.width===t&&this.canvas.height===s||(this.canvas.width=t,this.canvas.height=s,this.render())}render(){this.clear(),this.updateGrids(),this.updateLabels()}pixelToValueH(t){return(t-this.xAxisOffset)/this.xAxisScale}valueToPixelH(t){return t*this.xAxisScale+this.xAxisOffset}updateLabels(){if(this.container){var t=this.hticks.levelForStep(30),t=this.hticks.ticksAtLevel(t,!1);let e="";t.forEach(t=>{var s=Math.floor(this.valueToPixelH(t)),t=this.hformat(t,this.labelShowType,this.sample),i=t.toString().length/2*4;e+=`<span style="transform: translateX(${Math.floor(s-this.startOffset-i)}px);">${t}</span>`}),this.container.x.innerHTML=e}}clear(){this.cxt2D.clearRect(0,0,this.canvas.width,this.canvas.height)}updateGrids(){var s,i,t=this.pixelToValueH(0),e=this.pixelToValueH(this.canvas.width);this.hticks.range(t,e,this.canvas.width);for(let t=this.hticks.minTickLevel;t<=this.hticks.maxTickLevel;++t)if(0<(s=this.hticks.tickRatios[t])){this.cxt2D.strokeStyle=`rgba(${this._lineColor.rgb().toString()}, ${3*s})`;for(const h of this.hticks.ticksAtLevel(t,!0))this.cxt2D.beginPath(),i=this.valueToPixelH(h),this.cxt2D.moveTo(Math.floor(i)+.5,35),this.cxt2D.lineTo(Math.floor(i)+.5,this.canvas.height),this.cxt2D.stroke()}}}function syncAxisX(t,s){s.xAxisScale=t.xAxisScale,s.xAxisOffset=t.xAxisOffset}function syncAxisY(t,s){s.yAxisScale=t.yAxisScale,s.yAxisOffset=t.yAxisOffset}exports.Grid=Grid,exports.syncAxisX=syncAxisX,exports.syncAxisY=syncAxisY;