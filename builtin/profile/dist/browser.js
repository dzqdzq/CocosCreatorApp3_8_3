"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const BroadcaseMap={editor:{},project:{}};function executeMessage(e,o,a,t){"string"==typeof e?Editor.Message.send(o,e,a,t):Editor.Message.send(e.target||o,e.name,a,t)}async function load(){Editor.Package.getPackages().forEach(exports.methods.attach),Editor.Package.__protected__.on("register",exports.methods.attach),Editor.Profile.__protected__.on("change",exports.methods.profileChanged),Editor.Profile.__protected__.on("save",exports.methods.profileSaved)}function unload(){Editor.Package.__protected__.removeListener("register",exports.methods.attach),Editor.Profile.__protected__.removeListener("change",exports.methods.profileChanged),Editor.Profile.__protected__.removeListener("save",exports.methods.profileSaved)}exports.methods={attach(o){if(!o.invalid)try{if(o.name,o.info,o.info.contributions&&o.info.contributions.profile){var e=o.info.contributions.profile;if(e.editor)for(const r in e.editor){var a=e.editor[r];Editor.Profile.setConfig(o.name,r,a.default,"default"),a.message&&((BroadcaseMap.editor[`packages/${o.name}.json`]=BroadcaseMap.editor[`packages/${o.name}.json`]||{})[r]=[o.name,a.message])}if(e.project)for(const s in e.project){var t=e.project[s];Editor.Profile.setProject(o.name,s,t.default,"default"),t.message&&((BroadcaseMap.project[`packages/${o.name}.json`]=BroadcaseMap.project[`packages/${o.name}.json`]||{})[s]=[o.name,t.message])}}}catch(e){console.error(Editor.I18n.t("preferences.warn_info.register_failed")+": "+o.name),console.error(e)}},profileChanged(e,o,a,t){if("local"===e||"global"===e){if(BroadcaseMap.editor[o]&&BroadcaseMap.editor[o][a])try{var[r,s]=BroadcaseMap.editor[o][a],c=Editor.Package.getPackages({name:r,enable:!0});c&&c.length&&s?executeMessage(s,r,a,t):console.log(`Profile changed: ${r} (${a}: ${t})`)}catch(e){console.warn(e)}}else if("project"===e&&BroadcaseMap.project[o]&&BroadcaseMap.project[o][a])try{var[n,d]=BroadcaseMap.project[o][a],i=Editor.Package.getPackages({name:n,enable:!0});i&&i.length&&d?executeMessage(d,n,a,t):console.log(`Profile changed: ${n} (${a}: ${t})`)}catch(e){console.warn(e)}},profileSaved(e){}},exports.load=load,exports.unload=unload;