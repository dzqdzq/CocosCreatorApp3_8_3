"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScenePanelManager=void 0;const panel_constant_1=require("./panel-constant"),ipc_1=require("./native/ipc");class PanelManager{constructor(){this._previewPanel=null,this.onSceneMessage={"scene:ready":()=>{var e;this._scenePanel.onSceneReady(),null!=(e=this._previewPanel)&&e.onSceneReady()}}}get scene(){return this._scenePanel}set scene(e){e.nativeWindowPanel?(this._scenePanel=e.nativeWindowPanel,ipc_1.PanelIpc.setEngineView(e.$.scene)):console.error("PanelManager register failed:without nativeWindowPanel")}get preview(){return this._previewPanel}set preview(e){e.nativeWindowPanel?this._previewPanel=e.nativeWindowPanel:console.error("PanelManager register failed:without nativeWindowPanel")}init(e){e&&(Editor.Message.__protected__.addBroadcastListener("scene:editor-preview-set-play",async(e,n)=>{e===panel_constant_1.EditorPreviewState.Changing?(this._scenePanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),null!=(e=this._previewPanel)&&e.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel&&(this._previewPanel.setBackgroundVisible(!0,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.enableInput(!1))):await this.onPreviewStop(n)}),ipc_1.PanelIpc.on("onBrowserToPanel",this.onBrowserToPanel.bind(this)),ipc_1.PanelIpc.on("onSceneToPanel",this.onSceneToPanel.bind(this)))}getPanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async switchNativeWindows(e){await ipc_1.PanelIpc.requestToBrowser("switchWindows",e)}resize(e,n){null!=(e=this.getNativePanel(e))&&e.resize(n)}show(e){null!=(e=this.getNativePanel(e))&&e.show()}hide(e){null!=(e=this.getNativePanel(e))&&e.hide()}close(e){null!=(e=this.getNativePanel(e))&&e.close()}getNativePanel(e){return e===panel_constant_1.PanelName.Scene?this._scenePanel:this._previewPanel}async onBrowserToPanel(e){var{panel:e,method:n,args:a,callback:i}=e;i(await(null==(i=this.getNativePanel(e))?void 0:i.onBrowserPanel(n,...a)))}async onSceneToPanel(e,...n){e=this.onSceneMessage[e];e&&e.call(this,...n)}async onPreviewStop(e=!1){await this.switchNativeWindows(e),this._scenePanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._scenePanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal,this._previewPanel&&(this._previewPanel.enableInput(!0),this._previewPanel.setBackgroundVisible(!1,panel_constant_1.PanelBackgroundPriority.preview),this._previewPanel.backgroundPriority=panel_constant_1.PanelBackgroundPriority.normal)}}const ScenePanelManager=new PanelManager;exports.ScenePanelManager=ScenePanelManager;