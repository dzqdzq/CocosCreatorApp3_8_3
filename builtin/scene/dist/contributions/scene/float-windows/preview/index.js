"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.send=exports.close=exports.ready=exports.template=exports.mode=exports.dock=exports.right=exports.bottom=exports.height=exports.width=exports.type=void 0;const fs_1=require("fs"),path_1=require("path"),ElectronModule=require("@base/electron-module"),GlPreview=ElectronModule.require("PreviewExtends").default,glPreview=new GlPreview("scene:mini-preview","query-mini-preview-data");exports.type="cc.Camera",exports.width=200,exports.height=100,exports.bottom=10,exports.right=10,exports.dock=!0,exports.mode="simple";let currWidth,currHeight,toolbars,cameraPreview,canvasContain,canvas,panel,miniPreviewInfo,previewInfo,$scene,frameId,curCameraUUID="";function applyWindowSize(){canvas&&(previewInfo&&previewInfo.width&&previewInfo.height?(currHeight=$scene.clientHeight/4,(currWidth=currHeight*(previewInfo.width/previewInfo.height))>=$scene.clientWidth/2&&(currWidth=$scene.clientWidth/2,currHeight=currWidth/(previewInfo.width/previewInfo.height))):(currHeight=$scene.clientHeight/4,currWidth=2*currHeight),currWidth|=0,currHeight|=0,panel.style.height=currHeight+"px",panel.style.width=currWidth+"px",panel.style.setProperty("--float-window-width",currWidth+"px"),panel.style.setProperty("--float-window-height",currHeight+"px"),canvasContain.style.width=currWidth+"px",canvasContain.style.height=currHeight+"px",canvas.style.width="100%",canvas.style.height="100%",canvas.width=currWidth,canvas.height=currHeight,glPreview.resizeGL(currWidth,currHeight),send("cameraUpdate"))}async function callMiniPreviewFunction(e,...t){return $scene.callSceneMethod("callPreviewFunction",["scene:mini-preview",e,t])}async function ready(e,t,r){$scene=e.parentElement,(panel=e).style.opacity="1",panel.hidden=!0,1<t.nodes.length||!r[exports.type]||(r[exports.type][0].enabled?(await callMiniPreviewFunction("handleSelect",curCameraUUID=r[exports.type][0].uuid),canvasContain=panel.querySelector(".canvas-contain"),canvas=panel.querySelector("canvas"),(toolbars=panel.querySelector("ui-panel"))&&toolbars.setAttribute("src",(0,path_1.join)(__dirname,"./toolbars/camera-size.js")),cameraPreview=panel.querySelector("camera-preview"),previewInfo=await callMiniPreviewFunction("getPreviewInfo"),applyWindowSize(),$scene.$scene.getWebContentsId(),canvas&&(await glPreview.init({width:canvas.width,height:canvas.height}),await glPreview.initGL(canvas),applyWindowSize(),await send("cameraUpdate"),panel.hidden=!1)):e.hidden=!0)}async function close(){glPreview.destroyGL(),await callMiniPreviewFunction("handleUnselect",curCameraUUID)}function drawBuffer(e){try{glPreview.drawGL(e)}catch(e){console.warn(e)}}async function send(e){if("cameraUpdate"!==e)return"viewResize"===e?applyWindowSize():e&&e.name&&"preview-plugin"===e.name&&(previewInfo=e,applyWindowSize()),!0;{const e=await glPreview.queryPreviewData({width:canvas.width,height:canvas.height});return!e||e instanceof Uint8Array?!1:(drawBuffer(e),!0)}}exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"./index.html"),"utf-8"),exports.ready=ready,exports.close=close,exports.send=send,exports.default=__importStar(require("./index"));