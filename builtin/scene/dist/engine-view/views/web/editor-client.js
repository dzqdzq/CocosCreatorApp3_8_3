"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditorClient=void 0;const join=require("path")["join"],scene_web_ipc_1=__importDefault(require("../../ipc/scene-web-ipc")),utils_1=require("../../../script/utils/ipc/utils"),remote_1=require("@electron/remote"),base_client_1=require("../base-client"),preloadPath=join(__dirname,"../../../script/3d/preload/web/preload.js"),sourceUrl="packages://scene/static/template/3d-webview.html?url="+encodeURI(preloadPath);class EditorClient extends base_client_1.BaseClient{constructor(){super(),this.webview=document.createElement("webview"),this._loaded=!1}load(e){super.load(e),Editor.Metrics._trackEventWithTimer({category:"native-scene",id:"A100001",value:0}),this.webview.setAttribute("style","pointer-events: none;flex:1;"),this.webview.setAttribute("src",sourceUrl);let t=!1;this.webview.addEventListener("dom-ready",()=>{var e;t||(t=!0,console.debug("Scene view web contents ID: "+this.webview.getWebContentsId()),null!=(e=remote_1.webContents.fromId(this.webview.getWebContentsId()))&&e.setBackgroundThrottling(!1),null!=e&&e.on("render-process-gone",(e,t)=>{Editor.Message.broadcast("crash-reporter:report",{process:"Scene Web View",value:{A100000_3D_Engine:1},details:t,time:new Date}),"crashed"===t.reason&&(base_client_1.BaseClient.isCrash=!0,console.debug(`The scene process has crashed. Exit code: ${t.exitCode.toString(16)}(${t.exitCode})`))}))}),this.ipc=new scene_web_ipc_1.default(this.webview,utils_1.IPCChannel.SceneWebSend,utils_1.IPCChannel.SceneWebReply)}unload(e){this._loaded&&(this.webview.setAttribute("src",""),this.webview.reload(),e.removeChild(this.webview))}show(){this.webview.setAttribute("style","pointer-events: none;flex:1;")}hide(){this.webview.setAttribute("style","display: none")}}exports.EditorClient=EditorClient;