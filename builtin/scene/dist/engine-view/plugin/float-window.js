"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,o,i){void 0===i&&(i=o);var n=Object.getOwnPropertyDescriptor(e,o);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,i,n)}:function(t,e,o,i){t[i=void 0===i?o:i]=e[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)"default"!==o&&Object.prototype.hasOwnProperty.call(t,o)&&__createBinding(e,t,o);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.isHidden=exports.update=exports.send=exports.unselect=exports.select=exports.unregister=exports.register=exports.get=void 0;const $window=document.createElement("div");function get(){return $window}$window.innerHTML='<header><span></span><ui-icon class="setting" value="setting"></ui-icon></header><section></section>',$window.hidden=!0,$window.classList.add("float-window"),$window.querySelector(".setting").addEventListener("mouseup",async t=>{const e=_optionCache[0];if(e){const o=await Editor.Profile.getConfig("scene",`float-window.position.${e.type}.dock`);Editor.Menu.popup({x:t.pageX,y:t.pageY,menu:[{label:"Dock",checked:!!o,type:"checkbox",async click(){o?$window.removeAttribute("dock"):$window.setAttribute("dock",""),Editor.Profile.setConfig("scene",`float-window.position.${e.type}.dock`,!o,"local")}}]})}}),$window.addEventListener("mousedown",t=>{t.stopPropagation()}),$window.querySelector("header").addEventListener("mousedown",t=>{t.stopPropagation();const o={width:$window.clientWidth,height:$window.clientHeight},i={width:$window.parentElement.clientWidth||0,height:$window.parentElement.clientHeight||0},n={x:t.pageX,y:t.pageY},d={top:$window.style.top?parseInt($window.style.top):NaN,left:$window.style.left?parseInt($window.style.left):NaN};function r(t,e){return t<0&&(t=0),(e=e<0?0:e)>i.width-o.width&&(e=i.width-o.width),{top:t=t>i.height-o.height?i.height-o.height:t,left:e}}isNaN(d.top)&&(d.top=$window.style.bottom?i.height-o.height-parseInt($window.style.bottom):0),isNaN(d.top)&&(d.top=0),isNaN(d.left)&&(d.left=$window.style.right?i.width-o.width-parseInt($window.style.right):0),isNaN(d.top)&&(d.left=0),d.left<0&&(d.left=0),d.top<0&&(d.top=0),$window.removeAttribute("left"),$window.removeAttribute("right"),$window.removeAttribute("top"),$window.removeAttribute("bottom");function w(t){const e=t.pageX-n.x,o=t.pageY-n.y;t=r(d.top+o,d.left+e),$window.style.top=t.top+"px",$window.style.left=t.left+"px",$window.style.right="",$window.style.bottom=""}function s(t){var e=r($window.style.top?parseInt($window.style.top):0,$window.style.left?parseInt($window.style.left):0);e.top<i.height-(e.top+o.height)?e.left<i.width-(e.left+o.width)||($window.style.right=i.width-(e.left+o.width)+"px",$window.style.left=""):e.left<i.width-(e.left+o.width)?($window.style.bottom=i.height-(e.top+o.height)+"px",$window.style.top=""):($window.style.bottom=i.height-(e.top+o.height)+"px",$window.style.top="",$window.style.right=i.width-(e.left+o.width)+"px",$window.style.left=""),0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom"),document.removeEventListener("mousemove",w,!0),document.removeEventListener("mouseup",s,!0)}document.addEventListener("mousemove",w,!0),document.addEventListener("mouseup",s,!0)}),$window.addEventListener("mousemove",t=>{t.stopPropagation()}),$window.addEventListener("mouseup",t=>{t.stopPropagation()}),$window.addEventListener("wheel",t=>{t.stopPropagation()}),$window.addEventListener("keydown",t=>{t.stopPropagation()}),$window.addEventListener("keyup",t=>{t.stopPropagation()}),$window.addEventListener("dragover",t=>{t.stopPropagation()}),$window.addEventListener("drop",t=>{t.stopPropagation()}),exports.get=get;const map={};function register(t,e){map[t]=e}function unregister(t){delete map[t]}exports.register=register,exports.unregister=unregister;const _optionCache=[];async function select(t,o,i){o=o.map(t=>{var e=[];for(const o in map)for(const i of map[o])i.type===t&&e.push(i);return e}).filter(t=>0<t.length);if(1<=_optionCache.length&&unselect(),o[0]&&0!==o[0].length){o=mergeFloatWindowOptions(o[0]);let e=o;"simple"===o.mode?$window.setAttribute("simple",""):($window.removeAttribute("simple"),e=await Editor.Profile.getConfig("scene","float-window.position."+o.type)||o),$window.querySelector("header span").innerHTML=o.type,$window.querySelector("section").innerHTML=o.template,$window.style.width=`${o.width||200}px`,$window.style.height=`${o.height||200}px`,e.dock?$window.setAttribute("dock",""):$window.removeAttribute("dock");var n=o.height||200,d=o.width||200;if(void 0!==e.top&&null!==e.top){let t=e.top;(t=t+n>$window.parentElement.clientHeight?Math.max($window.parentElement.clientHeight-n,0):t)<0&&(t=0),$window.style.top=t+"px",$window.style.bottom=""}else{if(void 0!==e.bottom&&null!==e.bottom){let t=e.bottom;t+n>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-n),$window.style.bottom=t+"px"}else{let t=10;t+n>$window.parentElement.clientHeight&&(t=$window.parentElement.clientHeight-n),$window.style.bottom=t+"px"}$window.style.top=""}if(void 0!==e.left&&null!==e.left){let t=e.left;(t=t+d>$window.parentElement.clientWidth?Math.max($window.parentElement.clientWidth-d,0):t)<0&&(t=0),$window.style.left=t+"px",$window.style.right=""}else void 0!==e.right&&null!==e.right?(e.right+d>$window.parentElement.clientWidth&&Math.max($window.parentElement.clientWidth-d,0),$window.style.right=e.right+"px"):(10+d>$window.parentElement.clientWidth&&Math.max($window.parentElement.clientWidth-d,0),$window.style.right="10px"),$window.style.left="";_optionCache.push(o),$window.hidden=!1,0===parseInt($window.style.left||"")?$window.setAttribute("left",""):$window.removeAttribute("left"),0===parseInt($window.style.right||"")?$window.setAttribute("right",""):$window.removeAttribute("right"),0===parseInt($window.style.top||"")?$window.setAttribute("top",""):$window.removeAttribute("top"),0===parseInt($window.style.bottom||"")?$window.setAttribute("bottom",""):$window.removeAttribute("bottom");try{o.ready($window,t,i)}catch(t){console.error(t)}}else unselect()}function unselect(){for(var t,e,o,i,n=_optionCache[0];_optionCache.length;){var d=_optionCache.shift();try{d&&d.close()}catch(t){console.error(t)}}$window.hidden=!0,n&&(i=parseInt($window.style.top||""),t=parseInt($window.style.bottom||""),e=parseInt($window.style.left||""),o=parseInt($window.style.right||""),i={dock:null!==$window.getAttribute("dock"),top:isNaN(i)?null:i,bottom:isNaN(t)?null:t,left:isNaN(e)?null:e,right:isNaN(o)?null:o},Editor.Profile.setConfig("scene","float-window.position."+n.type,i,"local"))}function send(e,...o){_optionCache.forEach(t=>{t.type===e&&t.send&&t.send(...o)})}function update(e,o,i){_optionCache.forEach(t=>{o.includes(t.type)&&t.update&&t.update(e,i)})}function isHidden(){return $window.hidden}function mergeFloatWindowOptions(t){const o=[],i=[],n=[],d=[],e={type:"",width:0,height:0,top:void 0,bottom:void 0,left:void 0,right:void 0,template:"",ready(...e){o.forEach(t=>{t(...e)})},close(...e){i.forEach(t=>{t(...e)})},update(...e){n.forEach(t=>{t(...e)})},send(...e){d.forEach(t=>{t(...e)})}};return t.forEach(t=>{e.type=t.type,e.width=Math.max(t.width,e.width),e.height=Math.max(t.height,e.height),void 0!==t.top&&(e.top=Math.max(t.top,e.top||0)),void 0!==t.bottom&&(e.bottom=Math.max(t.bottom,e.bottom||0)),void 0!==t.left&&(e.left=Math.max(t.left,e.left||0)),void 0!==t.right&&(e.right=Math.max(t.right,e.right||0)),e.template+=t.template,e.mode=e.mode||t.mode,t.ready&&o.push(t.ready),t.close&&i.push(t.close),t.update&&n.push(t.update),t.send&&d.push(t.send)}),e}exports.select=select,exports.unselect=unselect,exports.send=send,exports.update=update,exports.isHidden=isHidden,exports.default=__importStar(require("./float-window"));