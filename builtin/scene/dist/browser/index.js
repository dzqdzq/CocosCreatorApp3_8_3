"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,a,n,t){void 0===t&&(t=n);var r=Object.getOwnPropertyDescriptor(a,n);r&&("get"in r?a.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return a[n]}}),Object.defineProperty(e,t,r)}:function(e,a,n,t){e[t=void 0===t?n:t]=a[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(a,e,n);return __setModuleDefault(a,e),a},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const ElectronModule=require("@base/electron-module"),path_1=require("path"),scene_cache_1=require("./scene-cache"),env_1=__importDefault(require("../script/utils/env"));let nativeManager;const electron=require("electron");async function load(){await env_1.default.useNativeScene()&&(nativeManager=require("./native/index").NativeManager);const n={import:require("./protocol/import"),"project-temp":require("./protocol/project-temp")};ElectronModule.register("PreviewExtends",(0,path_1.join)(__dirname,"../preview-extends/index")),Object.keys(n).forEach(e=>{var a=n[e];require("electron").protocol[a.type](e,a.handler)});try{await scene_cache_1.sceneCacheManager.init()}catch(e){console.error(e)}(await Promise.resolve().then(()=>__importStar(require("@base/electron-base-ipc")))).on("scene:check-ipc",e=>!0)}async function unload(){await scene_cache_1.sceneCacheManager.save()}electron.ipcMain.on("fire-web-contents",e=>{e.sender.on("new-window",(e,a,n,t,r,c)=>{e.preventDefault(),Object.assign(r,{autoHideMenuBar:!0});r=new electron.BrowserWindow(r);e.newGuest=r})}),exports.methods={open(){Editor.Panel.open("scene")},async queryLatestCache(e){try{return await scene_cache_1.sceneCacheManager.queryLatestCache(e)}catch(e){console.error(e)}},async clearSceneCache(e){try{return await scene_cache_1.sceneCacheManager.clearSceneCache(e)}catch(e){console.error(e)}},async saveSceneCacheToFile(){try{return await scene_cache_1.sceneCacheManager.save()}catch(e){console.error(e)}},updateCacheConfig(){scene_cache_1.sceneCacheManager.updateConfig()},onSceneReady(e){scene_cache_1.sceneCacheManager.onSceneReady(e),null!==nativeManager&&void 0!==nativeManager&&nativeManager.onSceneReady()},onSceneClosed(){scene_cache_1.sceneCacheManager.onSceneClosed()},async panelToBrowser(e,...a){if(nativeManager[e])return await nativeManager[e].call(nativeManager,...a);console.warn("nativeManager does not has "+e)}},exports.load=load,exports.unload=unload;