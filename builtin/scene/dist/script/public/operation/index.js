"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OperationPriority=void 0;const cc_1=require("cc"),window_1=require("../../utils/window");let isBind=!1;const isWin32="win32"===process.platform;class ProportionalToScene extends cc.ResolutionPolicy.ContainerStrategy{apply(e,t){var i=e._frameSize.width,n=e._frameSize.height,s=cc.game.container.style,r=t.width,t=t.height,o=i/r,d=n/t;let a,c;c=o<d?(a=i,t*o):(a=r*d,n);t=Math.round((i-a)/2),o=Math.round((n-c)/2);a=i-2*t,c=n-2*o,this._setupContainer(e,a,c),s.margin="0"}}function bindEvent(i){if(!isBind){if(isBind=!0,isSceneNative){let t=(0,window_1.getMainWindowSize)();cc_1.view.on("canvas-resize",()=>{var e=(0,window_1.getMainWindowSize)();e.width===t.width&&e.height===t.height||(t=e,i.emit("resize",t))})}else cc_1.view.on("canvas-resize",()=>{i.emit("resize",{width:cc_1.game.canvas.width,height:cc_1.game.canvas.height})});if("function"==typeof window.matchMedia){const t=()=>{var e=window.devicePixelRatio;window.matchMedia(`(resolution: ${e}dppx)`).addEventListener("change",()=>{window.dispatchEvent(new Event("resize")),t()},{once:!0})};t()}}}class Operation{constructor(){this._debug=!1,this._debugNode=null,this._events=new Map,bindEvent(this),window.addEventListener("load",()=>{bindEvent(this)})}requestPointerLock(){cce.Ipc.send("lock-pointer",!0)}exitPointerLock(){cce.Ipc.send("lock-pointer",!1)}changePointer(e){["-webkit-grab","-webkit-grabbing","zoom-in","zoom-out","n-resize","s-resize","e-resize","w-resize","ne-resize","ew-resize","nw-resize","ns-resize","se-resize","sw-resize","nesw-resize","nwse-resize","col-resize","row-resize","text","vertical-text","context-menu","copy","move","none","default","pointer","inherit","initial","alias","all-scroll","auto","cell","crosshair","no-drop","not-allowed","progress","unset","wait"].includes(e)||(e="default"),cce.Ipc.send("change-pointer",e)}get debug(){return this._debug}set debug(e){this._debug=e,this.updateDebugUI(e)}updateDebugUI(e){e?this._debugNode||(this._debugNode=document.createElement("div"),document.body.append(this._debugNode),this._debugNode.setAttribute("style","position: absolute; width: 5px; height: 5px;border-radius: 50%;background-color: red;")):this._debugNode&&(document.body.removeChild(this._debugNode),this._debugNode=null)}_emit(e,...i){var n=this._events.get(e);if(n)for(let t=0;t<n.length;t++){var s=n[t];let e;if(!1===(e=("function"==typeof s?s:(s=s["listener"],s))(...i)))return}}emit(e,...t){return this._emit(e,...t)}_emitMouseEvent(e,i){var n=this._events.get(e);if(n){let e=isSceneNative?devicePixelRatio:cc.screen.devicePixelRatio;isSceneNative&&!isWin32&&(e=1),i.x*=e,i.y*=e,i.deltaX*=e,i.deltaY*=e,i.wheelDeltaX*=e,i.wheelDeltaY*=e,i.moveDeltaX*=e,i.moveDeltaY*=e,this._debug&&(this.updateDebugUI(this._debug),this._debugNode)&&(this._debugNode.style.left=i.x/e-2+"px",this._debugNode.style.top=i.y/e-2+"px");for(let t=0;t<n.length;t++){var s=n[t];let e;if(!1===(e=("function"==typeof s?s:(s=s["listener"],s))(i)))return}}}on(e,t,i=void 0){return this.addListener(e,t,i)}addListener(e,i,n=void 0){this._events.has(e)||this._events.set(e,[]);var s=this._events.get(e);if(n){let t=0;for(let e=0;e<s.length;e++){if(!s[e].priority){t=e;break}if(s[e].priority<n){t=e;break}t++}s.splice(t,0,{listener:i,priority:n})}else s.push(i);return this}removeListener(e,t){this._events.has(e)||this._events.set(e,[]);var i=this._events.get(e);for(let e=0;e<i.length;e++)i[e]===t&&i.splice(e--,1)}}var OperationPriority;exports.default=new Operation,function(e){e[e.Preview=999]="Preview",e[e.Gizmo=99]="Gizmo",e[e.Camera=98]="Camera"}(OperationPriority=exports.OperationPriority||(exports.OperationPriority={}));