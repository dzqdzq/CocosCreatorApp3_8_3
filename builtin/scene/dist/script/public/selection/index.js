"use strict";var __importDefault=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),uuid_array_1=__importDefault(require("./uuid-array"));class Selection extends events_1.EventEmitter{constructor(){super(),this.selectUuids=new uuid_array_1.default,this.unselectUuids=new uuid_array_1.default,this.uuids=new uuid_array_1.default,this.noticeTimer=null,this._hover=void 0}isSelect(s){return-1!==this.uuids.indexOf(s)}query(){return this.uuids.uuids.slice()}select(s){this.uuids.add(s)?(this.selectUuids.add(s),this.unselectUuids.remove(s),this.notice()):(this.uuids.remove(s),this.emit("unselect",s,this.uuids.uuids.slice()),this.uuids.add(s)),this.emit("select",s,this.uuids.uuids.slice())}unselect(s){this.uuids.remove(s)&&(this.selectUuids.remove(s),this.unselectUuids.add(s),this.notice(),this.emit("unselect",s,this.uuids.uuids.slice()))}selectGizmo(s){this.uuids.add(s),this.emit("select_gizmo",this.uuids.last(),this.uuids.uuids.slice(0,this.uuids.uuids.length-1)),this.selectUuids.add(s),this.unselectUuids.remove(s)}unselectGizmo(s){this.uuids.remove(s),this.emit("unselect_gizmo",this.uuids.last(),[s]),this.selectUuids.remove(s),this.unselectUuids.add(s)}clearGizmo(){this.emit("unselect_gizmo",this.uuids.last(),this.selectUuids.uuids.slice(0,this.uuids.uuids.length-1)),this.uuids.clear(),this.selectUuids.clear(),this.unselectUuids.clear()}clear(){for(;0<this.uuids.uuids.length;){var s=this.uuids.uuids.shift();s&&(this.selectUuids.remove(s),this.unselectUuids.add(s),this.emit("unselect",s,this.uuids.uuids.slice()))}this.notice()}notice(){clearTimeout(this.noticeTimer),this.noticeTimer=setTimeout(()=>{cce.Ipc.send("unselect-nodes",this.unselectUuids.uuids),cce.Ipc.send("select-nodes",this.selectUuids.uuids),this.selectUuids.clear(),this.unselectUuids.clear()},100)}_select(s){this.uuids.add(s)&&(this.selectUuids.add(s),this.unselectUuids.remove(s),this.emit("select",s,this.uuids.uuids.slice()))}_unselect(s){this.uuids.remove(s)&&(this.selectUuids.remove(s),this.unselectUuids.add(s),this.emit("unselect",s,this.uuids.uuids.slice()))}}exports.default=new Selection;