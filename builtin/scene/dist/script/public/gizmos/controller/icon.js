"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),quad_1=__importDefault(require("./quad")),engine_1=__importDefault(require("../utils/engine")),external_1=__importDefault(require("../utils/external")),misc_1=__importDefault(require("../utils/misc")),{setMaterialProperty,setMeshColor,setNodeOpacity}=engine_1.default,EditorCamera=external_1.default.EditorCamera,tempVec3_a=new cc_1.Vec3,tempVec3_b=new cc_1.Vec3;class IconController extends quad_1.default{constructor(e,t){super(e,t),this._is3DIcon=!1,this._visibility=!1,this.shape.name="IconController",this.registerOrthoHeightChangedEvent(),this._baseDist=50,this._lockSize=!0}setTexture(e){setMaterialProperty(this._quadNode,"mainTexture",e)}setTextureByUUID(e){cc_1.assetManager.loadAny(e,(e,t)=>{t&&(this.setTexture(t),cce.Engine.repaintInEditMode())})}setColor(e){setMeshColor(this._quadNode,e)}set is3DIcon(e){this._is3DIcon=e,this._is3DIcon||this.resetShapeScale(),this.onEditorCameraMoved()}getDistScalar(){let e=1;return e=this.isCameraInOrtho()?this.getDistScalarInOrtho():this.getCameraDistScalar(this.getPosition())}resetShapeScale(){this.shape.setScale(cc_1.Vec3.ONE)}onShow(){this._eventsRegistered||(this.registerCameraMovedEvent(),this.registerOrthoHeightChangedEvent(),this._eventsRegistered=!0),this._visibility=!0,this.onEditorCameraMoved()}onHide(){this._eventsRegistered&&(this.unregisterCameraMoveEvent(),this.unregisterOrthoHeightChangedEvent(),this._eventsRegistered=!1),this._visibility=!1}onEditorCameraMoved(){super.onEditorCameraMoved();var e=tempVec3_a,e=(EditorCamera.camera.node.getWorldPosition(e),cc_1.Vec3.distance(this.getPosition(tempVec3_b),e)),e=255*misc_1.default.LimitLerp(0,1,e,5,10);setNodeOpacity(this._quadNode,e),this._visibility&&(this.shape.active=50<=e),this.adjustControllerSize()}adjustControllerSize(){this._is3DIcon?this.resetShapeScale():super.adjustControllerSize()}}exports.default=IconController;