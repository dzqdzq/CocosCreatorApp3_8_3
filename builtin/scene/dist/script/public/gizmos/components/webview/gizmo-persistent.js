"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),external_1=__importDefault(require("../../utils/external")),utils_1=__importDefault(require("../../utils")),base_1=require("../base"),image_1=__importDefault(require("../../controller/image")),rectangle_controller_1=require("../../node/rectangle-controller"),NodeUtils=external_1.default.NodeUtils,tempQuat_a=new cc_1.Quat,imageSize=(0,cc_1.size)(200,150);class WebviewGizmo extends base_1.SelectGizmo{init(){this.createController()}onShow(){this._controller.show(),this._rectController.show(),this.updateController()}onHide(){this._controller.hide(),this._rectController.hide()}onDestroy(){this._rectController.hide()}createController(){this._controller=new image_1.default(this.getGizmoRoot(),{texture:!0}),this._controller.onControllerMouseDown=this.onControllerMouseDown.bind(this),this._controller.onControllerMouseMove=this.onControllerMouseMove.bind(this),this._controller.onControllerMouseUp=this.onControllerMouseUp.bind(this),this._rectController=new rectangle_controller_1.RectangleController(this.getGizmoRoot()),this._rectController.setColor(new cc.Color(0,153,255)),this._rectController.setOpacity(155)}onControllerMouseDown(){}onControllerMouseMove(){}onControllerMouseUp(){this.target&&utils_1.default.select(this.target.node.uuid)}syncImageControllerData(){if(this.target){var o=this.target.node.getComponent(cc_1.UITransform);if(o){o=o.contentSize;this._controller.setTextureByUUID("b9f47df4-b2f0-4270-bd8a-07bb344a8253@6c48a"),this._controller.show();let t=1,e=1;imageSize.width>o.width&&(t=o.width/imageSize.width),imageSize.height>o.height&&(e=o.height/imageSize.height);o=t<e?t:e;this._controller.updateSize(cc.v3(),cc.v2(imageSize.width*o,-imageSize.height*o))}}}syncRectControllerData(){var t,e,o;this.target&&(e=this.target.node.getComponent(cc_1.UITransform))&&(t=e.contentSize,e=e.anchorPoint,(o=cc.v3()).x=(.5-e.x)*t.width,o.y=(.5-e.y)*t.height,this._controller.show(),this._rectController.updateSize(o,cc.v2(t.width,t.height)))}updateControllerData(){this._isInitialized&&this.target&&(this.syncImageControllerData(),this.syncRectControllerData(),this.target.enabled?(this._controller.show(),this._rectController.show()):(this._controller.hide(),this._rectController.hide()))}updateControllerTransform(){var t,e,o;this._isInitialized&&this.target&&(o=this.target.node,t=NodeUtils.getWorldPosition3D(o),e=tempQuat_a,NodeUtils.getWorldRotation3D(o,e),this._controller.setPosition(t),this._controller.setRotation(e),o=NodeUtils.getWorldScale3D(o),this._rectController.setPosition(t),this._rectController.setRotation(e),this._rectController.setScale(o))}updateController(){this.updateControllerData(),this.updateControllerTransform()}onTargetUpdate(){this.updateController()}onNodeChanged(){this.updateController()}}exports.default=WebviewGizmo;