"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=__importDefault(require("../../utils")),event_enum_1=require("../../../event-enum"),external_1=__importDefault(require("../../utils/external")),gizmo_utils_1=require("./gizmo-utils"),EditorCamera=external_1.default.EditorCamera;class GizmoBase{constructor(e){this._hidden=!0,this._isInitialized=!1,this._isControlBegin=!1,this._recorded=!1,this._nodeSelected=!1,this.shouldRegisterGizmoOperationEvent=!1,this.undoID="",this._target=e}get target(){return this._target}set target(e){this._target=e,this.onTargetUpdate&&this.checkVisible()&&(this.onTargetUpdate(),cce.Engine.repaintInEditMode()),this.nodes.length<=0&&this.hide()}get nodes(){return this.target?[this.target.node]:[]}layer(){return"scene"}getGizmoRoot(){return cce.Gizmo.gizmoRootNode}onControlBegin(t){this._isControlBegin=!0,this.recordChanges(),this.nodes.forEach(e=>{utils_1.default.emitNodeMessage("gizmo-control-begin",e,{propPath:t}),utils_1.default.broadcastMessage("scene:gizmo-control-begin",e.uuid,{propPath:t})})}onControlUpdate(e){this._isControlBegin||this.onControlBegin(e)}onControlEnd(t){this._isControlBegin=!1,this.commitChanges(),this.nodes.forEach(e=>{utils_1.default.emitNodeMessage("gizmo-control-end",e,{propPath:t}),utils_1.default.broadcastMessage("scene:gizmo-control-end",e.uuid,{propPath:t})})}recordChanges(){this._recorded||(this.undoID=utils_1.default.recordChanges(this.nodes.map(e=>e.uuid)),this._recorded=!0)}commitChanges(){this._recorded=!1,""!==this.undoID&&utils_1.default.commitChanges(this.undoID),this.undoID=""}checkVisible(){return(0,gizmo_utils_1.gizmoVisibilityCheck)(this)}visible(){return!this._hidden}initialize(){this._isInitialized||(this.init&&this.init(),this._isInitialized=!0)}destroy(){this.onDestroy&&this.onDestroy(),this.hide(),this._target=null}show(){this._hidden&&this.checkVisible()&&(this.initialize(),this.onShow&&this.onShow(),this._hidden=!1)}hide(){this._hidden||(this.onHide&&this.onHide(),this._hidden=!0)}update(e){this.onUpdate&&this.onUpdate(e)}getCompPropPath(e){var t=this.target;return t?"_components."+t.node._components.indexOf(t)+"."+e:null}onComponentChanged(e){utils_1.default.onNodeChanged(e,{type:event_enum_1.NodeEventType.COMPONENT_CHANGED})}onEditorCameraMoved(){}registerCameraMovedEvent(){EditorCamera.camera.node.on("transform-changed",this.onEditorCameraMoved,this)}unregisterCameraMoveEvent(){EditorCamera.camera.node.off("transform-changed",this.onEditorCameraMoved,this)}onNodeSelectionChanged(e){this._nodeSelected=e}}exports.default=GizmoBase;