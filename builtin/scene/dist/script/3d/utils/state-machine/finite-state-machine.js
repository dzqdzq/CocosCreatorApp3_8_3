"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const transition_1=require("./transition");class FiniteStateMachine{constructor(t){t.length<1&&console.error("A FiniteStateMachine needs at least 1 state"),this._transitions=new Map,(this._states=t).forEach(t=>{this._transitions.set(t,new Map)})}addTransition(t,e,n,s){var i;return this._states.includes(t)?this._states.includes(e)?"function"==typeof s?null!=(i=this._transitions.get(t))&&i.set(n,new transition_1.DefaultStateTransition(t,e,s)):null!=(i=this._transitions.get(t))&&i.set(n,null!=s?s:new transition_1.DefaultStateTransition(t,e)):console.error("unknown to state"):console.error("unknown from state"),this}Begin(t){return t&&(this._states.includes(t)?this.currentState=t:console.error("unknown first state")),this}async issueCommand(t,e={}){var n=this._transitions.get(this.currentState);if(null!=n&&n.has(t)){n=n.get(t);if(!n)return!1;if(await n.testCondition(e))return await n.Complete(),await this.currentState.exit(),this.currentState=n.toState,await this.currentState.enter(e),!0}return!1}}exports.default=FiniteStateMachine;