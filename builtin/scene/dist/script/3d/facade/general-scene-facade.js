"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GeneralSceneFacade=void 0;const scene_facade_state_interface_1=require("./scene-facade-state-interface"),scene_1=__importDefault(require("../manager/scene")),camera_1=__importDefault(require("../manager/camera")),node_1=__importDefault(require("../manager/node")),component_1=__importDefault(require("../manager/component")),asset_1=__importDefault(require("../manager/asset")),gizmos_1=__importDefault(require("../manager/gizmos")),animation_1=__importDefault(require("../manager/animation")),scripts_1=__importDefault(require("../manager/scripts")),preview_1=require("../manager/preview"),selection_1=__importDefault(require("../manager/selection")),effects_1=__importDefault(require("../manager/effects")),terrain_1=__importDefault(require("../manager/terrain")),general_scene_proxy_1=__importDefault(require("../manager/scene/proxy/general-scene-proxy")),prefab_1=__importDefault(require("../manager/prefab")),lod_1=__importDefault(require("../manager/lod")),engine_1=require("../manager/engine"),plugin_1=__importDefault(require("../manager/plugin")),ui_1=__importDefault(require("../manager/ui")),particle_1=__importDefault(require("../manager/particle")),physics_2d_1=__importDefault(require("../manager/physics-2d")),particle_2d_1=__importDefault(require("../manager/particle-2d")),message_1=require("../manager/message"),scene_view_1=require("../manager/scene-view"),time_1=__importDefault(require("../manager/engine/time")),index_1=require("../../export/undo/index"),doNotSupportFunc="don't support this function in current mode";let isOperating=!1;class GeneralSceneFacade{constructor(){this._sceneMgr=scene_1.default,this._cameraMgr=camera_1.default,this._nodeMgr=node_1.default,this._compMgr=component_1.default,this._assetMgr=asset_1.default,this._gizmoMgr=gizmos_1.default,this._materialPreviewMgr=preview_1.previewMgr.materialPreview,this._miniPreviewMgr=preview_1.previewMgr.miniPreview,this._scriptMgr=scripts_1.default,this._previewMgr=preview_1.previewMgr,this._animationMgr=animation_1.default,this._selectionMgr=selection_1.default,this._effectMgr=effects_1.default,this._terrainMgr=terrain_1.default,this._prefabMgr=prefab_1.default,this._engineMgr=engine_1.engineManager,this._pluginMgr=plugin_1.default,this._uiMgr=ui_1.default,this._particleMgr=particle_1.default,this._lodMgr=lod_1.default,this._modelPreviewMgr=preview_1.previewMgr.modelPreview,this._meshPreviewMgr=preview_1.previewMgr.meshPreview,this._physics2DMgr=physics_2d_1.default,this._particle2DMgr=particle_2d_1.default,this._recycleNode={},this._recycleComponent={},this._undoMgr=new index_1.SceneUndoManager,this.isHold=!1,this.modeName=scene_facade_state_interface_1.SceneModeType.General,this.closeSceneWhenExit=!1,this._sceneEventListener=[]}init(){this.modeName=scene_facade_state_interface_1.SceneModeType.General,this._sceneProxy=new general_scene_proxy_1.default(this._sceneMgr,this),this._undoMgr.init(),this.initEventListener()}initEventListener(){this._sceneEventListener.push(this._nodeMgr),this._sceneEventListener.push(this._gizmoMgr),this._sceneEventListener.push(this._particleMgr),this._sceneEventListener.push(this._cameraMgr),this._sceneEventListener.push(this._prefabMgr),this._sceneEventListener.push(this._miniPreviewMgr),this._sceneEventListener.push(this._previewMgr.scenePreview),this._sceneEventListener.push(this._engineMgr),this._sceneEventListener.push(this._pluginMgr),this._sceneEventListener.push(this._assetMgr),this._sceneEventListener.push(scene_view_1.sceneViewManager),this._sceneEventListener.push(this._lodMgr)}async enter(e){console.debug("enter general scene facade"),void 0!==e.uuid&&null!==e.uuid&&await this.openScene(e.uuid),this.fromState&&this.fromState.modeName!==scene_facade_state_interface_1.SceneModeType.Preview&&(this.snapshot(),await this.fromState.patchSceneState()?(this.snapshot(),cce.SceneFacadeManager.changeTitle()):this.abortSnapshot()),Editor.EditMode.enter(this.modeName.toLocaleLowerCase()),this._sceneProxy.sendModeChangeMsg(this.modeName)}resetUndo(){this._undoMgr.reset(),this._recycleComponent={},this._recycleNode={}}async exit(){this._sceneProxy.storeScenePrefabUUID(),console.debug("exit general scene facade")}setCloseSceneWhenExit(){this.closeSceneWhenExit=!0}async checkToClose(){return this._sceneProxy.checkClose()}async closeSceneState(){return!this.closeSceneWhenExit||(this.closeSceneWhenExit=!1,this._sceneProxy.close())}async stagingSceneState(){return this._sceneProxy.staging()}fireCloseEvent(){this._sceneMgr.sendSceneCloseMsg(cc.director.getScene())}async openScene(e){Editor.Metrics.trackTimeStart("[Metrics]general-scene-open");let t=!1;return t=this.isHold&&e===this.queryCurrentSceneUuid()?(await this._sceneProxy.restore(),!(this.isHold=!1)):await this._sceneProxy.open(e),Editor.Metrics.trackTimeEnd("[Metrics]general-scene-open",{output:!0}),t}async closeScene(){var e;return!!await this._sceneProxy.checkClose()&&(e=await this._sceneProxy.close(),this._sceneProxy.sendModeChangeMsg(scene_facade_state_interface_1.SceneModeType.Unset),e)}async saveScene(e){return await this._sceneProxy.save(e)}dumpSceneState(){return this._sceneProxy.serialize()}async patchSceneState(){return this._sceneProxy.patch()}async restoreSceneState(e){return this._sceneProxy.restore(e)}async softReloadScene(e){e=await this._sceneProxy.softReload(e);return this._sceneMgr.emit("soft-reload",e),e}async reloadScene(){return this._sceneProxy.reload()}async queryNodeTree(e){return this._sceneMgr.queryNodeTree(e)}async queryNodesByAssetUuid(e){}async querySceneSerializedData(){return this._sceneProxy.serialize()}async querySceneDirty(){return this._undoMgr.isDirty()}async queryClasses(e){return this._sceneMgr.queryClasses(e)}async queryComponents(){return this._sceneMgr.queryComponents()}async queryComponentHasScript(e){return this._sceneMgr.queryComponentHasScript(e)}async queryLayerBuiltin(){return this._sceneMgr.queryLayerBuiltin()}async querySortingLayerBuiltin(){return this._sceneMgr.querySortingLayerBuiltin()}queryMode(){return this.modeName}queryCurrentSceneUuid(){return this._sceneProxy.queryCurrentSceneUuid()}dispatchEvents(t,...r){this._sceneEventListener.forEach(e=>{e&&e[t]&&e[t].apply(e,r)})}onSceneOpened(e){this.dispatchEvents("onSceneOpened",e)}onSceneReload(e){this.dispatchEvents("onSceneReload",e)}onSceneClosed(e){this.dispatchEvents("onSceneClosed",e)}onResize(e){this.dispatchEvents("onResize",e)}queryRecycleNode(e){return null!=(e=this._recycleNode[e])?e:null}queryRecycleComponent(e){return null!=(e=this._recycleComponent[e])?e:null}async queryNodeDump(e){return this._nodeMgr.queryDump(e)}async queryComponentFunctionOfNode(e){return this._nodeMgr.queryComponentFunctionOfNode(e)}async previewSetNodeProperty(e){return this._nodeMgr.previewSetNodeProperty(e.uuid,e.path,e.dump)}async cancelPreviewSetNodeProperty(e){return this._nodeMgr.cancelPreviewSetNodeProperty(e.uuid,e.path)}async setNodeProperty(e){return this._nodeMgr.setProperty(e.uuid,e.path,e.dump)}async resetNode(e){return this._nodeMgr.resetNode(e)}async resetNodeProperty(e){return this._nodeMgr.resetProperty(e.uuid,e.path)}async updateNodePropertyFromNull(e){return this._nodeMgr.updatePropertyFromNull(e.uuid,e.path)}async setNodeAndChildrenLayer(e){return this._nodeMgr.setNodeAndChildrenLayer(e.uuid,e.dump)}async moveNodeArrayElement(e){return!("children"===e.path&&!this._prefabMgr.canModifySibling(e.uuid,e.target,e.offset))&&this._nodeMgr.moveArrayElement(e.uuid,e.path,e.target,e.offset)}async removeNodeArrayElement(e){return this._nodeMgr.removeArrayElement(e.uuid,e.path,e.index)}async generateNodeAvailableName(e,t){return this._nodeMgr.generateAvailableName(e,t)}selectAllNodes(){this._gizmoMgr.lightProbeEditMode&&this._gizmoMgr.selectAllLightProbes()}copyNode(e){return this._nodeMgr.copyNode(e)}duplicateNode(e){let t=[];if(!isOperating)if(this.queryLightProbeEditMode())this.duplicateCurrentSelectedProbes();else{!e&&(e=this.querySelection());const i=[];(Array.isArray(e)?e:[e]).forEach(e=>{var e=this._nodeMgr.query(e),e=this._nodeMgr.getNewNodeParent(null==(e=null==e?void 0:e.parent)?void 0:e.uuid);e&&!i.includes(e.uuid)&&i.push(e.uuid)});var r=this.beginRecording(i);t=this._nodeMgr.duplicateNode(e),this.endRecording(r),this.clearSelection(),t.forEach(e=>{e&&this.selectNode(e)})}return t}async pasteNode(t){let r=[],e=!1;if(!isOperating)if(this.queryLightProbeEditMode())this.duplicateCurrentSelectedProbes();else{if(!t){const s=this.querySelection()[0];var i=Editor.Clipboard.read("nodes-info");if(!i)return r;var{type:i,uuids:n}=i;if("cut"===i){let t=!1;if(n.every(e=>{if(s===e)return console.warn(Editor.I18n.t("scene.messages.cannot_cut_to_self")),!(t=!0)}),t)return r;isOperating=!0;i=this.beginRecording([s,...n]);r=await this.setNodeParent({parent:s,uuids:n,keepWorldTransform:!1}),this.endRecording(i),e=!0,Editor.Clipboard.clear()}t={target:s,uuids:n,keepWorldTransform:!1}}if(isOperating=!0,!e){let e=t.target;t.pasteAsChild||(i=await this.queryNodeDump(t.target))&&i.parent&&(e=i.parent.value.uuid);n=this.beginRecording(e);r=await this._nodeMgr.pasteNode(e,t.uuids,t.keepWorldTransform),this.endRecording(n)}cce.Selection.clear(),r.forEach(e=>{e&&this.selectNode(e)}),isOperating=!1}return r}async setNodeParent(e){var t=this._prefabMgr.filterChildOfPrefabAssetWhenSetParent(e.uuids);return!t||t.length<=0?t:this._nodeMgr.setParent(e.parent,t,e.keepWorldTransform)}async createNode(e){return(e=e||{}).nameIncrease&&(e.name=await this.generateNodeAvailableName(e.name||"Node",e.parent)),e.assetUuid?this._nodeMgr.createNodeFromAsset(e.parent,e.assetUuid,e):this._nodeMgr.createNode(e.parent,e.name||"",null,e.keepWorldTransform)}async removeNode(e){if(!isOperating)if(this.queryLightProbeEditMode())e?console.warn(Editor.I18n.t("scene.contributions.messages.description.light_probe_delete_when_editing_probe")):this.removeCurrentSelectedProbes();else{!e&&(e={uuid:this.querySelection()},cce.Selection.clear());var t=this._prefabMgr.filterChildOfPrefabAssetWhenRemoveNode(e.uuid);const i=[];t.forEach(e=>{e=this._nodeMgr.query(e),e=null==e?void 0:e.parent;e&&!i.includes(e.uuid)&&i.push(e.uuid)});var r=this._undoMgr.beginRecording(i);this._nodeMgr.removeNode(t,e.keepWorldTransform),this.endRecording(r)}}async changeNodeLock(e,t,r){this._nodeMgr.changeNodeLock(e,t,r)}async restorePrefab(e,t){return this._prefabMgr.revertPrefab(e)}onNodeBeforeChanged(e){this._undoMgr.updateDump([e.uuid],!1)}onNodeChanged(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onNodeChanged",e,t),this._prefabMgr.onNodeChangedInGeneralMode(e,t,this._sceneProxy.getRootNode()),!1!==t.record&&this.recordNode(e)}onAddNode(e){this.dispatchEvents("onAddNode",e),e.parent&&this.recordNode(e)}onRemoveNode(e){this.dispatchEvents("onRemoveNode",e),e.parent||this.recordNode(e)}onNodeAdded(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onNodeAdded",e,t),e.parent&&this.recordNode(e),this._recycleNode[e.uuid]&&delete this._recycleNode[e.uuid]}onNodeRemoved(e,t){t.modeName=this.modeName,this.dispatchEvents("onNodeRemoved",e,t),this._prefabMgr.checkToRemoveTargetOverride(e,this._sceneProxy.getRootNode()),Editor.Selection.unselect("node",e.uuid),e.parent||this.recordNode(e),this._recycleNode[e.uuid]=e}async queryComponent(e){return this._compMgr.queryDump(e)}createComponent(e){this._nodeMgr.createComponent(e.uuid,e.component)}async resetComponent(e){this._nodeMgr.resetComponent(e)}async removeComponent(e){this._nodeMgr.removeComponent(e.uuid)}async executeComponentMethod(e){return this._compMgr.executeComponentMethod(e.uuid,e.name,e.args)}async executeSceneScriptMethod(e){return this._pluginMgr.executeSceneScript(e)}onAddComponent(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onAddComponent",e,t)}onRemoveComponent(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onRemoveComponent",e,t),this._prefabMgr.onRemoveComponentInGeneralMode(e,this._sceneProxy.getRootNode())}onComponentAdded(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onComponentAdded",e,t),this._recycleComponent[e.uuid]&&delete this._recycleComponent[e.uuid]}onComponentRemoved(e,t={}){t.modeName=this.modeName,this.dispatchEvents("onComponentRemoved",e),this._prefabMgr.onComponentRemovedInGeneralMode(e,this._sceneProxy.getRootNode()),this._recycleComponent[e.uuid]=e}async snapshot(e){console.debug("snapshot is deprecated, please use beginRecording/endRecording instead"),this._undoMgr.snapshot(e)}abortSnapshot(){console.debug("abortSnapshot is deprecated, please use cancelRecording instead"),this._undoMgr.abort()}beginRecording(e,t){return this._undoMgr.beginRecording(e,t)}cancelRecording(e){return this._undoMgr.cancelRecording(e)}endRecording(e){e=this._undoMgr.endRecording(e);return this.changeTitle(),e}async undo(){await this._undoMgr.undo()}async redo(){await this._undoMgr.redo()}recordNode(e,t=!0){t&&this._undoMgr.record(e.uuid)}async queryAllEffects(){return this._assetMgr.queryAllEffects()}async queryMaterial(e){return this._assetMgr.queryMaterial(e)}async queryEffect(e){return this._assetMgr.queryEffect(e)}async queryRenderPipeline(e){return this._assetMgr.queryRenderPipeline(e)}async changeRenderPipeline(e){return this._assetMgr.changeRenderPipeline(e)}async applyRenderPipeline(e){await this._assetMgr.applyRenderPipeline(e)}async previewMaterial(e,t,r){return this._assetMgr.previewMaterial(e,t,r)}async applyMaterial(e,t){await this._assetMgr.applyMaterial(e,t)}async changePhysicsMaterial(e){return this._assetMgr.changePhysicsMaterial(e)}async applyPhysicsMaterial(e){await this._assetMgr.applyPhysicsMaterial(e)}async changeAnimationGraphVariant(e){return this._assetMgr.changeAnimationGraphVariant(e)}async applyAnimationGraphVariant(e){await this._assetMgr.applyAnimationGraphVariant(e)}async changeAnimationMask(e){return this._assetMgr.changeAnimationMask(e)}async applyAnimationMask(e){await this._assetMgr.applyAnimationMask(e)}async applyRenderTexture(e,t){await this._assetMgr.applyRenderTexture(e,t)}queryPhysicsMaterial(e){return this._assetMgr.queryPhysicsMaterial(e)}queryAnimationGraphVariant(e){return this._assetMgr.queryAnimationGraphVariant(e)}queryAnimationMask(e){return this._assetMgr.queryAnimationMask(e)}queryCreatableAssetTypes(){return this._nodeMgr.creatableAssetTypes}async assetChange(e,t,r){this.dispatchEvents("onAssetChanged",e,t,r)}assetDelete(e,t){this.dispatchEvents("onAssetDeleted",e,t)}assetRefresh(e){this._animationMgr.onAssetRefreshed(e)}async gizmoRefreshConfig(){return this._gizmoMgr.initFromConfig()}async queryGizmoToolName(){return this._gizmoMgr.transformToolName}async queryGizmoPivot(){return this._gizmoMgr.pivot}async queryGizmoCoordinate(){return this._gizmoMgr.coordinate}async queryIs2D(){return this._gizmoMgr.is2D}queryIsIconGizmo3D(){return this._gizmoMgr.isIconGizmo3D()}queryIconGizmoSize(){return this._gizmoMgr.queryIconGizmoSize()}updateInnerTetrahedron(){this._gizmoMgr.updateLightProbeInnerTetrahedron()}async setTransformToolName(e){this.queryLightProbeEditMode()||this.queryLightProbeBoundingBoxEditMode()||(this.toggleLightProbeEditMode(!1),this.toggleLightProbeBoundingBoxEditMode(!1),this._gizmoMgr.transformToolName=e)}async setPivot(e){this._gizmoMgr.pivot=e}async setCoordinate(e){this._gizmoMgr.coordinate=e}async setIs2D(e){this._gizmoMgr.is2D=e}async setIconGizmo3D(e){await this._gizmoMgr.setIconGizmo3D(e)}async setIconGizmoSize(e){await this._gizmoMgr.setIconGizmoSize(e)}async setToolsVisibility3d(e){await this._gizmoMgr.setToolsVisibility3d(e)}focus(e=null,t,r){this._cameraMgr.focus(e,t,r)}alignNodeToSceneView(e){this._cameraMgr.alignNodeToSceneView(e)}queryIsGridVisible(){return this._cameraMgr.isGridVisible()}setGridVisible(e){this._cameraMgr.setGridVisible(e)}alignWithView(){var e=selection_1.default.query();e&&this._cameraMgr.alignNodeToSceneView(e)}alignViewWithNode(){var e=selection_1.default.query();e&&this._cameraMgr.alignSceneViewToNode(e)}setGridLineColor(e){this._cameraMgr.setGridLineColor(e)}getCameraProperty(){return this._cameraMgr.getCameraProperty()}setCameraProperty(e){this._cameraMgr.setCameraProperty(e)}resetCameraProperty(){this._cameraMgr.resetCameraProperty()}getCameraWheelSpeed(){return this._cameraMgr.getWheelSpeed()}setCameraWheelSpeed(e){this._cameraMgr.setWheelSpeed(e)}getCameraWanderSpeed(){return this._cameraMgr.getWanderSpeed()}setCameraWanderSpeed(e){this._cameraMgr.setWanderSpeed(e)}zoomSceneViewUp(){this._cameraMgr.zoomUp()}zoomSceneViewDown(){this._cameraMgr.zoomDown()}resetSceneViewZoom(){this._cameraMgr.zoomReset()}toggleActiveSelectedNode(){for(const t of Editor.Selection.getSelected("node")){var e=this._nodeMgr.query(t);e&&(e.active=!e.active,cce.Node.emit("change",e))}}toggleActiveUnselectedNode(){var e=Editor.Selection.getSelected("node");e.map(e=>{return null==(e=this._nodeMgr.query(e))?void 0:e.parent}).filter(Boolean);for(const t of e){const r=this._nodeMgr.query(t);if(r){if(!r.parent)return r.active=!r.active,void cce.Node.emit("change",r);r.parent.children.every(e=>e.uuid===r.uuid||e.active!==r.active)&&(r.active=!r.active,cce.Node.emit("change",r));for(const i of r.parent.children)e.includes(i.uuid)||i.active===r.active&&(i.active=!r.active,cce.Node.emit("change",i))}}}toggleActiveAllNodes(){var e=Editor.Selection.getSelected("node");for(const r of e){var t=this._nodeMgr.query(r);if(t){if(!t.parent)return t.active=!t.active,void cce.Node.emit("change",t);if(t.active=!t.active,t.parent)for(const i of t.parent.children)e.includes(i.uuid)||(i.active=t.active,cce.Node.emit("change",t))}}}queryCurrentAnimationState(){return console.debug(doNotSupportFunc,"queryCurrentAnimationState"),null}queryCurrentAnimationInfo(){return this._animationMgr.getEditAnimationInfo()}queryAnimationRootNode(e){return this._animationMgr.queryAnimationRoot(e)}queryAnimationRootInfo(e){return this._animationMgr.queryAnimationRootInfo(e)}queryAnimationClipDump(e,t){return this._animationMgr.queryAnimationClipDump(e,t)}queryAnimationProperties(e){return this._animationMgr.queryProperties(e)}queryAnimationClipsInfo(e){return this._animationMgr.queryAnimClipsInfo(e)}queryAnimationClipCurrentTime(e){return this._animationMgr.queryPlayingClipTime(e)}queryAnimationPropValueAtFrame(e,t,r,i){return console.debug(doNotSupportFunc,this.modeName,"queryAnimationPropValueAtFrame"),null}queryAuxCurveValueAtFrame(e,t,r){return console.debug(doNotSupportFunc,this.modeName,this.queryAuxCurveValueAtFrame.name),null}async recordAnimation(e,t,r){return this._animationMgr.curEditRootNodeUuid=e,r&&await this._animationMgr.setEditClip(r),!1}async changeAnimationRootNode(e,t){return animation_1.default.changeAnimNode(e,t)}async setCurEditTime(e){return console.debug(doNotSupportFunc,this.modeName,"setCurEditTime"),!1}async changeClipState(e,t){return console.debug(doNotSupportFunc,this.modeName,"changeClipState"),!1}async setEditClip(e){return animation_1.default.setEditClip(e)}async saveClip(){return console.debug(doNotSupportFunc,this.modeName,"saveClip"),!1}async applyAnimationOperation(e){return console.debug(doNotSupportFunc,this.modeName,"applyAnimationOperation"),{state:"failure",result:null}}queryAnimationNodeEditInfo(e){return animation_1.default.queryAnimationNodeEditInfo(e)}queryAuxiliaryCurves(e){return this._animationMgr.queryAuxiliaryCurves(e)}async queryScriptName(e){return this._scriptMgr.queryScriptName(e)}async queryScriptCid(e){return this._scriptMgr.queryScriptCid(e)}async loadScript(e){return this._scriptMgr.loadScript(e)}async removeScript(e){return this._scriptMgr.removeScript(e)}async scriptChange(e){return this._scriptMgr.scriptChange(e)}querySelection(){return this._selectionMgr.query()}isSelectNode(e){return this._selectionMgr.isSelect(e)}selectNode(e){this._selectionMgr.select(e)}unselectNode(e){this._selectionMgr.unselect(e)}clearSelection(){this._selectionMgr.clear()}registerEffects(e){this._effectMgr.registerEffects(e)}removeEffects(e){this._effectMgr.removeEffects(e)}updateEffect(e){this._effectMgr.updateEffect(e)}onRemoveTerrain(e,t){this._terrainMgr.onRemoveTerrain(e,t)}async createPrefab(e,t){return this._prefabMgr.createPrefabAssetFromNode(e,t)}getPrefabData(e){e=this._prefabMgr.generatePrefabDataFromNode(e);return e?e.prefabData:null}linkPrefab(e,t){return this._prefabMgr.linkNodeWithPrefabAsset(e,t)}unlinkPrefab(e,t){var r=this._prefabMgr.getUnlinkNodeUuids(e,t),r=this._undoMgr.beginRecording(r),e=this.doUnlinkPrefab(e,t);return e?this.endRecording(r):this.cancelRecording(r),e}doUnlinkPrefab(e,t){return this._prefabMgr.unWrapPrefabInstance(e,t)}async applyPrefab(e){return this._prefabMgr.applyPrefab(e)}distributeSelectionUI(e){this._uiMgr.distributeSelection(e)}alignSelectionUI(e){this._uiMgr.alignSelection(e)}queryParticlePlayInfo(e){return this._particleMgr.queryPlayInfo(e)}setParticlePlaySpeed(e,t){this._particleMgr.setPlaySpeed(e,t)}playParticle(){this._particleMgr.play()}restartParticle(){this._particleMgr.restart()}pauseParticle(){this._particleMgr.pause()}stopParticle(){this._particleMgr.stop()}applyCurrentCameraSize(e){return this._lodMgr.applyCurrentCameraSize(e)}insertLOD(e,...t){this._lodMgr.insertLOD(e,...t)}eraseLOD(e,...t){this._lodMgr.eraseLOD(e,...t)}async updatePhysicsGroup(){const i={};for(const a in cc.internal.PhysicsGroup){var e=cc.internal.PhysicsGroup[a];i[e]=a}const n={};for(const o in cc.internal.PhysicsGroup2D){var t=cc.internal.PhysicsGroup2D[o];n[t]=o}var r=await Editor.Profile.getProject("project","physics.collisionGroups")||[];const s={};r.forEach(e=>{var t=1<<e.index,r=i[t],r=(r&&(delete cc.internal.PhysicsGroup[t],delete cc.internal.PhysicsGroup[r]),n[t]);r&&(delete cc.internal.PhysicsGroup2D[t],delete cc.internal.PhysicsGroup2D[r]),s[e.name]=t}),Object.assign(cc.internal.PhysicsGroup,s),cc.Enum.update(cc.internal.PhysicsGroup),Object.assign(cc.internal.PhysicsGroup2D,s),cc.Enum.update(cc.internal.PhysicsGroup2D)}onEngineUpdate(){this._cameraMgr.onUpdate(time_1.default.deltaTime),this._gizmoMgr.onUpdate(time_1.default.deltaTime)}regeneratePolygon2DPoints(e){this._physics2DMgr.resetPointsByUuid(e)}async exportParticlePlist(e){return this._particle2DMgr.exportParticlePlist(e)}duplicateCurrentSelectedProbes(){this._gizmoMgr.duplicateCurrentSelectedProbes()}removeCurrentSelectedProbes(){this._gizmoMgr.removeCurrentSelectedProbes()}toggleLightProbeEditMode(e){return this._gizmoMgr.lightProbeEditMode=Boolean(e),this._gizmoMgr.lightProbeEditMode}queryLightProbeEditMode(){return this._gizmoMgr.lightProbeEditMode}toggleLightProbeBoundingBoxEditMode(e){return this._gizmoMgr.lightProbeBoundingBoxEditMode=Boolean(e),this._gizmoMgr.lightProbeBoundingBoxEditMode}queryLightProbeBoundingBoxEditMode(){return this._gizmoMgr.lightProbeBoundingBoxEditMode}async changeTitle(){var e;isPreviewProcess||this.modeName!==scene_facade_state_interface_1.SceneModeType.General&&this.modeName!==scene_facade_state_interface_1.SceneModeType.Prefab||(e=await this.querySceneDirty(),message_1.messageManager.IpcSend("change-title",this.queryCurrentSceneUuid(),e))}}exports.GeneralSceneFacade=GeneralSceneFacade,exports.default=GeneralSceneFacade;