"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const EventEmitter_1=__importDefault(require("../../../public/EventEmitter")),cc_1=require("cc"),utils_1=require("../../manager/prefab/utils"),message_1=require("../message");class SceneManager extends EventEmitter_1.default{constructor(){super(),this.rootNode=null,this.ignore=!1}queryNodeTree(e){const n=e=>{var t,s,r;return e.objFlags&cc.Object.Flags.HideInHierarchy?null:(t=e.children.map(n).filter(Boolean),s=utils_1.prefabUtils.getPrefabStateInfo(e),r="Scene"===e.constructor.name,{name:!e.name&&r?"Scene":e.name,active:e.active,locked:Boolean(e.objFlags&cc.Object.Flags.LockedInEditor),type:"cc."+e.constructor.name,uuid:e.uuid,children:t.length?t:[],prefab:s,parent:e.parent&&e.parent.uuid||"",path:r?"/":e.getPathInHierarchy(),isScene:r,readonly:!1,components:e.components.map(e=>({type:cc.js.getClassName(e.constructor),value:e.uuid,extends:cc.Class.getInheritanceChain(e.constructor).map(e=>cc.js.getClassName(e)).filter(Boolean)}))})};return e?(e=cce.Node.query(e))?n(e):null:(e=cc_1.director.getScene())?n(e):null}queryClasses(s){var e=[];for(const t in cc.js._registeredClassNames)if(s){"string"==typeof s.extends&&(s.extends=[s.extends]);const r=cc.js._registeredClassNames[t];Array.isArray(s.extends)&&s.extends.some(e=>{var e=cc.js.getClassByName(e),t=cc.js.isChildClassOf(r,e);return s.excludeSelf?t&&e!==r:t})&&e.push({name:t})}else e.push({name:t});return e}async queryComponents(){let e=EditorExtends.Component.getMenus();var t=await Editor.Profile.getProject("engine","modules.includeModules");return(e=t&&!t.includes("3d")?e.filter(e=>"Effects/ParticleSystem"!==e.menuPath&&!(e.menuPath.startsWith("Light/")||e.menuPath.startsWith("Mesh/")||e.menuPath.startsWith("Physics/"))):e).map(e=>{var t=cc.js.getClassName(e.component),s=cc.js.getClassId(e.component);let r;return-1!==e.menuPath.indexOf("i18n:menu.custom_script")&&(r=e.component.prototype.__scriptUuid),{name:t,cid:s,path:e.menuPath,assetUuid:r}})}queryComponentHasScript(t){return this.queryClasses().some(e=>e.name===t)}queryLayerBuiltin(){let e=Object.keys(cc.Layers.Enum).map((e,t)=>({name:e,value:cc.Layers.Enum[e]}));return e=e.filter(e=>0!==e.value&&4294967295!==e.value)}querySortingLayerBuiltin(){return cc_1.SortingLayers.getBuiltinLayers()}sendSceneOpenMsg(e,t,s){this.rootNode=s,this.emit("open",e),message_1.messageManager.broadcast("scene:ready",t),cce.Ipc.send("scene:ready")}sendSceneCloseMsg(e){this.emit("close",e),message_1.messageManager.broadcast("scene:close"),cce.Ipc.send("scene:close")}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}emit(e,...t){return super.emit(e,...t)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}addListener(e,t){return super.addListener(e,t)}}exports.default=SceneManager;