"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var a=Object.getOwnPropertyDescriptor(t,i);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,a)}:function(e,t,i,n){e[n=void 0===n?i:n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransitionPreview=void 0;const animationApi=__importStar(require("cc/editor/new-gen-anim")),base_1=require("./base");class TransitionPreview extends base_1.AnimationGraphPreviewBase{constructor(){super(...arguments),this.transition=null}hide(){super.hide(),this.transition=null}show(e,t,i){if(!i)return base_1.PreviewState.NO_ANIMATION_GRAPH;if(!this.hasModel())return base_1.PreviewState.NO_MODEL;if(!animationApi.isAnimationTransition(e))return base_1.PreviewState.ILLEGAL_TRANSITION;this.playState!==base_1.PlayState.STOP&&this.stop(),this.setVariables(i);var i=e=>!(!e||e instanceof animationApi.ClipMotion&&!e.clip),n=[...extractMotionStatesAsPreviewSource(t,e.from)];return 0!==n.length&&(n=n[0]).motion&&i(n.motion)?(n=n.motion,0!==(t=[...extractMotionStatesAsPreviewDestination(t,e.to)]).length&&(t=t[0]).motion&&i(t.motion)?(i=t.motion,this.previewer.setSourceMotion(n),this.previewer.setTargetMotion(i),this.transition=e,this.cameraComp.enabled=!0,this.setProp(),this.active=!0,base_1.PreviewState.NO_ERROR):base_1.PreviewState.NO_TRANSITION_DESTINATION_MOTION):base_1.PreviewState.NO_TRANSITION_SOURCE_MOTION}setProp(){this.transition&&(this.previewer.setTransitionDuration(this.transition.duration),this.previewer.setRelativeTransitionDuration(this.transition.relativeDuration),this.previewer.setExitTimes(this.transition.exitCondition),this.previewer.setExitTimeEnabled(this.transition.exitConditionEnabled),this.previewer.setDestinationStart(this.transition.destinationStart),this.update())}createPreviewer(e){return new animationApi.TransitionPreviewer(e)}getLightName(){return"transition preview light"}getUpdateMessageName(){return"scene:update-transition-preview"}}function*extractMotionStatesAsPreviewSource(e,t){yield*function*e(t,i,n){if(n.has(i))return;n.add(i);if(i instanceof animationApi.MotionState)yield i;else if(i===t.exitState)for(const a of t.getIncomings(i))yield*e(t,a.from,n);else if(i===t.anyState)for(const i of t.states())yield*e(t,i,n);else i instanceof animationApi.SubStateMachine&&(yield*e(i.stateMachine,i.stateMachine.exitState,n))}(e,t,new Set)}function*extractMotionStatesAsPreviewDestination(e,t){yield*function*e(t,i,n){if(n.has(i))return;if(i instanceof animationApi.MotionState)yield i;else if(i===t.entryState)for(const a of t.getOutgoings(i))yield*e(t,a.to,n);else i instanceof animationApi.SubStateMachine&&(yield*e(i.stateMachine,i.stateMachine.entryState,n))}(e,t,new Set)}exports.TransitionPreview=TransitionPreview;