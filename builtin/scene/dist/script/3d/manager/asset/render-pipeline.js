"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const edit_component_asset_1=__importDefault(require("./edit-component-asset")),ElectronModule=require("@base/electron-module"),EditorExtends=ElectronModule.require("EditorExtends");class EditRenderPipeline extends edit_component_asset_1.default{constructor(){super(...arguments),this.changeTypes={_flows:{componentKey:"flow",optionalTypes:[]},_stages:{componentKey:"stage",optionalTypes:[]}}}queryComponents(o=void 0){return EditorExtends.Component.getMenus().map(e=>{var t=`hidden:render_${o}/`;return-1!==e.menuPath.indexOf(t)&&e.component?e.menuPath.replace(t,""):null}).filter(Boolean)}preview(){var e=cc.director.root.pipeline;e&&void 0!==e._uuid&&e._uuid===this.component.uuid&&(cc.director.root.setRenderPipeline(this.component),cce.Engine.repaintInEditMode())}modifyProp(e,t){if(e.name=t,!1!==e.visible&&e.value&&"object"==typeof e.value){var o=this.changeTypes[t];o&&(t=this.queryComponents(o.componentKey),o.optionalTypes=t),e.isArray&&e.elementTypeData&&o&&(this.modifyProp(e.elementTypeData),e.elementTypeData.optionalTypes=o.optionalTypes);for(const n in e.value)"object"==typeof e.value[n]&&(this.modifyProp(e.value[n],n),e.isArray)&&o&&(e.value[n].optionalTypes=o.optionalTypes)}}encodeComponent(e){var t=super.encodeComponent(e);return{name:"Pipeline",type:e.constructor.name,value:t,visible:!0,readonly:!1,optionalTypes:this.queryComponents("pipeline")}}async updateComponent(e){var t;return this.component.constructor.name!==e.type&&(t=cc.js.getClassByName(e.type))&&(t=new t,this.cacheComponent(t)),super.updateComponent(e.value)}}exports.default=new EditRenderPipeline;