"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){e[r=void 0===r?i:r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const edit_component_asset_1=__importDefault(require("./edit-component-asset")),animationApi=__importStar(require("cc/editor/new-gen-anim")),asset_1=require("../../../utils/asset");class EditAnimationGraphVariant extends edit_component_asset_1.default{constructor(){super(...arguments),this.overrides={},this.invalidEntries={}}resetOverrides(){if(this.overrides={},this.invalidEntries={},this.component.original)for(const t of animationApi.visitAnimationClips(this.component.original))t&&(this.overrides[t._uuid]="");var e=this.entryOverrides();for(const i in e)void 0===this.overrides[i]?this.invalidEntries[i]=e[i]:this.overrides[i]=e[i]}entryOverrides(){const t={};return[...this.component.clipOverrides].forEach(e=>{t[e.original._uuid]=e.substitution._uuid}),t}cacheComponent(e){super.cacheComponent(e),this.resetOverrides()}encodeComponent(){var e;return{graphUuid:null==(e=this.component.original)?void 0:e._uuid,clips:this.overrides,invalids:this.invalidEntries}}async updateComponent(e){var t=null==(t=this.component.original)?void 0:t._uuid;if(e.graphUuid!==t)e.graphUuid?this.component.original=await(0,asset_1.loadAssetUncached)(e.graphUuid):this.component.original=null,this.resetOverrides();else for(const i in e.clips)this.overrides[i]=e.clips[i];return this.encodeComponent()}async applyComponent(){this.component.clipOverrides.clear();try{for(const i in this.overrides){var e,t;this.overrides[i]&&(e=await(0,asset_1.loadAssetUncached)(i),t=await(0,asset_1.loadAssetUncached)(this.overrides[i]),this.component.clipOverrides.set(e,t))}}catch(e){return void console.error(e)}return this.getComponent()}}exports.default=new EditAnimationGraphVariant;