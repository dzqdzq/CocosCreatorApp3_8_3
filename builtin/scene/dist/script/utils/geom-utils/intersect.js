"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cc_1=require("cc"),ray=cc_1.geometry.Ray,aabb=cc_1.geometry.AABB,triangle=cc_1.geometry.Triangle,tempVec3_a=new cc_1.Vec3,ray_triangle=function(){const r=new cc_1.Vec3(0,0,0),_=new cc_1.Vec3(0,0,0),V=new cc_1.Vec3(0,0,0),m=new cc_1.Vec3(0,0,0),o=new cc_1.Vec3(0,0,0);return function(c,e,t=!1,a){cc_1.Vec3.subtract(r,e.b,e.a),cc_1.Vec3.subtract(_,e.c,e.a),cc_1.Vec3.cross(V,c.d,_);var n=cc_1.Vec3.dot(r,V);if(n<Number.EPSILON&&(!t||n>-Number.EPSILON))return 0;t=1/n,cc_1.Vec3.subtract(m,c.o,e.a),n=cc_1.Vec3.dot(m,V)*t;if(n<0||1<n)return 0;cc_1.Vec3.cross(o,m,r);e=cc_1.Vec3.dot(c.d,o)*t;return e<0||1<n+e||(n=cc_1.Vec3.dot(_,o)*t)<0?0:(cc_1.Vec3.scaleAndAdd(a,c.o,c.d,n),n)}}(),ray_aabb=function(){const V=new cc_1.Vec3,m=new cc_1.Vec3;return function(c,e){var t=c.o,c=c.d,a=1/c.x,n=1/c.y,c=1/c.z,e=(cc_1.Vec3.subtract(V,e.center,e.halfExtents),cc_1.Vec3.add(m,e.center,e.halfExtents),(V.x-t.x)*a),a=(m.x-t.x)*a,r=(V.y-t.y)*n,n=(m.y-t.y)*n,_=(V.z-t.z)*c,t=(m.z-t.z)*c,c=Math.max(Math.max(Math.min(e,a),Math.min(r,n)),Math.min(_,t)),e=Math.min(Math.min(Math.max(e,a),Math.max(r,n)),Math.max(_,t));return e<0||e<c?0:0<c?c:e}}(),ray_segment=function(){const h=new cc_1.Vec3,M=new cc_1.Vec3,x=new cc_1.Vec3,y=new cc_1.Vec3;return function(c,e,t,a=2,n){var a=a*a,e=(cc_1.Vec3.add(tempVec3_a,e,t),cc_1.Vec3.multiplyScalar(h,tempVec3_a,.5),cc_1.Vec3.subtract(tempVec3_a,t,e),cc_1.Vec3.normalize(M,tempVec3_a),cc_1.Vec3.subtract(x,c.o,h),.5*cc_1.Vec3.distance(e,t)),t=-c.d.dot(M),r=x.dot(c.d),_=-x.dot(M),V=x.lengthSqr(),m=Math.abs(1-t*t);let o,s,i,d,u=(i=0<m?(o=t*_-r,s=t*r-_,d=e*m,0<=o?s>=-d?s<=d?(m=1/m,o*=m,s*=m,o*(o+t*s+2*r)+s*(t*o+s+2*_)+V):(s=e,-(o=Math.max(0,-(t*s+r)))*o+s*(s+2*_)+V):(s=-e,-(o=Math.max(0,-(t*s+r)))*o+s*(s+2*_)+V):s<=-d?(o=Math.max(0,-(-t*e+r)),s=0<o?-e:Math.min(Math.max(-e,-_),e),-o*o+s*(s+2*_)+V):s<=d?(o=0,(s=Math.min(Math.max(-e,-_),e))*(s+2*_)+V):(o=Math.max(0,-(t*e+r)),s=0<o?e:Math.min(Math.max(-e,-_),e),-o*o+s*(s+2*_)+V)):(s=0<t?-e:e,-(o=Math.max(0,-(t*s+r)))*o+s*(s+2*_)+V),y&&cc_1.Vec3.scaleAndAdd(y,h,M,s),n&&n.set(y),0);return u=i<a?cc_1.Vec3.distance(c.o,y):u}}(),intersect={ray_triangle:ray_triangle,ray_aabb:ray_aabb,ray_segment:ray_segment};exports.default=intersect;