"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.serialize=exports.serializeSafe=void 0;const cc_1=require("cc"),DELIMETER=cc.Class.Attr.DELIMETER,debugInfo=[],nodeExcludeProps=["_parent","_children","_prefab","_components"],checkedObjectSet=new Set;function checkComponents(t,c=""){var r=t.components;if(Array.isArray(r))for(let e=r.length-1;0<=e;e--){var a=r[e];if(a){if(a.node!==t&&(a.node=t,debugInfo.push()),checkedObjectSet.has(a))return;checkedObjectSet.add(a),checkSerializableProperties(a,c+":"+a.name)}else r.splice(e,1)}else debugInfo.push(t.getPathInHierarchy()+"'s components is not array")}const baseTypeMap=new Map;function checkBaseType(e,t,c=""){if(cc.js.isChildClassOf(e.constructor,cc.ValueType)){var r=getDefaultMap(e.constructor);for(const a of t)typeof e[a]!=typeof r[a]&&debugInfo.push(`${c}|${a}'s value:${e[a]} is illegal,attr:`+r[a]);return!0}return!1}function getDefaultMap(e){let c=baseTypeMap.get(e);if(!c){c={},baseTypeMap.set(e,c);const r=e.__attrs__;e.__values__.forEach(e=>{var t=""+e+DELIMETER+"default";c[e]=r[t]})}return c}function checkSerializableProperties(e,r="",t){var c=e.constructor,t=null!=t?t:c.__values__,a=getDefaultMap(c);for(const s of t){const i=e[s];var n=typeof i;if(i&&i.constructor&&i.constructor.__values__){if(checkedObjectSet.has(i))return;checkedObjectSet.add(i),checkSerializableProperties(i,r+"."+s)}else"object"==n?Object.keys(i).forEach(e=>{var t=i[e],c=t?t.constructor:void 0;c&&c.__values__&&(checkedObjectSet.has(t)||(checkedObjectSet.add(t),checkSerializableProperties(t,r+"."+e)))}):n!=typeof a[s]&&(debugInfo.push(`${r}.${s}'s value:${e[s]} is illegal,attr:`+a[s]),e[s]=a[s])}}function checkPrefabInfo(e){e=e._prefab;if(e){var t={},c=e.nestedPrefabInstanceRoots;if(c)for(let e=c.length-1;0<=e;e--){var r=c[e],a=r._prefab;null!=a&&a.instance&&(t[a.instance.fileId]&&(debugInfo.push(r.getPathInHierarchy()+" prefabInstanceFileId is not unique"),a.instance.fileId=EditorExtends.UuidUtils.uuid()),t[a.instance.fileId]=!0)}}}function checkNode(t,c,e=""){var r,a=t.children;if(Array.isArray(a)){var n=e+"/"+t.name;if(!checkedObjectSet.has(t)){checkedObjectSet.add(t);for(let e=a.length-1;0<=e;e--){var s=a[e];!s||s.objFlags&cc_1.CCObject.Flags.HideInHierarchy?null==s&&a.splice(e,1):(s.parent!==t&&(debugInfo.push(n+`/${s.name} parent is illegal `+(null==(r=s.parent)?void 0:r.name)),s.parent=t),checkNode(s,c,n))}}}else debugInfo.push(`${e}/${t.name} children is not an array`)}function checkScene(e){let t;e instanceof cc_1.SceneAsset?t=e.scene:e instanceof cc_1.Prefab&&(t=e.data),t&&(e=t.constructor.__values__.slice().filter(e=>!nodeExcludeProps.includes(e)),checkNode(t,e),checkPrefabInfo(t))}function serializeSafe(e,t){return cce.Utils.serialize(e,t)}function serialize(e,t){return cce.Utils.serialize(e,t)}exports.serializeSafe=serializeSafe,exports.serialize=serialize;