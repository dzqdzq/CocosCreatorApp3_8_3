"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.importConfig=exports.exportConfig=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js"),vueTemplate=(Vue.config.productionTip=!1,(Vue.config.devtools=!1,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/general-layer.html"),"utf8")),ProjectLayerVM=Vue.extend({name:"ProjectLayerVM",data(){return{layers:[],userLayers:[],builtinLayers:[]}},mounted(){this.refresh()},methods:{async refresh(){try{this.builtinLayers=await Editor.Message.request("scene","query-layer-builtin")}catch(e){console.error(e),this.builtinLayers=[]}let e=await Editor.Profile.getProject("project","layer");e&&Array.isArray(e)||(e=[]),20<(this.userLayers=e).length&&(this.userLayers=e.splice(0,20),Editor.Profile.setProject("project","layer",this.userLayers));var t=this.userLayers.concat(this.builtinLayers),a=[];for(let r=0;r<32;r++){const i=1<<r;let e=t.find(e=>e.value===i);(e=e||{name:"",value:i}).label=20<=r?"Builtin Layer "+r:"User Layer "+r,a[r]=e}this.layers=a,this.layers.sort((e,r)=>e.index-r.index)},async _onSettingsConfirm(e,r){if(!(20<=r)){const a=e.target,i=a.value.trim(),s=1<<r;e=this.userLayers.find(e=>e.value===s);if(i||e)if(i&&this.layers.find(e=>e.name===i))requestAnimationFrame(()=>{a.value=this.layers[r].name}),console.warn(Editor.I18n.t("project.layers.warnInvalidName1",{name:i}));else{var t=parseInt(i);if("number"==typeof t&&!isNaN(t))for(let e=0;e<32;e++)if(t===1<<e)return requestAnimationFrame(()=>{a.value=this.layers[r].name}),void console.warn(Editor.I18n.t("project.layers.warnInvalidName2",{name:t}));i?e?e.name=i:this.userLayers.push({name:i,value:s}):(e=this.userLayers.findIndex(e=>e.value===s),this.userLayers.splice(e,1));e=this.userLayers.map(e=>({name:e.name,value:e.value}));await Editor.Profile.setProject("project","layer",e),await this.refresh(),Editor.Message.broadcast("project:setting-change","layers")}}}},template:vueTemplate});async function exportConfig(){var e={};return e.layer=await Editor.Message.request("project","query-config","project","layer")||[],e}async function importConfig(e){e.layer&&await Editor.Message.request("project","set-config","project","layer",e.layer)}function ready(){var e,r=this;null!=(e=r.vm)&&e.$destroy(),r.vm=new ProjectLayerVM,r.vm.$mount(r.$.container)}function close(){var e;null!=(e=this.vm)&&e.$destroy(),this.vm=null}exports.style=`
.layer > .info { margin-bottom: 1em; }
.content > ui-prop { margin-bottom: 4px; padding-left: 24px; }
.content > ui-prop > ui-input { flex: 1; }
.content > ui-prop { --left-width: 40%; padding: 2px 0; }
.layer { height: 100%; padding-bottom: 40px; box-sizing: border-box;display: flex; flex-direction: column;}
.content { overflow: auto; flex:1; }
`,exports.template='<div class="container"></div>',exports.$={container:".container"},exports.exportConfig=exportConfig,exports.importConfig=importConfig,exports.ready=ready,exports.close=close;