"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProjectSettingsHomeVM=void 0;const fs_1=require("fs"),path_1=require("path"),lodash_1=require("lodash"),Vue=require("vue/dist/vue.js"),template=(Vue.config.productionTip=!1,(Vue.config.devtools=!1,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/settings/index.html"),"utf8"));exports.ProjectSettingsHomeVM=Vue.extend({name:"ProjectSettingsHomeVM",data(){return{tab:"project",subTab:"general",configs:{},args:[],dbReady:!1}},computed:{alignCustomPanelFollowContent(){return!!((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"content"])&&0<Object.keys((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"content"])).length)},hasSlider(){return!!this.configs&&!!Object.keys(this.configs).length},hasContent(){var{configs:t,tab:e,subTab:s}=this;return t&&t[e]&&t[e].tabs[s]&&(t[e].tabs[s].content||t[e].tabs[s].custom)}},watch:{subTab(){this.handleCustomConfig()},dbReady(t){t&&this.handleCustomConfig()}},async mounted(){await Promise.all([this.refreshPackagesConfigs(),this._queryDbStatus()]),Editor.Message.__protected__.addBroadcastListener("project:packages-changed",this.refreshPackagesConfigs)},beforeDestroy(){Editor.Message.__protected__.removeBroadcastListener("project:packages-changed",this.refreshPackagesConfigs)},methods:{changeTab(t,e){this.tab=t,this.subTab=e},getRenderText(t,e){return t.attributes=t.attributes||{},t.attributes.path=e,JSON.stringify(t)},t(t){return"string"!=typeof t?"":(t=t.replace("i18n:",""),Editor.I18n.t(t)||t)},popup(t,e,s){this.tab&&Editor.Menu.popup({x:t,y:e,menu:[{label:Editor.I18n.t("project.menu.copyConfigKey"),click:()=>{var t=`'${this.tab}', '${s}'`;Editor.Clipboard.write("text",t)}},{label:Editor.I18n.t("project.menu.copyTabKey"),click:()=>{var t=`'${this.tab}', '${this.subTab}'`;Editor.Clipboard.write("text",t)}}]})},async refreshPackagesConfigs(){this.configs=await Editor.Message.request("project","query-project-configs"),this.configs&&this.configs[this.tab]&&this.configs[this.tab].tabs[this.subTab]||(this.tab="project",this.subTab="general")},handleCustomConfig(){if((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"custom"])){const e=Editor.Module.__protected__.requireFile((0,lodash_1.get)(this.configs,[this.tab,"tabs",this.subTab,"custom"])),s=document.createElement("ui-panel"),a={};e&&(Object.keys(e).forEach(t=>{a[t]=e[t]}),e.ready)&&(a.ready=()=>(s.ready=!0,e.ready.call(s.panelObject,...this.args))),s.config=a,this.$nextTick(()=>{var t=this.$refs[this.tab+"-"+this.subTab];t&&(t.innerHTML="",t.appendChild(s))})}},async _queryDbStatus(){await Editor.Message.request("asset-db","query-ready")&&(this.dbReady=!0)}},template:template});