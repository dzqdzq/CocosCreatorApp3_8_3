"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detach=exports.attach=exports.socketArray=exports.postArray=exports.getArray=exports.fileArray=void 0;const path_1=require("path"),express_1=__importDefault(require("express")),socket_1=require("./socket"),glob2rex_1=require("./glob2rex");function attach(t){if(!t.invalid&&t.info.contributions&&t.info.contributions.server){var e=(0,path_1.join)(t.path,t.info.contributions.server);const o=e=>e instanceof RegExp?e:(0,glob2rex_1.globToRegExp)(e);try{var r=Editor.Module.__protected__.requireFile(e);r.file&&r.file.forEach(e=>{var r;exports.fileArray.push({name:t.name,url:e.url,regexp:(r=e.url)instanceof RegExp?r:(0,glob2rex_1.globToRegExp)(r+"*"),handle:express_1.default.static(e.path)})}),r.get&&r.get.forEach(e=>{exports.getArray.push({name:t.name,url:e.url,regexp:o(e.url),handle:e.handle})}),r.post&&r.post.forEach(e=>{exports.postArray.push({name:t.name,url:e.url,regexp:o(e.url),handle:e.handle})}),r.connection&&exports.socketArray.push({name:t.name,connection:r.connection,disconnect:r.disconnect})}catch(e){console.error(e)}}}function detach(r){for(let e=0;e<exports.fileArray.length;e++)exports.fileArray[e].name===r.name&&exports.fileArray.splice(e--,1);for(let e=0;e<exports.getArray.length;e++)exports.getArray[e].name===r.name&&exports.getArray.splice(e--,1);for(let e=0;e<exports.postArray.length;e++)exports.postArray[e].name===r.name&&exports.postArray.splice(e--,1);for(let e=0;e<exports.socketArray.length;e++)exports.socketArray[e].name===r.name&&(exports.socketArray[e].disconnect((0,socket_1.getSocket)()),exports.socketArray.splice(e--,1))}exports.fileArray=[],exports.getArray=[],exports.postArray=[],exports.socketArray=[],exports.attach=attach,exports.detach=detach;