"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.sortIp=exports.scan=void 0;const os_1=__importDefault(require("os"));function getIPAdress(){var t=[],r=os_1.default.networkInterfaces();for(const s in r){var e=r[s];if(e)for(let r=0;r<e.length;r++){var o=e[r];"IPv4"!==o.family||"127.0.0.1"===o.address||o.internal||t.push(o)}}return t}async function scan(){var r,t=[[]];let e=0,o=!1;for(const i of getIPAdress().map(r=>{var t=r.netmask.split(".").map(r=>Number(r));const e=r.address.split(".").map(r=>Number(r));return t.map((r,t)=>{t=r&e[t];return[t,255-r+t]})}))for(let n=i[0][0];n<=i[0][1];n++)for(let p=i[1][0];p<=i[1][1];p++)for(let a=i[2][0];a<=i[2][1];a++)for(let s=i[3][0];s<=i[3][1];s++)!1===o?o=!0:((r=t[e]).push(new Promise(async o=>{setTimeout(()=>{o(null)},1e4);for(let e=7456;e<7460;e++)Editor.Network.get(`http://${n}.${p}.${a}.${s}:${e}/__server__/handshake`).then(r=>{if(r)try{var t=JSON.parse(r.toString());return t.ip=`${n}.${p}.${a}.`+s,t.port=e,o(t)}catch(r){}else o(null)})})),100<=r.length&&(t[++e]=[]));const s=[];for(const a of t)a&&a.length&&(await Promise.all(a)).forEach(r=>r&&s.push(r));return s}exports.scan=scan;const otherIp="other",ipAddrMap={192.168:1,172:2,10:3,169.254:4,[otherIp]:5,127:6},ipReg=/^((\d+)(?:\.(\d+))?)(\..*)?$/;function sortIp(r){return r.sort((r,t)=>{var[,r,e]=r.match(ipReg)||[],[,t,o]=t.match(ipReg)||[];return(ipAddrMap[r]||ipAddrMap[e]||ipAddrMap[otherIp])-(ipAddrMap[t]||ipAddrMap[o]||ipAddrMap[otherIp])})}exports.sortIp=sortIp;