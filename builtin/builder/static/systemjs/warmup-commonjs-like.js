import{setBaseUrl}from"./base-url.js";import{setImportMap}from"./import-map.js";import{systemJSPrototype}from"systemjs-source/system-core.js";export default function({pathname:t="/",importMap:e,importMapUrl:r,defaultHandler:n,handlers:o}){var s="no-schema:";if(setBaseUrl(s+t),setImportMap(e,s+"/"+r),n&&hookInstantiationOverSchema(s,wrapHandler(n)),o)for(const a of Object.keys(o))hookInstantiationOverSchema(a,wrapHandler(o[a]))}function isThenable(t){return Boolean(t&&"function"==typeof t.then)}function wrapHandler(n){return function(t){const e=this;let r;try{r=n(t)}catch(t){return Promise.reject(t)}return isThenable(r)?new Promise(t=>r.then(()=>{t(e.getRegister())})):e.getRegister()}}function hookInstantiationOverSchema(n,o){const s=systemJSPrototype.instantiate;systemJSPrototype.instantiate=function(t,e){var r=t.substr(0,n.length)===n?t.substr(n.length):null;return null===r?s.call(this,t,e):o.call(this,r,e)}}