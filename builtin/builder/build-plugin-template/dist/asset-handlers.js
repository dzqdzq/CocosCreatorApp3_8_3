"use strict";var __awaiter=this&&this.__awaiter||function(e,a,i,c){return new(i=i||Promise)(function(n,t){function o(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,r)}s((c=c.apply(e,a||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.compressTextures=void 0;const fs_extra_1=require("fs-extra"),compressTextures=n=>__awaiter(void 0,void 0,void 0,function*(){console.debug("Execute compress task "+n);for(let e=0;e<n.length;e++){var t=n[e];"jpg"===t.format&&(t.dest=t.dest.replace(".png",".jpg"),yield pngToJPG(t.src,t.dest,t.quality),n.splice(e,1),e--)}});function pngToJPG(n,o,r){return __awaiter(this,void 0,void 0,function*(){var e=yield getImage(n),t=document.createElement("canvas"),e=(t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/jpeg",r/100));yield fs_extra_1.outputFile(o,e),console.debug("pngToJPG",o)})}function getImage(o){return new Promise((e,t)=>{const n=new Image;n.onload=function(){e(n)},n.onerror=function(e){t(e)},n.src=o.replace("#","%23")})}exports.compressTextures=compressTextures;