"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),custom_render_1=require("./custom-render"),Vue=require("vue/dist/vue.js");function translateName(e){return e?(e=e.replace("i18n:",""),Editor.I18n.t(e)||e):""}Vue.config.productionTip=!1,Vue.config.devtools=!1;let panel=null,vm=null;const vueTemplate=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/template/platform-debug-tools.html"),"utf8"),BuilderPlatformDebugToolsVM=Vue.extend({name:"BuilderPlatformDebugToolsVM",data(){return{platforms:[],currentPlatform:"vivo-mini-game",currentProjectPath:"",projectList:{},platformConfigMap:{},processState:{},selectProject:"",consoleInfo:{}}},computed:{project(){return this.currentProjectPath||this.selectProject}},methods:{translateName:translateName,async executeCompMethod(t){if(this.currentPlatform&&this.currentProjectPath){let e=this.$refs[this.currentPlatform+"custom"];if((e=Array.isArray(e)?e[0]:e)&&e.handleCommand)if(await e.handleCommand(t))return;Editor.Message.send("builder",t+"-build-task",this.currentProjectPath,this.currentPlatform)}},resetSelection(){this.currentProjectPath=""},onPlatformChange(e){e=e.target;this.currentPlatform=e.value,this.currentProjectPath=""}},template:vueTemplate});async function ready(e,t,r){console.debug("ready",e,t,r),panel=this;const o={},a=[],s={},n={},l=await Editor.Message.request("builder","query-platform-config");l&&Array.isArray(l.order)&&l.order.forEach(e=>{var t=l.config[e];if(t&&t.name&&t.supportRun&&t.supportRun&&(o[e]={},n[e]={requireCompile:t.requireCompile,supportRun:t.supportRun},a.push({label:translateName(t.name),value:e}),t.debugConfig)){t=(0,custom_render_1.getVueComponentFromConfig)(t.debugConfig,e);for(const r of t)s[r.name]=r;n[e].compNames=t.map(e=>e.name)}});var i=await Editor.Message.request("builder","query-tasks");Object.values(i).forEach(e=>{var t,r;e.options&&({platform:e,buildPath:r,outputName:t}=e.options,o[e])&&r&&t&&(r=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(r),t),o[e][r]={name:t,path:r})}),null!==vm&&void 0!==vm&&vm.$destroy(),(vm=new BuilderPlatformDebugToolsVM({data:{platforms:a,currentPlatform:e||"vivo-mini-game",currentProjectPath:t||"",projectList:o,platformConfigMap:n},components:s})).$mount(panel.$.container),r&&vm.executeCompMethod(r)}function close(){null!==vm&&void 0!==vm&&vm.$destroy(),vm=null,panel=null}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../dist/platform-debug-tools.css")),exports.template=`
<div class="container"></div>
`,exports.$={container:".container"},exports.methods={initState(e,t,r){e&&(panel.vm.platform=e),t&&(panel.vm.packagePath=t),r&&panel.vm.executeCompMethod(r)},updateCompileProcess(e,t){panel.vm.$set(panel.vm.processState,e,t)},updateConsole(e,t,r){var o;e&&r&&t&&(o=panel.vm.consoleInfo[e],Array.isArray(o)?o.push({type:t,message:r}):panel.vm.$set(panel.vm.consoleInfo,e,[{type:t,message:r}]))}},exports.ready=ready,exports.close=close;