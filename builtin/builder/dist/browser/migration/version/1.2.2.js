"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateHuaweiTemplate=exports.migrateTaskName=exports.migrateHuaweiOption=exports.migrateProfile_1_2_2=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra");async function migrateProfile_1_2_2(){var e=await Editor.Profile.getConfig("builder","","local"),a=(migrateHuaweiTemplate(),e.common&&migrateTaskName(e.common),e.common&&migrateHuaweiOption(e.common),e.version&&e.version["huawei-mini-game"]&&(e.version["huawei-quick-game"]=e.version["huawei-mini-game"],delete e.version["huawei-mini-game"]),e.BuildTaskManager&&e.BuildTaskManager.queue);const i={};Array.isArray(a)&&0<a.length&&(a.forEach(e=>{var a=(i[(new Date).getTime()]=e).options;migrateHuaweiOption(a),delete a.splashScreen,delete a.includeModules,delete a.designResolution,a.outputName||(a.outputName=a.taskName||e.id,delete a.taskName)}),e.BuildTaskManager.taskMap=i,delete e.BuildTaskManager.queue),e["huawei-mini-game"]&&(e["huawei-quick-game"]={"huawei-quick-game":e["huawei-mini-game"]["huawei-mini-game"]},delete e["huawei-mini-game"],await Editor.Profile.removeConfig("builder","huawei-mini-game")),Editor.Profile.setConfig("builder","",e,"local")}function migrateHuaweiOption(e){"huawei-mini-game"===e.platform&&("huawei-mini-game"===e.platform&&(e.platform="huawei-quick-game"),"huawei-mini-game"===e.taskName&&(e.taskName="huawei-quick-game"),e.packages)&&e.packages["huawei-mini-game"]&&(e.packages["huawei-quick-game"]=e.packages["huawei-mini-game"],delete e.packages["huawei-mini-game"])}function migrateTaskName(e){!e.outputName&&e.taskName&&(e.outputName=e.taskName,delete e.taskName),e.outputName&&e.taskName&&delete e.taskName}function migrateHuaweiTemplate(){var e=(0,path_1.join)(Editor.Project.path,"build-templates"),a=(0,path_1.join)(e,"huawei-mini-game"),e=(0,path_1.join)(e,"huawei-quick-game");(0,fs_extra_1.existsSync)(a)&&(0,fs_extra_1.renameSync)(a,e)}exports.migrateProfile_1_2_2=migrateProfile_1_2_2,exports.migrateHuaweiOption=migrateHuaweiOption,exports.migrateTaskName=migrateTaskName,exports.migrateHuaweiTemplate=migrateHuaweiTemplate;