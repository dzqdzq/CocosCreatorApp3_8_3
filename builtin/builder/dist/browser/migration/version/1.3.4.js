"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateGenMipmaps=exports.migrateProject=exports.migrateLocal=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),utils_1=require("../utils");async function migrateLocal(t){if(t.BuildTaskManager&&t.BuildTaskManager.taskMap)for(const a of Object.keys(t.BuildTaskManager.taskMap)){var e=t.BuildTaskManager.taskMap[a];if(e.options.packages){for(const s of Object.keys(e.options.packages))await Editor.Profile.setConfig(s,"builder.taskOptionsMap."+e.id,e.options.packages[s],"local"),await Editor.Profile.setConfig(s,"builder.__version__","1.3.4","local");delete e.options.packages}}}async function migrateProject(t){migrateGenMipmaps(t),await migrateSplashSetting(t)}async function migrateGenMipmaps(t){var e=await Editor.Project.__protected__.getLastEditorVersion();e&&(0,utils_1.compareVersion)("3.7.0",e)&&(t.textureCompressConfig&&"boolean"==typeof t.textureCompressConfig.genMipmaps||(t.textureCompressConfig||(t.textureCompressConfig={}),t.textureCompressConfig.genMipmaps=!1))}async function migrateSplashSetting(t){if(t["splash-setting"]){var e=t["splash-setting"].url;if(e&&(0,path_1.isAbsolute)(t["splash-setting"].url)&&(0,fs_extra_1.existsSync)(e)){if(e.includes("app.asar"))return void delete t["splash-setting"].url;var a=(0,path_1.join)(Editor.Project.path,"settings","splash"+(0,path_1.extname)(e));await(0,fs_extra_1.copy)(e,a,{overwrite:!0}),t["splash-setting"].url=Editor.UI.__protected__.File.resolveToUrl(a,"project")}delete t["splash-setting"].displayWatermark,t["splash-setting"].watermarkLocation="default",t["splash-setting"].displayRatio&&(t["splash-setting"].displayRatio=Editor.Utils.Math.clamp(t["splash-setting"].displayRatio,.5,1.5))}}exports.migrateLocal=migrateLocal,exports.migrateProject=migrateProject,exports.migrateGenMipmaps=migrateGenMipmaps;