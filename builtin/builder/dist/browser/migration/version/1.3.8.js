"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateLocal=void 0;const lodash_1=__importDefault(require("lodash"));async function migrateLocal(e){const s=await Editor.Profile.getConfig("engine","builder");if(s&&s.options){var t=s.options;for(const i in t)t[i].cleanupImageCache&&Editor.Profile.setConfig(i,"builder.common.overwriteProjectSettings.macroConfig",{cleanupImageCache:t[i].cleanupImageCache})}if(Editor.Profile.removeConfig("engine","builder"),e.BuildTaskManager&&e.BuildTaskManager.taskMap){const n=await Editor.Profile.getConfig("engine","modules.includeModules")||[],r=await Editor.Profile.getConfig("wechatgame","builder.taskOptionsMap"),l=await Editor.Profile.getConfig("bytedance-mini-game","builder.taskOptionsMap"),d=await Editor.Profile.getConfig("web-mobile","builder.taskOptionsMap"),c=await Editor.Profile.getConfig("web-desktop","builder.taskOptionsMap");Object.values(e.BuildTaskManager.taskMap).forEach(function(e){var t,i,o,a=e.id;switch(s&&s.taskOptionsMap&&(e.options.overwriteProjectSettings={includeModules:{physics:"inherit-project-setting","physics-2d":"inherit-project-setting"}},s.taskOptionsMap[a])&&s.taskOptionsMap[a].cleanupImageCache&&(t=s.taskOptionsMap[a].cleanupImageCache,e.options.overwriteProjectSettings.macroConfig={cleanupImageCache:"inheritProjectSetting"===t?"inherit-project-setting":t},delete s.taskOptionsMap[a].cleanupImageCache),e.options.platform){case"wechatgame":r&&((i=r[a]).wasm&&(lodash_1.default.set(e.options,"overwriteProjectSettings.includeModules.physics","physics-ammo"),e.options.nativeCodeBundleMode="wasm",delete i.wasm),lodash_1.default.set(e.options,"overwriteProjectSettings.includeModules.gfx-webgl2","sameAsProjectSetting"===i.enabelWebGL2?"inherit-project-setting":"off"),delete i.enabelWebGL2);break;case"bytedance-mini-game":l&&(i=l[a]).physX&&(lodash_1.default.set(e.options,"overwriteProjectSettings.includeModules.physics","physics-physx"),o=n.includes("physics-physx"),i.physX.use="physX"===i.physX.use||o);break;case"web-desktop":c&&(i=c[a]).cullEngineAsmJsModule&&(e.options.nativeCodeBundleMode="wasm",delete i.cullEngineAsmJsModule),lodash_1.default.set(e.options,"overwriteProjectSettings.includeModules.gfx-webgl2","inherit-project-setting");break;case"web-mobile":d&&(o=d[a]).cullEngineAsmJsModule&&(e.options.nativeCodeBundleMode="wasm",delete o.cullEngineAsmJsModule),lodash_1.default.set(e.options,"overwriteProjectSettings.includeModules.gfx-webgl2","inherit-project-setting")}}),await Editor.Profile.setConfig("wechatgame","builder.taskOptionsMap",r),await Editor.Profile.setConfig("bytedance-mini-game","builder.taskOptionsMap",l),await Editor.Profile.setConfig("web-mobile","builder.taskOptionsMap",d),await Editor.Profile.setConfig("web-desktop","builder.taskOptionsMap",c)}}exports.migrateLocal=migrateLocal;