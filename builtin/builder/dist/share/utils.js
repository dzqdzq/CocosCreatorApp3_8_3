"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){e[o=void 0===o?r:o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.resolveToRaw=exports.formatMSTime=exports.requestModule=exports.transI18nName=exports.Metric=exports.defaultMerge=exports.defaultsDeep=exports.checkConfigDefault=exports.getParamsFromCommand=exports.checkHasError=exports.changeToLocalTime=exports.getCurrentTime=exports.getTaskLogDest=exports.transTimeToNumber=exports.checkCompressOptions=exports.getOptionsDefault=exports.getBuildDist=exports.getPreviewUrl=exports.compareUUID=exports.compareNumeric=void 0;const path_1=require("path"),textureCompressConfig=__importStar(require("../share/texture-compress"));function compareNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}async function getPreviewUrl(){var e=await Editor.Message.request("server","query-port");return`http://${await Editor.Message.request("preview","get-preview-ip")}:${e}/build`}function getBuildDist(e){return(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(Editor.Project.path,e)}function getOptionsDefault(t){const r={};return Object.keys(t).forEach(e=>{r[e]=t[e].default}),r}function checkCompressOptions(e){if(!e||"object"!=typeof e||Array.isArray(e))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.require_object")),!1;var t=Object.keys(textureCompressConfig.configGroups);for(const i of Object.keys(e)){var r=e[i];if(!r||"object"!=typeof r)return console.error(Editor.I18n.t("builder.project.texture_compress.tips.xx_require_object",{name:i+`(${r})`})),!1;if(!r.name)return console.error(Editor.I18n.t("builder.project.texture_compress.tips.require_name")),!1;if(!r.options||"object"!=typeof r.options||Array.isArray(r))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.xx_require_object",{name:"options"})),!1;for(const n of Object.keys(r.options)){if(!t.includes(n))return console.error(Editor.I18n.t("builder.project.texture_compress.tips.platform_err",{name:"options",supportPlatforms:t.toString()})),!1;var o=r.options[n];for(const s of Object.keys(o));}}return!0}function transTimeToNumber(e){var t=(e=(0,path_1.basename)(e,".log")).match(/-(\d+)$/);return(t?((e=Array.from(e))[t.index]=":",new Date(e.join(""))):new Date).getTime()}function getTaskLogDest(e,t){return Editor.UI.__protected__.File.resolveToUrl((0,path_1.join)(Editor.Project.tmpDir,"builder","log",e+changeToLocalTime(t,5).replace(/:/g,"-")+".log"),"project")}function getCurrentTime(){return changeToLocalTime(Date.now())}function changeToLocalTime(e,t=8){e=new Date(Number(e));return e.toLocaleDateString().replace(/\//g,"-")+" "+e.toTimeString().slice(0,t)}function checkHasError(e){if(e)if("object"!=typeof e||Array.isArray(e)){if("string"==typeof e)return!0}else for(const t of Object.keys(e))if(checkHasError(e[t]))return!0;return!1}function getParamsFromCommand(e){return(e=e&&e.match(/\$\{([^${}]*)}/g))?e.map(e=>e.replace("${","").replace("}","")):[]}function checkConfigDefault(r){return r?(void 0!==r.default&&null!==r.default||("array"===r.type&&Array.isArray(r.itemConfigs)&&(r.default=[],r.itemConfigs.forEach((e,t)=>{r.default[t]=checkConfigDefault(e)})),"object"===r.type&&"object"==typeof r.itemConfigs&&(r.default={},Object.keys(r.itemConfigs).forEach(e=>{r.default[e]=checkConfigDefault(r.itemConfigs[e])}))),r.default):null}function defaultsDeep(r,o){return null==r||Array.isArray(r)||Object.keys(o).forEach(e=>{var t=o[e];"object"==typeof t&&!Array.isArray(t)&&t?(r[e]||(r[e]={}),defaultsDeep(r[e],t)):void 0!==r[e]&&null!==r[e]||(r[e]=t)}),r}function defaultMerge(e,...t){for(const r of t)if(r&&"object"==typeof r)for(const o in r)!(o in e)||"object"!=typeof r[o]||Array.isArray(r[o])?e[o]=r[o]:e[o]=defaultMerge(e[o],r[o]);return e}function Metric(e){e&&Editor.Metrics._trackEventWithTimer({category:"buildSystem",id:e,value:1})}function transI18nName(e){return"string"!=typeof e?"":e.startsWith("i18n:")&&(e=e.replace("i18n:",""),Editor.I18n.t(e)||console.debug(e+" is not defined in i18n"),Editor.I18n.t(e))||e}async function requestModule(e,t,...r){try{return"function"==typeof e?await e[t](...r):e[t]}catch(e){return console.debug(e),null}}function formatMSTime(e){var t=e/1e3;let r="";var o=Math.floor(t/60/60),i=(o&&(r=o+" h"),Math.floor(t/60)%60),t=(i&&(r+=` ${i} min`),Math.floor(t)%60),e=(t&&(r+=` ${t} s`),e-1e3*(60*o*60+60*i+t));return e&&!r&&(r+=` ${e} ms`),r.trimStart()}function resolveToRaw(e,t){return(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(t,e)}exports.compareNumeric=compareNumeric,exports.compareUUID=compareNumeric,exports.getPreviewUrl=getPreviewUrl,exports.getBuildDist=getBuildDist,exports.getOptionsDefault=getOptionsDefault,exports.checkCompressOptions=checkCompressOptions,exports.transTimeToNumber=transTimeToNumber,exports.getTaskLogDest=getTaskLogDest,exports.getCurrentTime=getCurrentTime,exports.changeToLocalTime=changeToLocalTime,exports.checkHasError=checkHasError,exports.getParamsFromCommand=getParamsFromCommand,exports.checkConfigDefault=checkConfigDefault,exports.defaultsDeep=defaultsDeep,exports.defaultMerge=defaultMerge,exports.Metric=Metric,exports.transI18nName=transI18nName,exports.requestModule=requestModule,exports.formatMSTime=formatMSTime,exports.resolveToRaw=resolveToRaw;