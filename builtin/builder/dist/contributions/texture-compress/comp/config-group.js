"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){e[r=void 0===r?o:r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.beforeDestroy=exports.created=exports.methods=exports.computed=exports.data=exports.props=exports.components=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),configItems=__importStar(require("./config-items")),event_bus_1=require("../event-bus"),data=(exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static/contributions/config-group.html"),"utf8"),exports.components={"config-items":configItems},exports.props=["compressConfig","config","readonly","overwriteFormats"],function(){return{currentPlatform:"web",selectPlatforms:[]}});function created(){event_bus_1.EventBus.$on("blank-click",this.onBlankClickBind=this.onBlankClick.bind(this))}function beforeDestroy(){event_bus_1.EventBus.$off("blank-click",this.onBlankClickBind)}exports.data=data,exports.computed={showOverWrite(){var e=this;return!(!e.platformConfig[e.currentPlatform]||e.readonly&&(!e.config.overwrite||0===e.config.overwrite.length))},displayFormatInfo(){var e=this;if(Object.keys(e.config.options).length&&e.config.options[e.currentPlatform])return e.getFormatInfo("options",e.currentPlatform)},platformConfig(){const r=this,n=r.compressConfig.platformConfig,s={};return Object.keys(n).forEach(e=>{var t,o=n[e];o.textureCompressConfig&&(t=o.textureCompressConfig.platformType,r.compressConfig.configGroups[t].supportOverwrite)&&(s[t]||(s[t]={[e]:{name:o.name}}),s[t][e]={name:o.name})}),s}},exports.methods={onSelectPlatform(t){var e=this.selectPlatforms.findIndex(e=>e===t);-1===e?this.selectPlatforms.push(t):this.selectPlatforms.splice(e,1)},onBlankClick(){this.selectPlatforms=[]},showFormatMenu(e,t,o){Editor.Menu.popup({x:e.pageX,y:e.pageY,menu:this.getPlatformMenu(t,o)})},getPlatformMenu(o,r){const n=this;let t=[];"options"===o&&(e=n.compressConfig.configGroups[r].support,t=[...new Set([...e.rgba,...e.rgb])]);const s=n.compressConfig.formatsInfo;const i=[];Object.keys(n.compressConfig.textureFormatConfigs).forEach(e=>{e=n.compressConfig.textureFormatConfigs[e];1===e.formats.length?i.push(n.formatConfigOption(o,e.formats[0],r)):(t.length&&e.formats.filter(e=>t.includes(e.value)),i.push({label:e.displayName,submenu:e.formats.map(e=>n.formatConfigOption(o,e,r))}))});var e=Object.keys(n.compressConfig.customFormats).map(e=>{return{label:s[e].displayName+" (custom)",enabled:!n.config[r]||(t=e,!Object.keys(n.config[o][r]).find(e=>!!s[e]&&s[t].formatType===s[e].formatType&&s[t].alpha===s[e].alpha)),click(){n.$emit("add","options",r,e)}};var t});return[...i,{type:"separator"},...e]},checkFormatIsEnable(e,t,o){const r=this;if(!r.config[e]||!r.config[e][o])return!0;const n=r.compressConfig.formatsInfo[t];return!Object.keys(r.config[e][o]).find(e=>r.compressConfig.formatsInfo[e].formatType===n.formatType&&n.alpha===r.compressConfig.formatsInfo[e].alpha)},formatConfigOption(e,t,o){const r=this;return{label:t.displayName,enabled:r.checkFormatIsEnable(e,t.value,o),click(){r.$emit("add",e,o,t.value)}}},getFormatInfo(n,s){const i={},a=this;return Object.keys(a.config[n][s]).forEach(e=>{var t,o,r=a.compressConfig.formatsInfo[e];r?(t=JSON.parse(JSON.stringify(r)),a.overwriteFormats[e]&&a.compressConfig.formatsInfo[a.overwriteFormats[e]]&&(o=a.compressConfig.formatsInfo[a.overwriteFormats[e]],t.overwritedInfo={displayName:o.displayName,id:a.overwriteFormats[e]}),t.value=a.config[n][s][e],o=JSON.parse(JSON.stringify(a.compressConfig.textureFormatConfigs[r.formatType].options)),a.readonly&&(o.quality.render=Object.assign(o.quality.render,{attributes:{disabled:!0}})),t.options=o,i[e]=t):i[e]={displayName:""+e,missing:!0}}),i},removeFormat(e,t,o){this.$emit("remove",e,t,o)},onChangeQuality(e,t,o,r,n){var s=this;n&&r&&(s.config[e][t][n]=s.config[e][t][n]||{},s.config[e][t][n][o]=r,s.$emit("update",e,t,n,s.config[e][t][n]))},getCustomConfigInfo(e){var t=this.compressConfig.formatsInfo[e];return t||{displayName:e+"(missing)",missing:!0}},deletePlatformOverwrite(){const t=this;t.selectPlatforms.forEach(e=>{t.$emit("remove","overwrite",e)})},addPlatformOverwriteFormat(e,t){return this.showFormatMenu(e,"overwrite",t)},addPlatformOverwriteMenu(e){const t=this;var o=Object.keys(t.platformConfig[t.currentPlatform]).map(e=>{return{label:t.platformConfig[t.currentPlatform][e].name,enabled:t.checkPlatformAddEnable(e),click:()=>{t.$emit("add-platform",e,t.currentPlatform)}}});Editor.Menu.popup({x:e.x,y:e.y,menu:o})},checkPlatformAddEnable(e){return!this.config.overwrite||!this.config.overwrite[e]}},exports.created=created,exports.beforeDestroy=beforeDestroy;