"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,r)}:function(e,t,s,i){e[i=void 0===i?s:i]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildResult=exports.InternalBuildResult=void 0;const path_1=require("path"),asset_library_1=require("./asset-library"),stage_task_manager_1=require("../stage-task-manager"),BundleUtils=__importStar(require("../asset-handler/bundle/utils")),events_1=__importDefault(require("events")),utils_1=require("../asset-handler/bundle/utils");class Paths{constructor(e){this.cache={},this.effectBin="",this.engineMeta="",this.hashedMap={},this.plugins={},this.dir=e||"",this.compileConfig=(0,path_1.join)(e,stage_task_manager_1.BuildStageTask.optionsFileName)}get settings(){return this.cache.settings||(0,path_1.join)(this.dir,"src","settings.json")}set settings(e){this.cache.settings=e}get subpackages(){return this.cache.subpackages||(0,path_1.join)(this.dir,Build.SUBPACKAGES_HEADER)}set subpackages(e){this.cache.subpackages=e}get assets(){return this.cache.assets||(0,path_1.join)(this.dir,Build.ASSETS_HEADER)}set assets(e){this.cache.assets=e}get remote(){return this.cache.remote||(0,path_1.join)(this.dir,Build.REMOTE_HEADER)}set remote(e){this.cache.remote=e}get applicationJS(){return this.cache.applicationJS||(0,path_1.join)(this.dir,"application.js")}set applicationJS(e){this.cache.applicationJS=e}get importMap(){return this.cache.importMap||(0,path_1.join)(this.dir,"import-map.js")}set importMap(e){this.cache.importMap=e}get bundleScripts(){return this.cache.bundleScripts||(0,path_1.join)(this.dir,"src",Build.BUNDLE_SCRIPTS_HEADER)}set bundleScripts(e){this.cache.bundleScripts=e}}class InternalBuildResult extends events_1.default{get dest(){return this.paths.dir}get bundles(){return console.log(Editor.I18n.t("builder.warn.deprecatedTip",{oldName:"result.bundles",newName:"this.bundleManager.bundles"})),this.__task.bundleManager.bundles}get bundleMap(){return console.log(Editor.I18n.t("builder.warn.deprecatedTip",{oldName:"result.bundleMap",newName:"this.bundleManager.bundleMap"})),this.__task.bundleManager.bundleMap}constructor(e,t){super(),this.settings={CocosEngine:"0.0.0",engine:{debug:!0,platform:"web-desktop",customLayers:[],sortingLayers:[],macros:{},builtinAssets:[]},animation:{customJointTextureLayouts:[]},assets:{server:"",remoteBundles:[],subpackages:[],preloadBundles:[],bundleVers:{},preloadAssets:[],projectBundles:[]},plugins:{jsList:[]},scripting:{},launch:{launchScene:""},screen:{exactFitScreen:!0,designResolution:{width:960,height:640,policy:0}},rendering:{renderPipeline:""}},this.scriptPackages=[],this.pluginVers={},this.compressImageResult={},this.importMap={imports:{}},this.compileOptions=null,this.staticsInfo={},this.pluginScripts=[],this.rawOptions=JSON.parse(JSON.stringify(e.options));let s=(0,path_1.join)(Editor.Project.path,"build","preview");t||(s=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(e.options.buildPath),e.options.outputName)),this.paths=new Paths(s),this.__task=e}}exports.InternalBuildResult=InternalBuildResult;class BuildResult{get paths(){return this.__task.result.paths}constructor(e){this.__task=e,this.dest=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(e.options.buildPath),e.options.outputName),this.settings=e.result.settings}containsAsset(t){return!!this.__task.bundleManager.bundles.find(e=>e.containsAsset(t))}getRawAssetPaths(s){var e;return asset_library_1.buildAssetLibrary.getAsset(s)&&(e=this.__task.bundleManager.bundles.filter(e=>e.containsAsset(s,!0))).length?e.map(e=>{var t={bundleName:e.name,raw:[]};return e.getRedirect(s)&&(t.redirect=e.getRedirect(s)),t.raw=BundleUtils.getRawAssetPaths(s,e),t}):[]}getAssetPathInfo(s){var e=this.__task.bundleManager.bundles.filter(e=>e.containsAsset(s,!0));return e.length?e.map(e=>{var t={bundleName:e.name};return e.getRedirect(s)?t.redirect=e.getRedirect(s):Object.assign(t,BundleUtils.getAssetPathInfo(s,e)),t}):[]}getJsonPathInfo(s){var e=this.__task.bundleManager.bundles.filter(e=>e.containsAsset(s));return e.length?e.map(e=>{var t={bundleName:e.name};return e.getRedirect(s)?t.redirect=e.getRedirect(s):Object.assign(t,(0,utils_1.getJsonPathInfo)(s,e)),t}):[]}}exports.BuildResult=BuildResult;