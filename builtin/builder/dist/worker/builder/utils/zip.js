"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compressDirs=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),global_1=require("../../../share/global"),JsZip=require("jszip");async function compressDirs(o,n,c){await new Promise(r=>{const t=new JsZip,s=[],a=(0,path_1.parse)(global_1.BuildGlobalInfo.BUNDLE_ZIP_NAME).name,i=(o.forEach(e=>{getFilesInDirectory(s,e)}),{date:new Date("2021.06.21 06:00:00Z"),createFolders:!1});s.forEach(e=>{var r=(0,path_1.relative)(n,e);let s=(0,path_1.join)(a,r);s=s.replace(/\\/g,"/"),t.file(s,(0,fs_extra_1.readFileSync)(e),i)}),t.generateAsync({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}).then(e=>{(0,fs_extra_1.writeFileSync)(c,e),o.forEach(e=>{(0,fs_extra_1.removeSync)(e)}),r()})})}function getFilesInDirectory(r,s){(0,fs_extra_1.readdirSync)(s).forEach(e=>{e=(0,path_1.join)(s,e);(0,fs_extra_1.statSync)(e).isDirectory()?getFilesInDirectory(r,e):r.push(e)})}exports.compressDirs=compressDirs;