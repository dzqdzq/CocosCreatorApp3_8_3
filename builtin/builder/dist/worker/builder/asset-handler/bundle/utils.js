"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRawAssetPaths=exports.resolveNativePath=exports.resolveImportPath=exports.getJsonPathInfo=exports.getJsonPath=exports.getAssetPathInfo=void 0;const path_1=require("path"),asset_library_1=require("../../manager/asset-library"),utils_1=require("../../utils");function getAssetPathInfo(e,t){var s;return t.containsAsset(e,!0)&&(s=getJsonPathInfo(e,t),e=getRawAssetPaths(e,t),s||e.length)?(t={},s&&(t.json=s.json,s.groupIndex)&&(t.groupIndex=s.groupIndex),e&&(t.raw=e),t):null}function getJsonPath(e,t){return(null==(e=getJsonPathInfo(e,t))?void 0:e.json)||""}function getJsonPathInfo(t,e){var s;return!e.containsAsset(t)||(s=asset_library_1.buildAssetLibrary.getAsset(t))&&!Object.keys(s.library).includes(".json")?null:(s=e.groups.find(e=>e.uuids.includes(t)))?{json:resolveImportPath(s.name,e),groupIndex:s.uuids.indexOf(t)}:{json:resolveImportPath(t,e)}}function resolveImportPath(e,t){return(0,utils_1.getResImportPath)(t.dest,e+(t.assetVer.import[e]?"."+t.assetVer.import[e]:""))}function resolveNativePath(e,t,s){var r=(0,path_1.basename)(e,t),r=s.assetVer.native[r],e=e.replace((0,path_1.join)(Editor.Project.path,Build.LIBRARY_NAME),(0,path_1.join)(s.dest,Build.NATIVE_HEADER));return r?e.replace(t,"."+r+t):e}function getRawAssetPaths(t,s){if(!s.containsAsset(t,!0))return[];const r=asset_library_1.buildAssetLibrary.getAsset(t);if(!r)return console.error(`Can't get assetInfo of uuid {asset(${t})}`),[];var e=r.meta.files.filter(e=>".json"!==e),a=asset_library_1.buildAssetLibrary.getAssetProperty(r,"type");if("cc.Script"===a)return[s.scriptDest];if("cc.ImageAsset"===a&&s.compressRes[t])return s.compressRes[t];if(["cc.ImageAsset","cc.SpriteFrame","cc.SpriteAtlas"].includes(a)){var o=(s.atlasRes.assetsToImage[t]?[s.atlasRes.assetsToImage[t]]:s.atlasRes.atlasToImages[t])||[];if(o.length){var n,i=[];for(const p of o)p&&(s.compressRes[p]?i.push(...s.compressRes[p]):(n=s.assetVer.native[p],i.push((0,utils_1.getResRawAssetsPath)(s.dest,p,n?`.${n}.png`:".png"))));return i}}return"cc.TTFFont"===a&&s.assetVer.native[t]?e.map(e=>(0,utils_1.getResRawAssetsPath)(s.dest,`${t}.${s.assetVer.native[t]}/`,e)):e.map(e=>resolveNativePath(r.library+e,e,s))}exports.getAssetPathInfo=getAssetPathInfo,exports.getJsonPath=getJsonPath,exports.getJsonPathInfo=getJsonPathInfo,exports.resolveImportPath=resolveImportPath,exports.resolveNativePath=resolveNativePath,exports.getRawAssetPaths=getRawAssetPaths;