"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildEngineCommand=void 0;const ccbuild_1=require("@cocos/ccbuild"),path_1=require("path"),fs_extra_1=require("fs-extra"),defaultOptions={engine:"",out:"",platform:"HTML5",moduleFormat:"system",compress:!0,split:!1,nativeCodeBundleMode:"both",assetURLFormat:"runtime-resolved",noDeprecatedFeatures:!1,sourceMap:!1,features:[],loose:!1,mode:"BUILD",flags:{DEBUG:!1},metaFile:""};async function buildEngineCommand(e){var t,a=Object.assign({},defaultOptions,e||{}),{features:i,out:s}=a,s=(await(0,fs_extra_1.remove)(s),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(s)),console.debug("start build engine with options: "+JSON.stringify(a)),await(0,ccbuild_1.buildEngine)(a));a.split&&(t=await ccbuild_1.StatsQuery.create(a.engine),t=await ccbuild_1.buildEngine.transform(t.evaluateIndexModuleSource(t.getUnitsOfFeatures(i)),"system"),i=(0,path_1.join)(e.out,"cc.js"),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(i)),await(0,fs_extra_1.writeFile)(i,t.code,"utf8"),s.exports.cc="cc.js"),await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(a.metaFile)),await(0,fs_extra_1.writeJSON)(a.metaFile,s,{spaces:2})}exports.buildEngineCommand=buildEngineCommand;