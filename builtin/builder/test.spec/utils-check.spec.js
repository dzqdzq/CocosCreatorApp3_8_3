const expect=require("chai")["expect"],{checkHasError,defaultsDeep,defaultMerge,changeToLocalTime,transTimeToNumber,formatMSTime}=require("../dist/share/utils"),filterAssetWithBundleConfig=require("../dist/worker/builder/utils/bundle")["filterAssetWithBundleConfig"];describe("构建工具函数的基本使用",()=>{describe("formatMSTime",()=>{it("时分秒",()=>{expect(formatMSTime(6666666)).to.equal("1 h 51 min 6 s")}),it("分秒",()=>{expect(formatMSTime(555555)).to.equal("9 min 15 s")}),it("秒",()=>{expect(formatMSTime(12001)).to.equal("12 s")}),it("毫秒",()=>{expect(formatMSTime(30)).to.equal("30 ms")})}),describe("changeToLocalTime",()=>{it("changeToLocalTime",()=>{var e=changeToLocalTime(15530688e5);expect(e).to.be.equal("2019-3-20 16:00:00")}),it("transTimeToNumber",()=>{var e=transTimeToNumber("bundle-build-2019-3-20 16-00.log");expect(e).to.be.equal(15530688e5)})}),describe("checkHasError 校验是否含有错误信息",()=>{it("checkHasError 函数校验非字符串真值与假值",()=>{var e={test:null,testOpt:{test:void 0,testOpt:{test:"",testOpt:{test:1},testBoolean:!0},testArr:[null,void 0,1,""]}};expect(checkHasError(e)).to.be.false}),it("checkHasError 函数校验字符串真值",()=>{var e={test:null,testOpt:{test:void 0,testOpt:{test:"",testOpt:{test:1,error:"Error"},testBoolean:!0},testArr:[null,void 0,1,""]}};expect(checkHasError(e)).to.be.true})}),describe("defaultsDeep 接口校验",()=>{it("defaultsDeep 纯对象",()=>{var e={a:1,b:{c:{d:3,e:[2,3],r:!0},m:"",g:!1},u:"test",group:void 0};defaultsDeep(e,{a:44,b:{c:{d:55,e:[4,5,6,7],r:!1,f:"360"},m:"ffff",g:!0},c:"default",j:{f:"666"},group:{test:["test"]}}),expect(e.a).to.be.equal(1),expect(Array.isArray(e.group.test)).to.be.true,expect(e.c).to.be.equal("default"),expect(e.b.c.e[0]).to.be.equal(2),expect(e.b.c.e.length).to.be.equal(2),expect(e.b.c.r).to.be.true,expect(e.b.g).to.be.false,expect(e.b.m).to.be.equal(""),expect(e.u).to.be.equal("test"),expect(e.j.f).to.be.equal("666")})}),describe("defaultMerge 接口校验",()=>{it("defaultMerge 默认递归合并",()=>{var e={name:{label:"name",render:{ui:"ui-input"},default:"test-cases",verifyRules:["required","customNameCheck"]},server:{label:"server",description:"remote_server_address",render:{ui:"ui-input"}}};defaultMerge(e,{name:{label:"name",render:{ui:"ui-input"},default:"test-cases",verifyRules:["testNameCheck"]}},{server:{label:"server",render:{ui:"ui-input"},verifyRules:["http"]}}),expect(e.name.default).to.be.equal("test-cases"),expect(e.name.verifyRules.length).to.be.equal(1),expect(e.server.description).to.be.equal("remote_server_address"),expect(e.server.verifyRules.length).to.be.equal(1)})}),describe("checkAssetWithFilterConfig",()=>{const t={type:"asset",assets:["123"],range:"include"},l={type:"asset",assets:[],range:"include"},u={type:"asset",assets:["456"],range:"exclude"},a={type:"url",range:"include",patchOption:{value:"db://assets/Test/**/*",patchType:"glob"}},i={type:"url",range:"include",patchOption:{value:"",patchType:"glob"}},r={type:"url",range:"exclude",patchOption:{value:"db://assets/Bundle/**/*",patchType:"glob"}},s=[{url:"db://assets/test/123.jpg",uuid:"123"},{url:"db://assets/test/456.png",uuid:"456"},{url:"db://assets/bundle/789.text",uuid:"789"}];it("asset include",()=>{var e=filterAssetWithBundleConfig(s,[t]);expect(e.length).to.equal(1),expect(e[0].uuid).to.equal("123")}),it("asset include empty 过滤无效",()=>{var e=filterAssetWithBundleConfig(s,[l]);expect(e.length).to.equal(s.length)}),it("asset exclude",()=>{var e=filterAssetWithBundleConfig(s,[u]);expect(e.length).to.equal(2)}),it("url include empty 过滤无效",()=>{var e=filterAssetWithBundleConfig(s,[i]);expect(e.length).to.equal(s.length)}),it("url include",()=>{var e=filterAssetWithBundleConfig(s,[a]);expect(e.length).to.equal(2),expect(e[0].uuid).to.equal("123")}),it("url exclude",()=>{var e=filterAssetWithBundleConfig(s,[r]);expect(e.length).to.equal(2),expect(e[0].uuid).to.equal("123")}),it("url include endWith PNG",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"include",patchOption:{value:".PNG",patchType:"endWith"}}]);expect(e.length).to.equal(1),expect(e[0].uuid).to.equal("456")}),it("url exclude endWith PNG",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"exclude",patchOption:{value:".PNG",patchType:"endWith"}}]);expect(e.length).to.equal(2),expect(e[1].uuid).to.equal("789")}),it("url include contains tEst/456",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"include",patchOption:{value:"tEst/456",patchType:"contain"}}]);expect(e.length).to.equal(1),expect(e[0].uuid).to.equal("456")}),it("url exclude contains tEst/456",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"exclude",patchOption:{value:"tEst/456",patchType:"contain"}}]);expect(e.length).to.equal(2),expect(e[1].uuid).to.equal("789")}),it("url include beginWith DB://assets/bundle",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"include",patchOption:{value:"DB://assets/bundle",patchType:"beginWith"}}]);expect(e.length).to.equal(1),expect(e[0].uuid).to.equal("789")}),it("url exclude beginWith DB://assets/bundle",()=>{var e=filterAssetWithBundleConfig(s,[{type:"url",range:"exclude",patchOption:{value:"DB://assets/test",patchType:"beginWith"}}]);expect(e.length).to.equal(1),expect(e[0].uuid).to.equal("789")}),it("allTestBundleConfig",()=>{var e=[l,t,a,r],e=filterAssetWithBundleConfig(s,e);expect(e.length).to.equal(2),expect(e[0].url).to.equal(s[0].url),expect(e[1].url).to.equal(s[1].url)})})});