const{basename,join,extname}=require("path"),{copyFileSync,ensureDir,outputFileSync}=require("fs-extra"),EventEmitter=require("events")["EventEmitter"],TEMP_PATH=join(Editor.Project.path,"temp"),DB_PROTOCOL_HEADER="db://";async function getEnginInfo(){return await Editor.Message.request("engine","query-engine-info")}function getRightUrl(e){return e.startsWith(DB_PROTOCOL_HEADER)?e.slice(DB_PROTOCOL_HEADER.length)||(console.error("unknown mount to build: "+e),null):(console.error("unknown path to build: "+e),e)}async function writScripts(){var t=await Editor.Message.request("asset-db","query-assets",{ccType:"cc.Script"}),n=join(TEMP_PATH,"/quick-scripts");ensureDir(join(n,"assets"));for(let e=0;e<t.length;e++){var r=t[e],i=getRightUrl(r.source),s=extname(i),s=basename(i,s),o=basename(r.library[".js"]).replace(r.uuid,s),s=basename(r.library[".js.map"]).replace(r.uuid,s),i=getModules(i);outputFileSync(join(n,"assets",o),i),copyFileSync(r.library[".js.map"],join(n,"assets",s))}return n}module.exports={getEnginInfo:getEnginInfo,writScripts:writScripts};