"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const metrics_observer_base_1=require("./metrics-observer-base"),request_1=require("./request"),log_1=require("../libs/log"),TrackingID="UA-60734607-3";function sendData(t,o=!1){const s=Date.now();o&&log_1.logMgr.collectToFile("send analytics: "+s,t),(0,request_1.sendHttpRequest)({method:"POST",host:"www.google-analytics.com",path:"/collect",protocol:"https",data:t},e=>{e?o&&log_1.logMgr.collectToFile("send analytics fail: "+s,e):o&&log_1.logMgr.collectToFile("send analytics done: "+s,t)})}class GoogleMetricsObserver extends metrics_observer_base_1.MetricsObserverBase{constructor(){super(),this._trackID=TrackingID}trackEvent(e,t){var o;e.sendToCocosAnalyticsOnly||e.sendToNewCocosAnalyticsOnly||(t.cid?e.category&&e.action?(o={v:1,tid:this._trackID,cid:t.cid,uid:t.uid,t:"event",ec:e.category,ea:e.action},e.label&&(o.el=e.label),e.value&&(o.ev=e.value),t.debug&&console.debug("send trackEvent analytics ---\x3e",JSON.stringify(o)),sendData(o,t.debug)):console.debug("Metrics: no valid info"):console.debug("Metrics: no valid client ID"))}trackException(e,t){t.cid?(e={v:1,tid:this._trackID,cid:t.cid,uid:t.uid,t:"exception",exd:e.code+"-"+e.message,exf:0},t.debug&&console.debug("send trackException analytics ---\x3e",JSON.stringify(e)),sendData(e,t.debug)):console.debug("Metrics: no valid client ID")}sendAppInfo(e){var t={v:1,tid:this._trackID,cid:e.cid,uid:e.uid,t:"screenView",an:"CocosCreator",aid:"com.cocos.creator",av:Editor.App.version,cd:"Home",sc:"start",sr:e.resolution||"unknown",cd1:e.scaleFactor||"1",ul:Editor.I18n.getLanguage()||"unknown",ua:Editor.App.userAgent};e.debug&&console.debug("send sendAppInfo analytics ---\x3e",JSON.stringify(t)),sendData(t,e.debug)}close(e){}}module.exports=new GoogleMetricsObserver;