"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assetOutputPathCache=exports.AssetCache=exports.calcMd5=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),HASH_LEN=5;function calcMd5(e){e=Array.isArray(e)?e:[e];var t=require("crypto")["createHash"];const a=t("md5");return e.forEach(e=>{a.update(e)}),a.digest("hex").slice(0,HASH_LEN)}exports.calcMd5=calcMd5;class AssetCache{constructor(){this._cacheMap={}}_getCacheFilePath(e,t){return(0,path_1.join)(Editor.Project.tmpDir,"asset-db",e.uuid.slice(0,2),e.uuid,t)}async add(e,t,a){var t=calcMd5(JSON.stringify(t)),r=this._getCacheFilePath(e,t+(0,path_1.extname)(a));try{await(0,fs_extra_1.copy)(a,r),this._cacheMap[e.uuid]={path:a,md5Key:t}}catch(e){return console.warn(e),!1}return!0}query(e,t){t=JSON.stringify(t),e=this._cacheMap[e];return e.md5Key===t?e.path:null}}exports.AssetCache=AssetCache,exports.assetOutputPathCache=new AssetCache;