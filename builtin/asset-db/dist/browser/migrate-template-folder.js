"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migrateCreatorAndTemplates=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function migrateCreatorAndTemplates(){var t=await Editor.Project.__protected__.getLastEditorVersion();t&&Editor.Utils.Parse.compareVersion(t,"3.8.2")||(await migrateCreatorFolder()&&Editor.Task.addNotice({title:Editor.I18n.t("asset-db.migrations.creator.autoTitle"),message:Editor.I18n.t("asset-db.migrations.creator.message")+Editor.I18n.t("asset-db.migrations.creator.autoMessage"),source:"asset-db",type:"success"}),await migrateTemplateFolder()?Editor.Task.addNotice({title:Editor.I18n.t("asset-db.migrations.templates.autoTitle"),message:Editor.I18n.t("asset-db.migrations.templates.message")+Editor.I18n.t("asset-db.migrations.templates.autoMessage"),source:"builder",type:"success"}):Editor.Task.addNotice({title:Editor.I18n.t("asset-db.migrations.templates.title"),message:Editor.I18n.t("asset-db.migrations.templates.message"),source:"builder",type:"success"}))}async function migrateCreatorFolder(){var e=(0,path_1.join)(Editor.Project.path,"templates"),a=(0,path_1.join)(Editor.Project.path,".creator");if((0,fs_extra_1.existsSync)(a)){let t=!1;try{var r,s,i=(0,path_1.join)(a,"default-meta.json"),o=((0,fs_extra_1.existsSync)(i)&&(t=!0,r=(0,path_1.join)(Editor.Project.path,"settings","default-meta.json"),(0,fs_extra_1.existsSync)(r)?console.warn(r+" have already exist!"):(await(0,fs_extra_1.ensureDir)((0,path_1.join)(Editor.Project.path,"settings")),await(0,fs_extra_1.move)(i,r))),(0,path_1.join)(a,"asset-template"));(0,fs_extra_1.existsSync)(o)&&(t=!0,s=(0,path_1.join)(e,"new-asset"),(0,fs_extra_1.existsSync)(s)?console.warn(s+" have already exist!"):(await(0,fs_extra_1.ensureDir)(e),await(0,fs_extra_1.move)(o,s))),await(0,fs_extra_1.remove)(a)}catch(t){console.error(t),console.error("migrate .creator folder failed!")}return t}return!1}async function migrateTemplateFolder(){var t=(0,path_1.join)(Editor.Project.path,"preview-template"),e=(0,path_1.join)(Editor.Project.path,"build-templates"),a=(0,path_1.join)(Editor.Project.path,"templates");let r=!1;try{var s=(0,path_1.join)(a,"browser-preview");(0,fs_extra_1.existsSync)(t)&&!(0,fs_extra_1.existsSync)(s)&&(r=!0,await(0,fs_extra_1.ensureDir)(a),await(0,fs_extra_1.move)(t,s),await(0,fs_extra_1.symlink)(s,t))}catch(t){console.error(t)}try{var i=(0,path_1.join)(a,"build");(0,fs_extra_1.existsSync)(e)&&!(0,fs_extra_1.existsSync)(i)&&(r=!0,await(0,fs_extra_1.ensureDir)(a),await(0,fs_extra_1.move)(e,i),await(0,fs_extra_1.symlink)(i,e))}catch(t){console.error(t)}return r}exports.migrateCreatorAndTemplates=migrateCreatorAndTemplates;