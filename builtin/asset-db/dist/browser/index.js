"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=exports.methods=void 0;const tasks_1=require("./worker/tasks"),operation_1=require("./operation"),index_1=require("./worker/index"),electron_worker_1=__importDefault(require("@base/electron-worker")),utils_1=require("./utils"),asset_config_1=require("./asset-config"),electron_1=require("electron");let noticeDate=0;async function load(){Editor.Task.__protected__.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading")),(0,index_1.init)()}async function unload(){electron_worker_1.default.close("Assets"),Editor.Message.broadcast("asset-db:close")}exports.methods={noticeReloadEditor(){var e=Date.now();e-noticeDate<3e4||(noticeDate=e,Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.ignore_changed"),message:Editor.I18n.t("asset-db.preferences.notice_reload_editor"),source:Editor.I18n.t("asset-db.title"),type:"warn"}))},updateConfig(e,r){"autoScan"===e&&((0,tasks_1.setAutoRefresh)(!!r),r||Editor.Task.addNotice({title:Editor.I18n.t("asset-db.preferences.auto_scan"),message:Editor.I18n.t("asset-db.preferences.auto_scan_info"),source:Editor.I18n.t("asset-db.title"),type:"log"}))},refreshAllDatabase(){(0,tasks_1.refreshAllDatabase)()},refreshDefaultUserDataConfig(){return(0,index_1.forwarding)("asset-worker:refresh-default-user-data")||null},async updateDefaultUserData(e,r,s){return await(0,index_1.forwarding)("asset-worker:update-default-user-data",e,r,s)||null},ready(){Editor.Task.__protected__.removeSyncTask("import-asset")},close(){Editor.Task.__protected__.addSyncTask("import-asset",Editor.I18n.t("asset-db.mask.loading"))},async stopDatabase(e){return await(0,index_1.forwarding)("asset-worker:stop-database",e)||null},async startDatabase(e){return await(0,index_1.forwarding)("asset-worker:start-database",e)||null},async createAsset(e,r,s){return(0,operation_1.createAsset)(e,r,s)},async importAsset(e,r,s){return(0,operation_1.importAsset)(e,r,s)},async copyAsset(e,r,s){return(0,operation_1.copyAsset)(e,r,s)},async moveAsset(e,r,s){return(0,operation_1.moveAsset)(e,r,s)},async renameAsset(e,r,s){return(0,operation_1.renameAsset)(e,r,s)},async deleteAsset(e){return(0,operation_1.deleteAsset)(e)},async openAsset(e){return await(0,index_1.forwarding)("asset-worker:open-asset",e)||null},async saveAsset(e,r){return(0,operation_1.saveAsset)(e,r)},async saveAssetMeta(e,r){return(0,operation_1.saveAssetMeta)(e,r)},async reimportAsset(e){return(0,operation_1.reimportAsset)(e)},async refreshAsset(e){e=await(0,operation_1.refreshAsset)(e);return await new Promise(e=>{setTimeout(e,500)}),e},async refreshAllEffect(){return(0,operation_1.refreshAllEffect)()},async queryPath(e){return await(0,index_1.forwarding)("asset-worker:query-path",e)||null},async queryUrl(e){return await(0,index_1.forwarding)("asset-worker:query-url",e)||null},async queryUUID(e){return(0,index_1.forwarding)("asset-worker:query-uuid",e)},async queryAssets(e,r){return(0,index_1.forwarding)("asset-worker:query-assets",e,r)},async queryAssetInfo(e,r){return(0,index_1.forwarding)("asset-worker:query-asset-info",e,r)},async queryAssetMeta(e){return(0,index_1.forwarding)("asset-worker:query-asset-meta",e)},async queryMissingAssetInfo(e){return(0,index_1.forwarding)("asset-worker:query-missing-asset-info",e)},async queryAssetMtime(e){return(0,index_1.forwarding)("asset-worker:query-asset-mtime",e)},async queryAssetDependencies(e,r="asset"){return(0,index_1.forwarding)("asset-worker:query-asset-dependencies",e,r)},async queryAssetUsers(e,r="asset"){return(0,index_1.forwarding)("asset-worker:query-asset-users",e,r)},async queryAssetDependenciesDeprecated(e,r="asset"){return console.log(Editor.I18n.t("asset-db.deprecatedTip",{oldName:"query-asset-dependinces",newName:"query-asset-dependencies",version:"3.8.3"})),(0,index_1.forwarding)("asset-worker:query-asset-dependencies",e,r)},async queryAssetUsed(e,r="asset"){return console.log(Editor.I18n.t("asset-db.deprecatedTip",{oldName:"query-asset-used",newName:"query-asset-users",version:"3.8.3"})),(0,index_1.forwarding)("asset-worker:query-asset-users",e,r)},async queryAssetData(e){return(0,index_1.forwarding)("asset-worker:query-asset-data",e)},async isBusy(){return(0,index_1.forwarding)("asset-worker:query-database-busy")},async pause(e){return(0,index_1.forwarding)("asset-worker:pause-database",e)},async resume(){return(0,index_1.forwarding)("asset-worker:resume-database")},async generateAvailableUrl(e){return(0,operation_1.generateAvailableURL)(e)},async"query-db-info"(e){return(0,index_1.forwarding)("asset-worker:query-db-info",e)},async"query-db-list"(){return(0,index_1.forwarding)("asset-worker:query-db-list")},refresh(){(0,index_1.reload)()},"open-devtools"(){(0,index_1.debug)()},async queryReady(){return(0,tasks_1.isReady)()},async"create-asset-dialog"(e,r){var s;return"string"==typeof e?((s={}).url=r,asset_config_1.createAssetConfig[e]?s.handler=asset_config_1.createAssetConfig[e].handler:s.ccType=e,console.warn("The parameters of create-asset-dialog have changed, please refer to the new interface definition for adaptation"),(await(0,index_1.forwarding)("asset-worker:create-asset-dialog",s)).uuid):(0,index_1.forwarding)("asset-worker:create-asset-dialog",e)},async"init-asset"(e,r){return(0,operation_1.initAsset)(e,r)},async"query-all-importer"(){return(0,operation_1.queryAllImporter)()},async"query-all-asset-types"(){return(0,operation_1.queryAllAssetTypes)()},async executeScript(e){return(0,index_1.forwarding)("asset-worker:execute-script",e)},async projectChangeHighQuality(e){return(0,index_1.forwarding)("asset-worker:change-high-quality",e)},async queryCreateList(){return(0,index_1.forwarding)("asset-worker:query-create-list")},async queryIconConfigMap(){return(0,index_1.forwarding)("asset-worker:query-icon-config-map")},async queryAssetConfigMap(){return(0,index_1.forwarding)("asset-worker:query-asset-config-map")},async queryCreateMenuList(){var e=await(0,index_1.forwarding)("asset-worker:query-create-list");return(0,utils_1.formatCreateMenu)(e)},async queryAssetThumbnail(e,r){return(0,index_1.forwarding)("asset-worker:query-asset-thumbnail",e,r)},async queryAssetUserDataConfig(e){return(0,index_1.forwarding)("asset-worker:query-asset-userData-config",e)},async batchMessageHandler(e,r=!1){return(0,index_1.forwarding)("asset-worker:batch-message-handler",e,r)},async newAsset(e){return(0,index_1.forwarding)("asset-worker:create-asset",e)},async executeCustomOperation(e,r,...s){return(0,index_1.forwarding)("asset-worker:execute-custom-operation",e,r,...s)},async showAssetTemplateDir(e){return electron_1.shell.openPath(e)}},exports.load=load,exports.unload=unload;