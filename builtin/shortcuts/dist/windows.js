"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unload=exports.load=void 0;const utils_1=require("./utils");let shortcutMap={};const isWin="win32"===process.platform,isMac="darwin"===process.platform;function keyDownHandle(t){var e=(0,utils_1.handleEventKey)(t);if(!e)return;function r(){var e;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName)return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.undo(),1}function n(){var e;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName)return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.redo(),1}function a(){var e;if((window.getSelection()||"").toString())return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.cut(),1}function o(){var e;if((window.getSelection()||"").toString())return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.copy(),1}function s(){var e;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName)return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.paste(),1}function i(){var e;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName)return t.preventDefault(),(e=require("@electron/remote").BrowserWindow.getFocusedWindow())&&e.webContents.selectAll(),1}const c=t.path[0];switch(e){case"ctrl+z":if(isWin&&r())return;break;case"cmd+z":if(isMac&&r())return;break;case"shift+ctrl+z":if(isWin&&n())return;break;case"shift+cmd+z":if(isMac&&n())return;break;case"ctrl+x":if(isWin&&a())return;break;case"cmd+x":if(isMac&&a())return;break;case"ctrl+c":if(isWin&&o())return;break;case"cmd+c":if(isMac&&o())return;break;case"ctrl+v":if(isWin&&s())return;break;case"cmd+v":if(isMac&&s())return;break;case"ctrl+a":if(isWin&&i())return;break;case"cmd+a":if(isMac&&i())return}if("INPUT"!==c.tagName&&"TEXTAREA"!==c.tagName){e=shortcutMap[e];if(Array.isArray(e)&&0!==e.length)for(const u of e)u.when&&!Editor.Utils.Parse.checkWhen(u.when)||(t.preventDefault(),Editor.Message.send(u.pkgName,u.message,...u.params||[]))}}async function updateShortMap(){shortcutMap=await Editor.Message.request("shortcuts","query-shortcut-map")}async function load(){await updateShortMap(),Editor.Message.__protected__.addBroadcastListener("shortcuts:change",updateShortMap),document.addEventListener("keydown",keyDownHandle)}function unload(){Editor.Message.__protected__.removeBroadcastListener("shortcuts:change",updateShortMap),document.removeEventListener("keydown",keyDownHandle)}exports.load=load,exports.unload=unload;