"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.install=exports.initVivoProject=exports.hasCliProject=exports.isInstallVivoMiniGameTool=exports.isInitVivo=exports.isInstallNodeJs=exports.initEnvironmentPath=void 0;const child_process_1=require("child_process"),fs_1=require("fs"),path_1=require("path"),fs_extra_1=require("fs-extra");let environmentPath=process.env;function initEnvironmentPath(e,n){e?(console.log(Editor.I18n.t("builder.custom_npm_path_config"),e),"win32"===process.platform?environmentPath.Path=e:(environmentPath.PATH=e,environmentPath.PATH+=":/usr/bin:/bin:/usr/sbin:/sbin")):(n&&console.log(Editor.I18n.t("builder.custom_npm_path_not_config")),environmentPath=process.env)}function isInstallNodeJs(){return new Promise((n,o)=>{child_process_1.exec("node -v",{env:environmentPath},e=>{e?(console.error(e),"win32"===process.platform?console.error(new Error(Editor.I18n.t("builder.window_default_npm_path_error"))):console.error(new Error(Editor.I18n.t("builder.mac_default_npm_path_error"))),o(!1)):n(!0)})})}function isInitVivo(e){return!(!fs_1.existsSync(path_1.join(e,"node_modules"))||fs_1.existsSync(path_1.join(e,"node_modules",".staging")))}function isInstallVivoMiniGameTool(){try{child_process_1.execSync("mg -v")}catch(e){return console.error(e),!1}return!0}function hasCliProject(e){return!!fs_1.existsSync(path_1.join(e,"minigame.config.js"))}function initVivoProject(t){return fs_extra_1.ensureDirSync(t),new Promise((n,o)=>{child_process_1.exec(`mg init ${path_1.basename(t)} --force`,{cwd:path_1.dirname(t)},e=>{if(e)return o(!1),console.error(e),console.log("init vivo project tools failed"),fs_extra_1.removeSync(path_1.join(t,"node_modules")),!1;n(!0)})})}function install(t){const e="win32"===process.platform?"npm.cmd":"npm";return new Promise((n,o)=>{child_process_1.exec(e+" install",{cwd:t,env:environmentPath},e=>{if(!e)return console.log(Editor.I18n.t("builder.npm_installed_success")),n(!0),!0;console.error(e),console.error(new Error(Editor.I18n.t("builder.npm_install_fail"))),fs_extra_1.removeSync(path_1.join(t,"node_modules")),o(e)})})}exports.initEnvironmentPath=initEnvironmentPath,exports.isInstallNodeJs=isInstallNodeJs,exports.isInitVivo=isInitVivo,exports.isInstallVivoMiniGameTool=isInstallVivoMiniGameTool,exports.hasCliProject=hasCliProject,exports.initVivoProject=initVivoProject,exports.install=install;