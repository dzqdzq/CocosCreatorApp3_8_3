"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterInit=exports.throwError=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function generateOptions(t){var e,t=t.packages["open-harmonyos"];if(t.orientation=t.orientation||{},t.sdkPath=await Editor.Profile.getConfig("program","ohos_sdk")||"",t.ndkPath=await Editor.Profile.getConfig("program","ohos_ndk")||"",t.sdkPath&&t.ndkPath)return{packageName:t.packageName||"",orientation:{landscapeRight:null==(e=t.orientation.landscapeRight)||e,landscapeLeft:null==(e=t.orientation.landscapeLeft)||e,portrait:null!=(e=t.orientation.portrait)&&e,upsideDown:null!=(e=t.orientation.upsideDown)&&e},apiLevel:t.apiLevel||"7",sdkPath:t.sdkPath||"",ndkPath:t.ndkPath||"",renderBackEnd:{gles3:null==(t=null==(e=t.renderBackEnd)?void 0:e.gles3)||t}};throw new Error(Editor.I18n.t("ohos.tips.ohos_sdk_error"))}async function onAfterInit(t,e,a){fs_extra_1.emptyDirSync(e.paths.dir);var r=await generateOptions(t),n=(t.packages["open-harmonyos"]=r).renderBackEnd,n=(t.assetSerializeOptions["cc.EffectAsset"].glsl3=null==(n=n.gles3)||n,{packageName:r.packageName,orientation:r.orientation});a.__addStaticsInfo(n),t.assetSerializeOptions.exportCCON=!0,t.assetSerializeOptions.allowCCONExtension=!0,Object.assign(t.appTemplateData,{showFPS:!1}),Object.assign(t.buildEngineParam,{platform:"NATIVE",engineName:"src/cocos-js"});let i;r=(await Editor.Message.request("engine","query-info")).nativePath,a=await getBrowserslistQuery(r);(i=a?a:i)&&(t.buildEngineParam.targets=i,t.buildScriptParam.targets=i),t.buildScriptParam.system={preset:"commonjs-like"},await fs_extra_1.emptyDirSync(e.paths.dir)}async function getBrowserslistQuery(t){t=path_1.join(t,".browserslistrc");let e;try{e=await fs_extra_1.readFile(t,"utf8")}catch(t){return}t=function(t){var e=[];for(const r of t.split("\n")){var a=r.indexOf("#"),a=(a<0?r:r.substr(0,a)).trim();0!==a.length&&e.push(a)}return e}(e);if(0!==t.length)return t.join(" or ")}exports.throwError=!0,exports.onAfterInit=onAfterInit;