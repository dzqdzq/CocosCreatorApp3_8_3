"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){e[i=void 0===i?r:i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.findXcodeProjects=exports.getBrowserslistQuery=exports.createBundle=exports.outputJSBAdapter=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),Editor=__importStar(require("editor")),babelify=require("babelify"),browserify=require("browserify");async function outputJSBAdapter(e,t){var t=(t||{})["targets"],r=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/builtin/index.js"),i=path_1.join(Editor.App.path,"../resources/3d/jsb-adapter/engine/index.js");await createBundle(r,path_1.join(e,"jsb-adapter","jsb-builtin.js"),{targets:t}),await createBundle(i,path_1.join(e,"jsb-adapter","jsb-engine.js"),{targets:t})}async function createBundle(e,n,t){let r,s,a=(Array.isArray(t)?r=t:t&&(r=t.excludes,s=t.targets),browserify(e));return r&&r.forEach(function(e){a.exclude(e)}),await fs_extra_1.ensureDir(path_1.dirname(n)),new Promise((r,i)=>{a.transform(babelify,{presets:[[require("@babel/preset-env"),{targets:s}]]}).bundle((e,t)=>{e?(console.error(e),i(e)):(fs_extra_1.writeFileSync(n,t,"utf8"),r())})})}async function getBrowserslistQuery(e){e=path_1.join(e,".browserslistrc");let t;try{t=await fs_extra_1.readFile(e,"utf8")}catch(e){return}e=function(e){var t=[];for(const i of e.split("\n")){var r=i.indexOf("#"),r=(r<0?i:i.substr(0,r)).trim();0!==r.length&&t.push(r)}return t}(t);if(0!==e.length)return e.join(" or ")}function findXcodeProjects(e){return fs_extra_1.readdirSync(e).filter(e=>e.endsWith(".xcodeproj"))}exports.outputJSBAdapter=outputJSBAdapter,exports.createBundle=createBundle,exports.getBrowserslistQuery=getBrowserslistQuery,exports.findXcodeProjects=findXcodeProjects;