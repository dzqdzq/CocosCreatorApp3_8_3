"use strict";var __awaiter=this&&this.__awaiter||function(e,r,s,p){return new(s=s||Promise)(function(i,t){function n(e){try{a(p.next(e))}catch(e){t(e)}}function o(e){try{a(p.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,o)}a((p=p.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.data=exports.style=exports.template=void 0;const fs_extra_1=require("fs-extra"),util_1=require("util"),path_1=require("path"),child_process_1=require("child_process"),PKG_NAME="bytedance-mini-game";let panel;function run(n){return __awaiter(this,void 0,void 0,function*(){let t=yield Editor.Profile.getConfig("program","bytedance_app_path");if(t&&fs_extra_1.existsSync(t)){fs_extra_1.statSync(t).isDirectory()||"win32"!==process.platform||(t=path_1.dirname(t));var i;let e;e="darwin"===process.platform?path_1.join(t,"Contents/Resources/app.asar.unpacked/bytecli"):path_1.join(t,"resources/app.asar.unpacked/bytecli.bat"),fs_extra_1.existsSync(e)?(n.buildPath=Editor.UI.File.resolveToRaw(n.buildPath),i=["-o",path_1.join(n.buildPath,n.outputName)],console.log("Run command : "+i.join(" ")),(i=child_process_1.spawn(e,i,{env:{bytedanceide:t,byte_dance_ide:t}}))&&i.stdout&&i.stdout.on("data",function(e){console.log(e.toString())}),i&&i.stderr&&i.stderr.on("data",function(e){console.error(e.toString())})):yield Editor.Dialog.error(Editor.I18n.t("bytedance-mini-game.tips.client_path_error"))}else console.warn(""+util_1.format(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty"),t)),yield Editor.Dialog.warn(Editor.I18n.t("bytedance-mini-game.tips.bytedance_app_path_empty"));return!1})}exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8"),exports.style=`
.warning-tip {
    color: var(--color-warn-fill);
    font-sizeï¼š 11px;
    line-height: 16px;
    margin-bottom: 2px;
}

.jump {
    cursor: pointer;
    text-decoration: underline;
}

.jump:hover {
    color: var(--color-focus-fill-weakest)
}
`;const component={data(){return{includeModules:[],pkgOptions:null}},computed:{physicsX(){var e=this;return e.physics3D&&(e.pkgOptions&&"physX"===e.pkgOptions.physX.use||e.includeModules.includes("physics-physx"))},physics3D(){return!!this.includeModules.filter(e=>e.startsWith("physics-")&&!e.startsWith("physics-2d")).length},selectStyle(){return this.physics3D?{display:"flex"}:{display:"flex",color:"var(--color-warn-fill)"}}},methods:{t(e){return Editor.I18n.t("bytedance-mini-game.options."+e)},updateEngineModules(){return __awaiter(this,void 0,void 0,function*(){console.debug("engine-modules-config-changed"),this.includeModules=yield Editor.Profile.getProject("engine","modules.includeModules")})},init(){return __awaiter(this,void 0,void 0,function*(){this.pkgOptions=panel.options.packages["bytedance-mini-game"],yield this.updateEngineModules()})},onConfirm(e){var t=e.target.value,e=e.target.getAttribute("path");this.pkgOptions.physX[e]=t,panel.dispatch("update",`packages.${PKG_NAME}.physX.`+e,t,null)},openProjectSettings(){Editor.Message.send("project","open-settings","engine","modules")}},mounted(){this.init(),Editor.Message.addBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)},beforeDestroy(){Editor.Message.removeBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)}};function update(e,t){return __awaiter(this,void 0,void 0,function*(){panel=this,t&&!t.startsWith("packages."+panel.pkgName)||(panel.options=e,panel.vm.init())})}function ready(e){panel=this;var t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".bytedance-mini-game"},exports.update=update,exports.ready=ready;