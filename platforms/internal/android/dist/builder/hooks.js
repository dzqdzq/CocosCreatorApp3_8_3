"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterInit=exports.throwError=void 0;const fs_1=require("fs"),path_1=require("path"),options_1=require("./options");async function generateOptions(e){var a,e=e.packages.android;if(e.orientation=e.orientation||{},e.sdkPath=await Editor.Profile.getConfig("program","android_sdk")||"",e.ndkPath=await Editor.Profile.getConfig("program","android_ndk")||"",e.sdkPath&&e.ndkPath)return{packageName:e.packageName||"",orientation:{landscapeRight:null==(a=e.orientation.landscapeRight)||a,landscapeLeft:null==(a=e.orientation.landscapeLeft)||a,portrait:null!=(a=e.orientation.portrait)&&a,upsideDown:null!=(a=e.orientation.upsideDown)&&a},apiLevel:e.apiLevel||"",appABIs:e.appABIs||[],useDebugKeystore:e.useDebugKeystore,keystorePath:e.keystorePath||"",keystorePassword:e.keystorePassword||"",keystoreAlias:e.keystoreAlias||"",keystoreAliasPassword:e.keystoreAliasPassword||"",appBundle:null!=(a=e.appBundle)&&a,androidInstant:null!=(a=e.androidInstant)&&a,remoteUrl:e.remoteUrl||"",sdkPath:e.sdkPath||"",ndkPath:e.ndkPath||"",renderBackEnd:{vulkan:null!=(a=null==(a=e.renderBackEnd)?void 0:a.vulkan)&&a,gles3:null==(a=null==(a=e.renderBackEnd)?void 0:a.gles3)||a,gles2:null==(e=null==(a=e.renderBackEnd)?void 0:a.gles2)||e}};throw new Error(Editor.I18n.t("android.tips.android_sdk_error"))}async function onAfterInit(e,a,r){var t=await generateOptions(e),n=(e.packages.android=t).renderBackEnd,n=(e.assetSerializeOptions["cc.EffectAsset"].glsl1=null==(o=n.gles2)||o,e.assetSerializeOptions["cc.EffectAsset"].glsl3=null==(o=n.gles3)||o,e.assetSerializeOptions["cc.EffectAsset"].glsl4=null==(o=n.vulkan)||o,{packageName:t.packageName,orientation:t.orientation}),o=(r.__addStaticsInfo(n),await options_1.checkAndroidAPILevels(t.apiLevel,e)),r=(o.error&&(console.error(o.error),o.newValue)&&(t.apiLevel=o.newValue),Editor.Metrics.trackEvent({category:"Project",action:"Rendering Backend",label:"Vulkan",value:e.packages.android.renderBackEnd.vulkan?100:0}),path_1.join(Editor.Project.path,"native","android","res","values","strings.xml"));fs_1.existsSync(r)&&fs_1.readFileSync(r,"utf8")}exports.throwError=!0,exports.onAfterInit=onAfterInit;