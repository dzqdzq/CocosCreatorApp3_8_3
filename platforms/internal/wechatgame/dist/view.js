"use strict";var __awaiter=this&&this.__awaiter||function(e,r,s,c){return new(s=s||Promise)(function(o,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?o(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.data=exports.template=exports.style=exports.buttonConfig=void 0;const child_process_1=require("child_process"),fs_extra_1=require("fs-extra"),path_1=require("path"),iconv=require("iconv-lite"),PKG_NAME="wechatgame";let panel;exports.buttonConfig={configs:{run:{label:"i18n:wechatgame.run.label",click(e,i){return __awaiter(this,void 0,void 0,function*(){i.buildPath=Editor.UI.File.resolveToRaw(i.buildPath);var e=path_1.join(i.buildPath,i.outputName),t=e.match(/([`~!#$%^&*+=<>?"{}|,;'·~！#￥%……&*（）+={}|《》？：“”【】、；‘'，。、])/im);t&&console.warn(Editor.I18n.t("wechatgame.tips.build_path_contains_symbol",{symbol:t[1]}));let o=yield Editor.Profile.getConfig("program","wechat_devtools");if(!o||!fs_extra_1.existsSync(o))return console.warn(""+Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty",{wechatgamePath:o})),1===(yield Editor.Dialog.warn(Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty"),{buttons:["Cancel","Set Wechat DevTools"]})).response&&Editor.Message.send("preferences","open-settings","program"),!1;fs_extra_1.statSync(o).isDirectory()||"win32"!==process.platform||(o=path_1.dirname(o));let n;return"darwin"===process.platform?(n=path_1.join(o,"Contents/Resources/app.nw/bin/cli"),fs_extra_1.existsSync(n)||(n=path_1.join(o,"Contents/MacOS/cli"))):n=path_1.join(o,"cli.bat"),fs_extra_1.existsSync(n)?(t=["-o",e,"-f","cocos"],console.log("Run command : "+t.join(" ")),(e=child_process_1.spawn(n,t))&&e.stdout&&e.stdout.on("data",function(e){console.log(""+iconv.decode(e,"utf8").toString())}),e&&e.stderr&&e.stderr.on("data",function(e){console.error(""+iconv.decode(e,"utf8").toString())}),!0):(yield Editor.Dialog.error(Editor.I18n.t("builder.wechat_game.client_path_error")),!1)})}}}},exports.style=`
.warning-tip {
    color: var(--color-warn-fill);
    font-size： 11px;
    line-height: 16px;
    margin-bottom: 2px;
}

.jump {
    cursor: pointer;
    text-decoration: underline;
}

.jump:hover {
    color: var(--color-focus-fill-weakest)
}
`,exports.template=fs_extra_1.readFileSync(path_1.join(__dirname,"../static/view.html"),"utf8");const component={data(){return{pkgOptions:{},includeModules:[]}},computed:{physics3D(){return!!this.includeModules.filter(e=>e.startsWith("physics-")&&!e.startsWith("physics-2d")).length}},methods:{t(e){return Editor.I18n.t("wechatgame.options."+e)},init(){return __awaiter(this,void 0,void 0,function*(){this.pkgOptions=panel.options.packages.wechatgame,yield this.updateEngineModules()})},onConfirm(e,t){e=e.target.value;this.pkgOptions[t]=e,panel.dispatch("update",`packages.${PKG_NAME}.`+t,e,null)},openProjectSettings(){Editor.Message.send("project","open-settings","engine","modules")},updateEngineModules(){return __awaiter(this,void 0,void 0,function*(){this.includeModules=yield Editor.Profile.getProject("engine","modules.includeModules")})}},mounted(){this.init(),Editor.Message.addBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)},beforeDestroy(){Editor.Message.removeBroadcastListener("engine:engine-modules-config-changed",this.updateEngineModules)}};function update(e,t){return __awaiter(this,void 0,void 0,function*(){panel=this,t&&!t.startsWith("packages."+panel.pkgName)||(panel.options=e,panel.vm.init())})}function ready(e){panel=this;var t=require("vue/dist/vue.js");panel.options=e,panel.vm=new t(Object.assign({el:panel.$.root},component))}exports.data={vm:null,options:{}},exports.$={root:".wechatgame"},exports.update=update,exports.ready=ready;