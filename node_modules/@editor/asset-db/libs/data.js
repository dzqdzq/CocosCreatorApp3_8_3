"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataManager=void 0;const fs_extra_1=require("fs-extra");class DataManager{constructor(a){this.dataMap={},this._saveTimer=null,this.console=a||console}async setRecordJSON(a){if(this.file=a,(0,fs_extra_1.existsSync)(a))try{this.dataMap=(0,fs_extra_1.readJSONSync)(this.file)}catch(a){this.console.error(a),this.dataMap={}}else this.dataMap={}}save(){clearTimeout(this._saveTimer),this._saveTimer=setTimeout(()=>{this.saveImmediate()},400)}saveImmediate(){clearTimeout(this._saveTimer),this.file&&(0,fs_extra_1.outputJSONSync)(this.file,this.dataMap,{spaces:2})}has(a){return!!this.dataMap[a.uuid]}empty(a){this.dataMap[a.uuid]={url:a.url,value:{},versionCode:a.versionCode},this.save()}update(a){this.dataMap[a.uuid]||(this.dataMap[a.uuid]={url:a.url,value:{},versionCode:a.versionCode}),this.dataMap[a.uuid].url=a.url,this.dataMap[a.uuid].versionCode=a.versionCode}setValue(a,e,t){this.update(a),this.dataMap[a.uuid].value[e]=t,this.save()}getValue(a,e){return this.dataMap[a.uuid].value[e]}get(a,e="value"){return this.dataMap[a.uuid]?this.dataMap[a.uuid][e]:null}}exports.DataManager=DataManager;