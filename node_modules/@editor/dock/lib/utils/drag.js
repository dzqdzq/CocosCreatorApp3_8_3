"use strict";const ipc=require("@base/electron-base-ipc"),element=require("./element"),pkg=require("../../package.json"),ipcFlag=`${pkg.name}@${pkg.version}`;let $mask=document.createElement("div");$mask.style.position="absolute",$mask.style.pointerEvents="none",$mask.style.background="#075692",$mask.style.border="2px solid #71c2ff",$mask.style.opacity=.5,$mask.style.zIndex=1e3;let $line=document.createElement("div");$line.style.position="absolute",$line.style.pointerEvents="none",$line.style.width="2px",$line.style.height="28px",$line.style.background="red";let isDrag=!1;ipc.on(`${ipcFlag}:panel-drag-start`,()=>{isDrag=!0}),ipc.on(`${ipcFlag}:panel-drag-end`,()=>{isDrag=!1});let start=function(e,t){e.dataTransfer.setData("type","editor-panel"),e.dataTransfer.setData("name",t.name),t.$tabs.$groups&&(e.dataTransfer.setData("panel-width",t.$tabs.$groups.clientWidth),e.dataTransfer.setData("panel-height",t.$tabs.$groups.clientHeight)),ipc.send(`${ipcFlag}:panel-drag-start`).callback(async(e,a)=>{if(e)return console.warn(e),void ipc.send(`${ipcFlag}:panel-drag-closed`,!1);if(!a)return void ipc.send(`${ipcFlag}:panel-drag-closed`,!1);if(!1===await t.$tabs.$groups.removePanel(t.name,a))return ipc.send(`${ipcFlag}:panel-drag-closed`,!1),!1;ipc.send(`${ipcFlag}:panel-drag-closed`,!0)})},end=function(e,t){setTimeout(()=>{ipc.send(`${ipcFlag}:panel-drag-end`,!1).callback((e,a)=>{a&&element.refresh(t)})},500)},drop=function(e,t){let a=t.getBoundingClientRect(),n=e.pageX-a.left,s=e.pageY-a.top,i=n/a.width,l=s/a.height,p="";if(i<.3333?l>.3333&&l<.6666&&(p="left"):i<.6666?l<.3333?p="top":l>.6666&&(p="bottom"):l>.3333&&l<.6666&&(p="right"),!p)return!1;const r=e.dataTransfer.getData("name"),o=e.dataTransfer.getData("panel-height"),d=e.dataTransfer.getData("panel-width");return ipc.send(`${ipcFlag}:panel-drag-end`,!0).callback((e,a)=>{a&&(element.addLayout(t,{panels:[r]},p,{width:d,height:o}),element.refresh(t))}),switchMask(!1),!0},dropTab=function(e,t){switchLine(!1);let a=e.dataTransfer.getData("name");if(t.name===a)return void ipc.send(`${ipcFlag}:panel-drag-end`,!1);let n=t.$tabs.$groups.panels.indexOf(t.name),s=t.getBoundingClientRect(),i=e.pageX-s.left;$line.style.top=`${s.top}px`,i/s.width>=.5&&(n+=1),ipc.send(`${ipcFlag}:panel-drag-end`,!0).callback((e,s)=>{s&&(element.addPanel(t,a,n),element.refresh(t))})},tab=function(e,t){e.preventDefault(),e.stopPropagation();let a=t.getBoundingClientRect(),n=e.pageX-a.left;$line.style.top=`${a.top}px`,n/a.width<.5?$line.style.left=`${a.left}px`:$line.style.left=`${a.left+a.width}px`,switchLine(!0)},area=function(e,t){let a=t.getBoundingClientRect(),n=e.pageX-a.left,s=e.pageY-a.top,i=n/a.width,l=s/a.height,p="";return i<.3333?l>.3333&&l<.6666&&(p="left",$mask.style.left=a.left+"px",$mask.style.top=a.top+"px",$mask.style.width=a.width/2+"px",$mask.style.height=a.height+"px"):i<.6666?l<.3333?(p="top",$mask.style.left=a.left+"px",$mask.style.top=a.top+"px",$mask.style.width=a.width+"px",$mask.style.height=a.height/2+"px"):l>.6666&&(p="bottom",$mask.style.left=a.left+"px",$mask.style.top=a.top+a.height/2+"px",$mask.style.width=a.width+"px",$mask.style.height=a.height/2+"px"):l>.3333&&l<.6666&&(p="right",$mask.style.left=a.left+a.width/2+"px",$mask.style.top=a.top+"px",$mask.style.width=a.width/2+"px",$mask.style.height=a.height+"px"),switchMask(!!p),!!p},switchMask=function(e){e?!$mask.parentElement&&document.body.appendChild($mask):$mask.parentElement&&document.body.removeChild($mask)},switchLine=function(e){e?!$line.parentElement&&document.body.appendChild($line):$line.parentElement&&document.body.removeChild($line)},getDrag=function(){return isDrag};exports.start=start,exports.end=end,exports.drop=drop,exports.dropTab=dropTab,exports.area=area,exports.tab=tab,exports.switchMask=switchMask,exports.switchLine=switchLine,exports.getDrag=getDrag;