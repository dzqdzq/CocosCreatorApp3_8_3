"use stirct";const Resize=require("../renderer/element/dock-resize");let addLayout=function(e,t,n,i){const r=e,d=document.createElement("dock-layout"),l=document.createElement("dock-resize"),a=e.parentElement;if(null===a){const e=document.createElement("dock-layout");for(e.direction=r.direction;r.children.length;){let t=r.children[0];r.removeChild(t),e.appendChild(t)}return"left"===n||"right"===n?(r.direction="row",i.width&&(t.percent=i.width/(r.clientWidth-(r.children.length/2|0)*Resize.line),t.percent*=1+t.percent)):(r.direction="column",i.height&&(t.percent=i.height/(r.clientHeight-(r.children.length/2|0)*Resize.line),t.percent*=1+t.percent)),"left"===n||"top"===n?(r.appendChild(d),r.appendChild(l),r.appendChild(e)):(r.appendChild(e),r.appendChild(l),r.appendChild(d)),void d.layout(t)}if("none"!==r.direction){if("row"===r.direction&&("left"===n||"right"===n)||"column"===r.direction&&("top"===n||"bottom"===n))"row"===r.direction?i.width&&(t.percent=i.width/(r.clientWidth-(r.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(r.clientHeight-(r.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n?(r.insertBefore(l,r.firstElementChild),r.insertBefore(d,r.firstElementChild)):(r.appendChild(l),r.appendChild(d));else if("row"===a.direction?i.width&&(t.percent=i.width/(a.clientWidth-(a.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(a.clientHeight-(a.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n)a.insertBefore(d,r),a.insertBefore(l,r);else{let e=r.nextElementSibling;e?(a.insertBefore(l,e),a.insertBefore(d,e)):(a.appendChild(l),a.appendChild(d))}d.layout(t)}else{if("row"===a.direction&&("left"===n||"right"===n)||"column"===a.direction&&("top"===n||"bottom"===n))if("row"===a.direction?i.width&&(t.percent=i.width/(a.clientWidth-(a.children.length/2|0)*Resize.line),t.percent*=1+t.percent):i.height&&(t.percent=i.height/(a.clientHeight-(a.children.length/2|0)*Resize.line),t.percent*=1+t.percent),"left"===n||"top"===n)a.insertBefore(d,r),a.insertBefore(l,r);else{let e=r.nextElementSibling;e?(a.insertBefore(l,e),a.insertBefore(d,e)):(a.appendChild(l),a.appendChild(d))}else{let e=document.createElement("dock-layout");"row"===a.direction?(e.direction="column",i.width&&(t.percent=i.width/(e.clientWidth-(e.children.length/2|0)*Resize.line),t.percent*=1+t.percent)):(e.direction="row",i.height&&(t.percent=i.height/(e.clientHeight-(e.children.length/2|0)*Resize.line),t.percent*=1+t.percent)),e.data._percent=r.data._percent,d.data._percent=r.data._percent=.5,a.insertBefore(e,r),a.removeChild(r),"left"===n||"top"===n?(e.appendChild(d),e.appendChild(l),e.appendChild(r)):(e.appendChild(r),e.appendChild(l),e.appendChild(d))}d.layout(t)}},addPanel=function(e,t,n){e.parentElement.parentElement.parentElement.addPanel(t,n)},refreshLayout=function(e){e.data.minWidth=0,e.data.minHeight=0;for(let t=0;t<e.children.length;t++){let n=e.children[t];switch(n.tagName){case"DOCK-GROUPS":e.data.minWidth=n.minWidth||200,e.data.minHeight=n.minHeight||150,0===n.panels.length&&(e.removeChild(n),t--);continue;case"DOCK-RESIZE":continue;case"DOCK-LAYOUT":if(refreshLayout(n),0===n.children.length){n.nextElementSibling&&"DOCK-RESIZE"===n.nextElementSibling.tagName?e.removeChild(n.nextElementSibling):n.previousElementSibling&&(e.removeChild(n.previousElementSibling),t--),e.removeChild(n),t--;continue}"row"===e.direction?(e.data.minWidth+=n.data.minWidth,0!==t&&(e.data.minWidth+=Resize.line),e.data.minHeight=Math.max(e.data.minHeight,n.data.minHeight)):"column"===e.direction?(e.data.minWidth=Math.max(e.data.minWidth,n.data.minWidth),e.data.minHeight+=n.data.minHeight,0!==t&&(e.data.minHeight+=Resize.line)):(e.data.minWidth=Math.max(e.data.minWidth,n.data.minWidth),e.data.minHeight=Math.max(e.data.minHeight,n.data.minHeight));continue}}if(1===e.children.length&&"DOCK-LAYOUT"===e.children[0].tagName){let t=e.children[0];for(e.removeChild(t);t.children.length;){let n=t.children[0];t.removeChild(n),e.appendChild(n)}e.direction=t.direction}let t=0,n=[],i=[];for(let r=0;r<e.children.length;r++){let d=e.children[r];"DOCK-LAYOUT"===d.tagName&&(d.data.percent?(t+=d.data.percent,i.push(d)):!0!==d.data.minimize&&n.push(d))}if(t<1){if(n.length>0){let e=(1-t)/n.length;n.forEach(t=>{t.data.percent=e;let n=document.createEvent("HTMLEvents");n.initEvent("resize",!1,!1),t.dispatchEvent(n)})}else if(i.length>0){let e=(1-t)/i.length;i.forEach(t=>{t.data.percent+=e;let n=document.createEvent("HTMLEvents");n.initEvent("resize",!1,!1),t.dispatchEvent(n)})}}else for(let n=0;n<e.children.length;n++){let i=e.children[n];if("DOCK-LAYOUT"===i.tagName&&!0!==i.data.minimize){i.data.percent/=t;let e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1),i.dispatchEvent(e)}}},refresh=function(e){let t=e;for(;t.parentElement;)t=t.parentElement;"DOCK-LAYOUT"===t.tagName&&(refreshLayout(t),emit(t))},emit=function(e){let t=e;for(;t.parentElement;)t=t.parentElement;if(t.$parent){let e=document.createEvent("HTMLEvents");e.initEvent("layout",!1,!1),t.$parent.dispatchEvent(e)}},recursiveFindPanel=function(e,t,n=[]){return Array.prototype.forEach.call(e.children,e=>{switch(e.tagName){case"DOCK-LAYOUT":recursiveFindPanel(e,t,n);break;case"DOCK-GROUPS":e.panels.includes(t)&&n.push(e)}}),n},appendPanel=function(e,t,n){const i=Array.prototype.find.call(e.shadowRoot.children,e=>"DOCK-LAYOUT"===e.tagName),r=recursiveFindPanel(i,t);r[0]&&(r[0].addPanel(n),r[0].active=n)};exports.addLayout=addLayout,exports.addPanel=addPanel,exports.refresh=refresh,exports.emit=emit,exports.appendPanel=appendPanel;