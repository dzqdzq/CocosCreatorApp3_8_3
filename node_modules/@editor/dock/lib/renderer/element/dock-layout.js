"use strict";const utils=require("../../utils");class Data{constructor(t){this._elem=t,this._percent=1,this._minWidth=300,this._minHeight=200,this._minimize=!1}get minimize(){return this._minimize}set minimize(t){this._minimize=!!t,requestAnimationFrame(()=>{const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1),this._elem.dispatchEvent(t)})}get percent(){return this.minimize?0:this._percent}set percent(t){this._percent=t,this._elem.style.flex=t}get minWidth(){return this._minWidth}set minWidth(t){t=parseInt(t),isNaN(t)&&(t=200),this._minWidth=t,this._elem.style.minWidth=t+"px"}get minHeight(){return this._minHeight}set minHeight(t){t=parseInt(t),isNaN(t)&&(t=150),this._minHeight=t,this._elem.style.minHeight=t+"px"}}class DockLayout extends window.HTMLElement{constructor(){super(),this.data=new Data(this),this.addEventListener("panel-area",t=>{utils.drag.area(t,this)&&(t.preventDefault(),t.stopPropagation())}),this.addEventListener("panel-drop",t=>{utils.drag.drop(t,this)&&(t.preventDefault(),t.stopPropagation())}),this.addEventListener("panel-leave",t=>{utils.drag.switchMask(!1)}),this.addEventListener("resize",()=>{Array.prototype.forEach.call(this.children,t=>{let e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1),t.dispatchEvent(e)})}),this.addEventListener("move",()=>{Array.prototype.forEach.call(this.children,t=>{let e=document.createEvent("HTMLEvents");e.initEvent("move",!1,!1),t.dispatchEvent(e)})})}get direction(){return this.getAttribute("direction")}set direction(t){this.setAttribute("direction",t)}get minimize(){return null!==this.getAttribute("minimize")}set minimize(t){t?(this.setAttribute("minimize",""),this.data.minimize=!0,utils.element.refresh(this)):(this.data.minimize=!1,this.removeAttribute("minimize")),this.children[0]&&"DOCK-GROUPS"===this.children[0].tagName&&this.children[0].$panels.emit("resize")}layout(t){const e=this.querySelectorAll("panel-frame");if(e)for(let t=0;t<e.length;t++)e[t].emit("close");if(this.innerHTML="",this.direction=t.direction||"none",this.data.percent=t.percent,this.data.minWidth=t["min-width"],this.data.minHeight=t["min-height"],t.minimize?this.setAttribute("minimize",""):this.removeAttribute("minimize"),this.data.minimize=t.minimize,t.panels){let e=document.createElement("dock-groups");return e.panels=t.panels,e.active=t.active||t.panels[0],void this.appendChild(e)}if(t.children&&0!==t.children.length)for(let e=0;e<t.children.length;e++){if(0!==e){let t=document.createElement("dock-resize");this.appendChild(t)}let i=document.createElement("dock-layout");this.appendChild(i),i.layout(t.children[e])}}dump(){let t={"min-width":this.data.minWidth,"min-height":this.data.minHeight,direction:this.direction,percent:this.data._percent,minimize:this.data.minimize};if(1===this.children.length){let e=this.children[0];t.active=e.active,t.panels=e.panels}else{let e=[];for(let t=0;t<this.children.length;t++){let i=this.children[t];"DOCK-LAYOUT"===i.tagName&&e.push(i.dump())}t.children=e}return t}}module.exports=DockLayout;