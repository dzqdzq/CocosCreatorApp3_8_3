"use strict";const ps=require("path"),i18n=require("@base/electron-i18n"),panel=require("@editor/panel"),utils=require("../../utils");let $tabs=[],updateInfo=function(t){let e=panel.queryInfo(t.name);if(t.$img)if(e&&e.userData&&e.userData.icon){let a=e.userData.packageDir||e.dirname;t.$img.innerHTML=`<img src="${ps.join(a,e.userData.icon)}" />`}else t.$img.innerHTML="";if(e&&e.userData&&e.userData.title){let a=e.userData.title;a.startsWith("i18n:")&&(a=a.substr(5),a=i18n.translation(a)||a),t.$name.innerHTML=a}else t.$name.innerHTML=t.data.name};class DockTab extends window.HTMLElement{constructor(){super(),this.data={name:"",title:"",active:!1},this.$tabs=null,this.addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),this.$tabs.$groups.active=this.name}),this.addEventListener("dblclick",()=>{const t=this.$tabs.$groups.parentElement;if(!t||!t.parentElement||"DOCK-LAYOUT"!==t.parentElement.tagName)return;const e=!t.minimize,a=t.parentElement.children;e&&Array.prototype.every.call(a,e=>"DOCK-LAYOUT"!==e.tagName||t===e||e.minimize)||(t.minimize=e,e||Array.prototype.forEach.call(a,e=>"DOCK-LAYOUT"!==e.tagName||t===e||(e.data.percent*=1-t.data.percent)))}),this.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),utils.drag.tab(t,this)}),this.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),utils.drag.switchLine(!1)}),this.addEventListener("dragstart",t=>{utils.drag.start(t,this)}),this.addEventListener("dragend",t=>{utils.drag.end(t,this),utils.drag.switchMask(!1)}),this.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),utils.drag.dropTab(t,this)})}connectedCallback(){$tabs.push(this),this.setAttribute("draggable","true"),this.$img=document.createElement("span"),this.$img.classList.add("img"),this.insertBefore(this.$img,this.firstElementChild),updateInfo(this)}disconnectedCallback(){let t=$tabs.indexOf(this);$tabs.splice(t,1),this.removeChild(this.$img)}get name(){return this.data.name}set name(t){this.data.name=t,this.$name||(this.$name=document.createElement("span"),this.appendChild(this.$name)),updateInfo(this)}get title(){return this._title}set title(t){this._title=t}get active(){return this.data.active}set active(t){t=!!t,this.data.active=t,t?this.setAttribute("active",t):this.removeAttribute("active")}}module.exports=DockTab,panel.on("register",t=>{$tabs.forEach(e=>{e.name===t&&updateInfo(e)})}),panel.on("change",t=>{$tabs.forEach(e=>{e.name===t&&updateInfo(e)})}),i18n.on("switch",()=>{$tabs.forEach(t=>{updateInfo(t)})});