'use strict';

if (process.platform === 'win32') {
    const Module = require('module');
    const _resolveFilename = Module._resolveFilename;

    Module._resolveFilename = function(...args) {
        let filePath = _resolveFilename(...args);
        if (!/\\electron\.asar\\/.test(filePath)) {
            filePath = filePath.replace(/^([a-z])\:/, (str, drive) => {
                return drive.toUpperCase() + ':';
            });
        }
        return filePath;
    };
}

const { join } = require('path');

const rm = require('./dist/require');

const { init } = require('./dist/init');

exports.init = async function(option) {
    await init(option);
    require('./dist/index');
};

exports.registerFindModulePath = function(func) {
    rm._findPathHandle = func;
};

exports.getPreloadFilePath = function () {
    return join(__dirname, './dist/require.js');
};
