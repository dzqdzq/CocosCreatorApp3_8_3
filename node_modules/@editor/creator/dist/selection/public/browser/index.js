"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSelected=exports.getLastSelected=exports.getLastSelectedType=exports.hover=exports.update=exports.clear=exports.unselect=exports.select=void 0;const ipc=require("@base/electron-base-ipc"),cache={},hoverTimer={},activatedTimer={};function _broadcastActivated(e){clearTimeout(hoverTimer[e]),hoverTimer[e]=setTimeout(()=>{const t=cache[e]=cache[e]||[];Editor.Message.broadcast("selection:activated",e,t.map(e=>e.id))},50)}function _select(e,t){if("string"!=typeof t)return;const c=cache[e]=cache[e]||[];for(let e=c.length-1;e>=0;e--){const s=c[e];if(s&&s.id===t){c.splice(e,1);break}}c.push({id:t,time:Date.now()}),Editor.Message.broadcast("selection:select",e,t)}function select(e,t){if("string"==typeof e){if(!Array.isArray(t))return _select(e,t),void _broadcastActivated(e);t.forEach(t=>{_select(e,t)}),_broadcastActivated(e)}}function _unselect(e,t){const c=cache[e];if(c)for(let s=c.length-1;s>=0;s--){const r=c[s];if(r&&r.id===t){c.splice(s,1),Editor.Message.broadcast("selection:unselect",e,t);break}}}function unselect(e,t){if("string"==typeof e){if(!Array.isArray(t))return _unselect(e,t),void _broadcastActivated(e);t.forEach(t=>{_unselect(e,t)}),_broadcastActivated(e)}}function clear(e){cache[e]&&(cache[e].forEach(t=>{Editor.Message.broadcast("selection:unselect",e,t.id)}),cache[e].length=0,_broadcastActivated(e))}function update(e,t){const c=[],s=cache[e]||[];t.forEach(t=>{if("string"!=typeof t)return;const r={id:t,time:Date.now()};c.push(r),s.find((e,t)=>e.id===r.id&&(s.splice(t,1),!0))||Editor.Message.broadcast("selection:select",e,r.id)});for(let t=0;t<s.length;t++)Editor.Message.broadcast("selection:unselect",e,s[t].id);cache[e]=c,_broadcastActivated(e)}function hover(e,t){"string"==typeof e&&(clearTimeout(hoverTimer[e]),hoverTimer[e]=setTimeout(()=>{"string"!=typeof t&&Editor.Message.broadcast("selection:hover",e),Editor.Message.broadcast("selection:hover",e,t)},50))}function getLastSelectedType(){let e;return Object.keys(cache).forEach(t=>{const c=cache[t];if(!c)return;const s=c[c.length-1];s&&(!e||e.time<s.time)&&(e={type:t,uuid:s.id,time:s.time})}),e?e.type:""}function getLastSelected(e){if("string"!=typeof e||!cache[e])return"";const t=cache[e],c=t[t.length-1];return c?c.id:""}function getSelected(e){return"string"!=typeof e?[]:(cache[e]||[]).map(e=>e.id)}exports.select=select,exports.unselect=unselect,exports.clear=clear,exports.update=update,exports.hover=hover,exports.getLastSelectedType=getLastSelectedType,exports.getLastSelected=getLastSelected,exports.getSelected=getSelected,ipc.on("editor-lib-selection:call",(e,t,c=[])=>{if(module.exports[t]){let s=module.exports[t](...c);return e.reply(null,s),s}});