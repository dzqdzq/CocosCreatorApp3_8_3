"use strict";var __awaiter=this&&this.__awaiter||function(e,n,o,t){return new(o||(o=Promise))(function(i,s){function a(e){try{l(t.next(e))}catch(e){s(e)}}function r(e){try{l(t.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof o?n:new o(function(e){e(n)})).then(a,r)}l((t=t.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeListener=exports.once=exports.on=exports.getSessionCode=exports.getUserToken=exports.logout=exports.login=exports.isLoggedIn=exports.getData=exports.skip=exports.hideMask=exports.showMask=void 0;const events_1=require("events"),ipc=require("@base/electron-base-ipc"),Profile=require("@base/electron-profile"),emitter=new events_1.EventEmitter,flag="editor-lib-user";let _panel,isReady=!1;function _init(){isReady||(isReady=!0,(_panel=document.createElement("login-panel")).loading=!0,_panel.hidden=!0,document.body.prepend(_panel),isLoggedIn().then(e=>{_panel.loading=!1,e?ipc.send(`${flag}:call`,"nextInit"):_panel.hidden=!1}).catch(e=>{console.warn(e),_panel.loading=!1,_panel.hidden=!1}),emitter.on("login",()=>{_panel.loading=!1,hideMask()}),emitter.on("logout",()=>{_panel.loading=!1,showMask()}))}if(window.__MAIN__){ipc.on(`${flag}:showMask`,(e,n,...o)=>{_panel.hidden=!1}),ipc.on(`${flag}:hideMask`,(e,n,...o)=>{_panel.hidden=!0}),ipc.on(`${flag}:init`,()=>__awaiter(void 0,void 0,void 0,function*(){_init()})),ipc.sendSync(`${flag}:check-skip-init`)||_init()}function showMask(){ipc.send(`${flag}:call`,"showMask")}function hideMask(){ipc.send(`${flag}:call`,"hideMask")}function skip(){ipc.send(`${flag}:call`,"skip")}function getData(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"getData").callback((o,t)=>o?n(o):e(t))})}function isLoggedIn(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"isLoggedIn").callback((o,t)=>o?n(o):e(t))})}function login(e,n){return __awaiter(this,void 0,void 0,function*(){return new Promise((o,t)=>{ipc.send(`${flag}:call`,"login",e,n).callback((e,n)=>e?t(e):o(n))})})}function logout(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"logout").callback((o,t)=>o?n(o):e())})}function getUserToken(){return new Promise((e,n)=>{ipc.send(`${flag}:call`,"getUserToken").callback((o,t)=>o?n(o):e(t))})}function getSessionCode(e){return new Promise((n,o)=>{ipc.send(`${flag}:call`,"getSessionCode",e).callback((e,t)=>e?o(e):n(t))})}function on(e,n){emitter.on(e,n)}function once(e,n){emitter.once(e,n)}function removeListener(e,n){emitter.removeListener(e,n)}exports.showMask=showMask,exports.hideMask=hideMask,exports.skip=skip,exports.getData=getData,exports.isLoggedIn=isLoggedIn,exports.login=login,exports.logout=logout,exports.getUserToken=getUserToken,exports.getSessionCode=getSessionCode,exports.on=on,exports.once=once,exports.removeListener=removeListener,ipc.on(`${flag}:emit`,(e,n,...o)=>{emitter.emit(n,...o)});