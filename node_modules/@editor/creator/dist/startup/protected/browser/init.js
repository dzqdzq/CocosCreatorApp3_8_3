"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{p(i.next(t))}catch(t){s(t)}}function a(t){try{p(i.throw(t))}catch(t){s(t)}}function p(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}p((i=i.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=exports.builtin=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),app_1=require("../../../app"),setting=require("@editor/setting");function init(t){return __awaiter(this,void 0,void 0,function*(){try{const e=(0,path_1.join)(app_1.App.path,"../builtin.js"),n=(0,path_1.join)(app_1.App.path,"../builtin.json");let i;if((0,fs_extra_1.existsSync)(e)){const t=require(e);t&&t.main&&(i=yield t.main())}else(0,fs_extra_1.existsSync)(n)&&(i=yield(0,fs_extra_1.readJSON)(n));i||(i={}),Array.isArray(i.disableBuiltin)?exports.builtin.disableBuiltin=i.disableBuiltin:exports.builtin.disableBuiltin=[],Array.isArray(i.extensions)?exports.builtin.extensions=i.extensions.map(t=>(0,path_1.isAbsolute)(t)?t:(0,path_1.join)(app_1.App.path,"..",t)):exports.builtin.extensions=[],i.env||(i.env={}),exports.builtin.env=i.env,t.env=t.env||{};const r=i.env.HOME||t.env.HOME;r&&(exports.builtin.env.HOME=r,setting.PATH.HOME=r);const s=i.env.PROJECT||t.env.PROJECT;s&&(exports.builtin.env.PROJECT=s,setting.PATH.PROJECT=s);const o=i.env.LANGUAGE||t.env.LANGUAGE;o&&(exports.builtin.env.LANGUAGE=o,setting.PATH.LANGUAGE=o);const a=i.env.LAYOUT||t.env.LAYOUT;a&&(exports.builtin.env.LAYOUT=normalizePATH(a)),i.env.MAIN_WINDOW_CUSTOM_HEADER&&(exports.builtin.env.MAIN_WINDOW_CUSTOM_HEADER=normalizePATH(i.env.MAIN_WINDOW_CUSTOM_HEADER)),i.env.MAIN_WINDOW_ORIGIN_HEADER&&(exports.builtin.env.MAIN_WINDOW_ORIGIN_HEADER=i.env.MAIN_WINDOW_ORIGIN_HEADER),i.env.MAIN_WINDOW_FOOTER&&(exports.builtin.env.MAIN_WINDOW_FOOTER=normalizePATH(i.env.MAIN_WINDOW_FOOTER))}catch(t){console.error(t),exports.builtin={}}})}function normalizePATH(t){return(0,path_1.isAbsolute)(t)?t:(0,path_1.join)(app_1.App.path,"..",t)}exports.builtin={env:{}},exports.init=init;