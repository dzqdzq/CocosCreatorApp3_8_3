"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._findPathHandle=void 0;const fs=require("fs"),vm=require("vm"),v8=require("v8"),path=require("path"),Module=require("module"),zlib=require("zlib");let _findPathHandle=function(e){return e};exports._findPathHandle=_findPathHandle;let compiler=null;try{compiler=process._linkedBinding("electron_common_compile")}catch(e){console.log(`(${process.pid}) Develop mode...`)}Module.__findPath=Module._findPath,Module._findPath=function(...e){const[t,n]=(0,exports._findPathHandle)(e),r=Module.__findPath(t,n,e[2]);return r||Module.__findPath(t.replace(/\.js$/,""),n,e[2])},global.__vm__=vm,v8.setFlagsFromString("--no-lazy"),Number.parseInt(process.versions.node.split(".")[0],10)>=12&&v8.setFlagsFromString("--no-flush-bytecode");const readSourceHash=function(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");return process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?e.slice(12,16).reduce((e,t,n)=>e+=t*Math.pow(256,n),0):e.slice(8,12).reduce((e,t,n)=>e+=t*Math.pow(256,n),0)},compileCode=function(e){if("string"!=typeof e)throw new Error(`javascriptCode must be string. ${typeof e} was given.`);let t=new vm.Script(e,{produceCachedData:!0});return t.createCachedData&&t.createCachedData.call?t.createCachedData():t.cachedData};function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function fixBytecode(e){if(!Buffer.isBuffer(e))throw new Error("bytecodeBuffer must be a buffer object.");let t=compileCode('"c_c"');process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?(t.slice(16,20).copy(e,16),t.slice(20,24).copy(e,20)):process.version.startsWith("v12")||process.version.startsWith("v13")?t.slice(12,16).copy(e,12):(t.slice(12,16).copy(e,12),t.slice(16,20).copy(e,16))}let extFunction=function(e,t){let n,r=path.basename(t,path.extname(t)),o=`${r}.jsc`,i=`${r}.js`,s=`${r}.cjs`,c=path.join(path.dirname(t),i),a=path.join(path.dirname(t),o),l=path.join(path.dirname(t),s);if(fs.existsSync(c)){t=c;const n=fs.readFileSync(t,"utf8");return e._compile(stripBOM(n),t)}if(!fs.existsSync(a)){t=l;const n=fs.readFileSync(t,"utf8");return e._compile(stripBOM(n),t)}function u(t){return e.require(t)}t=a,n=loadJSC.call(this,a),u.resolve=function(t,n){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,n):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,n))},u.main=process.mainModule,u.extensions=Module._extensions,u.cache=Module._cache;let d=path.dirname(t),p=[e.exports,u,e,t,d,process,global];return n.apply(e.exports,p)};const cccFunction=function(e,t){let n=`${path.basename(t,path.extname(t))}.ccc`,r=path.join(path.dirname(t),n);function o(t){return e.require(t)}o.resolve=function(t,n){return"highlight.js"===t||"ipaddr.js"===t?Module._resolveFilename(t,e,!1,n):(t=t.replace(/\.js$/,""),Module._resolveFilename(t,e,!1,n))},o.main=process.mainModule,o.extensions=Module._extensions,o.cache=Module._cache;let i=path.dirname(r),s=[e.exports,o,e,t,i,process,global];return fs.existsSync(r)?(t=r,loadCCC.call(this,r,...s)):null};function loadCCC(e,...t){return compiler.test(e,["exports","require","module","__filename","__dirname"],{filename:e},...t)}function loadJSC(e){return _compileCode(fs.readFileSync(e),e)}function _compileCode(e,t){fixBytecode(e);let n=readSourceHash(e),r="";n>1&&(r='"'+"â€‹".repeat(n-2)+'"');let o=new vm.Script(r,{filename:t,lineOffset:0,displayErrors:!0,cachedData:e});if(o.cachedDataRejected)throw new Error("Invalid or incompatible cached data (cachedDataRejected)");return o.runInThisContext({filename:t,lineOffset:0,columnOffset:0,displayErrors:!0})}function extGFunction(e,t){const n=fs.readFileSync(t),r=zlib.gunzipSync(n);e._compile(r.toString(),t)}Module._extensions[".js"]=extFunction,Module._extensions[".jsc"]=extFunction,Module._extensions[".jsg"]=extGFunction,Module._extensions[".ccc"]=cccFunction;