"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,i){return new(t||(t=Promise))(function(a,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function o(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(s,o)}c((i=i.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const events_1=require("events"),fs_1=require("fs"),path_1=require("path"),Profile=require("@base/electron-profile"),ipc=require("@base/electron-base-ipc"),ps=require("path"),fse=require("fs-extra"),dock=require("@editor/dock"),panel=require("@editor/panel"),Chroma=require("chroma-js"),profile=Profile.load("global://editor/theme.json"),uiKit=require("../../ui-kit"),windows=require("../../windows");function mColor(e,r){if(e){switch(e=Chroma(`#${e}`),r){case"weakest":e=e.brighten(.6);break;case"weaker":e=e.brighten(.3);break;case"emphasis":e=e.darken(.3);break;case"important":e=e.darken(.6)}return e.name()}}class Theme extends events_1.EventEmitter{constructor(){super(),this.$style=document.createElement("style"),document.head.appendChild(this.$style),dock.importStyle((0,path_1.join)(__dirname,"../dist/dock.css")),panel.importStyle((0,path_1.join)(__dirname,"../dist/panel.css")),this.$cssVariables=document.createElement("style"),document.head.appendChild(this.$cssVariables),window.addEventListener("resize",()=>{this.cssVariables()})}cssVariables(){this.$cssVariables.innerHTML=`\n        body { \n            --device-pixel-ratio: ${devicePixelRatio}; \n        }\n        `}getList(){return fse.readdirSync(ps.join(__dirname,"../../../static/theme")).map(e=>{const r=ps.extname(e);return e.replace(r,"")})}use(e){if(!e)return profile.get("theme");ipc.send("editor3d-lib-theme:use",e)}}const manager=module.exports=new Theme;function apply(e){e||(e="creator"),require("@editor/dock/lib/renderer/element/dock-resize").line=0;let r=(0,path_1.join)(__dirname,`../../../static/theme/${e}.js`);if(!(0,fs_1.existsSync)(r))return console.log("The theme does not exist. Use the default theme."),void manager.use("creator");const t=JSON.parse(JSON.stringify(require(r)));let i="body {\n";Object.keys(t.color).forEach(e=>{Object.keys(t.color[e]).forEach(r=>{let a=t.color[e][r];"string"==typeof a&&(a={normal:a}),i+=`  --color-${e}-${r}: ${a.normal};\n`,a.weaker||(a.weaker=Chroma(`${a.normal}`).brighten(t.contrast).hex()),a.weakest||(a.weakest=Chroma(`${a.weaker}`).brighten(t.contrast).hex()),a.emphasis||(a.emphasis=Chroma(`${a.normal}`).darken(t.contrast).hex()),a.important||(a.important=Chroma(`${a.emphasis}`).darken(t.contrast).hex()),Object.keys(a).forEach(t=>{i+=`  --color-${e}-${r}-${t}: ${a[t]};\n`})})}),Object.keys(t.size).forEach(e=>{Object.keys(t.size[e]).forEach(r=>{i+=`  --size-${e}-${r}: ${t.size[e][r]};\n`})}),Object.keys(t.font).forEach(e=>{i+=`  --font-${e}: ${t.font[e]};\n`}),i+="\n}",manager.$style.innerHTML=i,manager.cssVariables()}apply("creator"),ipc.on("editor3d-lib-theme:use",(e,r)=>__awaiter(void 0,void 0,void 0,function*(){apply(r)}));