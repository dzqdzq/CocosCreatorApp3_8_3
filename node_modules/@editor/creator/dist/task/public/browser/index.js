"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))(function(c,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?c(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(n,s)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.queryNotices=exports.removeNotice=exports.changeNoticeTimeout=exports.addNotice=void 0;const browser_1=require("../../protected/browser"),ipc=require("@base/electron-base-ipc");let ID=0;const noticeTasks=[],noticeTaskMap={};function addNotice(e){void 0===e.timeout&&(e.timeout=-1);const t=ID++,o=Object.assign({id:t},e);return noticeTasks.push(o),noticeTaskMap[t]=o,(0,browser_1.emit)("add-notice",o),ipc.broadcast("editor-lib-task:emit","add-notice",o),e.timeout>0&&(o.timer=setTimeout(()=>{removeNotice(t)},e.timeout)),t}function changeNoticeTimeout(e,t){const o=noticeTaskMap[e];o&&(clearTimeout(o.timer),(t=t||0)>0?(o.timeout=t,o.timer=setTimeout(()=>{removeNotice(e)},o.timeout)):o.timeout=t=0)}function removeNotice(e){const t=noticeTaskMap[e];if(!t)return;const o=noticeTasks.indexOf(t);-1!==o&&noticeTasks.splice(o,1),delete noticeTaskMap[e],delete t.timer,(0,browser_1.emit)("remove-notice",t),ipc.broadcast("editor-lib-task:emit","remove-notice",t)}function queryNotices(){return noticeTasks}exports.addNotice=addNotice,exports.changeNoticeTimeout=changeNoticeTimeout,exports.removeNotice=removeNotice,exports.queryNotices=queryNotices,ipc.on("editor-lib-task:call",(e,t,...o)=>__awaiter(void 0,void 0,void 0,function*(){try{const i=yield exports[t](...o);return e.reply(null,i),i}catch(t){e.reply(t)}return null}));