"use strict";const fse=require("fs-extra"),utils=require("../utils"),{extname:extname}=require("path"),xxtea=require("xxtea-node"),ENCRYPTED_EXTNAME=".profile",ENCRYPT_KEY="1234567890";let file2data={};const load=function(e,t){if(file2data[e]&&!t)return file2data[e];let r;if(fse.existsSync(e))try{if(".profile"===extname(e)){let t=fse.readFileSync(e,"utf8"),a=xxtea.decryptToString(t,ENCRYPT_KEY);r=JSON.parse(a)}else r=fse.readJSONSync(e)}catch(e){console.warn(e),r=Object.create(null)}else r=Object.create(null);return file2data[e]=r,r},save=function(e){let t=file2data[e];t&&(".profile"===extname(e)&&(t=xxtea.encryptToString(JSON.stringify(t),ENCRYPT_KEY)),fse.outputJSONSync(e,t,{spaces:2}))},set=function(e,t,r){const a=file2data[e];if(!a)return;if(!t){if(r)for(let e in r)a[e]=r[e];return}let i=t.split(".");utils.setData(a,r,i)},remove=function(e,t){const r=file2data[e];if(!r)return;if(!t)return void(file2data[e]={});const a=t.split(".");utils.removeData(r,a)},empty=function(e){file2data[e]={}},clear=function(){file2data={}},get=function(){return file2data};exports.get=get,exports.load=load,exports.save=save,exports.set=set,exports.remove=remove,exports.empty=empty,exports.clear=clear;