"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeNull=exports.getTrimRect=exports.getPixiel=exports.clamp=exports.linkToAssetTarget=exports.i18nTranslate=exports.getDeserializeResult=exports.deserialize=exports.getDependList=exports.getDependUUIDList=void 0;const electron_i18n_1=__importDefault(require("@base/electron-i18n"));function getDependUUIDList(t,r){if("string"!=typeof t)return getDeserializeResult(t).uuids;{let e=t.match(/[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}(@[a-z0-9]+){0,}/g);return(e=e&&JSON.parse(JSON.stringify(Array.from(new Set(e)).filter(e=>e!==r))))||[]}}function getDependList(e){var t,r;return"string"==typeof e?(r=getDependUUIDList(e),t=(t=e.match(/"__type__":\s*"([0-9a-zA-Z+/]{22,23})"/g))&&t.toString().match(/[0-9a-zA-Z+/]{22,23}/g)||[],{uuids:r,dependScriptUuids:Array.from(new Set(t.map(e=>Editor.Utils.UUID.decompressUUID(e))))}):{uuids:(r=getDeserializeResult(e)).uuids,dependScriptUuids:r.dependScriptUuids}}function deserialize(e){return getDeserializeResult(e).instance}function getDeserializeResult(e){var t=new cc.deserialize.Details;t.reset();const r=EditorExtends.MissingReporter.classInstance,i=(r.reset(),r.hasMissingClass=!1,new Set);e=cc.deserialize(e,t,{classFinder:function(e){return Editor.Utils.UUID.isUUID(e)&&i.add(Editor.Utils.UUID.decompressUUID(e)),r.classFinder(e)}});return t.assignAssetsBy(function(e,t){return EditorExtends.serialize.asAsset(e)}),{instance:e,uuids:t.uuidList,dependScriptUuids:Array.from(i),classFinder:r.classFinder}}function i18nTranslate(e,...t){let r=electron_i18n_1.default.translation(e);if("object"==typeof t[0]){var i=t[0],e=r.match(/{(\w+)}/g);if(e)for(const n of e){var s=n.substr(1,n.length-2);r=r.replace(n,i[s])}}return r}function linkToAssetTarget(e){return`{asset(${e})}`}function clamp(e,t,r){return e<t?t:r<e?r:e}function getPixiel(e,t,r,i){t=4*t+r*i*4;return{r:e[t],g:e[1+t],b:e[2+t],a:e[3+t]}}function getTrimRect(e,t,r,i){var s=i;let n=t,o=r,a=0,l=0,d,p;for(p=0;p<r;p++)for(d=0;d<t;d++)if(getPixiel(e,d,p,t).a>=s){o=p,p=r;break}for(p=r-1;p>=o;p--)for(d=0;d<t;d++)if(getPixiel(e,d,p,t).a>=s){l=p-o+1,p=0;break}for(d=0;d<t;d++)for(p=o;p<o+l;p++)if(getPixiel(e,d,p,t).a>=s){n=d,d=t;break}for(d=t-1;d>=n;d--)for(p=o;p<o+l;p++)if(getPixiel(e,d,p,t).a>=s){a=d-n+1,d=0;break}return[n,o,a,l]}function removeNull(e,t){let r=!1;for(const n of e){if(n._children&&n._children.length)for(let e=0;e<n._children.length;e++){var i=n._children[e];i||(n._children.splice(e,1),r=!0,console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.node"),value:String(i)})),e--)}if(n._components)for(let e=0;e<n._components.length;e++){var s=n._components[e];s||(n._components.splice(e,1),console.warn(Editor.I18n.t("engine-extends.importers.invalidNodeData",{assetUuid:t,type:Editor.I18n.t("engine-extends.importers.component"),value:String(s)})),r=!0,e--)}}return r}exports.getDependUUIDList=getDependUUIDList,exports.getDependList=getDependList,exports.deserialize=deserialize,exports.getDeserializeResult=getDeserializeResult,exports.i18nTranslate=i18nTranslate,exports.linkToAssetTarget=linkToAssetTarget,exports.clamp=clamp,exports.getPixiel=getPixiel,exports.getTrimRect=getTrimRect,exports.removeNull=removeNull;