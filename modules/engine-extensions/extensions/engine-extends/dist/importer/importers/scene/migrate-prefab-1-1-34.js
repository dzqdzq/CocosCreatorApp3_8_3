"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.migratePrefabInstanceRootsByJson=exports.migratePrefabInstanceRoots=void 0;const fs_extra_1=require("fs-extra"),utils_1=require("./utils");async function migratePrefabInstanceRoots(e){migratePrefabInstanceRootsByJson(e.getSwapSpace().json||await fs_extra_1.readJSON(e.source))}function migratePrefabInstanceRootsByJson(a){var e,t=a[1];if(t){t._prefab||(e={__type__:"cc.PrefabInfo",fileId:t._id},e=a.push(e)-1,t._prefab={__id__:e});const s=t._prefab?a[t._prefab.__id__]:null;if(t&&s&&t._children){const n=[];t._children.forEach(e=>{utils_1.walkNode(a,e,(e,t)=>{e&&e._prefab&&a[e._prefab.__id__].instance&&n.push(t)}),0<n.length?s.nestedPrefabInstanceRoots=n:s.nestedPrefabInstanceRoots=void 0})}}else console.warn("can't find root node")}exports.migratePrefabInstanceRoots=migratePrefabInstanceRoots,exports.migratePrefabInstanceRootsByJson=migratePrefabInstanceRootsByJson;