"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrefabImporter=void 0;const asset_db_1=require("@editor/asset-db"),index_1=require("./scene/index"),migrates_1=require("./scene/migrates"),fs_extra_1=require("fs-extra"),utils_1=require("../utils");class PrefabImporter extends asset_db_1.Importer{get version(){return index_1.version}get name(){return"prefab"}get assetType(){return"cc.Prefab"}get migrations(){return migrates_1.migrations}get migrationHook(){return{async pre(e){e.getSwapSpace().json=await fs_extra_1.readJSON(e.source)},async post(e,r){var t=e.getSwapSpace();0<r&&(r=JSON.stringify(t.json,null,2),await fs_extra_1.writeFile(e.source,r)),delete t.json}}}async import(e){var r=await fs_extra_1.readJSON(e.source),t=e.basename||"";let s=r[0]._name!==t||r[1]._name!==t||r[0].persistent!==!!e.userData.persistent;s&&(r[0]._name=t||"",r[1]._name=t||"",r[0].persistent=!!e.userData.persistent);try{s=s||utils_1.removeNull(r,e.uuid)}catch(e){console.debug(e)}if(s)try{const a=JSON.stringify(r,void 0,2);await fs_extra_1.writeFile(e.source,a)}catch(e){}const a=JSON.stringify(r,void 0,2);await e.saveToLibrary(".json",a);r=utils_1.getDependList(a);return e.setData("depends",r.uuids),e.setData("dependScripts",r.dependScriptUuids),e.userData.syncNodeName=t,!0}}exports.PrefabImporter=PrefabImporter;