"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoImporter=void 0;const asset_db_1=require("@editor/asset-db"),cc_1=require("cc"),utils_1=require("../utils");class VideoImporter extends asset_db_1.Importer{get version(){return"1.0.0"}get name(){return"video-clip"}get assetType(){return cc_1.js.getClassName(cc_1.VideoClip)}async import(r){await r.copyToLibrary(r.extname,r.source);var e=document.createElement("video");try{await this.loadVideo(r,e)}catch(e){console.error(`Loading video ${r.source} failed, the video you are using may be in a corrupted format or not supported by the current browser version of the editor, in the latter case you can ignore this error.`),console.debug(e)}e=this.createVideo(r,e.duration),e=EditorExtends.serialize(e),await r.saveToLibrary(".json",e),e=utils_1.getDependUUIDList(e);return r.setData("depends",e),!0}loadVideo(o,a){return new Promise((e,r)=>{a.addEventListener("loadedmetadata",async()=>{e()}),a.addEventListener("error",e=>{r(e)});try{var t=o.source.split(/\\|\//).map(e=>encodeURIComponent(e)).join("/").replace("%3A",":");a.src=t}catch(e){r(e)}})}createVideo(e,r){var t=new cc_1.VideoClip;return r&&(t._duration=r),t.name=e.basename,t._setRawAsset(e.extname),t}}exports.VideoImporter=VideoImporter;