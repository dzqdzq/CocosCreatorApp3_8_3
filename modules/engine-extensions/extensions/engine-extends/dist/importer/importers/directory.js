"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DirectoryImporter=void 0;const asset_db_1=require("@editor/asset-db"),path_1=require("path"),migrate_bundle_config_1=require("./migrates/migrate-bundle-config"),InternalBundleName=["internal","resources","main"];class DirectoryImporter extends asset_db_1.Importer{get version(){return"1.2.0"}get name(){return"directory"}get assetType(){return"cc.Asset"}async validate(e){return e.isDirectory()}get migrations(){return[{version:"1.1.0",migrate:migrateSubpackageSettings},{version:"1.2.0",migrate:migrateBundleConfig}]}async import(e){var r;return"db://assets/resources"===asset_db_1.queryUrl(e.uuid)&&(e.userData.isBundle=!0,e.userData.bundleConfigID=null!=(r=e.userData.bundleConfigID)?r:"default",e.userData.bundleName="resources",e.userData.priority=8),!0}}function migrateSubpackageSettings(e){e.userData.isBundle=!1,e.userData.priority=1,e.userData.bundleName="",e.userData.compressionType={},e.userData.isRemoteBundle={},e.userData.isSubpackage&&(e.userData.isBundle=e.userData.isSubpackage,e.userData.bundleName=e.userData.subpackageName||"",e.userData.priority=5),e.userData.isSubpackage=void 0,e.userData.subpackageName=void 0}async function migrateBundleConfig(r){if(r.userData.isBundle&&!r.userData.bundleConfigID){var{compressionType:a,isRemoteBundle:t,bundleName:s}=r.userData,u="auto_"+Editor.Utils.UUID.generate();let e=s||path_1.basename(r.source).replace(/[^a-zA-Z0-9_-]/g,"_");InternalBundleName.includes(e)&&"db://assets/resources"!==r.url&&(e=e+"_"+u,console.warn(`Bundle {asset(${r.url})} `+Editor.I18n.t("builder.asset_bundle.duplicate_reserved_keyword_message",{name:e})));s=migrate_bundle_config_1.mergeBundleConfig(a,t,e);Editor.Profile.setProject("builder","bundleConfig.custom."+u,s),r.userData.bundleConfigID=u,delete r.userData.compressionType,delete r.userData.isRemoteBundle}}exports.DirectoryImporter=DirectoryImporter;