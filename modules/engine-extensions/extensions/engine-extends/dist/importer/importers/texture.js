"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureImporter=exports.makeDefaultTexture2DAssetUserDataFromImageUuid=exports.makeDefaultTexture2DAssetUserDataFromImagePath=exports.makeDefaultTexture2DAssetUserData=void 0;const asset_db_1=require("@editor/asset-db"),texture_base_1=require("./texture-base"),cc_1=require("cc"),utils_1=require("../utils");function makeDefaultTexture2DAssetUserData(){return texture_base_1.makeDefaultTextureBaseAssetUserData()}function makeDefaultTexture2DAssetUserDataFromImagePath(e){return Object.assign(texture_base_1.makeDefaultTextureBaseAssetUserData(),{isUuid:!1,imageUuidOrDatabaseUri:e})}function makeDefaultTexture2DAssetUserDataFromImageUuid(e,t){var a=texture_base_1.makeDefaultTextureBaseAssetUserData();return t&&[".exr",".hdr",".znt"].includes(t)&&(a.mipfilter="none",a.minfilter="nearest",a.magfilter="nearest"),Object.assign(a,{isUuid:!0,imageUuidOrDatabaseUri:e})}exports.makeDefaultTexture2DAssetUserData=makeDefaultTexture2DAssetUserData,exports.makeDefaultTexture2DAssetUserDataFromImagePath=makeDefaultTexture2DAssetUserDataFromImagePath,exports.makeDefaultTexture2DAssetUserDataFromImageUuid=makeDefaultTexture2DAssetUserDataFromImageUuid;class TextureImporter extends asset_db_1.Importer{get version(){return"1.0.22"}get name(){return"texture"}get assetType(){return"cc.Texture2D"}get migrations(){return[{version:"1.0.21",migrate:texture_base_1.migrateAnisotropy}]}async import(e){var t=e.userData,a=new cc.Texture2D,t=(e.parent instanceof asset_db_1.Asset&&(a.name=e.parent.basename||"",!t.mipfilter)&&[".hdr",".exr"].includes(e.parent.extname)&&(t.mipfilter="none",t.minfilter="nearest",t.magfilter="nearest"),e.assignUserData(makeDefaultTexture2DAssetUserData()),texture_base_1.applyTextureBaseAssetUserData(t,a),this._getImageAsset(e)),t=(t&&(a._mipmaps=[t]),EditorExtends.serialize(a)),a=(await e.saveToLibrary(".json",t),utils_1.getDependUUIDList(t));return e.setData("depends",a),!0}_getImageAsset(t){var a=t.userData,r=a.imageUuidOrDatabaseUri;if(r){let e=null;if(a.isUuid?e=r:(e=asset_db_1.queryUUID(r))||(console.warn(`Cannot find image ${asset_db_1.queryPath(r)||""}.`),t.depend(r)),null!==e)return EditorExtends.serialize.asAsset(e,cc_1.ImageAsset)}return null}}exports.TextureImporter=TextureImporter;