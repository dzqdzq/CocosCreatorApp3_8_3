"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dragAnimationGraphOntoNodeHandlerEntry=void 0;const cc_1=require("cc"),new_gen_anim_1=require("cc/editor/new-gen-anim"),i18n_1=require("../utils/i18n");async function ensureAnimationController(n){let e=n.getComponent(cc_1.animation.AnimationController);if(!e){var o=n.getComponent(cc_1.Animation);if(o){if(!await showConfirmDialog((0,i18n_1.translate)("engine-extends.drag_asset_onto_node_handlers.animation_graph.confirm_existing_animation_component")))return null;if(!removeComponent(o))return console.warn(`Failed to remove animation component ${o}. No animation controller would be created.`),null}(e=addComponent(n,cc_1.animation.AnimationController))||console.warn("Failed to add animation controller component.")}return e}function addComponent(n,e){return cce.Node.createComponent(n.uuid,cc_1.js.getClassName(e))?n.getComponent(e):null}function removeComponent(n){var e=n.node,e=(n.uuid?cce.Node.removeComponent(n.uuid):n.destroy(),!e.components.includes(n));return e}async function showConfirmDialog(n){return 0===(await Editor.Dialog.info(n,{title:(0,i18n_1.translate)("engine-extends.drag_asset_onto_node_handlers.animation_graph.title"),buttons:[(0,i18n_1.translate)("engine-extends.drag_asset_onto_node_handlers.animation_graph.yes"),(0,i18n_1.translate)("engine-extends.drag_asset_onto_node_handlers.animation_graph.cancel")],default:1,cancel:1})).response}exports.dragAnimationGraphOntoNodeHandlerEntry=[new_gen_anim_1.AnimationGraph,async function(n){n=await ensureAnimationController(n);return!!n&&(n.graph=this,!0)}];