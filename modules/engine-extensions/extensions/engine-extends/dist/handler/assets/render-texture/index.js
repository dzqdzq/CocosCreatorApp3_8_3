"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTextureHandler=void 0;const fs_extra_1=require("fs-extra"),texture_base_1=require("../texture-base"),cc_1=require("cc"),utils_1=require("../../utils"),migration_utils_1=require("../utils/migration-utils");function fillUserdata(e,t,r){t in e.userData||(e.userData[t]=r)}const migrations=[{version:"1.1.0",migrate:migrateAssetContent},{version:"1.2.0",migrate:migrateRenderTextureData},{version:"1.2.1",migrate(e){delete e.userData.redirect}}];async function migrateAssetContent(e){var t,r,a,i,e=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source);e.content&&({name:t,width:r,height:a}=e.content,i=new cc_1.RenderTexture,t&&(i._name=t),r&&(i._width=r),a&&(i._height=a),delete e.content,Object.assign(e,JSON.parse(EditorExtends.serialize(i))))}async function migrateRenderTextureData(e){var e=e.getSwapSpace().json||await(0,fs_extra_1.readJSON)(e.source),{_name:t,_width:r,_height:a}=e;e.content={base:"2,2,0,0,0,0",w:r,h:a,n:t},delete e._name,delete e._width,delete e._height}exports.RenderTextureHandler={name:"render-texture",assetType:"cc.RenderTexture",createInfo:{generateMenuInfo(){return[{label:"i18n:ENGINE.assets.newRenderTexture",fullFileName:"render-texture.rt",template:`db://internal/default_file_content/${exports.RenderTextureHandler.name}/default.rt`}]}},importer:{version:"1.2.1",migrations:migrations,migrationHook:migration_utils_1.migrationHook,async import(e){var t=await(0,fs_extra_1.readJSON)(e.source),t=cc.deserialize(t),t=(t.name=e.basename||"",fillUserdata(e,"width",t.width),fillUserdata(e,"height",t.height),fillUserdata(e,"anisotropy",t._anisotropy),fillUserdata(e,"minfilter",(0,texture_base_1.getFilterString)(t._minFilter)),fillUserdata(e,"magfilter",(0,texture_base_1.getFilterString)(t._magFilter)),fillUserdata(e,"mipfilter",(0,texture_base_1.getFilterString)(t._mipFilter)),fillUserdata(e,"wrapModeS",(0,texture_base_1.getWrapModeString)(t._wrapS)),fillUserdata(e,"wrapModeT",(0,texture_base_1.getWrapModeString)(t._wrapT)),t.resize(e.userData.width,e.userData.height),(0,texture_base_1.applyTextureBaseAssetUserData)(e.userData,t),EditorExtends.serialize(t)),t=(await e.saveToLibrary(".json",t),(0,utils_1.getDependUUIDList)(t)),t=(e.setData("depends",t),await e.createSubAsset("spriteFrame","rt-sprite-frame",{displayName:e.basename}));return t.userData.imageUuidOrDatabaseUri=e.uuid,t.userData.width=e.userData.width,t.userData.height=e.userData.height,!0}}},exports.default=exports.RenderTextureHandler;