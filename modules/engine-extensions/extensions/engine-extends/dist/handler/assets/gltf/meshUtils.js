"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeMeshes=void 0;const cc_1=require("cc");function mergeMeshes(t=[]){if(0===t.length)return console.warn("mergeMeshes: meshes is empty"),new cc_1.Mesh;if(1===t.length)return t[0];if(t.every(e=>e.struct.compressed))return new cc_1.Mesh;if(!(e=>{var t=e.map(e=>e.struct.encoded),r=e.map(e=>e.struct.compressed),s=e.map(e=>e.struct.quantized);if(!(t.every(e=>void 0===e)&&r.every(e=>void 0===e)&&s.every(e=>void 0===e))){var n=t[0];for(let e=1;e<t.length;e++)if(t[e]!==n)return!1;var i=r[0];for(let e=1;e<r.length;e++)if(r[e]!==i)return!1;var o=s[0];for(let e=1;e<s.length;e++)if(s[e]!==o)return!1}return!0})(t))return console.warn("mergeMeshes: encoded state is not the same"),new cc_1.Mesh;if(!(e=>{var t=e.map(e=>e.struct.jointMaps);if(!t.every(e=>void 0===e)){var r=t[0],s=r.length;for(let e=1;e<t.length;e++){var n=t[e];if(n.length!==s)return!1;for(let t=0;t<n.length;t++){var i=r[t].length;if(n[t].length!==i)return!1;for(let e=0;e<i;e++)if(n[t][e]!==r[t][e])return!1}}}return!0})(t))return console.warn("mergeMeshes: jointMap is not the same"),new cc_1.Mesh;if(!t.map(e=>e.struct.morph).every(e=>void 0===e))return console.warn("mergeMeshes: morph is not supported"),new cc_1.Mesh;var e=t.reduce((e,t)=>e+t.data.byteLength,0),r=new Uint8Array(e),s=[],n=[];let i=0,o=0;var c=t[0].struct.minPosition||new cc_1.Vec3(1e9),a=t[0].struct.maxPosition||new cc_1.Vec3(-1e9);for(let e=0;e<t.length;e++){var u=t[e],m=u.data;r.set(m,i),s.push(...u.struct.vertexBundles.map(e=>{return e.view.offset+=i,e})),n.push(...u.struct.primitives.map(e=>{var t=e;return t.vertexBundelIndices=e.vertexBundelIndices.map(e=>e+o),t.indexView&&(t.indexView.offset+=i),t})),i+=m.byteLength,o+=u.struct.vertexBundles.length,c.x=Math.min(c.x,u.struct.minPosition?.x||1e9),c.y=Math.min(c.y,u.struct.minPosition?.y||1e9),c.z=Math.min(c.z,u.struct.minPosition?.z||1e9),a.x=Math.max(a.x,u.struct.maxPosition?.x||-1e9),a.y=Math.max(a.y,u.struct.maxPosition?.y||-1e9),a.z=Math.max(a.z,u.struct.maxPosition?.z||-1e9)}var e={struct:{vertexBundles:s,primitives:n,minPosition:c,maxPosition:a,jointMaps:t[0].struct.jointMaps,dynamic:t[0].struct.dynamic,compressed:t[0].struct.compressed,quantized:t[0].struct.quantized,encoded:t[0].struct.encoded},data:r},h=new cc_1.Mesh;return h.reset(e),h.hash,h}exports.mergeMeshes=mergeMeshes;