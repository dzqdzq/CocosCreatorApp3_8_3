"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,s)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureCubeHandler=exports.makeDefaultTextureCubeAssetUserData=void 0;const asset_db_1=require("@editor/asset-db"),cc=__importStar(require("cc")),utils_1=require("../utils"),texture_base_1=require("./texture-base"),load_asset_sync_1=require("./utils/load-asset-sync");function makeDefaultTextureCubeAssetUserData(){var e=(0,texture_base_1.makeDefaultTextureBaseAssetUserData)();return e.isRGBE=!1,e}exports.makeDefaultTextureCubeAssetUserData=makeDefaultTextureCubeAssetUserData,exports.TextureCubeHandler={name:"texture-cube",assetType:"cc.TextureCube",createInfo:{generateMenuInfo(){return[{label:"i18n:ENGINE.assets.newCubeMap",fullFileName:"cubemap.cubemap",template:""}]}},importer:{version:"1.0.4",migrations:[{version:"1.0.3",migrate:texture_base_1.migrateAnisotropy}],async import(t){0===Object.getOwnPropertyNames(t.userData).length&&(t.assignUserData(makeDefaultTextureCubeAssetUserData(),!0),t.userData.isRGBE=!1);var r=t.userData,a={};for(const n of["front","back","left","right","top","bottom"]){let e=r[n];if(!e){var s=`db://internal/default_cubemap/${n}.jpg`,u=(0,asset_db_1.queryUUID)(s);if(!u)throw new Error(`[[internal-error]] Default face url ${s} doesn't exists.`);e=u}s=(0,load_asset_sync_1.loadAssetSync)(e,cc.ImageAsset);if(!s)throw new Error(`Failed to load ${n} face of ${t.uuid}.`);a[n]=s}var e=new cc.TextureCube,e=((0,texture_base_1.applyTextureBaseAssetUserData)(r,e),t.parent instanceof asset_db_1.Asset&&(e.name=t.parent.basename||""),e.isRGBE=r.isRGBE,e._mipmaps=[a],EditorExtends.serialize(e)),e=(await t.saveToLibrary(".json",e),(0,utils_1.getDependUUIDList)(e));return t.setData("depends",e),!0}}},exports.default=exports.TextureCubeHandler;