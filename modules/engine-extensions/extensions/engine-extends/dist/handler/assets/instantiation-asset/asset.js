"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zip=exports.InstantiationAssetHandler=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");function zip(e,t){var r=require("archiver"),e=(0,fs_extra_1.createWriteStream)(e);const a=r("zip");a.on("error",e=>{throw e}),a.pipe(e),t.forEach(e=>{var t=(0,path_1.parse)(e);a.append((0,fs_extra_1.createReadStream)(e),{name:t.ext.substr(1)})}),a.finalize()}exports.InstantiationAssetHandler={name:"instantiation-asset",assetType:"cc.Asset",importer:{version:"1.0.0",async import(t){var r=(0,path_1.join)(t._assetDB.options.temp,t.uuid),e="darwin"===process.platform?"unzip":(0,path_1.join)(Editor.App.path,"../tools/unzip.exe"),a=(await Editor.Utils.Process.quickSpawn(e,[t.source,"-d",r]),(0,fs_extra_1.readdirSync)(r));for(let e=0;e<a.length;e++){var s=a[e],i=(0,path_1.join)(r,s);await t.copyToLibrary("."+s,i)}return(0,fs_extra_1.existsSync)(r)&&(0,fs_extra_1.removeSync)(r),!0}}},exports.default=exports.InstantiationAssetHandler,exports.zip=zip;