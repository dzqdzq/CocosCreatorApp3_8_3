"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectHeaderHandler=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),effect_compiler_1=require("../../../static/effect-compiler"),effect_1=require("./effect"),builtinChunkDir=(0,path_1.join)(Manager.AssetInfo.engine,"./editor/assets/chunks"),builtinChunks=(()=>{const a=[];return function r(n){(0,fs_extra_1.readdirSync)(n).forEach(e=>{var t=(0,path_1.join)(n,e);/\.chunk$/.test(e)?a.push(t):(0,fs_extra_1.statSync)(t).isDirectory()&&r(t)})}(builtinChunkDir),a})();for(let e=0;e<builtinChunks.length;++e){const h=(0,path_1.basename)(builtinChunks[e],".chunk"),i=(0,fs_extra_1.readFileSync)(builtinChunks[e],{encoding:"utf8"});(0,effect_compiler_1.addChunk)(h,i)}const migrations=[{version:"1.0.1",migrate:effect_1.migrateDefines},{version:"1.0.2",migrate:effect_1.migrateEnableDirShadow},{version:"1.0.3",migrate:effect_1.migrateIncludeDecodeBase},{version:"1.0.4",migrate:effect_1.migrateMacroUseLightMap},{version:"1.0.5",migrate:effect_1.migrateChunkFolders},{version:"1.0.6",migrate:effect_1.migrateCSMInclude},{version:"1.0.7",migrate:effect_1.migrateMacroUseBatching}];exports.EffectHeaderHandler={name:"effect-header",assetType:"",createInfo:{generateMenuInfo(){return[{label:"i18n:ENGINE.assets.newChunk",fullFileName:"chunk.chunk",template:`db://internal/default_file_content/${exports.EffectHeaderHandler.name}/chunk`}]}},importer:{version:"1.0.7",migrations:migrations,async import(e){try{var t=e._assetDB.options.target,r=(0,path_1.relative)((0,path_1.join)(t,"chunks"),(0,path_1.dirname)(e.source)).replace(/\\/g,"/"),n=r+(r.length?"/":"")+(0,path_1.basename)(e.source,(0,path_1.extname)(e.source)),a=(0,fs_extra_1.readFileSync)(e.source,{encoding:"utf-8"});return(0,effect_compiler_1.addChunk)(n,a),!0}catch(e){return console.error(e),!1}}}},exports.default=exports.EffectHeaderHandler;