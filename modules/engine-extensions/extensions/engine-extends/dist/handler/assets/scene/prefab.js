"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrefabHandler=void 0;const index_1=require("./index"),migrates_1=require("./migrates"),fs_extra_1=require("fs-extra"),utils_1=require("../../utils");exports.PrefabHandler={name:"prefab",assetType:"cc.Prefab",open(e){e._assetDB.options.readonly||Editor.Message.send("scene","open-scene",e.uuid)},createInfo:{generateMenuInfo(){return[{label:"i18n:ENGINE.assets.newPrefab",fullFileName:"Node.prefab",template:`db://internal/default_file_content/${exports.PrefabHandler.name}/default.prefab`,group:"scene"}]}},importer:{version:index_1.version,versionCode:index_1.versionCode,migrations:migrates_1.migrations,migrationHook:{async pre(e){e.getSwapSpace().json=await(0,fs_extra_1.readJSON)(e.source)},async post(e,r){var t=e.getSwapSpace();0<r&&(r=JSON.stringify(t.json,null,2),await(0,fs_extra_1.writeFile)(e.source,r)),delete t.json}},async import(e){var r=await(0,fs_extra_1.readJSON)(e.source),t=e.basename||"";let a=r[0]._name!==t||r[1]._name!==t||r[0].persistent!==!!e.userData.persistent;a&&(r[0]._name=t||"",r[1]._name=t||"",r[0].persistent=!!e.userData.persistent);try{a=a||(0,utils_1.removeNull)(r,e.uuid)}catch(e){console.debug(e)}if(a)try{const s=JSON.stringify(r,void 0,2);await(0,fs_extra_1.writeFile)(e.source,s)}catch(e){}const s=JSON.stringify(r,void 0,2);await e.saveToLibrary(".json",s);r=(0,utils_1.getDependList)(s);return e.setData("depends",r.uuids),e.setData("dependScripts",r.dependScriptUuids),e.userData.syncNodeName=t,!0}}},exports.default=exports.PrefabHandler;