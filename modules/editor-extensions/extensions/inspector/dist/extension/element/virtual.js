"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualElement=void 0;let ID=1e3;class Additional{constructor(){this.parent=null,this.events={}}changeCallback(){}}const elementMap=new WeakMap;class VirtualElement{constructor(e){this.id=ID++,this.tag=e.toLocaleLowerCase(),this.text="",this.attrs={},this.events=[],this.children=[],elementMap.set(this,new Additional)}setAttribute(e,t){this.attrs[e]=(t+="")+""}removeAttribute(e){delete this.attrs[e]}getAttribute(e){return this.attrs[e]}hasAttribute(e){return e in this.attrs}addEventListener(e,t){var n;"function"!=typeof t||((n=elementMap.get(this)).events[e]||(n.events[e]=[],this.events.push(e)),(n=n.events[e]).includes(t))||n.push(t)}removeEventListener(e,t){var n=elementMap.get(this);if(n.events[e]){var s=n.events[e];const i=s.indexOf(t);if(-1!==i&&s.splice(i,1),0===s.length){delete n.events[e];const i=this.events.indexOf(e);-1!==i&&this.events.splice(i,1)}}}removeAllEventListener(e){var t=elementMap.get(this);t.events[e]&&(delete t.events[e],-1!==(t=this.events.indexOf(e)))&&this.events.splice(t,1)}async dispatch(e,...t){var n=elementMap.get(this);if(n.events[e])return n=n.events[e],Promise.all(n.map(e=>e.call(this,...t)))}setParent(e){elementMap.get(this).parent=e}getParent(){return elementMap.get(this).parent||null}getRoot(){let e=this.getParent(),t=e;for(;e;)e=(t=e).getParent();return t}appendChild(e){this.children.includes(e)||(this.children.push(e),e.setParent(this))}insertChild(e,t){this.children.includes(e)&&this.removeChild(e),this.children.splice(t,0,e),e.setParent(this)}removeChild(e){var t=this.children.indexOf(e);-1!==t&&(this.children.splice(t,1),e.setParent(null))}queryChildrenByTag(i){const r=[];return function e(t){for(const n of t)n.tag===i&&r.push(n);for(const s of t)e(s.children)}(this.children),r}queryChildByID(r){return function e(t){for(const s of t)if(s.id===r)return s;for(const i of t){var n=e(i.children);if(n)return n}}(this.children)}apply(e){this.tag=e.tag,this.text=e.text,this.attrs=JSON.parse(JSON.stringify(e.attrs)),this.events=JSON.parse(JSON.stringify(e.events));var t=elementMap.get(this),n=(t.events={},elementMap.get(e));for(const s in n.events)t.events[s]=n.events[s];e.children.forEach((t,n)=>{let s;for(let e=n;e<this.children.length;e++)if(t.tag===this.children[e].tag){s=this.children[e];break}s?s.apply(t):s=t,this.insertChild(s,n)}),this.children.length=e.children.length,t.changeCallback.call(this)}setChangeCallback(e){var t=elementMap.get(this);t.changeCallback="function"==typeof e?e:function(){}}}exports.VirtualElement=VirtualElement;