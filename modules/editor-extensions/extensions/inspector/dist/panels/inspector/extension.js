"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.end=exports.start=exports.queryDropConfig=exports.queryRendererMap=exports.queryType=exports.detach=exports.attach=void 0;const path_1=require("path");let started=!1;const slots=["header","section","footer"];let inspectorConfig={};const pluginsGroup={};function typeInit(e,t){inspectorConfig[e]={panel:t??"",slot:{header:{},section:{},footer:{}},drop:{}}}function mergeConfig(){inspectorConfig={},Object.values(pluginsGroup).forEach(r=>{const t=r.info.contributions.inspector;Object.entries(t.type??[]).forEach(([e,t])=>{t=(0,path_1.isAbsolute)(t)?t:(0,path_1.join)(r.path,t),inspectorConfig[e]?(inspectorConfig[e].panel&&console.warn(Editor.I18n.t("inspector.extension.overwritten",{oldPanel:inspectorConfig[e].panel,plugin:r.name,panel:t})),inspectorConfig[e].panel=t):typeInit(e,t)}),slots.forEach(n=>{var e=t[n];e&&Object.entries(e).forEach(([o,e])=>{Object.entries(e).forEach(([e,t])=>{t=(0,path_1.isAbsolute)(t)?t:(0,path_1.join)(r.path,t),inspectorConfig[o]||typeInit(o),Array.isArray(inspectorConfig[o].slot[n][e])?-1===inspectorConfig[o].slot[n][e].indexOf(t)&&inspectorConfig[o].slot[n][e].push(t):inspectorConfig[o].slot[n][e]=[t]})})}),t.drop&&Object.entries(t.drop).forEach(([o,e])=>{Array.isArray(e)&&(inspectorConfig[o]||typeInit(o),e.forEach(e=>{var{type:e,message:t}=e;inspectorConfig[o].drop[e]={package:r.name,message:t}}))})})}function attach(e){!e.info.contributions?.inspector||pluginsGroup[e.name]||(pluginsGroup[e.name]=e,mergeConfig())}function detach(e){e.info.contributions?.inspector&&pluginsGroup[e.name]&&(delete pluginsGroup[e.name],mergeConfig(),deleteRequireCache(e))}function queryType(e){return e?inspectorConfig[e]?.panel??"":Object.entries(inspectorConfig).reduce((e,[t,o])=>(e[t]=o?.panel??"",e),{})}function queryRendererMap(e){return e?inspectorConfig[e]?inspectorConfig[e].slot:{}:Object.entries(inspectorConfig).reduce((e,[t,o])=>(e[t]=o.slot,e),{})}function queryDropConfig(e){return inspectorConfig[e]&&inspectorConfig[e].drop}function start(){started||(started=!0,Editor.Package.getPackages({enable:!0}).forEach(attach),Editor.Package.__protected__.on("enable",attach),Editor.Package.__protected__.on("disable",detach))}function end(){}function deleteRequireCache(t){const o=t.info.contributions.inspector;slots.forEach(e=>{e=o[e];e&&Object.entries(e).forEach(([,e])=>{Object.entries(e).forEach(([,e])=>{e=(0,path_1.isAbsolute)(e)?e:(0,path_1.join)(t.path,e),delete require.cache[e]})})})}exports.attach=attach,exports.detach=detach,exports.queryType=queryType,exports.queryRendererMap=queryRendererMap,exports.queryDropConfig=queryDropConfig,exports.start=start,exports.end=end;