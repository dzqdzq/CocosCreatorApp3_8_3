"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path_1=require("path"),cc_1=(module.paths.push((0,path_1.join)(Editor.App.path,"node_modules")),require("cc")),fs_1=require("fs"),{HideInHierarchy,DontSave}=cc_1.CCObject.Flags,NAME="Reference-Image";exports.methods={async getTargets(){var e,a;let t=(0,cc_1.find)(`Editor Scene Background/${NAME}-Canvas`),n=(t||((t=new cc_1.Node(NAME+"-Canvas")).addComponent(cc_1.Canvas),t.parent=(0,cc_1.find)("Editor Scene Background"),t.hideFlags|=DontSave|HideInHierarchy),t.getChildByName(NAME)),i=(n||((n=new cc_1.Node(NAME)).parent=t,n.hideFlags|=DontSave|HideInHierarchy),n.active=await Editor.Profile.getConfig("reference-image","show"),n.getComponent(cc_1.Sprite));return i||((a=(i=n.addComponent(cc_1.Sprite)).color.clone()).a=null!=(e=await Editor.Profile.getConfig("reference-image","opacity"))?e:50,i.color=a),cce.Engine.repaintInEditMode(),{node:n,sprite:i}},async syncData(e){try{var{node:a,sprite:t}=await this.getTargets(),n=a.position,i=(e.sx,n.x=e.x,n.y=e.y,n.z=0,a.position=n,a.scale),c=(i.x=e.sx,i.y=e.sy,i.z=1,a.scale=i,t.color.clone());c.a=e.opacity,t.color=c,cce.Engine.repaintInEditMode()}catch(e){console.log("sync data invalid. ",e)}},async switchImages(e){const a=(await this.getTargets())["sprite"];e=(0,fs_1.readFileSync)(e),e=new Buffer(e).toString("base64");const t=new ccwindow.Image;t.src="data:png;base64,"+e,t.onload=()=>{a.spriteFrame=cc_1.SpriteFrame.createWithImage(t),cce.Engine.repaintInEditMode()}},async resetImage(){var e=(await this.getTargets())["sprite"];e.spriteFrame=null,cce.Engine.repaintInEditMode()},async setImageVisible(e){var a=(await this.getTargets())["node"];(a.active=e)&&Editor.Panel.open("reference-image"),cce.Engine.repaintInEditMode()}};