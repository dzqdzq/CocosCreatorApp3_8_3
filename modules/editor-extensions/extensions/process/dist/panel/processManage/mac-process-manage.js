"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.macProcess=exports.MacProcessManage=void 0;const path_1=require("path"),electron_1=require("electron"),MAC_ARM_PATH=(0,path_1.join)(Editor.App.path,"../tools/process-info/mac_arm.node"),MAC_X64_PATH=(0,path_1.join)(Editor.App.path,"../tools/process-info/mac_x64.node");class MacProcessManage{constructor(){this.macProcessInstance=null,this.windowPanelCollect={},this.factor=1}async init(){try{this.macProcessInstance="arm64"===process.arch?await require(MAC_ARM_PATH):await require(MAC_X64_PATH),await this.macProcessInstance.initializeSystem();var e=this.macProcessInstance.getCpuBrand(),s=e&&e.length<2?e.length:1,t=!(!e||!e[0])&&/Apple/i.test(e[0]);this.factor="arm64"!==process.arch&&t?.025:s}catch(e){console.error(e)}}parseWindowInfo(){var e=electron_1.webContents.getAllWebContents(),s=electron_1.BrowserWindow.getAllWindows();const t=e.reduce((e,s)=>(e[s.getOSProcessId()]=[s.getTitle(),!1],e),{});return s.forEach(e=>{e=e.webContents.getOSProcessId();t[e]&&(t[e][1]=!0)}),t}async getProcessList(e){return this.macProcessInstance||await this.init(),this.windowPanelCollect=this.parseWindowInfo(),this.macProcessInstance.getProcessInfo().map(e=>({name:this.windowPanelCollect[e.pid]?this.windowPanelCollect[e.pid][0]:e.name,pid:e.pid,ppid:e.ppid,memory:Math.ceil(Number(e.memory)/1024/1024),cmd:e.command,cpu:(Number(e.cpuUsage)/this.factor).toFixed(2)||0,panel:!!this.windowPanelCollect[e.pid]&&this.windowPanelCollect[e.pid][1]}))}}exports.MacProcessManage=MacProcessManage,exports.macProcess=new MacProcessManage;