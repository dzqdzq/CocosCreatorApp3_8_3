"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transformText=exports.replaceHttpAndLocalPath2UILink=exports.fileLink=exports.weblink=exports.baseLocalLinkClause=exports.winLocalLinkClause2=exports.unixLocalLinkClause2=exports.winLocalLinkClause=exports.winDrivePrefix=exports.unixLocalLinkClause=void 0;const platform_1=require("./platform"),pathPrefix="(\\.\\.?|\\~)",pathSeparatorClause="\\/",excludedPathCharactersClause="[^\\0\\s!`&*()\\[\\]'\":;\\\\]",winPathPrefix=(exports.unixLocalLinkClause="(("+pathPrefix+"|("+excludedPathCharactersClause+")+)?("+pathSeparatorClause+"("+excludedPathCharactersClause+")+)+)",exports.winDrivePrefix="(?:\\\\\\\\\\?\\\\)?[a-zA-Z]:","("+exports.winDrivePrefix+"|\\.\\.?|\\~)"),winPathSeparatorClause="(\\\\|\\/)",winExcludedPathCharactersClause="[^\\0<>\\?\\|\\/\\s!`&*()\\[\\]'\":;]",excludedPathCharactersClause2=(exports.winLocalLinkClause="(("+winPathPrefix+"|("+winExcludedPathCharactersClause+")+)?("+winPathSeparatorClause+"("+winExcludedPathCharactersClause+")+)+)","[^\\0\\s!`&*()\\[\\]'\":;\\\\\\/]");function replaceHttpAndLocalPath2UILink(e){return e.split(" ").map(e=>e.replace(new RegExp(`(${exports.weblink.source})|(${exports.baseLocalLinkClause})|(${exports.fileLink.source})`,"g"),e=>`{link[${e}](${e})}`)).join(" ")}exports.unixLocalLinkClause2=`^~?(\\/${excludedPathCharactersClause2}+)+\\/?$`,exports.winLocalLinkClause2=`^[a-zA-Z]:((\\\\|\\/)${excludedPathCharactersClause2}*)+$`,exports.baseLocalLinkClause=platform_1.isWindows?exports.winLocalLinkClause2:exports.unixLocalLinkClause2,exports.weblink=/^(((http|https|ftp):\/\/)|(www\.))[\w-]+(\.[\w-]+)+([\w-.,@?^=%&:/~+#-\(\)]*[\w@?^=%&/~+#-\(\)])?/,exports.fileLink=/^(file:\/\/\/[^)]+)$/g,exports.replaceHttpAndLocalPath2UILink=replaceHttpAndLocalPath2UILink;const renderTypes={link(e,a){return`<ui-link value="${a=a.replace(/:\d+/g,"")}">${e||a}</ui-link>`},message(a,r){let e=[];try{e=JSON.parse(r)}catch(e){return console.debug(e),`<span>${a}-${r}<span>`}return`<ui-link type="message" value='${r}'>${a||e[2]}</ui-link>`},asset(e,a){return`<ui-link type="${a.startsWith("db://")?"assetUrl":"assetUuid"}" value="${a}">${e||a}</ui-link>`},node(e,a){return`<ui-link type="nodeUuid" value="${a}">${e||a}</ui-link>`},image(e,a){return`
        <ui-link value="${a}">
            <ui-image value="${a}" max-height>${e||a}</ui-image>
        </ui-link>
        `},i18n(e,a){return Editor.I18n.t(a)},hidden(){return""}};function transformText(e){return e.replace(/\{([\w]+)(?:\[([^[]*)\])?(?:\(([^()]*)\))\}/gi,(e,a,r,t)=>{a=a.toLowerCase();return renderTypes[a]?renderTypes[a](r,t):e})}exports.transformText=transformText;