"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,r)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AssetsPreviewHomeVM=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js"),utils=(Vue.config.productionTip=!1,Vue.config.devtools=!1,__importStar(require("../../../components/utils"))),panel_menu_1=require("../../../components/panel-menu"),template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../../static","/template/preview/index.html"),"utf8");exports.AssetsPreviewHomeVM=Vue.extend({data(){return{active:"",uuid:"",path:"",crumbs:[],list:[],prev:[],next:[],requestAnimationId:null}},methods:{async select(e){const i=this;i.crumbs=[],i.path="",i.uuid=e,i.list=[],window.cancelAnimationFrame(i.requestAnimationId);var t=await utils.getAssetForPreview(e);if(t){i.next[i.next.length-1]!==e&&i.prev[i.prev.length-1]!==e&&(100<i.prev.length&&i.prev.shift(),i.prev.push(e),i.next=[]),i.path=t.path,i.crumbs=t.url.substr(5).split("/");const s=await utils.getChildrenForPreview(e);if(s&&s.length){const r=s.length;if(r<200)i.list=s;else{let t=0;i.requestAnimationId=window.requestAnimationFrame(function e(){if(t<r){for(let e=0;e<10;e++){if(t++,!s[t])return;i.list.push(s[t])}i.requestAnimationId=window.requestAnimationFrame(e)}})}}}},async unselect(){var e=this;e.path="",e.crumbs=[],e.list=[]},getAdditional(t){const i=[{type:t.type,value:t.uuid}];return t.redirect&&i.push({type:t.redirect.type,value:t.redirect.uuid}),t.extends&&0<t.extends.length&&t.extends.forEach(e=>{i.push({type:e,value:t.uuid})}),JSON.stringify(i)},dblClick(e){e.isDirectory?(Editor.Selection.clear("asset"),Editor.Selection.select("asset",e.uuid),Editor.Message.send("assets","twinkle",e.uuid,"light")):utils.openAsset(e)},async crumbsClick(e){e=this.crumbs.slice(0,e+1),e=await Editor.Message.request("asset-db","query-uuid","db://"+e.join("/"));Editor.Selection.clear("asset"),e&&(Editor.Selection.select("asset",e),Editor.Message.send("assets","twinkle",e))},async prevClick(){var e=this,t=e.prev.pop();t&&(e.next[e.next.length-1]!==t&&e.next.push(t),0!==e.prev.length)&&(t=e.prev[e.prev.length-1],await Editor.Message.request("asset-db","query-asset-info",t)?(Editor.Selection.clear("asset"),Editor.Selection.select("asset",t)):e.prevClick())},async nextClick(){var e=this,t=e.next.pop();t&&(await Editor.Message.request("asset-db","query-asset-info",t)?(e.prev[e.prev.length-1]!==t&&e.prev.push(t),Editor.Selection.clear("asset"),Editor.Selection.select("asset",t)):e.nextClick())},popupMenu(e){(0,panel_menu_1.previewPopupContextMenu)(e)}},template:template});