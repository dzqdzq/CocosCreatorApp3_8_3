"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){e[r=void 0===r?a:r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.openAsset=exports.twinkle=exports.closestWhichCanCreate=exports.scrollIntoView=exports.isAIncludeB=exports.getChildrenUuid=exports.getDirectory=exports.getSibling=exports.getParent=exports.getChildrenForPreview=exports.getAssetForPreview=exports.getAsset=exports.scriptName=exports.isSearchingMode=exports.canNotReimport=exports.canNotRevealInLibrary=exports.canNotRevealInExplorer=exports.canNotDrop=exports.isEmptyToPaste=exports.canNotPaste=exports.canNotDrag=exports.canNotRename=exports.canNotCut=exports.canNotDuplicate=exports.canNotCopy=exports.canNotCreate=exports.canNotDelete=void 0;const panelData=__importStar(require("./panel-data")),treeData=__importStar(require("./tree-data"));function canNotDelete(e){return!e||e.isDB||e.readonly||e.isSubAsset}function canNotCreate(e){return!e||e.isSubAsset||e.readonly||!e.isDirectory}function canNotCopy(e){return!e||e.isDB||e.isSubAsset}function canNotDuplicate(e){return!e||!e.uuid||(e=treeData.uuidToParentUuid[e.uuid])&&canNotCreate(treeData.uuidToAsset[e])}function canNotCut(e){return canNotDelete(e)}function canNotRename(e){return canNotDelete(e)}function canNotDrag(e){return!e||e.isDB}function canNotPaste(e){return!e||e.isSubAsset||e.readonly||!e.isDirectory}function isEmptyToPaste(){var e=Editor.Clipboard.read("assets-copied-info"),e=!e||!e.assetInfo.length,t=Editor.Clipboard.read("assets-cut-info"),t=!t||!t.assetInfo.length||Editor.Project.path!==t.projectPath;return e&&t}function canNotDrop(e){return!e||e.readonly}function canNotRevealInExplorer(e){return!e||!e.file||e.isSubAsset}function canNotRevealInLibrary(e){return!e||0===Object.keys(e.library).length}function canNotReimport(e){return!e||e.isDB}function isSearchingMode(){var e,t,a,r,n=panelData.$.panel;return!!n&&({searchValue:n,searchType:e,extendSearchFunc:t,searchInFolder:a,searchAssetTypes:r}=n,""!==n||"fails"===e||t[e]||a||!!r.length)}function getAsset(e){return e?treeData.uuidToAsset[e]:null}async function getAssetForPreview(e,t){return!e||t?null:treeData.uuidToAsset[e]||Editor.Message.request("assets","query-asset",e,!!panelData.$.panel)}async function getChildrenForPreview(e,t){return!e||t?null:(t=treeData.uuidToChildren[e])&&t.length?t.map(e=>treeData.uuidToAsset[e]).filter(Boolean):Editor.Message.request("assets","query-children",e,!!panelData.$.panel)}function getParent(e){return e?getAsset(treeData.uuidToParentUuid[e]):null}function getSibling(e){var{displayArray:t,uuidToAsset:a}=treeData,r=t.indexOf(e),n=t.length-1;let s=r-1,o=r+1;return 0===r&&(s=n),r===t.length-1&&(o=0),[a[e],a[t[s]],a[t[o]]]}function getDirectory(e){var t=getAsset(e);return!!t&&(t.isDirectory?t:getDirectory(treeData.uuidToParentUuid[e]))}function getChildrenUuid(e,t,a=!1,r=!1){var n=treeData.uuidToChildren[e];if(n&&(!a||treeData.uuidToExpand[e])){var s=n.length;for(let e=0;e<s;e++){var o=n[e],i=getAsset(o);i&&(t.push(o),!i.isParent||r&&!i.isDirectory||getChildrenUuid(o,t,a,r))}}}function isAIncludeB(e,t){e=treeData.uuidToAsset[e],t=treeData.uuidToAsset[t];return!(!e||!t)&&t.url.startsWith(e.url+"/")}async function scrollIntoView(a,r=!1){var n=getAsset(a);if(n){await treeData.pointExpand(a);var s=panelData.$.viewBox.clientHeight,o=panelData.$.viewBox.offsetWidth,i=panelData.$.viewBox.scrollWidth;let e=panelData.$.viewBox.scrollLeft,t=panelData.$.viewBox.scrollTop;const d=panelData.config.assetHeight;var l=panelData.config.iconWidth,c=panelData.$.tree.scrollTop,u=c+s-d-4,p=e>n.left,i=o<i&&.3*o<n.left-e;(p||i)&&(e=n.left-2*l);const g=treeData.displayArray.indexOf(a)*d;r?t=g-s/2:g<=c?t=g:g>=u&&(t=g-s+d+4,setTimeout(()=>{t=g-panelData.$.viewBox.clientHeight+d+4,panelData.$.viewBox.scrollWidth!==panelData.$.viewBox.clientWidth&&(t+=10),panelData.$.viewBox.scrollTo(e,t)},100)),panelData.$.tree.$nextTick(()=>{panelData.$.viewBox.scrollTo(e,t)})}}function closestWhichCanCreate(e){var t=getAsset(e);return t?canNotCreate(t)?t.isDirectory?null:closestWhichCanCreate(treeData.uuidToParentUuid[e]):t:null}async function openAsset(e){if(!e.isSubAsset&&!e.isDirectory)try{await Editor.Message.request("asset-db","open-asset",e.url)}catch(e){console.error(e)}}exports.canNotDelete=canNotDelete,exports.canNotCreate=canNotCreate,exports.canNotCopy=canNotCopy,exports.canNotDuplicate=canNotDuplicate,exports.canNotCut=canNotCut,exports.canNotRename=canNotRename,exports.canNotDrag=canNotDrag,exports.canNotPaste=canNotPaste,exports.isEmptyToPaste=isEmptyToPaste,exports.canNotDrop=canNotDrop,exports.canNotRevealInExplorer=canNotRevealInExplorer,exports.canNotRevealInLibrary=canNotRevealInLibrary,exports.canNotReimport=canNotReimport,exports.isSearchingMode=isSearchingMode,exports.scriptName={allScripts:null,allClassNames:[],timer:0,fileName:"",className:"",classNameStringFormat:"",requiredCamelCaseClassName:!1,async isValid(e){let t="";var a;return(t=this.requiredCamelCaseClassName?(a=this.getValidCamelCaseClassName(e),this.classNameStringFormat.replace("<%CamelCaseClassName%>",a).trim()||a):(a=this.getValidClassName(e),this.classNameStringFormat.replace("<%UnderscoreCaseClassName%>",a).trim()||a))?{state:""}:{state:"errorScriptClassName"}},async getValidFileName(e){var t=e=(e=e.trim().replace(/[^a-zA-Z0-9_-]/g,""))&&!isFinite(e)?e:"NewComponent";let a=0;for(;(await this.isValid(e)).state;){if(1e3<a)return e;e=t+("-"+(++a).toString().padStart(3,"0"))}return e},getValidClassName(e){e=(e=e.trim().replace(/^[^a-zA-Z_]+/g,"")).match(/[a-zA-Z0-9_]+/g);return e?e.join("_"):""},getValidCamelCaseClassName(e){e=(e=e.trim().replace(/^[^a-zA-Z]+/g,"")).match(/[a-zA-Z0-9]+/g);return e?e.filter(Boolean).map(e=>e[0].toLocaleUpperCase()+e.substr(1)).join(""):""}},exports.getAsset=getAsset,exports.getAssetForPreview=getAssetForPreview,exports.getChildrenForPreview=getChildrenForPreview,exports.getParent=getParent,exports.getSibling=getSibling,exports.getDirectory=getDirectory,exports.getChildrenUuid=getChildrenUuid,exports.isAIncludeB=isAIncludeB,exports.scrollIntoView=scrollIntoView,exports.closestWhichCanCreate=closestWhichCanCreate,exports.twinkle={requestAnimationId:0,watch:!0,start(){this.watch=!0},stop(){this.watch=!1},add(e,t="hint"){this.watch&&(panelData.act.twinkles[e]=t,setTimeout(()=>{panelData.act.twinkles[e]=void 0,delete panelData.act.twinkles[e],window.cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=requestAnimationFrame(()=>{panelData.$.tree.render()})},1e3))}},exports.openAsset=openAsset;