"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a);var i=Object.getOwnPropertyDescriptor(t,a);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,i)}:function(e,t,a,r){e[r=void 0===r?a:r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mounted=exports.data=exports.watch=exports.methods=exports.components=exports.template=exports.props=exports.name=void 0;const path_1=require("path"),fs_1=require("fs"),panelData=__importStar(require("./panel-data")),treeData=__importStar(require("./tree-data")),utils=__importStar(require("./utils"));let vm=null,requestAnimationId,dragOverUuid,dragOverTimeId,selectedTimeId,refreshingTimeId;function data(){return{assets:[],renameUrl:"",addInfo:{type:"",importer:"",name:"",fileExt:"",fileName:"",parentDir:""},intoViewBySelected:"",intoViewByUser:"",scrollTop:0,droppableTypes:[],checkShiftUpDownMerge:{uuid:"",direction:""},searchTimer:void 0}}async function mounted(){(vm=this).refreshing.ignores={}}exports.name="tree",exports.props={droppableTypesProp:{type:Array,default(){return[]}}},exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/template/tree.html"),"utf8"),exports.components={"tree-node":require("./tree-node")},exports.methods={t(e){return panelData.$.panel.t(e)},update(){vm.droppableTypes=[...vm.droppableTypesProp,...panelData.config.assetTypes()],vm.addInfo.parentDir="",vm.renameUrl=""},clear(){treeData.clear(),vm.render()},refreshing(e,t,a){a&&vm.refreshing.ignores[a]?delete vm.refreshing.ignores[a]:(panelData.$.panel.refreshing={type:e,name:t},window.clearTimeout(refreshingTimeId),refreshingTimeId=window.setTimeout(()=>{panelData.$.panel.refreshing.type="",vm.refreshing.ignores={}},1e3))},toggle(e,t,a){a?treeData.loopExpand(e,t):treeData.toggleExpand(e,t)},nextToggleExpand(e){let t=!1;e=e.every(e=>{var t=treeData.uuidToAsset[e];return"isParent"in t&&t.isParent||(e=treeData.uuidToParentUuid[e]),!treeData.uuidToExpand[e]});return t=e?!0:t},allToggle(){let a=treeData.uuidToChildren[panelData.config.protocol];var e=panelData.act.selects.length,r=(a=e?panelData.act.selects:a).length;if(r){var i=vm.nextToggleExpand(a);for(let t=0;t<r;t++){let e=a[t];var s=treeData.uuidToAsset[e];"isParent"in s&&s.isParent||(e=treeData.uuidToParentUuid[e]),treeData.loopExpand(e,i)}}},selectAll(a){if(utils.isSearchingMode())Editor.Selection.clear("asset"),Editor.Selection.select("asset",treeData.displayArray);else{let e=a||vm.getFirstSelectSortByDisplay();treeData.uuidToChildren[e]||(e=treeData.uuidToParentUuid[e]);var r=[];utils.getChildrenUuid(e,r,!0);a=panelData.act.selects.slice().includes(e);let t=!0;var i=r.length;for(let e=0;e<i;e++)panelData.act.selects.includes(r[e])||(t=!1);t?a?e!==panelData.config.protocol&&vm.selectAll(treeData.uuidToParentUuid[e]):Editor.Selection.select("asset",e):(Editor.Selection.clear("asset"),a&&r.unshift(e),Editor.Selection.select("asset",r))}},selectClear(){Editor.Selection.clear("asset")},selected(e){(e=Array.isArray(e)?e:[e]).forEach(e=>{panelData.act.selects.includes(e)||(panelData.act.selects.push(e),vm.intoViewBySelected=e,window.clearTimeout(selectedTimeId),selectedTimeId=window.setTimeout(()=>{utils.scrollIntoView(vm.intoViewBySelected)},50),e===vm.checkShiftUpDownMerge.uuid&&vm.shiftUpDownMergeSelected())}),panelData.$.panel.allExpand=vm.isAllExpand()},unselected(e){var t=panelData.act.selects.indexOf(e);-1!==t&&(panelData.act.selects.splice(t,1),window.clearTimeout(selectedTimeId),selectedTimeId=window.setTimeout(()=>{treeData.render()},50)),vm.intoViewBySelected===e&&(vm.intoViewBySelected="")},resetSelected(){panelData.act.selects=[];var e=Editor.Selection.getSelected("asset");vm.selected(e),window.clearTimeout(selectedTimeId),utils.scrollIntoView(vm.intoViewBySelected,!0)},shiftClick(e){if(0===panelData.act.selects.length)vm.ipcSelect(e);else{var t=[],a=treeData["displayArray"],r=a.indexOf(panelData.act.selects[0]),i=a.indexOf(e);if(-1!==r||-1!==i)if(r<=i)for(let e=r;e<=i;e++)t.push(a[e]);else for(let e=r;e>=i;e--)t.push(a[e]);vm.ipcSelect(t)}},ctrlClick(e){panelData.act.selects.includes(e)?Editor.Selection.unselect("asset",e):Editor.Selection.select("asset",e)},ipcSelect(e){Editor.Selection.clear("asset"),Editor.Selection.select("asset",e)},ipcSelectFirstChild(){Editor.Selection.clear("asset");var e=this.getFirstChild();e&&Editor.Selection.select("asset",e)},click(){panelData.$.panel.isOperating||Editor.Selection.clear("asset")},async addTo(e){utils.isSearchingMode()&&(panelData.$.panel.clearSearch(),await new Promise(e=>setTimeout(e,300))),e.folderUuid||(e.folderUuid=vm.getFirstSelect());var t,a,r,i=utils.closestWhichCanCreate(e.folderUuid);!i||treeData.uuidToState[i.uuid]?(t=Editor.I18n.t("assets.operate.canNotAddTo",{uuid:e.folderUuid}),console.warn(t)):(vm.toggle(i.uuid,!0),await utils.scrollIntoView(i.uuid),r=(t=i.url)+"/"+(e.fileName||"New File")+(a=e.fileExt),r=await Editor.Message.request("asset-db","generate-available-url",r),vm.addInfo={url:r,importer:e.importer,template:e.template,fileExt:a,fileName:(0,path_1.basename)(r,a),name:(0,path_1.basename)(r),parentDir:t,parentUuid:i.uuid})},async addConfirm(e){var t,a;e&&e.parentDir&&e.parentUuid&&e.fileName?(e.name=e.fileName+e.fileExt,(t=utils.closestWhichCanCreate(e.parentUuid))&&(vm.addInfo.parentDir="",treeData.uuidToState[t.uuid]="add-loading",panelData.$.panel.isOperating=!0,a=e.parentDir+"/"+e.fileName+e.fileExt,await vm.add({handler:e.importer,target:a,template:e.template,overwrite:!0})||(treeData.uuidToState[t.uuid]="",treeData.unFreeze(t.uuid),treeData.render()),setTimeout(()=>{panelData.$.panel.isOperating=!1},200))):vm.addInfo.parentDir=""},async add(e){const t=await Editor.Message.request("asset-db","new-asset",e);return t?(vm.ipcSelect(t.uuid),setTimeout(()=>{utils.scrollIntoView(t.uuid)},300),t.uuid):null},async added(e,t){panelData.act.twinkleQueue.push({uuid:e,animation:"shrink"}),treeData.added(e,t),vm.refreshing("added",t.name);t=treeData.uuidToParentUuid[e];vm.refreshing.ignores[t]=!0},async changed(e,t){panelData.act.twinkleQueue.push({uuid:e,animation:"light"}),treeData.changed(e,t),vm.refreshing("changed",t.name,e);t=treeData.uuidToParentUuid[e];vm.refreshing.ignores[t]=!0,e===vm.intoViewByUser&&setTimeout(()=>{var e=vm.intoViewByUser;vm.intoViewByUser="",utils.scrollIntoView(e)},300)},async delete(a){let t=[];var e=panelData.act.selects.includes(a),r=(t=a&&!e?[a]:panelData.act.selects.slice()).length;let i=[];for(let e=0;e<r;e++){const a=t[e];var s=utils.getAsset(a);!s||utils.canNotDelete(s)||(i=i.filter(e=>!utils.isAIncludeB(a,e))).some(e=>utils.isAIncludeB(e,a))||i.push(a)}const l=i.length;if(l){let t="";for(let e=0;e<l;e++){var n=i[e];if(5<e)break;n=utils.getAsset(n);n&&(e<5?t+=n.name+`
`:t+="...")}var o=await Editor.Message.request("asset-db","execute-script",{name:"assets",method:"queryDepends",args:[i]});if(o&&0<o.length){t+="\n"+Editor.I18n.t("assets.operate.maybeDependOther");for(let e=0;e<5&&o[e];e++)t+=`
`+o[e];5<o.length&&(t+="\n...")}a=Editor.I18n.t("assets.operate.sureDelete",{length:String(l),filelist:t}),a=await Editor.Dialog.warn(a,{buttons:["Yes","Cancel"],default:0,cancel:1,title:Editor.I18n.t("assets.operate.dialogQuestion")});if(1!==a.response){var u=[];for(let e=0;e<l;e++){var d=i[e],c=utils.getAsset(d);c&&(treeData.uuidToState[d]="loading",treeData.unFreeze(d),u.push(Editor.Message.request("asset-db","delete-asset",c.url)))}treeData.render(),await Promise.all(u).then(()=>{for(let e=0;e<l;e++)delete treeData.uuidToState[i[e]]}),e&&Editor.Selection.clear("asset")}}},deleted(e,t){treeData.deleted(e,t),vm.refreshing("deleted",t.name);t=treeData.uuidToParentUuid[e];vm.refreshing.ignores[t]=!0},upDownLeftRight(t){var e,a=vm.getLastSelect();if("right"===t)vm.isExpand(a)?(e=treeData.uuidToChildren[a],Array.isArray(e)&&e.length&&vm.ipcSelect(e[0])):vm.toggle(a,!0);else if("left"===t)vm.isExpand(a)?vm.toggle(a,!1):(e=treeData.uuidToParentUuid[a])!==panelData.config.protocol&&vm.ipcSelect(e);else{var r=utils.getSibling(a);let e;switch(t){case"up":e=r[1];break;case"down":e=r[2]}e&&vm.ipcSelect(e.uuid)}},async shiftUpDown(e){var t=panelData.act.selects.length;if(0!==t){var[t,a,r]=utils.getSibling(panelData.act.selects[t-1]),i=panelData.act.selects.includes(a.uuid),s=panelData.act.selects.includes(r.uuid);if("up"===e){if(!i)return Editor.Selection.select("asset",a.uuid),vm.checkShiftUpDownMerge.uuid=a.uuid,void(vm.checkShiftUpDownMerge.direction=e);s||Editor.Selection.unselect("asset",t.uuid),await utils.scrollIntoView(a.uuid),panelData.act.selects.splice(panelData.act.selects.indexOf(a.uuid),1),panelData.act.selects.push(a.uuid)}"down"===e&&(s?(i||Editor.Selection.unselect("asset",t.uuid),await utils.scrollIntoView(r.uuid),panelData.act.selects.splice(panelData.act.selects.indexOf(r.uuid),1),panelData.act.selects.push(r.uuid)):(Editor.Selection.select("asset",r.uuid),vm.checkShiftUpDownMerge.uuid=r.uuid,vm.checkShiftUpDownMerge.direction=e))}},shiftUpDownMergeSelected(){if(vm.checkShiftUpDownMerge.uuid){let e=!0,t=vm.checkShiftUpDownMerge.uuid,a=(vm.checkShiftUpDownMerge.uuid="",panelData.act.selects.length);for(;e;){var r=utils.getSibling(t);if(!(r&&r[1]&&r[2]&&a))return;t=("down"===vm.checkShiftUpDownMerge.direction?r[2]:r[1]).uuid,a--,panelData.act.selects.includes(t)?(panelData.act.selects.splice(panelData.act.selects.indexOf(t),1),panelData.act.selects.push(t)):e=!1}}},async keyboardRename(){var e,t;vm.renameUrl||(e=vm.getFirstSelect(),(t=utils.getAsset(e))&&!utils.canNotRename(t)&&(await utils.scrollIntoView(e),vm.renameUrl=t.url))},async rename(e,t=""){var a=utils.getAsset(e);if(!a||"loading"===treeData.uuidToState[e])return!1;if(vm.renameUrl="",utils.canNotRename(a)||""===t||t===a.fileName)return treeData.uuidToState[e]="",treeData.unFreeze(e),treeData.render(),!1;var r=utils.getParent(e);if(!r)return!1;treeData.uuidToState[e]="loading";t+=a.fileExt,r=r.url+"/"+t;return await Editor.Message.request("asset-db","move-asset",a.url,r),treeData.uuidToState[e]="",treeData.unFreeze(e),treeData.resort(),!0},sort(){treeData.resort()},clearSearchTimer(){window.clearTimeout(vm.searchTimer),vm.searchTimer=null},search(){treeData.render(),vm.clearSearchTimer(),panelData.$.panel.searchValue?vm.searchTimer=window.setTimeout(()=>{panelData.$.viewBox.scrollTo(0,0)},100):panelData.$.panel.searchInFolder||(vm.searchTimer=window.setTimeout(()=>{utils.scrollIntoView(vm.intoViewBySelected,!0)},100))},dragOver(s,l){window.cancelAnimationFrame(requestAnimationId),requestAnimationId=requestAnimationFrame(()=>{var t=utils.getAsset(s);if(t)if(t.isDirectory){var a=Date.now(),a=(dragOverUuid!==s?(dragOverUuid=s,dragOverTimeId=a):800<a-dragOverTimeId&&vm.toggle(s,!0),panelData.$.viewBox),r=vm.scrollTop%panelData.config.assetHeight,i=a.getBoundingClientRect().top-vm.$el.getBoundingClientRect().top,r=treeData.displayArray.indexOf(s)*panelData.config.assetHeight+r-i+3,i=[];let e=t.readonly?0:1;vm.isSearchingMode()?l&&(e=l.isDirectory?e:0):utils.getChildrenUuid(s,i,!0),panelData.$.panel.dropBoxStyle={left:a.scrollLeft+"px",top:r+"px",height:(i.length+1)*panelData.config.assetHeight+2+"px",opacity:e}}else vm.isSearchingMode()||vm.dragOver(treeData.uuidToParentUuid[s],l||t)})},dragLeave(e){let t=utils.getAsset(e);(t=t&&!t.isDirectory?utils.getParent(e):t)&&(treeData.uuidToState[t.uuid]="")},async drop(e){if(!utils.isSearchingMode()){var t=JSON.parse(JSON.stringify(Editor.UI.__protected__.DragArea.currentDragInfo))||{};if(vm.assets[0]){var a=vm.assets[0].uuid,r=Array.from(e.dataTransfer.files);if(r&&0<r.length&&(t.type="osFile",t.files=r),t.value){r=utils.getParent(t.value);if(r&&r.uuid===a)return}t.to=a,t.copy=e.ctrlKey,vm.ipcDrop(t)}}},dragEnter(){utils.isSearchingMode()?panelData.$.panel.dropBoxStyle={}:(window.cancelAnimationFrame(requestAnimationId),requestAnimationId=requestAnimationFrame(()=>{vm.dragOver(treeData.displayArray[0])}))},async ipcDrop(a){panelData.$.panel.focusWindow(),utils.isSearchingMode()&&(panelData.$.panel.clearSearch(),await new Promise(e=>setTimeout(e,300)));const r=utils.getDirectory(a.to);if(!r||utils.canNotCreate(r))e=Editor.I18n.t("assets.operate.canNotDrop",{uuid:a.to}),console.warn(e);else if("osFile"===a.type){if(Array.isArray(a.files)){var e=a.files.map(e=>e.path);treeData.uuidToState[r.uuid]="loading",treeData.unFreeze(r.uuid),treeData.render();const l=await e.reduce(async(e,t)=>{var e=await e,a=r.url+"/"+(0,path_1.basename)(t);return a!==await Editor.Message.request("asset-db","generate-available-url",a)&&e.push({file:t,name:(0,path_1.basename)(t)}),e},Promise.resolve([])),n={overwrite:!1,rename:!1};let t=!1;if(0<l.length){let e=l.map(e=>e.name).slice(0,5).join("\n");5<l.length&&(e+="\n ...");var i=await Editor.Dialog.warn(Editor.I18n.t("assets.operate.repeatTip"),{title:Editor.I18n.t("assets.operate.dialogQuestion"),detail:e,buttons:[Editor.I18n.t("assets.operate.overwrite"),Editor.I18n.t("assets.operate.rename"),Editor.I18n.t("assets.operate.cancel")],default:0,cancel:2});0===i.response?n.overwrite=!0:1===i.response?n.rename=!0:t=!0}!t&&e.length&&await Promise.all(e.map(t=>Editor.Message.request("asset-db","import-asset",t,r.url+"/"+(0,path_1.basename)(t),l.some(e=>e.file===t)?n:{}))),treeData.uuidToState[r.uuid]="",treeData.unFreeze(r.uuid),treeData.render()}}else if("cc.Node"===a.type){for(const o of a.additional)if("cc.Node"===o.type){var t=o.value,s=await Editor.Message.request("scene","query-node",t),s=`${r.url}/${s.name.value||"Node"}.prefab`;const u=await Editor.Message.request("scene","create-prefab",t,s);u&&(vm.ipcSelect(u),setTimeout(()=>{utils.scrollIntoView(u)},300))}}else if(panelData.config.extendDrop.types&&panelData.config.extendDrop.types.includes(a.type)){i=Object.values(panelData.config.extendDrop.callbacks[a.type]);if(Array.isArray(i)){const d=utils.getAsset(a.to);d&&i.forEach(e=>{e({uuid:d.uuid,type:d.type,isDirectory:d.isDirectory},a.additional)})}}else a.additional&&Array.isArray(a.additional)&&(a.copy?(e=a.additional.map(e=>e.value.split("@")[0]),vm.copy([...new Set(e)]),vm.paste(a.to)):await vm.move(a,r))},copy(t){if(!panelData.$.panel.isOperating){let e=[];t=(e=Array.isArray(t)?t:t&&!panelData.act.selects.includes(t)?[t]:panelData.act.selects.slice()).filter(e=>{e=utils.getAsset(e);return e&&!utils.canNotCopy(e)}),t=(t.forEach(e=>{utils.twinkle.add(e,"light")}),vm.uuidsToCopiedInfo(t));Editor.Clipboard.write("assets-copied-info",t),vm.render()}},async paste(e,t){if(!panelData.$.panel.isOperating){e=e||vm.getFirstSelect();let i=utils.closestWhichCanCreate(e);if(i){var a=Editor.Clipboard.read("assets-cut-info");if(a&&a.assetInfo.length&&Editor.Project.path===a.projectPath)return a=a.assetInfo.map(e=>e.uuid),i&&a.includes(i.uuid)?void 0:(a={additional:a.map(e=>({value:e}))},await vm.move(a,i),void Editor.Clipboard.clear());if(!t){var a=Editor.Clipboard.read("assets-copied-info");let e=[];if(a&&(t=a.assetInfo.map(e=>e.uuid),e=a.assetInfo.map(e=>({srcPath:e.file,tarPath:i.url+"/"+e.name}))),e.length&&Editor.Project.path!==a.projectPath){treeData.uuidToState[i.uuid]="loading",treeData.unFreeze(i.uuid),treeData.render(),vm.toggle(i.uuid,!0);for(const o of e)await Editor.Message.request("asset-db","import-asset",o.srcPath,o.tarPath);return void(treeData.uuidToState[i.uuid]="")}}if(i&&t?.includes(i.uuid))if(!(i=utils.closestWhichCanCreate(treeData.uuidToParentUuid[i.uuid])))return a=Editor.I18n.t("assets.operate.canNotPaste",{uuid:e}),void console.warn(a);const n=[];if(t?.forEach(e=>{var t,a,r=utils.getAsset(e);r&&((t=!utils.canNotCopy(r))||(a=Editor.I18n.t("assets.operate.copyFail")+": "+r.name,console.warn(a)),(a=utils.isAIncludeB(e,i.uuid))&&(r=Editor.I18n.t("assets.operate.errorPasteParentToChild")+": "+r.name,console.warn(r)),t)&&!a&&n.push(e)}),0!==n.length){let e=0;let t;var r=[];treeData.uuidToState[i.uuid]="loading",treeData.unFreeze(i.uuid),treeData.render(),vm.toggle(i.uuid,!0);do{var s,l=utils.getAsset(n[e]);e++,t=null,l&&(s=(0,path_1.basename)(l.url),s=i.url+"/"+s,s=await Editor.Message.request("asset-db","generate-available-url",s),t=await Editor.Message.request("asset-db","copy-asset",l.url,s))&&(vm.intoViewByUser=t.uuid,r.push(t.uuid))}while(t);treeData.uuidToState[i.uuid]="",vm.ipcSelect(r)}}else a=Editor.I18n.t("assets.operate.canNotPaste",{uuid:e}),console.warn(a)}},cut(t){if(!panelData.$.panel.isOperating){let e=[];t=(e=Array.isArray(t)?t:t&&!panelData.act.selects.includes(t)?[t]:panelData.act.selects.slice()).filter(e=>{e=utils.getAsset(e);return e&&!utils.canNotCut(e)}),t=(t.forEach(e=>{utils.twinkle.add(e,"light")}),vm.uuidsToCopiedInfo(t));Editor.Clipboard.write("assets-cut-info",t),vm.render()}},uuidsToCopiedInfo(e){const t={};return t.projectPath=Editor.Project.path,t.assetInfo=[],e.forEach(e=>{e=utils.getAsset(e),e={uuid:e?e.uuid:"",file:e?e.file:"",name:e?e.name:""};t.assetInfo.push(e)}),t},async duplicate(e){if(!panelData.$.panel.isOperating){e=(e=e||panelData.act.selects.slice().filter(Boolean)).filter(e=>{e=utils.getAsset(e);return e&&!utils.canNotDuplicate(e)});if(0!==e.length)try{for(const t of e)await vm.paste(treeData.uuidToParentUuid[t],[t])}catch(e){console.error(e)}}},async move(t,a){if(t&&a&&Array.isArray(t.additional)){vm.toggle(a.uuid,!0);var r=t.additional.map(e=>e.value.split("@")[0]);r.sort((e,t)=>{return treeData.uuidToIndex[e]-treeData.uuidToIndex[t]});const p=[];var i=r.length;for(let e=0;e<i;e++){var s,l,n=r[e];p.includes(n)||(s=utils.getAsset(n),l=utils.getParent(n),s&&l&&(a.uuid===s.uuid||utils.canNotCut(s)||utils.isAIncludeB(s.uuid,t.to)||a.uuid!==l.uuid&&p.push(n)))}var o=[];const m=p.length;for(let e=0;e<m;e++){var u=p[e],d=utils.getAsset(u),c=utils.getParent(u);d&&c&&(vm.intoViewByUser=d.uuid,treeData.uuidToState[u]="loading",treeData.unFreeze(u),treeData.render(),c=a.url+"/"+(0,path_1.basename)(d.url),d.instantiation?o.push(Editor.Message.request("asset-db","init-asset",d.url,c)):o.push(Editor.Message.request("asset-db","move-asset",d.url,c)))}await Promise.all(o).finally(()=>{for(let e=0;e<m;e++){var t=p[e];treeData.uuidToState[t]="",treeData.unFreeze(t)}treeData.render()}),vm.ipcSelect(p)}},async reimport(t){let a=[];var r=(a=panelData.act.selects.includes(t)?panelData.act.selects:[t]).length;let i=[];for(let e=0;e<r;e++){const t=a[e];var s=utils.getAsset(t);if(s&&!utils.canNotReimport(s))if(s.isDirectory){i.includes(t)||i.push(t);s=treeData.uuidToChildren[t];if(Array.isArray(s))for(const l of s)i.includes(l)||i.push(l)}else(i=i.filter(e=>!utils.isAIncludeB(t,e))).some(e=>utils.isAIncludeB(e,t))||i.includes(t)||i.push(t)}if(i.length){for(const e of i)treeData.uuidToState[e]="loading",treeData.unFreeze(e);treeData.render();for(const n of i)await Editor.Message.request("asset-db","reimport-asset",n),treeData.uuidToState[t]="",treeData.unFreeze(t),treeData.render()}},render(){for(panelData.$.panel.treeHeight=treeData.displayArray.length*panelData.config.assetHeight,panelData.$.panel.allExpand=vm.isAllExpand(),vm.filterAssets();panelData.act.twinkleQueue.length;){var e=panelData.act.twinkleQueue.shift();utils.twinkle.add(e.uuid,e.animation)}},filterAssets(){vm.assets=[];var e=vm.scrollTop%panelData.config.assetHeight,t=vm.scrollTop-e,a=t+panelData.$.panel.viewHeight,e=(vm.$el.style.top=`-${e}px`,Math.round(t/panelData.config.assetHeight)),t=Math.ceil(a/panelData.config.assetHeight)+1;vm.assets=treeData.outputDisplay(e,t)},getFirstSelect(){var e=panelData.act.selects[0];return e||treeData.displayArray[0]},getLastSelect(){var e=panelData.act.selects.length;return e?panelData.act.selects[e-1]:(e=treeData.displayArray.length,treeData.displayArray[e-1])},getFirstSelectSortByDisplay(){let t=panelData.config.protocol;var a=treeData.displayArray.length,r=panelData.act.selects.length;if(r)for(let e=0;e<r;e++){var i=panelData.act.selects[e];treeData.displayArray.indexOf(i)<a&&(t=i)}return t},getFirstChild(){return treeData.displayArray[0]},isExpand(e){return treeData.uuidToExpand[e]},isSelect(e){return-1!==panelData.act.selects.indexOf(e)},getTwinkle(e){return panelData.act.twinkles[e]??""},isAllExpand(){let a=!0,r=treeData.uuidToChildren[panelData.config.protocol];var e=panelData.act.selects.length;if(!(r=e?panelData.act.selects:r)||!r.length)return a;var i=r.length;for(let t=0;t<i;t++){let e=r[t];var s=treeData.uuidToAsset[e];if(s&&"isParent"in s&&!s.isParent&&(e=treeData.uuidToParentUuid[e]),treeData.uuidToExpand[e]){a=!1;break}}return!a},isSearchingMode(){return utils.isSearchingMode()},async dialogError(e){await Editor.Dialog.error(Editor.I18n.t("assets.operate."+e),{title:Editor.I18n.t("assets.operate.dialogError")})}},exports.watch={scrollTop(){vm.filterAssets()},activeAsset(){panelData.$.panel.activeAsset=vm.activeAsset}},exports.data=data,exports.mounted=mounted;