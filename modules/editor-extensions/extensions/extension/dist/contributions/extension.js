"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.unload=exports.load=void 0;const requestProgress=require("request-progress"),request=require("request"),fs_extra_1=require("fs-extra"),path_1=require("path"),semver_1=require("semver"),utils_1=require("../public/utils"),import_1=require("../public/import");function load(){}function unload(){}exports.load=load,exports.unload=unload,exports.methods={async isCreator3DPackage(e){if(e.dependency)return(0,semver_1.gte)((0,semver_1.valid)((0,semver_1.coerce)(e.dependency)),"3.0.0")},async downloadZip(o,a){return await(0,fs_extra_1.ensureDir)((0,path_1.dirname)(o.file)),new Promise((t,r)=>{var e=encodeURI(o.url);requestProgress(request(e),{delay:300}).on("progress",function(e){o.downloadProgress=e.percent,a()}).on("error",function(e){r(e)}).on("end",function(e,r){o.downloadProgress=1,a(),t(null)}).pipe((0,fs_extra_1.createWriteStream)(o.file))})},async installExtension(r,e){var t="en"===Editor.I18n.getLanguage()&&r.name_en||r.name;if(!(0,fs_extra_1.existsSync)(r.file))throw new Error(Editor.I18n.t("extension.store.install_exists_error"));if(".zip"!==(0,path_1.extname)(r.file))throw new Error(Editor.I18n.t("extension.store.install_exname_error"));var o="zh"===Editor.I18n.getLanguage()?r.name:r.name_en,o=await Editor.Dialog.info(Editor.I18n.t("extension.store.install_package",{name:o}),{cancel:2,buttons:[Editor.I18n.t("extension.create_package.global"),Editor.I18n.t("extension.create_package.local"),Editor.I18n.t("extension.create_package.cancel")]});if(2===o.response)throw new Error("cancel");try{var a=await(0,import_1.importPackage)(0===o.response?"global":"project",r.file,{extensionDisplayName:t});await Editor.Message.request("extension","enable",a,!0)}catch(e){o=e.message;if(o!==import_1.ImportPackageErrorMessage.decompressFail)throw new Error(o);(0,utils_1.handleDecompressFail)(r.file,t,!1)}},async copyZip(e,r){var t="zh"===Editor.I18n.getLanguage()?e.name:e.name_en,o=await Editor.Dialog.select({title:Editor.I18n.t("cloud-component.store.copy_to_directory"),type:"directory"});if(!o||!o.filePaths[0])throw new Error("cancel");await(0,fs_extra_1.copy)(e.file,(0,path_1.join)(o.filePaths[0],t+".zip"))}};