"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExtensionCreation=exports.LocationType=void 0;const path_1=require("path"),fs_1=require("fs"),vue_js_1=require("vue/dist/vue.js"),utils_build_1=require("../../public/utils-build");exports.LocationType={"extension.create_package.local":"0"},exports.ExtensionCreation=(0,vue_js_1.defineComponent)({name:"ExtensionCreationApp",props:{preloadExtensionInfo:{type:Object,required:!0},author:{type:String,default:""},showInManager:Boolean,showInFolder:Boolean},data(){var e="extension",t=this.preloadExtensionInfo[e]?.templates[0],i=t?.defaultName??(0,utils_build_1.getFallbackExtensionName)();return{LocationType:exports.LocationType,extensionInfoMap:this.preloadExtensionInfo,currentLocation:"0",name:i,currentTemplate:t,currentExtension:e,editorVersion:(0,utils_build_1.getEditorVersion)(),extensionExist:!1,timeoutId:{selectionScroll:null},applying:!1}},computed:{wrongName(){return(0,utils_build_1.isExtensionNameError)(this.name)},wrongAuthor(){return!this.author},wrongEditorVersion(){return(0,utils_build_1.isEditorVersionError)(this.editorVersion)},distPath(){return(0,utils_build_1.getExtensionDist)(this.name)}},watch:{name(e,t){e!==t&&this.updateExtensionIsExist()},currentLocation(e,t){e!==t&&this.updateExtensionIsExist()}},methods:{selectTemplate(e,t){this.currentExtension=e,this.currentTemplate=t,this.name=t.defaultName??(0,utils_build_1.getFallbackExtensionName)(),this.timeoutId.selectionScroll&&window.clearTimeout(this.timeoutId.selectionScroll),this.timeoutId.selectionScroll=window.setTimeout(()=>{var e=this.$refs.content?.querySelector(`[data-template-id="${t.id}"]`);e&&e.scrollIntoView({block:"nearest"}),this.timeoutId.selectionScroll=null},0)},getAvailableTemplate(e,t){if(this.extensionInfoMap[e])return e=this.extensionInfoMap[e].templates,"string"==typeof t?e.find(e=>e.rawPath===t):0<e.length?e[0]:void 0},async loadAllCreatorModule(e){(e=e||{}).force=e.force||!1;var t,i=await Editor.Message.request("extension","get-extension-info-map");this.extensionInfoMap={};for(const s in i)!e.force&&this.extensionInfoMap[s]||(t=i[s],this.$set(this.extensionInfoMap,s,t))},async unloadAllCreatorModule(e){for(const t in this.extensionInfoMap)e&&e.name!==t||this.$delete(this.extensionInfoMap,t)},async onPluginEnable(e){await this.loadAllCreatorModule()},async onPluginDisable(e){await this.unloadAllCreatorModule(e)},isEmptyObject(e){return 0===Object.keys(e).length},t(...e){return Editor.I18n.t(...e)},async apply(){if(this.applying)throw new Error("template is applying, please wait for a moment");this.applying=!0;try{await Editor.Profile.setTemp("extension",utils_build_1.TempProfileKeys.author,this.author),await Editor.Profile.setTemp("extension",utils_build_1.TempProfileKeys.showInManager,this.showInManager),await Editor.Profile.setTemp("extension",utils_build_1.TempProfileKeys.showInFolder,this.showInFolder);var e=await Editor.Message.request("extension","create-extension-template",{type:this.currentExtension,templateId:this.currentTemplate.id,dist:this.distPath,author:this.author,editorVersion:this.editorVersion,name:this.name,showInFolder:this.showInFolder},!0);e.success?(Editor.Task.addNotice({title:this.name,message:this.t("extension.create_package.create_extension_successful",{name:this.name,path:this.distPath}),timeout:5e3,type:"success"}),setTimeout(()=>{this.applying=!1,Editor.Panel.has("extension.create").then(e=>{e&&Editor.Panel.close("extension.create")})},200)):(this.applying=!1,Editor.Dialog.error(e.msg,{title:"Creator Extension",detail:e.msg}),this.updateExtensionIsExist())}catch(e){this.applying=!1,e instanceof Error&&Editor.Dialog.error(e.message,{title:e.name,detail:e.stack}),this.updateExtensionIsExist()}},updateExtensionIsExist(){this.extensionExist=""!==this.name&&(0,fs_1.existsSync)(this.distPath)}},template:(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static","/template/create/index.html"),"utf8")});