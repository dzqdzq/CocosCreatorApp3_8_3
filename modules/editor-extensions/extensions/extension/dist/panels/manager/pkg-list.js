"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=require("fs"),path_1=require("path"),pkg_node_1=__importDefault(require("./pkg-node")),Vue=require("vue/dist/vue.js");Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.default=Vue.extend({name:"PkgList",components:{"pkg-node":pkg_node_1.default},props:{label:{type:String,default:""},active:{type:Boolean,default:!1},choosed:{type:String,default:""},pageSize:{type:Number,default:15},isSearch:{type:Boolean,default:!1},searchKey:{type:String,default:""}},data(){return{list:[],page:1,loading:!1,total:0,errorMessage:""}},computed:{isNoData(){return!(this.loading||0!==this.list.length||this.isSearch&&""===this.searchKey)},isNoMore(){return 0<this.list.length&&(this.list.length===this.total||this.list.length>this.total)}},watch:{active(t,e){this.isSearch||!t||0!==this.list.length||this.errorMessage||this.loading?t&&0<this.list.length&&this.choose(this.list[0]):(this.page=1,this.$emit("update-list",this.label,this.page,this.pageSize))},loading(t){t&&0<this.list.length&&this.$nextTick(()=>{this.$refs.main.scrollTop=this.$refs.main.scrollTop+this.$refs.loading.scrollHeight})}},created(){},mounted(){},methods:{t(t){return Editor.I18n.t("extension.manager."+t)},scrollToBottom(t){this.loading||this.errorMessage||this.isNoMore||(t=t.path[0]).scrollHeight-t.scrollTop-5<t.clientHeight&&(this.page+=1,this.$emit("update-list",this.label,this.page,this.pageSize))},updateList(t,e){this.list.push(...t),this.total=e,this.active&&1===this.page&&0<this.list.length&&this.choose(this.list[0])},updateDownloadStatus(e,s,i,a){this.list.forEach(t=>{t.name===e&&(s?(t.state="none",t.progress=0):i?(t.state="none",t.isInstalled=!0,t.enable=!0,t.isBuiltIn&&!t.builtInVersion?(t.builtInPath=t.path,t.builtInVersion=t.version,t.version=i.version,t.path=i.path):(t.path=i.path,t.version=i.version),t.progress=0):("installing"!==t.state&&(t.state="installing"),t.progress=a))})},updateUninstallStatus(s,i,a,l){this.list.forEach(t=>{var e;t.name===s&&(i?(t.state="none",t.progress=0):a?(t.state="none",t.progress=0,e="function"==typeof a?a(t):a,t.version=e.version,t.path=e.path,""===e.path&&(t.isInstalled=!1)):("uninstalling"!==t.state&&(t.state="uninstalling"),t.progress=l))})},addPackage(t){0<this.list.length&&this.list.unshift(t)},refresh(){this.$emit("refresh")},reset(){this.list=[],this.page=1,this.loading=!1,this.total=0,this.errorMessage=""},setError(t){this.list=[],this.errorMessage=t},remove(e){var t=this.list.findIndex(t=>t.name===e);-1<t&&(this.list.splice(t,1),this.active)&&(0<this.list.length?this.choose(this.list[0]):this.choose(void 0))},toggleEnableHandle(e){this.list.forEach(t=>{t.name===e.name&&t.path===e.path&&(t.enable=e.enable)})},handleListUpdate(t){0!==this.list.length&&t.forEach(e=>{var t=this.list.findIndex(t=>t.name===e.name&&t.path===e.path);-1<t&&(this.list[t].enable=e.enable,this.list[t].isInstalled=e.isInstalled,this.list[t].progress=e.progress,this.list[t].state=e.state,this.list[t].version=e.version,this.list[t].path=e.path)})},updateUninstallLoading(e,s){this.list.forEach(t=>{t.name===e&&(t.state=s?"uninstalling":"none")})},toggleEnable(t,e,s){this.$emit("set-enable",t,!e,s)},removePackage(e){this.list.forEach(t=>{t.name===e&&(t.state="uninstalling")}),this.$emit("remove-package",e)},uninstallPackage(t,e,s){this.$emit("uninstall-package",t,e,s)},updatePackage(e,t,s){this.list.forEach(t=>{t.name===e&&(t.state="installing")}),this.$emit("update-package",e,t,s)},choose(t){this.$emit("choose",t)}},template:(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/template/manager/pkg-list.html"),"utf8")});