"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.onItemUpdate=exports.getDownloadInfo=exports.removeDownloadList=exports.removeDownloadItem=exports.pushDownloadList=exports.generateDownloadItem=exports.init=exports.downloadList=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),DOWNLOAD_PATH=(0,path_1.join)(Editor.App.home,"download");async function init(){(await Editor.Profile.getConfig("extension","download-list")).forEach(o=>{o.downloadProgress<1&&(o.downloadProgress=-1),o.installProgress<1&&(o.installProgress=-1),exports.downloadList.push(o)})}function generateDownloadItem(o){var e=(0,path_1.join)(DOWNLOAD_PATH,o.production_id+"-"+o.version_id+".zip");return{version_id:o.version_id,production_id:o.production_id,name:o.name,name_en:o.name_en,type:o.type_id,file:e,url:o.download_url,downloadProgress:0,installProgress:0,date:Date.now(),dependency:o.dependency}}function pushDownloadList(o){exports.downloadList.push(o),Editor.Message.broadcast("extension:downloader-update"),Editor.Profile.setConfig("extension","download-list",exports.downloadList,"global")}async function removeDownloadItem(e,t){for(let o=0;o<exports.downloadList.length;o++){var n=exports.downloadList[o];if(n.version_id===e&&n.production_id===t)return await(0,fs_extra_1.remove)(n.file),exports.downloadList.splice(o,1),Editor.Message.broadcast("extension:downloader-update"),Editor.Profile.setConfig("extension","download-list",exports.downloadList,"global"),!0}return!1}async function removeDownloadList(){await Promise.all(exports.downloadList.map(async o=>{await(0,fs_extra_1.remove)(o.file)})),exports.downloadList.splice(0,exports.downloadList.length),Editor.Message.broadcast("extension:downloader-update"),Editor.Profile.setConfig("extension","download-list",exports.downloadList,"global")}function getDownloadInfo(e,t){for(let o=0;o<exports.downloadList.length;o++){var n=exports.downloadList[o];if(n.version_id===e&&n.production_id===t)return n}return null}function onItemUpdate(o){Editor.Message.broadcast("extension:downloader-update",o),Editor.Profile.setConfig("extension","download-list",exports.downloadList,"global")}exports.downloadList=[],exports.init=init,exports.generateDownloadItem=generateDownloadItem,exports.pushDownloadList=pushDownloadList,exports.removeDownloadItem=removeDownloadItem,exports.removeDownloadList=removeDownloadList,exports.getDownloadInfo=getDownloadInfo,exports.onItemUpdate=onItemUpdate;