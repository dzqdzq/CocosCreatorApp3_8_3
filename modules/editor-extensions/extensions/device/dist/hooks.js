"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.queryDefaultDevice=exports.register=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path");async function register(e){var e=e.contributions.profile.editor,t=(await queryDefaultDevice())["deviceConfig"];await Editor.Profile.setConfig("device","deviceConfig",t,"default");const i={};t.forEach(e=>{e.name&&"number"==typeof e.width&&"number"==typeof e.height&&"number"==typeof e.ratio?e.enable&&(i[e.name]=!0):console.warn("Invalid device data "+JSON.stringify(e))}),e.deviceConfig.default=t,e.enableDevice.default=i,await Editor.Profile.setConfig("device","enableDevice",i,"default")}async function queryDefaultDevice(){var e="device-list";let t=!1,i=[];console.log("Request namespace: "+e);try{var r=await Editor.Profile.getConfig("device","releaseKey")||"",a=await Editor.Network.get(`https://config.cocos.com/configs/creator-settings/default/${e}?releaseKey=`+r),o=JSON.parse(a.toString());i=JSON.parse(o.configurations.list),t=r===o.releaseKey,Editor.Profile.setConfig("device","releaseKey",o.releaseKey,"global")}catch(e){console.warn("update profile: "+e)}return{deviceConfig:i=i&&0!==i.length?i:(0,fs_extra_1.readJSONSync)((0,path_1.join)(__dirname,"../static/devices.json")),dirty:t}}exports.register=register,exports.queryDefaultDevice=queryDefaultDevice;