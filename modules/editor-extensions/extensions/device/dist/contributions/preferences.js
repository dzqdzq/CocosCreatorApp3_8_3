"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importConfig=exports.exportConfig=exports.close=exports.ready=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),Vue=require("vue/dist/vue.js"),vueTemplate=(Vue.config.productionTip=!1,(Vue.config.devtools=!1,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/contributions/preferences.html"),"utf8")),DevicePreferenceVM=Vue.extend({name:"DevicePreferenceVM",data(){return{config:{builtin:[],custom:[],enable:{}},deviceType:"",num:-1,device:{name:"",width:0,height:0,ratio:0},editType:""}},computed:{confirmButtonDisabled(){return!this.device.name||0===this.device.height||0===this.device.width||0===this.device.ratio},deviceFormDisabled(){return"builtin"===this.deviceType&&"add"!==this.editType}},mounted(){this.refresh()},methods:{async refresh(){var e=await Editor.Profile.getConfig("device","deviceConfig","default"),i=await Editor.Profile.getConfig("device","custom","global"),t=await Editor.Profile.getConfig("device","enableDevice");this.config.builtin=e,i&&(this.config.custom=i),t&&(this.config.enable=t),this.chooseDevice("builtin",0)},chooseDevice(e,i){"add"!==this.editType&&(this.editType="",this.deviceType=e,this.num=i,this.updateDevice())},updateDevice(){requestAnimationFrame(()=>{var e;this.config[this.deviceType]&&this.config[this.deviceType][this.num]&&(e=this.config[this.deviceType][this.num],this.device.name=e.name,this.device.width=e.width,this.device.height=e.height,this.device.ratio=e.ratio)})},onDeviceChange(e){var e=e.target,i=e.getAttribute("path");i&&void 0!==this.device[i]&&(e=e.value,this.device[i]=e,"add"!==this.editType)&&(this.isDeviceChanged()?this.editType="update":this.editType="")},createDevice(){this.device.name=Editor.I18n.t("device.markname"),this.device.width=0,this.device.height=0,this.device.ratio=1,this.editType="add"},confirmDevice(){if("add"===this.editType){if(this.isDeviceNameExist(this.device.name))return void Editor.Dialog.warn(Editor.I18n.t("device.invalid.exists"));this.config.custom.push(JSON.parse(JSON.stringify(this.device))),this.editType="",this.chooseDevice("custom",this.config.custom.length-1)}else{var e=this.config.custom[this.num];if(!e)return;if(e.name!==this.device.name&&this.isDeviceNameExist(this.device.name))return void Editor.Dialog.warn(Editor.I18n.t("device.invalid.exists"));e.name=this.device.name,e.width=this.device.width,e.height=this.device.height,e.ratio=this.device.ratio,this.editType=""}Editor.Profile.setConfig("device","custom",this.config.custom,"global")},cancelCreate(){this.editType="";var e=this.config[this.deviceType][this.num];this.device.name=e.name,this.device.width=e.width,this.device.height=e.height,this.device.ratio=e.ratio},deleteDevice(e){var i;this.config.custom[e]&&(i=this.config.custom[e].name,this.config.custom.splice(e,1),"custom"===this.deviceType&&e<=this.num&&(0===this.config.custom.length?this.chooseDevice("builtin",0):this.chooseDevice("custom",this.num-1)),Editor.Profile.setConfig("device","custom",this.config.custom,"global"),delete this.config.enable[i],Editor.Profile.setConfig("device","enableDevice",this.config.enable,"global"))},async switchEnable(e,i){this.config.enable[i]=e,await Editor.Profile.setConfig("device","enableDevice",this.config.enable,"global"),Editor.Message.broadcast("device:devices-changed")},isDeviceNameExist(i){return this.config.builtin.some(e=>i===e.name)||this.config.custom.some(e=>i===e.name)},isDeviceChanged(){var e=this.config.custom[this.num];let i=!1;for(const t in e)e[t]!==this.device[t]&&(i=!0);return i}},template:vueTemplate});function ready(){var e=this;e.vm?.$destroy(),e.vm=new DevicePreferenceVM,e.vm.$mount(e.$.container)}function close(){this.vm?.$destroy(),this.vm=null}async function exportConfig(){var e={};return e.custom={type:"global",value:await Editor.Message.request("preferences","query-config","device","custom")},e.enableDevice={type:"global",value:await Editor.Message.request("preferences","query-config","device","enableDevice")},e}async function importConfig(e){e.custom&&await Editor.Message.request("preferences","set-config","device","custom",e.custom.value,"global"),e.enableDevice&&await Editor.Message.request("preferences","set-config","device","enableDevice",e.enableDevice.value,"global")}exports.style=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"./preferences.css"),"utf8"),exports.template='<div class="container"></div>',exports.$={container:".container"},exports.ready=ready,exports.close=close,exports.exportConfig=exportConfig,exports.importConfig=importConfig;