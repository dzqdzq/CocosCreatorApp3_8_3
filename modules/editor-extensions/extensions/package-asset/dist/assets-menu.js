"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assetMenu=exports.dbMenu=void 0;const path_1=require("path"),utlis_1=require("./common/utlis"),I18n=Editor["I18n"];async function DialogOpenImportZip(){var e=await Editor.Dialog.select({title:Editor.I18n.t("package-asset.import.title"),path:await Editor.Profile.getConfig("package-asset","import-path")||Editor.Project.path,filters:[{name:"Package",extensions:["zip"]}]});if(!e.canceled)return e=e.filePaths&&e.filePaths[0],(0,utlis_1.isPath)(e)?(await Editor.Profile.setConfig("package-asset","import-path",(0,path_1.dirname)(e)),e):void 0}function getImportMenu(e){return{label:"i18n:package-asset.menu.import",enabled:!e||!e.readonly,async click(){var e;await Editor.Panel.has("package-asset.import")?Editor.Panel.focus("package-asset.import"):(e=await DialogOpenImportZip())&&Editor.Panel.open("package-asset.import",e)}}}function getExportMenu(e){return{label:"i18n:package-asset.menu.export",enabled:!e||!e.readonly,async click(){await Editor.Panel.has("package-asset.export")?Editor.Panel.focus("package-asset.export"):Editor.Panel.open("package-asset.export",e)}}}function getImportNewAssetMenu(e,t){const r=(e?e.url:"db://assets").replace("db://","");e=!e||!e.readonly&&e.isDirectory;return{label:"i18n:package-asset.menu."+("directory"===t?"importNewFolders":"importNewFiles"),enabled:e,async click(){try{var a=await Editor.Dialog.select({title:Editor.I18n.t("package-asset.importNewAsset.title"),path:await Editor.Profile.getConfig("package-asset","import-new-asset-path")||Editor.Project.path,type:t,multi:!0});if(!a.canceled){let t;for(let e=0;e<a.filePaths.length;e++){var s=a.filePaths[e],i=await Editor.Message.request("asset-db","import-asset",s,"db://"+(0,path_1.join)(r,(0,path_1.basename)(s)));0===e&&(t=i,await Editor.Profile.setConfig("package-asset","import-new-asset-path",(0,path_1.dirname)(s)))}t&&Editor.Message.send("assets","twinkle",t.uuid)}}catch(e){console.error(e)}}}}function dbMenu(e){return[getImportNewAssetMenu(e,"file"),getImportNewAssetMenu(e,"directory"),getImportMenu(e)]}function assetMenu(e){return[getImportNewAssetMenu(e,"file"),getImportNewAssetMenu(e,"directory"),getImportMenu(e),getExportMenu(e)]}exports.dbMenu=dbMenu,exports.assetMenu=assetMenu;