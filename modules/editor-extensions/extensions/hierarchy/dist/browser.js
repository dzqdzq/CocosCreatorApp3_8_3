"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=void 0;const Profile=require("@base/electron-profile"),sceneState={},messageProtocol={scene:"scene"};async function queryMessageProtocolScene(){try{var e=await Editor.Profile.getConfig("hierarchy","message-protocol");e&&Object.assign(messageProtocol,e)}catch(e){console.error(e),messageProtocol.scene="scene"}}Profile.on("change",(e,r,t)=>{"defaultPreferences"===e&&"packages/hierarchy.json"===r&&"message-protocol"===t&&queryMessageProtocolScene()}),exports.methods={open(){Editor.Panel.open("hierarchy")},async staging(e){e&&e.assetUuid&&(sceneState[e.assetUuid]=e).expandLevels&&e.expandLevels.length&&Editor.Profile.setTemp("hierarchy",e.assetUuid,e)},async unstaging(){var e=await Editor.Message.request(messageProtocol.scene,"query-current-scene");let r=sceneState[e];return r=(r=!r&&e?await Editor.Profile.getTemp("hierarchy",e):r)||{assetUuid:"",animationUuid:"",expandLevels:["0"]},Array.isArray(r.expandLevels)||(r.expandLevels=["0"]),e&&(r.assetUuid=e),r},async"link-prefab"(){var e,r=Editor.Selection.getLastSelected("node"),t=Editor.Selection.getLastSelected("asset");let a="";r?(await Editor.Message.request(messageProtocol.scene,"query-node",r)).isScene&&(a=Editor.I18n.t("hierarchy.menu.link_prefab_error_node_isScene")):a=Editor.I18n.t("hierarchy.menu.link_prefab_error_node_empty"),t?(e=await Editor.Message.request("asset-db","query-asset-info",t))&&"cc.Prefab"===e.type||(a=Editor.I18n.t("hierarchy.menu.link_prefab_error_asset_invalid")):a=Editor.I18n.t("hierarchy.menu.link_prefab_error_asset_empty"),a?await Editor.Dialog.warn(a,{title:Editor.I18n.t("hierarchy.operate.dialogWarning")}):1!==(await Editor.Dialog.warn(Editor.I18n.t("hierarchy.menu.link_prefab_make_sure"),{buttons:["Yes","Cancel"],default:0,cancel:1,title:Editor.I18n.t("hierarchy.operate.dialogWarning")})).response&&(e=await Editor.Message.request(messageProtocol.scene,"begin-recording",r),await Editor.Message.request(messageProtocol.scene,"link-prefab",r,t),await Editor.Message.request(messageProtocol.scene,"end-recording",e))},async"unlink-prefab"(e){let r="";(e=e||Editor.Selection.getLastSelected("node"))?(await Editor.Message.request(messageProtocol.scene,"query-node",e)).__prefab__||(r=Editor.I18n.t("hierarchy.menu.unlink_prefab_error_prefab_empty")):r=Editor.I18n.t("hierarchy.menu.link_prefab_error_node_empty"),r?await Editor.Dialog.warn(r,{title:Editor.I18n.t("hierarchy.operate.dialogWarning")}):await Editor.Message.request(messageProtocol.scene,"unlink-prefab",e,!1)},async"unlink-prefab-recursively"(){var e=Editor.Selection.getLastSelected("node");let r="";e?(await Editor.Message.request(messageProtocol.scene,"query-node",e)).__prefab__||(r=Editor.I18n.t("hierarchy.menu.unlink_prefab_error_prefab_empty")):r=Editor.I18n.t("hierarchy.menu.link_prefab_error_node_empty"),r?await Editor.Dialog.warn(r,{title:Editor.I18n.t("hierarchy.operate.dialogWarning")}):await Editor.Message.request(messageProtocol.scene,"unlink-prefab",e,!0)}};