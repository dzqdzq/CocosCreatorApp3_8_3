"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){e[n=void 0===n?a:n]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.popupContextMenu=exports.popupSearchMenu=exports.popupPanelMenu=exports.popupCreateMenu=void 0;const panelData=__importStar(require("./panel-data")),utils=__importStar(require("./utils"));function prependCancelSearchMenu(e){return utils.isSearching()&&e.unshift({label:Editor.I18n.t("hierarchy.menu.cancelSearch"),click(){panelData.$.panel.clearSearch()}},{type:"separator"}),e}async function createMenu(e){var t=await Editor.Menu.__protected__.queryMain();if(!t||!t["i18n:menu.node"])return[];var a=t["i18n:menu.node"].submenu;if(a)for(const n in a)"create"!==a[n].group&&delete a[n];t=suitSubmenu(t["i18n:menu.node"],e).submenu,t.push({type:"extend-menu"}),e=await mergeMenu(t,"createMenu");return e}function suitSubmenu(e,a){return e.submenu&&(e.submenu=Object.values(e.submenu).reduce((e,t)=>(t.click=()=>{a(t.message?.params?.[0])},suitSubmenu(t,a),e.push(t),e),[])),e}async function popupCreateMenu(){utils.enableContextMenu()&&Editor.Menu.popup({menu:await createMenu(e=>{panelData.$.tree.addTo(e)})})}async function createPanelMenu(){return await mergeMenu([{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:utils.enableContextMenu(),submenu:await createMenu(e=>{panelData.$.tree.addTo(e)})},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.isNoneCopyOrCut()&&utils.enableContextMenu(),click(){panelData.$.tree.paste()}},{type:"extend-menu"}],"panelMenu")}async function popupPanelMenu(){var e=await createPanelMenu();prependCancelSearchMenu(e),Editor.Menu.popup({menu:e})}function createSearchMenu(){var e=panelData.$.panel["searchType"];return[{label:Editor.I18n.t("hierarchy.menu.searchName"),type:"radio",checked:"name"===e,click(){panelData.$.panel.searchType="name"}},{label:Editor.I18n.t("hierarchy.menu.searchUuid"),type:"radio",checked:"uuid"===e,click(){panelData.$.panel.searchType="uuid"}},{label:Editor.I18n.t("hierarchy.menu.searchPath"),type:"radio",checked:"path"===e,click(){panelData.$.panel.searchType="path"}},{label:Editor.I18n.t("hierarchy.menu.searchComponent"),type:"radio",checked:"component"===e,click(){panelData.$.panel.searchType="component"}},{label:Editor.I18n.t("hierarchy.menu.searchAsset"),type:"radio",checked:"asset"===e,click(){panelData.$.panel.searchType="asset"}},{label:Editor.I18n.t("hierarchy.menu.searchMissAsset"),type:"radio",checked:"missAsset"===e,click(){panelData.$.panel.searchType="missAsset"}}]}async function popupSearchMenu(){Editor.Menu.popup({menu:createSearchMenu()})}function createConsoleMenu(e){return[{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.showUuid"),click(){Editor.Clipboard.write("text",e.uuid),console.log("UUID ",Editor.I18n.t("hierarchy.menu.doneCopied")," ",e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.showPath"),click(){Editor.Clipboard.write("text",e.path),console.log("PATH ",Editor.I18n.t("hierarchy.menu.doneCopied")," ",e.path)}}]}function createEditPrefab(e){return e.prefab&&e.prefab.state&&3!==e.prefab.state&&!e.prefab.assetUuid.includes("@")&&e.prefab.assetUuid!==panelData.act.assetUuid?[{label:Editor.I18n.t("hierarchy.menu.prefab"),submenu:[{label:Editor.I18n.t("hierarchy.menu.unlink_prefab"),click(){Editor.Message.send("hierarchy","unlink-prefab",e.uuid)}},{label:Editor.I18n.t("hierarchy.menu.unlink_prefab_recursively"),click(){Editor.Message.send("hierarchy","unlink-prefab-recursively")}}]},{type:"separator"}]:[]}function createLocateAsset(e){return e.isScene||!e.prefab||e.prefab.state?[{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.locateAsset"),enabled:utils.isExistedAsset(),click(){utils.twinkle.asset(e)}}]:[]}async function createRootMenu(t){return await mergeMenu([{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:!utils.canNotCreateNode(t)&&utils.enableContextMenu(),submenu:await createMenu(e=>{e.parent=t.uuid,panelData.$.tree.addTo(e)})},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.canNotPasteNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.paste(t.uuid)}},...createLocateAsset(t),{type:"extend-menu"},...createConsoleMenu(t)],"rootMenu",t)}async function createNodeMenu(t){return await mergeMenu([...createEditPrefab(t),{label:Editor.I18n.t("hierarchy.menu.newNode"),enabled:!utils.canNotCreateNode(t)&&utils.enableContextMenu(),submenu:await createMenu(e=>{e.parent=t.uuid,panelData.$.tree.addTo(e)})},{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.copy"),accelerator:"CmdOrCtrl+C",enabled:!utils.canNotCopyNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.copy(t.uuid)}},{label:Editor.I18n.t("hierarchy.menu.duplicate"),accelerator:"CmdOrCtrl+D",enabled:!utils.canNotCopyNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.duplicate(t.uuid)}},{label:Editor.I18n.t("hierarchy.menu.cut"),accelerator:"CmdOrCtrl+X",enabled:!utils.canNotCutNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.cut(t.uuid)}},{label:Editor.I18n.t("hierarchy.menu.paste"),accelerator:"CmdOrCtrl+V",enabled:!utils.canNotPasteNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.paste(t.uuid)}},{label:Editor.I18n.t("hierarchy.menu.pasteAsChild"),accelerator:`CmdOrCtrl+${"win32"===process.platform?"Alt":"Option"}+V`,enabled:!utils.canNotPasteNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.paste(t.uuid,!1,!0)}},{label:Editor.I18n.t("hierarchy.menu.rename"),accelerator:"Enter",enabled:!utils.canNotRename(t)&&utils.enableContextMenu(),click(){panelData.$.tree.renameUuid=t.uuid}},...createLocateAsset(t),{type:"extend-menu"},{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.selectAll"),accelerator:"CmdOrCtrl+A",click(){panelData.$.tree.selectAll(t.uuid)}},{type:"separator"},{label:Editor.I18n.t("hierarchy.menu.delete"),accelerator:"Delete",enabled:!utils.canNotDeleteNode(t)&&utils.enableContextMenu(),click(){panelData.$.tree.delete(t.uuid)}},...createConsoleMenu(t)],"nodeMenu",t)}async function popupContextMenu(e){e=e.isScene||e.isPrefabRoot?await createRootMenu(e):await createNodeMenu(e);prependCancelSearchMenu(e),Editor.Menu.popup({menu:e})}async function mergeMenu(e,t,a){t=await panelData.config.extendMenu.show(t,a),a=e.findIndex(e=>"extend-menu"===e.type),e=e.slice();return e.splice(a,1,...t),e}exports.popupCreateMenu=popupCreateMenu,exports.popupPanelMenu=popupPanelMenu,exports.popupSearchMenu=popupSearchMenu,exports.popupContextMenu=popupContextMenu;