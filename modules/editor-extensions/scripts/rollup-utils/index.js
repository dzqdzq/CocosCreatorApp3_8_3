"use strict";const VuePlugin=require("rollup-plugin-vue"),commonjs=require("@rollup/plugin-commonjs"),postcss=require("rollup-plugin-postcss"),babel=require("@rollup/plugin-babel")["babel"],typescript=require("rollup-plugin-typescript2"),terser=require("rollup-plugin-terser")["terser"],json=require("@rollup/plugin-json"),url=require("@rollup/plugin-url"),del=require("rollup-plugin-delete"),{join,relative,dirname}=require("path"),writeFileSync=require("fs")["writeFileSync"];exports.getTaskConfig=function(t,o){var e="production"!==process.env.NODE_ENV;const n=join(o,t.distDir);var i=join(o,t.sourceDir),r=join(__dirname,"./","normalize-component.js").replace(/\\/g,"/"),l=join(__dirname,"./","style-injector.js").replace(/\\/g,"/"),u=join(o,t.tsconfigPath),p={};for(let e=0;e<t.sources.length;e++){var s=t.sources[e];p[s.replace(".ts","")]=join(i,s)}var a=new RegExp("\\.("+["png","jpe?g","gif","svg","ico","webp","avif","mp4","webm","ogg","mp3","wav","flac","aac","woff2?","eot","ttf","otf","wasm","webmanifest","pdf","txt"].join("|")+")(\\?.*)?$"),c={vue:{defaultOptions:{defaultLang:{script:"ts"},css:!0,isWebComponent:!0,normalizer:"~"+r,styleInjectorShadow:"~"+l},pluginModule:VuePlugin},commonjs:{defaultOptions:{},pluginModule:commonjs},postcss:{defaultOptions:{inject:!1,extract:!1},pluginModule:postcss},babel:{defaultOptions:{babelHelpers:"bundled"},pluginModule:babel},typescript:{defaultOptions:{tsconfig:u},pluginModule:typescript,enable:t.tsconfigPath},terser:{defaultOptions:{},pluginModule:terser,enable:!e},json:{defaultOptions:{},pluginModule:json},url:{defaultOptions:{limit:0,fileName:"[dirname][name][extname]",destDir:n,publicPath:n+"/",sourceDir:join(o,i),include:a},pluginModule:url},del:{defaultOptions:{targets:t.distDir+"/*",runOnce:!0,cwd:o},pluginModule:del,enable:!e},relativeRoot:{defaultOptions:{},pluginModule:function(){return{name:"relative-root",resolveImportMeta(e,t){return"relativePath"===e?`"${relative(dirname(join(n,t.chunkId)),o).replace(/\\/g,"/")}"`:null}}}},importEditorCC:{defaultOptions:{},pluginModule:function(){return{name:"import-editor-cc",async writeBundle(e,t){for(const i in t){var o=t[i];o&&o.imports&&o.imports.includes("cc")&&writeFileSync(join(n,o.fileName),d+o.code,{encoding:"utf8"})}}}}}};const d="{const {join} = require('path');const __editorModulePath__ = join(Editor.App.path,'node_modules');module.paths.push(__editorModulePath__);}";var g=[];for(const b in c){var f=c[b],m=t.pluginSetting&&t.pluginSetting[b];if(!1!==f.enable&&!m||m&&!1!==m.enable){let e=f.defaultOptions;m&&(e="function"==typeof m.options?m.options(f.defaultOptions):f.defaultOptions),g.push(f.pluginModule(e))}}t.extraPlugin&&g.push(...t.extraPlugin);r={input:p,plugins:g,external:["vue","fs","path","cc","child_process","events"]},l="function"==typeof t.inputOptions?Object.assign({},t.inputOptions(r),{plugins:g,input:p}):r,l.input||console.error("请配置 rollup 的入口！"),u={format:t.format||"cjs",dir:n};let j;return(j="function"==typeof t.outputOptions?Object.assign({},t.outputOptions(u),{format:t.format,dir:n}):u).dir||console.error("请配置 rollup 的输出目录！"),j.format||console.error("请配置 rollup 的输出格式！"),{inputOptions:l,outputOptions:j,sourceDir:i}};