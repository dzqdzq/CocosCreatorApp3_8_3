"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.ready=exports.update=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path"),build_1=require("./build"),verification_1=require("./utils/verification"),lodash=require("lodash"),methods={onNewCertificate(){Editor.Panel.open("certificate")},t(e,t=""){return Editor.I18n.t("xiaomi-quick-game."+t+e)},async onChange(e){var t=this,a=e.target.value,e=e.target.getAttribute("path");lodash.set(t.pkgOptions,e,a),["useDebugKey","certificatePemPath","privatePemPath"].includes(e)&&t.updatePemPathCheckRes(),panel.dispatch("update",`packages.${t.pkgName}.`+e,a,t.verifyRes[e])},updatePemPathCheckRes(){var e=this,t=(0,verification_1.verificationFunc)("privatePemPath",e.pkgOptions.privatePemPath,panel.options),a=(0,verification_1.verificationFunc)("certificatePemPath",e.pkgOptions.certificatePemPath,panel.options);e.verifyRes.privatePemPath=e.pkgOptions.useDebugKey?null:t.error,e.verifyRes.certificatePemPath=e.pkgOptions.useDebugKey?null:a.error,panel.dispatch("update",`packages.${e.pkgName}.certificatePemPath`,e.pkgOptions.certificatePemPath,e.verifyRes.certificatePemPath),panel.dispatch("update",`packages.${e.pkgName}.privatePemPath`,e.pkgOptions.privatePemPath,e.verifyRes.privatePemPath)},updateCertificationPenPath(e){var t;e&&((t=this).pkgOptions.certificatePemPath=(0,path_1.join)(e,"certificate.pem"),t.pkgOptions.privatePemPath=(0,path_1.join)(e,"private.pem"),t.updatePemPathCheckRes())},init(){var e=this;e.pkgOptions=JSON.parse(JSON.stringify(lodash.get(panel.options,"packages."+panel.options.platform)||{})),e.verifyRes=JSON.parse(JSON.stringify(lodash.get(panel.errorMap,"packages."+panel.options.platform)||{})),e.updatePemPathCheckRes(e.pkgOptions.useDebugKey)},updateKey(e){var t,a=this;e?(t=e.replace(`packages.${panel.pkgName}.`,""))in build_1.optionsInPanel||(lodash.set(a.pkgOptions,t,lodash.get(panel.options,e)),lodash.set(a.verifyRes,t,lodash.get(panel.errorMap,e)),a.updatePemPathCheckRes(a.pkgOptions.useDebugKey)):a.init(e)}};let panel;function update(e,t){panel=this,t&&!t.startsWith("packages."+panel.pkgName)||(panel.options=e,panel.vm.updateKey(t))}function ready(e,t,a,i){panel=this;var p=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.errorMap=i,panel.vm=new p({el:panel.$.root,data(){return{pkgName:a,optionsConfig:build_1.optionsInPanel,pkgOptions:{},verifyRes:{}}},mounted(){this.init()},methods:methods}),Editor.Message.__protected__.addBroadcastListener("certificate:generate-certificate-success",panel.vm&&panel.vm.updateCertificationPenPath)}function close(){Editor.Message.__protected__.removeBroadcastListener("certificate:generate-certificate-success",panel.vm&&panel.vm.updateCertificationPenPath)}exports.style=`
.new-certificate { margin-left: 4px; }
`,exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../static/view.html"),"utf8"),exports.$={root:".xiaomi-quick-game"},exports.update=update,exports.ready=ready,exports.close=close;