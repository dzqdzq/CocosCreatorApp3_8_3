"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.template=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),options_1=require("./options"),lodash=require("lodash");let panel;exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../static/builder/view.html"),"utf8");const methods={t(e,t){return Editor.I18n.t("openharony."+e,t)},async onSetSDK(){Editor.Message.send("preferences","open-settings","program")},getDefaultPackageName(){return options_1.defaultOptions.packageName},async onChange(e){var t=e.target.value,e=e.target.getAttribute("path");await this.onUpdateOptions(e,t)},async onUpdateOptions(e,t){var a;e&&(a=this,"apiLevel"===e&&(t=Number(t)),lodash.set(a.pkgOptions,e,t),t=await(0,options_1.verificationFunc)(e,t,panel.options),a.pkgErrorMap[e]=t.error,a.emitChange())},async onChangeABI(e,t){var a=this,e=e.target.value;Array.isArray(a.pkgOptions.appABIs)||(a.pkgOptions.appABIs=[]),e?a.pkgOptions.appABIs.push(t):a.pkgOptions.appABIs.splice(a.pkgOptions.appABIs.indexOf(t),1),await a.onUpdateOptions("appABIs",a.pkgOptions.appABIs)},emitChange(){var e=this;panel.dispatch("update","packages."+e.pkgName,e.pkgOptions,e.pkgErrorMap)},async init(){var e=this;e.pkgOptions=lodash.get(panel.options,"packages."+panel.options.platform)||{};for(const a of Object.keys(options_1.defaultOptions)){var t=await(0,options_1.verificationFunc)(a,e.pkgOptions[a],panel.options);e.pkgErrorMap[a]=t.error}this.emitChange()}};async function update(e,t){panel=this,t&&!t.startsWith("packages."+panel.pkgName)||(panel.options=e,panel.vm.init())}function ready(e,t,a,p){panel=this;var n=BuildPanel.Vue;panel.options=e,panel.pkgName=a,panel.errorMap=p,panel.vm=new n({el:panel.$.root,data(){return{pkgName:a,type:t,pkgOptions:options_1.defaultOptions,pkgErrorMap:options_1.defaultOptions,apiLevels:[],appABIList:["armeabi-v7a","arm64-v8a"]}},async mounted(){var e=this;"check"===e.type?(e.pkgOptions=lodash.get(panel.options,"packages."+panel.pkgName)||{},e.pkgErrorMap={}):e.init()},methods:methods})}function getAPILevels(){if(!process.env.OHOS_SDK_HOME)return console.warn(Editor.I18n.t("openharmony.tips.sdk_home_empty")),[];const t=(0,path_1.join)(process.env.OHOS_SDK_HOME,"ets"),a=[];try{(0,fs_extra_1.readdirSync)(t).forEach(e=>{e=(0,fs_extra_1.readJSONSync)((0,path_1.join)(t,e,"oh-uni-package.json"));a.push(e.apiVersion)})}catch(e){console.warn(e)}return a}exports.$={root:".openharmony"},exports.update=update,exports.ready=ready;