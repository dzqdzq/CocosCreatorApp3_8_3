"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.close=exports.beforeClose=exports.ready=exports.methods=exports.$=exports.template=exports.style=void 0;const fs_1=require("fs"),path_1=require("path");let panel=null,vm;const Vue=require("vue/dist/vue.js");async function ready(){panel=this,vm=new Vue({el:panel.$.certificate,data:{settings:{password:"",confirmPassword:"",alias:"",aliasPassword:"",confirmAliasPassword:"",validity:3650,commonName:"",organization:"",organizationalUnit:"",locality:"",state:"",country:""},dirty:!1,saveBtnState:!1,saveBtnDisabled:!1,generateSuccess:!1,verifyResult:{}},async mounted(){this.netStatus="success",await this.initData()},methods:{onConfirm(e){var t,s,i=e.target.getAttribute("name");i&&(e=e.target.value,(t=this).dirty=!0,t.saveBtnState=!1,s=t.judgeEmpty(i,e),(t.verifyResult[i]=s)&&console.warn(i+" can't be empty!"),t.saveBtnDisabled=t.calcBtnState(),t.settings[i]=e,Editor.Profile.setConfig("android","certificate."+i,e))},judgeEmpty(e,t){let s="";return s=!t||t.trim&&0==t.trim().length?e+" Can't be empty":s},onGenerate(){const t=this;-1===process.env.PATH.indexOf("/usr/bin/openssl")&&(process.env.PATH+=":/usr/bin/openssl");var e=t.settings.certificatePath,{country:s,state:i,locality:a,organization:r,organizationalUnit:o,commonName:n,email:c}=t.settings,s=`/C=${s}/ST=${i}/L=${a}/O=${r}/OU=${o}/CN=${n}/emailAddress=`+c,i=path_1.join(Editor.App.path,"../tools/openSSLWin64/bin"),a=path_1.join(i,"openssl"),r=("win32"===process.platform?a:"openssl")+" req -newkey rsa:2048 -nodes -keyout private.pem -x509 -days 3650 -out certificate.pem -subj "+s,o=path_1.join(i,"openssl.cfg"),n="win32"===process.platform?{OPENSSL_CONF:o}:process.env;(0,require("child_process").exec)(r,{env:n,cwd:e},e=>{e?(t.generateSuccess=!1,console.error(Editor.I18n.t("builder.certificate.build_certificate_fail")+e)):(console.log(Editor.I18n.t("builder.certificate.build_certificate_complete")),t.generateSuccess=!0,Editor.Panel.close("builder.certificate"))})},calcBtnState(){var e=this;if(e.saveBtnState)return!0;for(const t of Object.keys(e.verifyResult))if(e.verifyResult[t])return!0;return!1},async initData(){var e=await Editor.Profile.getConfig("builder","certificate");Object.assign(this.settings,e)}}})}async function beforeClose(){}async function close(){}async function checkIsSave(){var e;if(vm&&vm.dirty)return e=Editor.I18n.t,1!==(e=await Editor.Dialog.warn(e("builder.splash_setting.is_save_dialog.title"),{buttons:[e("builder.splash_setting.is_save_dialog.save"),e("builder.splash_setting.is_save_dialog.cancel"),e("builder.splash_setting.is_save_dialog.abort")],default:0,cancel:1})).response&&(0===e.response&&await vm.saveSettings(),!0)}Vue.config.productionTip=!1,Vue.config.devtools=!1,exports.style=fs_1.readFileSync(path_1.join(__dirname,"../../dist/certificate.css"),"utf8"),exports.template=fs_1.readFileSync(path_1.join(__dirname,"../../static/certificate.html"),"utf8"),exports.$={certificate:".certificate"},exports.methods={},exports.ready=ready,exports.beforeClose=beforeClose,exports.close=close;