"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),child_process_1=require("child_process"),iconv_lite_1=__importDefault(require("iconv-lite"));exports.methods={async run(t,e){var o=t.match(/([`~!#$%^&*+=<>?"{}|,;'·~！#￥%……&*（）+={}|《》？：“”【】、；‘'，。、])/im),o=(o&&console.warn(Editor.I18n.t("wechatgame.tips.build_path_contains_symbol",{symbol:o[1]})),await Editor.Message.request("program","query-program-info","wechatDevtools"));let a=o?o.path:"";if(!a||!(0,fs_extra_1.existsSync)(a))return console.warn(""+Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty",{wechatgamePath:a})),1===(await Editor.Dialog.warn(Editor.I18n.t("wechatgame.tips.wechatgame_app_path_empty"),{buttons:["Cancel","Set Wechat DevTools"]})).response&&Editor.Message.send("preferences","open-settings","program"),!1;(0,fs_extra_1.statSync)(a).isDirectory()||"win32"!==process.platform||(a=(0,path_1.dirname)(a));let r;if("darwin"===process.platform?(r=(0,path_1.join)(a,"Contents/Resources/app.nw/bin/cli"),(0,fs_extra_1.existsSync)(r)||(r=(0,path_1.join)(a,"Contents/MacOS/cli"))):r=(0,path_1.join)(a,"cli.bat"),!(0,fs_extra_1.existsSync)(r))return await Editor.Dialog.error(Editor.I18n.t("wechatgame.options.client_path_error")),!1;o=["-o",t,"-f","cocos"],console.log("Run command : "+o.join(" ")),t=(0,child_process_1.spawn)(r,o);t&&t.stdout&&t.stdout.on("data",function(t){console.log("[WeChat Dev Tool] "+iconv_lite_1.default.decode(t,"utf8").toString())}),t&&t.stderr&&t.stderr.on("data",function(t){console.warn("[WeChat Dev Tool]"+iconv_lite_1.default.decode(t,"utf8").toString())})}};