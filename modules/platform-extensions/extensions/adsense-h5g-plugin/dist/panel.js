"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ready=exports.update=exports.$=exports.data=exports.template=void 0;const axios_1=__importDefault(require("axios")),fs_1=require("fs"),lodash_1=__importDefault(require("lodash")),path_1=require("path"),PKG_NAME="adsense-h5g-plugin";let panel;exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../static/panel.html"),"utf8");const component={data(){return{renderList:[],pkgOptions:{otherAFPHostPropertyCode:"",otherAFPDomain:"",AFPHostPropertyCode:"",AFPHostDomain:""},pkgErrorMap:{otherAFPHostPropertyCode:null,otherAFPDomain:null}}},methods:{t(e){e=e.replace("i18n:","");return Editor.I18n.t(e)||e},updateOptions(){var e=this;e.pkgOptions=lodash_1.default.get(panel.options,"packages."+PKG_NAME)||{otherAFPHostPropertyCode:"",otherAFPDomain:"",AFPHostPropertyCode:"",AFPHostDomain:""},"other"===e.pkgOptions.AFPHostPropertyCode?(e.onOtherAFPHostPropertyCodeChange(e.pkgOptions.otherAFPHostPropertyCode),e.onOtherAFPDomainChange(e.pkgOptions.otherAFPDomain)):e.onAFPHostPropertyCodeChange(e.renderList[0].value)},async init(){var e=this;if(!e.renderList.length){try{var t={"cache-control":"no-cache"},o=(await axios_1.default.get("https://adsense.cocos.com/agent.json",{headers:t})).data.map(e=>({label:e.name,value:e.code,domain:e.domain}));e.renderList=o}catch(e){console.warn("query AFPHostPropertyCodeList failed!"),console.warn(e)}e.renderList.push({value:"other",label:"i18n:adsense-h5g-plugin.options.otherAFPHostPropertyCode"})}e.updateOptions()},onDataChange(e){var t=e.target.getAttribute("path");if(t){var o=e.target.value,a=this;switch(t){case"otherAFPHostPropertyCode":return a.onOtherAFPHostPropertyCodeChange(o);case"otherAFPDomain":return a.onOtherAFPDomainChange(o);case"AFPHostPropertyCode":return a.onAFPHostPropertyCodeChange(o)}}},onAFPHostPropertyCodeChange(t){var e,o=this;o.afterChange("AFPHostPropertyCode",t,null),"other"===t?(o.onOtherAFPHostPropertyCodeChange(o.pkgOptions.otherAFPHostPropertyCode),o.onOtherAFPDomainChange(o.pkgOptions.otherAFPDomain)):((e=o.renderList.find(e=>e.value===t))&&o.afterChange("AFPHostDomain",e.domain,null),o.afterChange("otherAFPHostPropertyCode","",null),o.afterChange("otherAFPDomain","",null))},onOtherAFPHostPropertyCodeChange(e){var t=new RegExp("^ca-host-pub-\\d+$");let o=null;""===e||t.test(e)||(o="i18n:adsense-h5g-plugin.adsensePropertyCodeRule_msg");this.afterChange("otherAFPHostPropertyCode",e,o)},onOtherAFPDomainChange(e){this.afterChange("otherAFPDomain",e,null)},afterChange(e,t,o){var a=this;a.pkgOptions[e]===t&&a.pkgErrorMap[e]===o||(a.$set(a.pkgOptions,e,t),a.$set(a.pkgErrorMap,e,o),panel.dispatch("update",`packages.${PKG_NAME}.`+e,t,o))}},async mounted(){await this.init(),this.pkgOptions.enableAdsense=await Editor.Profile.getProject(panel.pkgName,"enableAdsense"),panel.dispatch("update",`packages.${PKG_NAME}.enableAdsense`,this.pkgOptions.enableAdsense,null)}};function update(e,t){panel=this,t&&!t.startsWith("packages."+panel.pkgName)||(e=lodash_1.default.get(e,t),t===`packages.${panel.pkgName}.enableAdsense`&&Editor.Profile.setProject(panel.pkgName,"enableAdsense",e),e!==lodash_1.default.get(panel.options,t)&&(lodash_1.default.set(panel.options,t,e),panel.vm.init()))}function ready(e,t,o){panel=this;var a=require("vue/dist/vue.js");panel.options=e,panel.pkgName=o,panel.vm=new a(Object.assign({el:panel.$.root},component))}exports.data={vm:null},exports.$={root:".adsense-h5g-plugin"},exports.update=update,exports.ready=ready;