"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPreviewUrl=exports.load=exports.methods=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),server_1=require("./server"),lodash=require("lodash");async function load(){setPreviewPathFromTask().catch(e=>{console.error(e)})}async function setPreviewPathFromTask(){var e=await Editor.Profile.getConfig("builder","BuildTaskManager.taskMap")||{};Object.values(e).forEach(e=>{var r,t;1===e.progress&&(t=lodash.get(e,"options.platform"),r=lodash.get(e,"options.buildPath"),"web-desktop"===t)&&"string"==typeof r&&(t=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(r),e.options.outputName),(0,server_1.setRootPath)(t))})}async function getPreviewUrl(e,r=!1){var t=await Editor.Message.request("preview","query-preview-url"),o=new URL(t);return r&&"http:"===o.protocol?`http://localhost:${await Editor.Message.request("server","query-port")}/web-desktop/${e}/index.html`:t+`/web-desktop/${e}/index.html`}exports.methods={async preview(e,r=!1){return(0,server_1.setRootPath)(e),Editor.Message.send("program","open-url",await getPreviewUrl((0,path_1.basename)(e),r)),!0},"set-preview-path"(e){return!!(0,fs_extra_1.existsSync)(e)&&((0,server_1.setRootPath)(e),!0)}},exports.load=load,exports.getPreviewUrl=getPreviewUrl;