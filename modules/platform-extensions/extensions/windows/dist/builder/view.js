"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.update=exports.ready=exports.$=exports.template=void 0;const fs_1=require("fs"),path_1=require("path"),utils_1=require("./utils"),lodash=require("lodash");let panel;const defaultOptions={renderBackEnd:{vulkan:!1,gles3:!0,gles2:!1}};function ready(e,a,t,n){panel=this;var r=BuildPanel.Vue;panel.options=e,panel.pkgName=t,panel.errorMap=n,panel.vm=new r({el:panel.$.root,data(){return{pkgOptions:defaultOptions,pkgErrorMap:{},vsData:[]}},mounted(){this.init()},methods:{t(e,a){return Editor.I18n.t("windows."+e,a)},async init(){var e=this,a=(e.pkgOptions=lodash.get(panel.options,"packages.windows")||{},await Editor.Profile.getConfig("windows","vsData")),a=(a?e.vsData=a:(e.vsData=[],a=await(0,utils_1.queryVisualStudioVersion)(),e.vsData=a||[],a=0<a.length?a[0].value:"",lodash.set(panel.options,"packages.windows.vsData",a),await Editor.Profile.setConfig("windows","vsData",e.vsData)),await verificationFunc("renderBackEnd",e.pkgOptions.renderBackEnd));e.$set(e.pkgErrorMap,"renderBackEnd",a.error),e.emitChange()},async onGLES23Change(e){var a=this,e=e.target.value,e=(a.pkgOptions.renderBackEnd=e?Object.assign(a.pkgOptions.renderBackEnd,{gles3:!0}):Object.assign(a.pkgOptions.renderBackEnd,{gles2:!1,gles3:!1}),await verificationFunc("renderBackEnd",a.pkgOptions.renderBackEnd));a.$set(a.pkgErrorMap,"renderBackEnd",e.error),panel.dispatch("update",`packages.${panel.pkgName}.renderBackEnd`,a.pkgOptions.renderBackEnd,e.error)},async onChange(e){var a=this,t=e.target.value,e=e.target.getAttribute("path");lodash.set(a.pkgOptions,e,t),e&&e.startsWith("renderBackEnd.")&&(t=await verificationFunc("renderBackEnd",a.pkgOptions.renderBackEnd),a.$set(a.pkgErrorMap,"renderBackEnd",t.error)),a.emitChange()},async onVsData(e){var a=await(0,utils_1.queryVisualStudioVersion)(),a=(this.vsData=a||[],0<a.length?a[0].value:"");lodash.set(panel.options,"packages.windows.vsData",a),await Editor.Profile.setConfig("windows","vsData",this.vsData)},emitChange(){panel.dispatch("update","packages."+panel.pkgName,this.pkgOptions,this.pkgErrorMap)}}})}function update(e,a){panel=this,a&&!a.startsWith("packages."+panel.pkgName)||(panel.options=e,panel.vm.init())}async function verificationFunc(e,a){var t={error:"",newValue:a,level:!0};return"renderBackEnd"===e&&Object.keys(a).every(e=>!a[e])&&(t.error=Editor.I18n.t("windows.tips.at_least_one")),t}exports.template=(0,fs_1.readFileSync)((0,path_1.join)(__dirname,"../../static/view.html"),"utf8"),exports.$={root:".windows"},exports.ready=ready,exports.update=update;