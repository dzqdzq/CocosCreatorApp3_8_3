"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.onAfterBundleInit=exports.onAfterInit=exports.throwError=void 0;const path_1=__importDefault(require("path")),os_1=__importDefault(require("os")),fs_extra_1=require("fs-extra");function localWhich(t){var e=[t];const r="win32"===os_1.default.platform();r&&e.push(t+".exe");t=r?null==(t=process.env.PATH)?void 0:t.split(";"):null==(t=process.env.PATH)?void 0:t.split(":");if(t&&0!==t.length)for(const n of t)if(0<e.filter(t=>{if(!(0,fs_extra_1.existsSync)(path_1.default.join(n,t)))return!1;if(r)return!0;try{return(0,fs_extra_1.accessSync)(path_1.default.join(n,t),fs_extra_1.constants.X_OK),!0}catch(t){return!1}}).length)return n;return null}async function generateOptions(t){var t=t.packages.ohos,e=(t.orientation=t.orientation||{},await Editor.Message.request("program","query-program-info","ohosSDK")),r=await Editor.Message.request("program","query-program-info","ohosNDK");if(t.sdkPath=e?e.path:"",t.ndkPath=r?r.path:"",t.sdkPath&&t.ndkPath)return{packageName:t.packageName||"",orientation:{landscapeRight:null==(e=t.orientation.landscapeRight)||e,landscapeLeft:null==(r=t.orientation.landscapeLeft)||r,portrait:null!=(e=t.orientation.portrait)&&e,upsideDown:null!=(r=t.orientation.upsideDown)&&r},apiLevel:t.apiLevel||26,sdkPath:t.sdkPath||"",ndkPath:t.ndkPath||"",renderBackEnd:{gles3:null==(r=null==(e=t.renderBackEnd)?void 0:e.gles3)||r}};throw new Error(Editor.I18n.t("ohos.tips.ohos_sdk_error"))}async function onAfterInit(t,e,r){var n=await generateOptions(t);const o=(t.packages.ohos=n).renderBackEnd;o&&Object.keys(o).forEach(t=>{e.compileOptions.cMakeConfig["CC_USE_"+t.toUpperCase()]=o[t]}),Object.assign(e.compileOptions.platformParams,n),await(0,fs_extra_1.outputJSON)(e.paths.compileConfig,e.compileOptions),e.staticsInfo.B100005=n.packageName,e.staticsInfo.B100011=n.orientation}function onAfterBundleInit(t){var e;t.assetSerializeOptions["cc.EffectAsset"].glsl3=null==(e=t.packages.ohos.renderBackEnd.gles3)||e,t.buildScriptParam.platform="OHOS"}exports.throwError=!0,exports.onAfterInit=onAfterInit,exports.onAfterBundleInit=onAfterBundleInit;