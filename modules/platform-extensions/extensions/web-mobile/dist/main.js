"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=exports.methods=void 0;const path_1=require("path"),fs_extra_1=require("fs-extra"),server_1=require("./server"),utils_1=require("./utils"),lodash=require("lodash");async function load(){setPreviewPathFromTask().catch(e=>{console.error(e)})}async function setPreviewPathFromTask(){var e=await Editor.Profile.getConfig("builder","BuildTaskManager.taskMap")||{};Object.values(e).forEach(e=>{var t,r;1===e.progress&&(r=lodash.get(e,"options.platform"),t=lodash.get(e,"options.buildPath"),"web-mobile"===r)&&"string"==typeof t&&(r=(0,path_1.join)(Editor.UI.__protected__.File.resolveToRaw(t),e.options.outputName),(0,server_1.setRootPath)(r))})}exports.methods={async preview(e,t=!1){(0,server_1.setRootPath)(e);e=await(0,utils_1.getPreviewUrl)((0,path_1.basename)(e),t);return Editor.Message.send("program","open-url",e),e},async"set-preview-path"(e){(0,server_1.setRootPath)(e);var t=await(0,utils_1.getPreviewUrl)((0,path_1.basename)(e));return(0,fs_extra_1.existsSync)(e),t}},exports.load=load;