"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.methods=exports.computed=exports.data=exports.created=exports.name=exports.template=void 0;const fs_extra_1=require("fs-extra"),path_1=require("path"),huawei=require("./lib/huawei"),phone_1=require("../../utils/phone"),log_1=require("../../utils/log"),info_1=require("../../utils/info");async function created(){this.register_handler(),await huawei.checkRuntimeVersion(),this.rpkPath=await huawei.getRpkPath()}function data(){return{rpkPath:"",params:"",huaweiPlugin:huawei}}exports.template=(0,fs_extra_1.readFileSync)((0,path_1.join)(__dirname,"../../../static/plugins/huawei/ui.html"),"utf-8"),exports.name="huawei-runtime",exports.created=created,exports.data=data,exports.computed={runDisabled(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free},cancelDisabled(){return this.huaweiPlugin.state!==huawei.RUNTIME_STATE.free}},exports.methods={t(e){return Editor.I18n.t(e)},paramsChange(e){this.params=e.target.value},rpkSelected(e){this.rpkPath=e.target.value},register_handler(){phone_1.phone.on("add_device",async e=>{huawei.needToCreatLogcat(e)&&(await huawei.checkRuntime(),huawei.openLogcat(e))}),phone_1.phone.on("remove_device",e=>{})},async installApk(){await huawei.installRuntime()},async onChooseRpkPath(e){e.stopPropagation();e=await Editor.Dialog.select({path:(0,path_1.join)(Editor.Project.path,"/build"),type:"file",filters:[{name:this.t("runtime-dev-tools.huawei")+" runtime rpk",extensions:["rpk"]}]});e.filePaths&&e.filePaths[0]&&(this.rpkPath=e.filePaths[0])},getLaunchParams(){var t=this,e=["--ei","debugmode","1"];if(t.uri&&(e.push("--es"),e.push("uri"),e.push(encodeURIComponent(t.uri))),t.params)try{JSON.parse(t.params),e.push("--es"),e.push("params"),e.push(encodeURIComponent(t.params))}catch(e){log_1.log.warn(t.t("runtime-dev-tools.error_params"))}return e.join(" ")},async launch(){var e=this;(0,fs_extra_1.existsSync)(e.rpkPath)?(await huawei.stopRuntime(),await huawei.pushRpkToPhone(e.rpkPath),await huawei.startRuntimeWithRpk((0,path_1.basename)(e.rpkPath),e.getLaunchParams())):(log_1.log.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath),info_1.info.error(e.t("runtime-dev-tools.can_not_find_rpk"),e.rpkPath))},async stop(){await huawei.stopRuntime()}};